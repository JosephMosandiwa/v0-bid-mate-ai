(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,970065,e=>{"use strict";var s=e.i(375298),r=e.i(647163);function t({className:e,...t}){return(0,s.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...t})}function a({className:e,...t}){return(0,s.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...t})}function l({className:e,...t}){return(0,s.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-semibold",e),...t})}function n({className:e,...t}){return(0,s.jsx)("div",{"data-slot":"card-description",className:(0,r.cn)("text-muted-foreground text-sm",e),...t})}function d({className:e,...t}){return(0,s.jsx)("div",{"data-slot":"card-content",className:(0,r.cn)("px-6",e),...t})}function i({className:e,...t}){return(0,s.jsx)("div",{"data-slot":"card-footer",className:(0,r.cn)("flex items-center px-6 [.border-t]:pt-6",e),...t})}e.s(["Card",()=>t,"CardContent",()=>d,"CardDescription",()=>n,"CardFooter",()=>i,"CardHeader",()=>a,"CardTitle",()=>l])},692626,e=>{"use strict";let s=(0,e.i(197140).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>s],692626)},781947,e=>{"use strict";var s=e.i(375298),r=e.i(294237),t=e.i(647163);let a=(0,r.cva)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function l({className:e,variant:r,...l}){return(0,s.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,t.cn)(a({variant:r}),e),...l})}function n({className:e,...r}){return(0,s.jsx)("div",{"data-slot":"alert-title",className:(0,t.cn)("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",e),...r})}function d({className:e,...r}){return(0,s.jsx)("div",{"data-slot":"alert-description",className:(0,t.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",e),...r})}e.s(["Alert",()=>l,"AlertDescription",()=>d,"AlertTitle",()=>n])},492313,e=>{"use strict";let s=(0,e.i(197140).default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);e.s(["Download",()=>s],492313)},881660,e=>{"use strict";let s=(0,e.i(197140).default)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>s],881660)},740302,e=>{"use strict";let s=(0,e.i(197140).default)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",()=>s],740302)},752990,e=>{"use strict";var s=e.i(375298),r=e.i(769107),t=e.i(167881),a=e.i(970065),l=e.i(781947),n=e.i(692626),d=e.i(492313),i=e.i(881660),c=e.i(740302);let o=(0,e.i(197140).default)("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]);function h(){let[e,h]=(0,r.useState)(!1),[m,x]=(0,r.useState)(null),[u,j]=(0,r.useState)(null),[g,p]=(0,r.useState)(!1),[f,v]=(0,r.useState)(null),[C,N]=(0,r.useState)([]),[b,y]=(0,r.useState)(!1),[w,T]=(0,r.useState)(null),[S,A]=(0,r.useState)(!1),[F,k]=(0,r.useState)(null),D=async()=>{h(!0),j(null),x(null),N(["ðŸš€ Starting API fetch..."]);try{N(e=>[...e,"ðŸ“¡ Calling /api/fetch-all-api-tenders..."]);let e=await fetch("/api/fetch-all-api-tenders",{method:"POST"});N(s=>[...s,`âœ… API responded with status: ${e.status}`]);let s=await e.json();if(N(e=>[...e,`ðŸ“¦ Received data: ${JSON.stringify(s).substring(0,200)}...`]),!e.ok||!s.success&&0===s.totalSaved){j(s.error||"Failed to fetch tenders"),s.sources&&s.sources.length>0&&x(s),N(e=>[...e,`âŒ Fetch failed: ${s.error}`]);return}N(e=>[...e,`âœ… Success! Fetched ${s.totalFetched}, Saved ${s.totalSaved}`]),x(s)}catch(s){console.error("[v0] Error:",s);let e=s instanceof Error?s.message:"Unknown error";j(e),N(s=>[...s,`âŒ Exception: ${e}`])}finally{h(!1),N(e=>[...e,"ðŸ Fetch complete"])}},P=async()=>{p(!0),v(null);try{console.log("[v0] Running pipeline test...");let e=await fetch("/api/test-tender-flow",{method:"POST"}),s=await e.json();console.log("[v0] Test result:",s),v(s)}catch(e){console.error("[v0] Test error:",e),v({success:!1,error:e instanceof Error?e.message:"Unknown error"})}finally{p(!1)}},E=async()=>{y(!0),T(null),j(null);try{let e=await fetch("/api/etender-simple-fetch"),s=await e.json();T(s),s.success||j(s.error||"Simple fetch failed")}catch(s){console.error("[v0] Simple fetch error:",s);let e=s instanceof Error?s.message:"Unknown error";j(e),T({success:!1,error:e})}finally{y(!1)}},I=async()=>{A(!0),k(null),j(null);try{let e=await fetch("/api/admin/trigger-etender-api-scrape",{method:"POST"}),s=await e.json();k(s),s.success||j(s.error||"Engine scrape failed")}catch(s){console.error("[v0] Engine scrape error:",s);let e=s instanceof Error?s.message:"Unknown error";j(e),k({success:!1,error:e})}finally{A(!1)}};return(0,s.jsxs)("div",{className:"container mx-auto p-6 max-w-4xl",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"API Tender Fetcher"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-2",children:"Fetch tenders from all available South African tender APIs (eTender, EasyTenders, and more)"})]}),(0,s.jsxs)(a.Card,{className:"mb-6 border-blue-500",children:[(0,s.jsxs)(a.CardHeader,{children:[(0,s.jsx)(a.CardTitle,{children:"Engine-Integrated eTender Scrape (Recommended)"}),(0,s.jsx)(a.CardDescription,{children:"Fetch tenders through the full engine pipeline: eTender API â†’ TenderEngine (validation) â†’ Documind (documents) â†’ Strategist (opportunity matching) â†’ User alerts"})]}),(0,s.jsx)(a.CardContent,{children:(0,s.jsx)(t.Button,{onClick:I,disabled:S,size:"lg",className:"w-full",children:S?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing through Engine Pipeline..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.Download,{className:"mr-2 h-4 w-4"}),"Fetch via Engine Pipeline"]})})})]}),F&&(0,s.jsxs)(a.Card,{className:"mb-6",children:[(0,s.jsx)(a.CardHeader,{children:(0,s.jsx)(a.CardTitle,{className:"flex items-center gap-2",children:F.success?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.CheckCircle,{className:"h-5 w-5 text-green-500"}),"Engine Pipeline Success"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.XCircle,{className:"h-5 w-5 text-red-500"}),"Engine Pipeline Failed"]})})}),(0,s.jsx)(a.CardContent,{children:(0,s.jsxs)("div",{className:"space-y-3",children:[F.message&&(0,s.jsx)(l.Alert,{className:F.success?"border-green-500":"border-red-500",children:(0,s.jsx)(l.AlertDescription,{children:F.message})}),F.data&&(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Source:"})," ",F.data.sourceName]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Scraped:"})," ",F.data.scrapedCount," tenders"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Saved:"})," ",F.data.savedCount," tenders"]})]}),F.error&&(0,s.jsx)(l.Alert,{variant:"destructive",children:(0,s.jsx)(l.AlertDescription,{children:F.error})}),F.instructions&&(0,s.jsx)(l.Alert,{className:"border-yellow-500 bg-yellow-50",children:(0,s.jsxs)(l.AlertDescription,{className:"text-yellow-900",children:[(0,s.jsx)("strong",{children:"Setup Required:"})," ",F.instructions]})})]})})]}),(0,s.jsxs)(a.Card,{className:"mb-6",children:[(0,s.jsxs)(a.CardHeader,{children:[(0,s.jsx)(a.CardTitle,{children:"Pipeline Diagnostic Test"}),(0,s.jsx)(a.CardDescription,{children:"Test the entire tender pipeline to identify any issues before fetching real data"})]}),(0,s.jsx)(a.CardContent,{children:(0,s.jsx)(t.Button,{onClick:P,disabled:g,size:"lg",className:"w-full bg-transparent",variant:"outline",children:g?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Running Tests..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o,{className:"mr-2 h-4 w-4"}),"Run Full Pipeline Test"]})})})]}),f&&(0,s.jsxs)(a.Card,{className:"mb-6",children:[(0,s.jsx)(a.CardHeader,{children:(0,s.jsx)(a.CardTitle,{className:"flex items-center gap-2",children:f.success?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.CheckCircle,{className:"h-5 w-5 text-green-500"}),"All Tests Passed"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.XCircle,{className:"h-5 w-5 text-red-500"}),"Tests Failed"]})})}),(0,s.jsx)(a.CardContent,{children:(0,s.jsxs)("div",{className:"space-y-3",children:[f.steps?.map(e=>(0,s.jsxs)("div",{className:"flex items-start gap-3 p-3 border rounded-lg",children:["passed"===e.status?(0,s.jsx)(i.CheckCircle,{className:"h-5 w-5 text-green-500 flex-shrink-0 mt-0.5"}):"failed"===e.status?(0,s.jsx)(c.XCircle,{className:"h-5 w-5 text-red-500 flex-shrink-0 mt-0.5"}):(0,s.jsx)(n.Loader2,{className:"h-5 w-5 text-blue-500 animate-spin flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"font-semibold",children:["Step ",e.step,": ",e.name]}),e.error&&(0,s.jsx)("div",{className:"text-sm text-red-500 mt-1",children:e.error}),void 0!==e.currentCount&&(0,s.jsxs)("div",{className:"text-sm text-muted-foreground mt-1",children:["Current count: ",e.currentCount]}),e.tenderId&&(0,s.jsxs)("div",{className:"text-sm text-muted-foreground mt-1",children:["Created tender ID: ",e.tenderId]}),void 0!==e.totalTenders&&(0,s.jsxs)("div",{className:"text-sm text-muted-foreground mt-1",children:["Total tenders: ",e.totalTenders]})]})]},e.step)),f.message&&(0,s.jsx)(l.Alert,{className:f.success?"border-green-500":"border-red-500",children:(0,s.jsx)(l.AlertDescription,{children:f.message})})]})})]}),(0,s.jsxs)(a.Card,{className:"mb-6",children:[(0,s.jsxs)(a.CardHeader,{children:[(0,s.jsx)(a.CardTitle,{children:"Simple eTender Fetch (Direct)"}),(0,s.jsx)(a.CardDescription,{children:"Direct simplified fetch from eTenders API only - bypasses complex logic"})]}),(0,s.jsx)(a.CardContent,{children:(0,s.jsx)(t.Button,{onClick:E,disabled:b,size:"lg",className:"w-full",children:b?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Fetching from eTenders..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.Download,{className:"mr-2 h-4 w-4"}),"Simple eTender Fetch"]})})})]}),w&&(0,s.jsxs)(a.Card,{className:"mb-6",children:[(0,s.jsx)(a.CardHeader,{children:(0,s.jsx)(a.CardTitle,{className:"flex items-center gap-2",children:w.success?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.CheckCircle,{className:"h-5 w-5 text-green-500"}),"Simple Fetch Success"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.XCircle,{className:"h-5 w-5 text-red-500"}),"Simple Fetch Failed"]})})}),(0,s.jsx)(a.CardContent,{children:(0,s.jsxs)("div",{className:"space-y-3",children:[w.message&&(0,s.jsx)(l.Alert,{className:w.success?"border-green-500":"border-red-500",children:(0,s.jsx)(l.AlertDescription,{children:w.message})}),void 0!==w.fetched&&(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsx)("strong",{children:"Fetched:"})," ",w.fetched," tenders"]}),void 0!==w.saved&&(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsx)("strong",{children:"Saved:"})," ",w.saved," tenders"]}),w.sampleTender&&(0,s.jsxs)("details",{className:"text-xs",children:[(0,s.jsx)("summary",{className:"cursor-pointer font-semibold",children:"Sample Tender Data"}),(0,s.jsx)("pre",{className:"mt-2 p-2 bg-gray-100 rounded overflow-auto max-h-60",children:JSON.stringify(w.sampleTender,null,2)})]}),w.error&&(0,s.jsx)(l.Alert,{variant:"destructive",children:(0,s.jsx)(l.AlertDescription,{children:w.error})})]})})]}),(0,s.jsxs)(a.Card,{children:[(0,s.jsxs)(a.CardHeader,{children:[(0,s.jsx)(a.CardTitle,{children:"Fetch Latest Tenders from All API Sources"}),(0,s.jsx)(a.CardDescription,{children:"This will fetch tenders from all available APIs (eTender OCDS, EasyTenders) from the last 30 days"})]}),(0,s.jsxs)(a.CardContent,{children:[(0,s.jsx)(t.Button,{onClick:D,disabled:e,size:"lg",className:"w-full",children:e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Fetching from All API Sources..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.Download,{className:"mr-2 h-4 w-4"}),"Fetch from All APIs"]})}),C.length>0&&(0,s.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg border",children:[(0,s.jsx)("h4",{className:"font-semibold mb-2 text-sm",children:"Live Progress:"}),(0,s.jsx)("div",{className:"space-y-1 text-sm font-mono max-h-60 overflow-y-auto",children:C.map((e,r)=>(0,s.jsx)("div",{className:"text-gray-700",children:e},r))})]})]})]}),u&&(0,s.jsxs)(l.Alert,{variant:"destructive",className:"mt-6",children:[(0,s.jsx)(c.XCircle,{className:"h-4 w-4"}),(0,s.jsxs)(l.AlertDescription,{children:[(0,s.jsx)("strong",{children:"Error:"})," ",u]})]}),m&&(0,s.jsxs)(a.Card,{className:"mt-6",children:[(0,s.jsxs)(a.CardHeader,{children:[(0,s.jsx)(a.CardTitle,{className:"flex items-center gap-2",children:m.success?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.CheckCircle,{className:"h-5 w-5 text-green-500"}),"Success!"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.XCircle,{className:"h-5 w-5 text-yellow-500"}),"Partial Success"]})}),(0,s.jsxs)(a.CardDescription,{children:["Database had ",m.beforeCount," tenders before fetch. After fetching ",m.totalFetched," tenders from APIs and saving ",m.totalSaved,", database now has ",m.afterCount," tenders (",m.newTenders," ","new, ",m.totalSaved-m.newTenders," updated)."]})]}),(0,s.jsx)(a.CardContent,{children:(0,s.jsxs)("div",{className:"space-y-4",children:[0===m.newTenders&&m.totalSaved>0&&(0,s.jsx)(l.Alert,{className:"border-blue-500 bg-blue-50",children:(0,s.jsxs)(l.AlertDescription,{className:"text-blue-900",children:[(0,s.jsx)("strong",{children:"Note:"})," All ",m.totalSaved," tenders from the API already existed in the database and were updated. No genuinely new tenders were added. This means the system is working correctly and preventing duplicates."]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold mb-3",children:"Results by Source"}),(0,s.jsx)("div",{className:"space-y-3",children:m.sources?.map((e,r)=>(0,s.jsx)("div",{className:`p-4 rounded-lg border ${e.error?"border-red-200 bg-red-50":e.saved>0?"border-green-200 bg-green-50":"border-gray-200 bg-gray-50"}`,children:(0,s.jsx)("div",{className:"flex items-start justify-between",children:(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"font-semibold flex items-center gap-2",children:[e.error?(0,s.jsx)(c.XCircle,{className:"h-4 w-4 text-red-500"}):e.saved>0?(0,s.jsx)(i.CheckCircle,{className:"h-4 w-4 text-green-500"}):(0,s.jsx)(c.XCircle,{className:"h-4 w-4 text-gray-400"}),e.name]}),e.error?(0,s.jsx)("div",{className:"text-sm text-red-600 mt-1",children:e.error}):(0,s.jsxs)("div",{className:"text-sm text-muted-foreground mt-1",children:["Fetched: ",e.fetched," | Saved: ",e.saved]})]})})},r))})]}),(0,s.jsx)(l.Alert,{children:(0,s.jsxs)(l.AlertDescription,{children:["Go to ",(0,s.jsx)("strong",{children:"/dashboard/search"})," to view the newly fetched tenders"]})})]})})]})]})}e.s(["default",()=>h],752990)}]);