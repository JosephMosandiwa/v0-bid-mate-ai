module.exports=[288495,e=>{"use strict";var t=e.i(248749),r=e.i(219650),a=e.i(508677),s=e.i(615159),n=e.i(548938),i=e.i(273073),o=e.i(129714),l=e.i(403736),d=e.i(817889),u=e.i(428765),c=e.i(762198),g=e.i(117109),p=e.i(590702),h=e.i(462216),f=e.i(539401),R=e.i(222695),y=e.i(193695);e.i(31514);var m=e.i(267074),w=e.i(303826),v=e.i(89660);e.i(754105);var _=e.i(161513),E=e.i(274506);async function S(e){try{var t,r,a,s;let n,i,o,l,d,u,c,g,p=await (0,v.createClient)(),{data:{user:h}}=await p.auth.getUser();if(!h)return Response.json({error:"Unauthorized"},{status:401});let{tender_id:f,strategy_type:R="bid",title:y}=await e.json();if(!f)return Response.json({error:"Tender ID is required"},{status:400});let{data:m}=await p.from("user_tenders").select("*").eq("id",f).single();if(!m)return Response.json({error:"Tender not found"},{status:404});console.log("[Strategist] Generating strategy for THIS SPECIFIC TENDER:",f,m.title),console.log("[Strategist] Strategy type:",R);let{data:S}=await p.from("user_custom_tender_analysis").select("analysis_data").eq("tender_id",f).single();if(!S?.analysis_data)return Response.json({error:"Tender analysis not found. Please analyze the tender first."},{status:404});let T=await _.StrategistService.buildContext(h.id,f,"strategy"),C=`ðŸŽ¯ **YOU ARE CREATING A STRATEGY FOR THIS SPECIFIC TENDER:**

**Tender Title:** "${m.title}"
**Organization:** ${m.organization||"Not specified"}
**Deadline:** ${m.deadline||"Not specified"}
**Value:** ${m.value||"Not specified"}
**Description:** ${m.description||"No description provided"}

ðŸš¨ **CRITICAL INSTRUCTION:**
- EVERY piece of strategy MUST reference THIS specific tender: "${m.title}"
- Do NOT provide generic tender strategies
- Tailor EVERYTHING to winning THIS particular opportunity
- Reference the organization (${m.organization||"this client"}) throughout
- Consider THIS tender's deadline: ${m.deadline||"upcoming"}
- Focus on THIS tender's value: ${m.value||"the tender value"}

${(0,E.buildStrategyGenerationPrompt)(R,S.analysis_data,T)}

Remember: You are NOT creating a general strategy template. You are creating a specific, actionable strategy to win "${m.title}" from ${m.organization||"this organization"}.`;console.log("[Strategist] Generating tender-specific strategy with AI...");let{text:x}=await (0,w.default)({model:"openai/gpt-4-turbo",prompt:C,temperature:.6,maxTokens:4e3});try{let e=x.trim();e.startsWith("```json")&&(e=e.slice(7)),e.startsWith("```")&&(e=e.slice(3)),e.endsWith("```")&&(e=e.slice(0,-3)),g=JSON.parse(e.trim())}catch(e){return console.error("[Strategist] Failed to parse strategy:",e),Response.json({error:"Failed to generate strategy"},{status:500})}let N=A(g),I=(t=g,n=t.risk_mitigation_plan?.length||0,i=t.compliance_strategy?.gaps?.length||0,(o=n+i+(t.strengths_weaknesses?.weaknesses?.length||0))>10?"critical":o>6?"high":o>3?"medium":"low"),j=(r=g,a=T,l=.3+.3*A(r),a.user_preferences?.experience_level==="advanced"?l+=.15:a.user_preferences?.experience_level==="intermediate"&&(l+=.1),a.user_preferences?.has_tax_clearance&&a.user_preferences?.has_csd_registration&&(l+=.1),Math.max(.1,Math.min(.85,l))),b=(s=g,d=s.strengths_weaknesses?.strengths?.length||0,u=s.strengths_weaknesses?.weaknesses?.length||0,c=s.risk_mitigation_plan?.length||0,`Strategy analysis complete with ${d} strengths identified, ${u} areas for improvement, and ${c} risks with mitigation plans.`),{data:O,error:P}=await p.from("strategist_strategies").insert({user_id:h.id,tender_id:f,title:y||`${R.charAt(0).toUpperCase()+R.slice(1)} Strategy`,strategy_type:R,content:g,summary:b,viability_score:N,risk_level:I,win_probability:j,status:"draft"}).select().single();if(P)return console.error("[Strategist] Error saving strategy:",P),Response.json({error:"Failed to save strategy"},{status:500});return console.log("[Strategist] Strategy generated and saved:",O.id),Response.json({strategy:O,message:"Strategy generated successfully"})}catch(e){return console.error("[Strategist] Strategy generation error:",e),Response.json({error:"Failed to generate strategy"},{status:500})}}async function T(e){try{let t=await (0,v.createClient)(),{data:{user:r}}=await t.auth.getUser();if(!r)return Response.json({error:"Unauthorized"},{status:401});let{searchParams:a}=new URL(e.url),s=a.get("tender_id"),n=a.get("status"),i=t.from("strategist_strategies").select("*").eq("user_id",r.id).order("created_at",{ascending:!1});s&&(i=i.eq("tender_id",s)),n&&(i=i.eq("status",n));let{data:o,error:l}=await i;if(l)return console.error("[Strategist] Error fetching strategies:",l),Response.json({error:"Failed to fetch strategies"},{status:500});return Response.json({strategies:o||[]})}catch(e){return console.error("[Strategist] GET strategies error:",e),Response.json({error:"Failed to fetch strategies"},{status:500})}}async function C(e){try{let t=await (0,v.createClient)(),{data:{user:r}}=await t.auth.getUser();if(!r)return Response.json({error:"Unauthorized"},{status:401});let{searchParams:a}=new URL(e.url),s=a.get("id");if(!s)return Response.json({error:"Strategy ID is required"},{status:400});let{data:n}=await t.from("strategist_strategies").select("id").eq("id",s).eq("user_id",r.id).single();if(!n)return Response.json({error:"Strategy not found"},{status:404});let{error:i}=await t.from("strategist_strategies").delete().eq("id",s).eq("user_id",r.id);if(i)return console.error("[Strategist] Error deleting strategy:",i),Response.json({error:"Failed to delete strategy"},{status:500});return Response.json({success:!0,message:"Strategy deleted"})}catch(e){return console.error("[Strategist] DELETE strategy error:",e),Response.json({error:"Failed to delete strategy"},{status:500})}}async function x(e){try{let t=await (0,v.createClient)(),{data:{user:r}}=await t.auth.getUser();if(!r)return Response.json({error:"Unauthorized"},{status:401});let{strategy_id:a,updates:s}=await e.json();if(!a)return Response.json({error:"Strategy ID is required"},{status:400});let n={};for(let e of["title","status","summary"])void 0!==s[e]&&(n[e]=s[e]);if(0===Object.keys(n).length)return Response.json({error:"No valid updates provided"},{status:400});n.updated_at=new Date().toISOString();let{data:i,error:o}=await t.from("strategist_strategies").update(n).eq("id",a).eq("user_id",r.id).select().single();if(o)return console.error("[Strategist] Error updating strategy:",o),Response.json({error:"Failed to update strategy"},{status:500});return Response.json({strategy:i})}catch(e){return console.error("[Strategist] PATCH strategy error:",e),Response.json({error:"Failed to update strategy"},{status:500})}}function A(e){let t=.5,r=e.strengths_weaknesses?.strengths?.length||0,a=e.strengths_weaknesses?.weaknesses?.length||0;r>a?t+=.15:a>r&&(t-=.1);let s=e.compliance_strategy?.requirements||[],n=s.filter(e=>"met"===e.status).length;s.length>0&&(t+=n/s.length*.2);let i=e.risk_mitigation_plan?.length||0;return i>5?t-=.1:i<3&&(t+=.1),Math.max(.1,Math.min(.95,t))}e.s(["DELETE",()=>C,"GET",()=>T,"PATCH",()=>x,"POST",()=>S,"maxDuration",0,60],609740);var N=e.i(609740);let I=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/strategist/strategy/route",pathname:"/api/strategist/strategy",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/strategist/strategy/route.ts",nextConfigOutput:"",userland:N}),{workAsyncStorage:j,workUnitAsyncStorage:b,serverHooks:O}=I;function P(){return(0,a.patchFetch)({workAsyncStorage:j,workUnitAsyncStorage:b})}async function U(e,t,a){I.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/strategist/strategy/route";w=w.replace(/\/index$/,"")||"/";let v=await I.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:_,params:E,nextConfig:S,parsedUrl:T,isDraftMode:C,prerenderManifest:x,routerServerContext:A,isOnDemandRevalidate:N,revalidateOnlyGenerated:j,resolvedPathname:b,clientReferenceManifest:O,serverActionsManifest:P}=v,U=(0,l.normalizeAppPath)(w),q=!!(x.dynamicRoutes[U]||x.routes[b]),k=async()=>((null==A?void 0:A.render404)?await A.render404(e,t,T,!1):t.end("This page could not be found"),null);if(q&&!C){let e=!!x.routes[b],t=x.dynamicRoutes[U];if(t&&!1===t.fallback&&!e){if(S.experimental.adapterPath)return await k();throw new y.NoFallbackError}}let H=null;!q||I.isDev||C||(H="/index"===(H=b)?"/":H);let D=!0===I.isDev||!q,$=q&&!D;P&&O&&(0,i.setReferenceManifestsSingleton)({page:w,clientReferenceManifest:O,serverActionsManifest:P,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:P})});let F=e.method||"GET",M=(0,n.getTracer)(),z=M.getActiveScopeSpan(),G={params:E,prerenderManifest:x,renderOpts:{experimental:{authInterrupts:!!S.experimental.authInterrupts},cacheComponents:!!S.cacheComponents,supportsDynamicResponse:D,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:S.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>I.onRequestError(e,t,a,A)},sharedContext:{buildId:_}},L=new d.NodeNextRequest(e),K=new d.NodeNextResponse(t),V=u.NextRequestAdapter.fromNodeNextRequest(L,(0,u.signalFromNodeResponse)(t));try{let i=async e=>I.handle(V,G).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=M.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${F} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${w}`)}),o=!!(0,s.getRequestMeta)(e,"minimalMode"),l=async s=>{var n,l;let d=async({previousCacheEntry:r})=>{try{if(!o&&N&&j&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await i(s);e.fetchMetrics=G.renderOpts.fetchMetrics;let l=G.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let d=G.renderOpts.collectedTags;if(!q)return await (0,p.sendResponse)(L,K,n,G.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(n.headers);d&&(t[R.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==G.renderOpts.collectedRevalidate&&!(G.renderOpts.collectedRevalidate>=R.INFINITE_CACHE)&&G.renderOpts.collectedRevalidate,a=void 0===G.renderOpts.collectedExpire||G.renderOpts.collectedExpire>=R.INFINITE_CACHE?void 0:G.renderOpts.collectedExpire;return{value:{kind:m.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await I.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,g.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:N})},A),t}},u=await I.handleResponse({req:e,nextConfig:S,cacheKey:H,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:x,isRoutePPREnabled:!1,isOnDemandRevalidate:N,revalidateOnlyGenerated:j,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:o});if(!q)return null;if((null==u||null==(n=u.value)?void 0:n.kind)!==m.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",N?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,h.fromNodeOutgoingHttpHeaders)(u.value.headers);return o&&q||c.delete(R.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,f.getCacheControlHeader)(u.cacheControl)),await (0,p.sendResponse)(L,K,new Response(u.value.body,{headers:c,status:u.value.status||200})),null};z?await l(z):await M.withPropagatedContext(e.headers,()=>M.trace(c.BaseServerSpan.handleRequest,{spanName:`${F} ${w}`,kind:n.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},l))}catch(t){if(t instanceof y.NoFallbackError||await I.onRequestError(e,t,{routerKind:"App Router",routePath:U,routeType:"route",revalidateReason:(0,g.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:N})}),q)throw t;return await (0,p.sendResponse)(L,K,new Response(null,{status:500})),null}}e.s(["handler",()=>U,"patchFetch",()=>P,"routeModule",()=>I,"serverHooks",()=>O,"workAsyncStorage",()=>j,"workUnitAsyncStorage",()=>b],288495)}];

//# sourceMappingURL=38113_next_dist_esm_build_templates_app-route_028f2f67.js.map