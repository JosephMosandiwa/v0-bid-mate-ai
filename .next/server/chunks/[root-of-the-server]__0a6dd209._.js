module.exports=[918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},89660,e=>{"use strict";e.i(929961);var t=e.i(771884),r=e.i(875216);async function o(){let e=await (0,r.cookies)();return(0,t.createServerClient)("https://xqyecqkrtaydoesxnvlw.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhxeWVjcWtydGF5ZG9lc3hudmx3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEzMjM0NTgsImV4cCI6MjA3Njg5OTQ1OH0.wsb5Jz_I9RqxoNoZ6D3QPbK4aefbdGKcrGgWDfm3c4o",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:o})=>e.set(t,r,o))}catch{}}}})}e.s(["createClient",()=>o,"createServerClient",0,o])},46327,e=>{"use strict";var t=e.i(248749),r=e.i(219650),o=e.i(508677),n=e.i(615159),a=e.i(548938),s=e.i(273073),l=e.i(129714),i=e.i(403736),d=e.i(817889),c=e.i(428765),u=e.i(762198),p=e.i(117109),g=e.i(590702),f=e.i(462216),h=e.i(539401),m=e.i(222695),v=e.i(193695);e.i(31514);var x=e.i(267074),R=e.i(89660);e.i(801612);var w=e.i(430497),b=e.i(747402),C=e.i(521854);async function y(e,t){try{let{id:r}=t?.params?await t.params:t?.params??t,{documentId:o}=await e.json(),n=await (0,R.createClient)();console.log("[v0] ========================================"),console.log("[v0] MAKE PDF EDITABLE REQUEST"),console.log("[v0] ========================================"),console.log("[v0] Tender ID:",r),console.log("[v0] Document ID:",o);let{data:{user:a}}=await n.auth.getUser();if(!a)return console.log("[v0] Unauthorized - no user"),Response.json({error:"Unauthorized"},{status:401});console.log("[v0] User ID:",a.id);let{data:s,error:l}=await n.from("user_custom_tenders").select("*").eq("id",r).single();if(l||!s)return console.log("[v0] Tender not found:",l),Response.json({error:"Tender not found"},{status:404});console.log("[v0] Tender found:",s.title);let{data:i}=await n.from("user_custom_tender_responses").select("*").eq("tender_id",r).eq("user_id",a.id).single(),d=i?.response_data||{},c=s.form_fields||[];console.log("[v0] Form responses:",Object.keys(d).length),console.log("[v0] Form fields:",c.length);let u=c;0===u.length&&Object.keys(d).length>0&&(console.log("[v0] No form fields defined, generating from responses..."),u=Object.entries(d).map(([e,t],r)=>({id:e,label:e.replace(/_/g," ").replace(/-/g," ").replace(/([A-Z])/g," $1").trim(),type:"text",section:"Responses",required:!1,order:r})),console.log("[v0] Generated",u.length,"fields from responses"));let p=s.document_url;if(o){console.log("[v0] Fetching document by ID:",o);let{data:e,error:t}=await n.from("user_custom_tender_documents").select("blob_url").eq("id",o).eq("tender_id",r).single();if(t||!e)return console.log("[v0] Document not found:",t),Response.json({error:"Document not found"},{status:404});p=e.blob_url,console.log("[v0] Found document URL from document ID")}if(!p)return console.log("[v0] No document URL found"),Response.json({error:"No document URL found"},{status:404});console.log("[v0] Fetching original PDF from:",p);let g=await fetch(p);if(!g.ok)throw console.log("[v0] Failed to fetch PDF, status:",g.status),Error("Failed to fetch original PDF");let f=await g.arrayBuffer(),h=await w.PDFDocument.load(f);console.log("[v0] Loaded PDF with",h.getPageCount(),"pages");let m=h.getForm(),v=m.getFields();if(console.log("[v0] PDF has",v.length,"existing form fields"),v.length>0){console.log("[v0] PDF already has form fields, filling them...");let e=0;for(let t of v){let r=t.getName();console.log("[v0] Processing field:",r);let o=Object.entries(d).find(([e,t])=>[e,e.toLowerCase(),e.replace(/_/g," "),e.replace(/-/g," "),e.replace(/([A-Z])/g," $1").trim()].some(e=>r.toLowerCase().includes(e.toLowerCase())));if(o){let[,n]=o;try{t instanceof b.PDFTextField?(t.setText(String(n)),e++,console.log("[v0] ✓ Filled text field:",r,"with:",n)):t instanceof b.PDFCheckBox&&(t.check(),e++,console.log("[v0] ✓ Checked checkbox:",r))}catch(e){console.error("[v0] Error filling field:",r,e)}}}console.log("[v0] Filled",e,"out of",v.length,"fields");let t=await h.save();return new Response(t,{headers:{"Content-Type":"application/pdf","Content-Disposition":`attachment; filename="editable_tender_${s.title?.replace(/[^a-z0-9]/gi,"_").toLowerCase()||"document"}.pdf"`,"X-Fields-Added":String(v.length),"X-Fields-Filled":String(e)}})}if(console.log("[v0] PDF has no form fields, adding fields at standard positions..."),0===u.length)return console.log("[v0] No form fields or responses available"),Response.json({error:"No form fields or responses available. Please fill out the tender form first."},{status:400});let x=0,y=0,E=h.getPage(y),{height:P}=E.getSize(),_=u.reduce((e,t)=>{let r=t.section||"General";return e[r]||(e[r]=[]),e[r].push(t),e},{}),F=P-100;for(let[e,t]of Object.entries(_)){for(let r of(F<100&&(h.addPage(),y=h.getPageCount()-1,F=(E=h.getPage(y)).getSize().height-100),console.log("[v0] Adding section:",e,"with",t.length,"fields"),E.drawText(e,{x:50,y:F+5,size:12,color:(0,C.rgb)(0,0,0)}),F-=30,t)){F<100&&(h.addPage(),y=h.getPageCount()-1,F=(E=h.getPage(y)).getSize().height-100);try{E.drawText(r.label+":",{x:50,y:F+5,size:10,color:(0,C.rgb)(0,0,0)});let e=m.createTextField(`field_${r.id}`);e.addToPage(E,{x:250,y:F,width:300,height:20,borderColor:(0,C.rgb)(0,0,0),backgroundColor:(0,C.rgb)(1,1,1)}),e.enableMultiline(),e.setFontSize(10);let t=d[r.id];t?(e.setText(String(t)),console.log("[v0] ✓ Added and filled field:",r.label,"with:",String(t).substring(0,50))):console.log("[v0] ✓ Added empty field:",r.label),x++,F-=30}catch(e){console.error("[v0] Error adding field:",r.label,e)}}F-=30}console.log("[v0] Added",x,"form fields to the PDF"),console.log("[v0] Total pages:",h.getPageCount());let A=await h.save();return new Response(A,{headers:{"Content-Type":"application/pdf","Content-Disposition":`attachment; filename="editable_tender_${s.title?.replace(/[^a-z0-9]/gi,"_").toLowerCase()||"document"}.pdf"`,"X-Fields-Added":String(x),"X-Fields-Filled":String(x)}})}catch(e){return console.error("[v0] Error making PDF editable:",e),Response.json({error:e.message||"Failed to make PDF editable"},{status:500})}}e.i(228952),new(e.i(461309)).default({apiKey:process.env.OPENAI_API_KEY}),e.s(["POST",()=>y],785860);var E=e.i(785860);let P=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/custom-tenders/[id]/make-pdf-editable/route",pathname:"/api/custom-tenders/[id]/make-pdf-editable",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/custom-tenders/[id]/make-pdf-editable/route.ts",nextConfigOutput:"",userland:E}),{workAsyncStorage:_,workUnitAsyncStorage:F,serverHooks:A}=P;function T(){return(0,o.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:F})}async function D(e,t,o){P.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let R="/api/custom-tenders/[id]/make-pdf-editable/route";R=R.replace(/\/index$/,"")||"/";let w=await P.prepare(e,t,{srcPage:R,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==o.waitUntil||o.waitUntil.call(o,Promise.resolve()),null;let{buildId:b,params:C,nextConfig:y,parsedUrl:E,isDraftMode:_,prerenderManifest:F,routerServerContext:A,isOnDemandRevalidate:T,revalidateOnlyGenerated:D,resolvedPathname:k,clientReferenceManifest:I,serverActionsManifest:S}=w,j=(0,i.normalizeAppPath)(R),N=!!(F.dynamicRoutes[j]||F.routes[k]),O=async()=>((null==A?void 0:A.render404)?await A.render404(e,t,E,!1):t.end("This page could not be found"),null);if(N&&!_){let e=!!F.routes[k],t=F.dynamicRoutes[j];if(t&&!1===t.fallback&&!e){if(y.experimental.adapterPath)return await O();throw new v.NoFallbackError}}let q=null;!N||P.isDev||_||(q="/index"===(q=k)?"/":q);let U=!0===P.isDev||!N,M=N&&!U;S&&I&&(0,s.setReferenceManifestsSingleton)({page:R,clientReferenceManifest:I,serverActionsManifest:S,serverModuleMap:(0,l.createServerModuleMap)({serverActionsManifest:S})});let H=e.method||"GET",z=(0,a.getTracer)(),L=z.getActiveScopeSpan(),$={params:C,prerenderManifest:F,renderOpts:{experimental:{authInterrupts:!!y.experimental.authInterrupts},cacheComponents:!!y.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:y.cacheLife,waitUntil:o.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,o)=>P.onRequestError(e,t,o,A)},sharedContext:{buildId:b}},K=new d.NodeNextRequest(e),G=new d.NodeNextResponse(t),X=c.NextRequestAdapter.fromNodeNextRequest(K,(0,c.signalFromNodeResponse)(t));try{let s=async e=>P.handle(X,$).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=z.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=r.get("next.route");if(o){let t=`${H} ${o}`;e.setAttributes({"next.route":o,"http.route":o,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${R}`)}),l=!!(0,n.getRequestMeta)(e,"minimalMode"),i=async n=>{var a,i;let d=async({previousCacheEntry:r})=>{try{if(!l&&T&&D&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await s(n);e.fetchMetrics=$.renderOpts.fetchMetrics;let i=$.renderOpts.pendingWaitUntil;i&&o.waitUntil&&(o.waitUntil(i),i=void 0);let d=$.renderOpts.collectedTags;if(!N)return await (0,g.sendResponse)(K,G,a,$.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(a.headers);d&&(t[m.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==$.renderOpts.collectedRevalidate&&!($.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&$.renderOpts.collectedRevalidate,o=void 0===$.renderOpts.collectedExpire||$.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:$.renderOpts.collectedExpire;return{value:{kind:x.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:o}}}}catch(t){throw(null==r?void 0:r.isStale)&&await P.onRequestError(e,t,{routerKind:"App Router",routePath:R,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:T})},A),t}},c=await P.handleResponse({req:e,nextConfig:y,cacheKey:q,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:F,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:D,responseGenerator:d,waitUntil:o.waitUntil,isMinimalMode:l});if(!N)return null;if((null==c||null==(a=c.value)?void 0:a.kind)!==x.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(i=c.value)?void 0:i.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",T?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),_&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,f.fromNodeOutgoingHttpHeaders)(c.value.headers);return l&&N||u.delete(m.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,h.getCacheControlHeader)(c.cacheControl)),await (0,g.sendResponse)(K,G,new Response(c.value.body,{headers:u,status:c.value.status||200})),null};L?await i(L):await z.withPropagatedContext(e.headers,()=>z.trace(u.BaseServerSpan.handleRequest,{spanName:`${H} ${R}`,kind:a.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},i))}catch(t){if(t instanceof v.NoFallbackError||await P.onRequestError(e,t,{routerKind:"App Router",routePath:j,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:T})}),N)throw t;return await (0,g.sendResponse)(K,G,new Response(null,{status:500})),null}}e.s(["handler",()=>D,"patchFetch",()=>T,"routeModule",()=>P,"serverHooks",()=>A,"workAsyncStorage",()=>_,"workUnitAsyncStorage",()=>F],46327)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__0a6dd209._.js.map