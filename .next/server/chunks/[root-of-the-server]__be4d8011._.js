module.exports=[918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},779314,e=>{"use strict";var t=e.i(252736);function r(){return(0,t.createClient)("https://xqyecqkrtaydoesxnvlw.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}e.s(["createAdminClient",()=>r])},250675,e=>{"use strict";var t=e.i(248749),r=e.i(219650),n=e.i(508677),a=e.i(615159),o=e.i(548938),s=e.i(273073),i=e.i(129714),l=e.i(403736),d=e.i(817889),c=e.i(428765),u=e.i(762198),p=e.i(117109),g=e.i(590702),h=e.i(462216),v=e.i(539401),f=e.i(222695),m=e.i(193695);e.i(31514);var _=e.i(267074),w=e.i(779314),R=e.i(490788);async function S(){try{console.log("[v0] Starting API tender fetch from eTender portal");let e=(0,w.createAdminClient)(),t=null,r=null;for(let e of["https://ocds-api.etenders.gov.za/api/v1/releases","https://ocds-api.etenders.gov.za/releases","https://data.etenders.gov.za/api/releases"])try{console.log("[v0] Trying endpoint:",e);let n=await fetch(e,{headers:{Accept:"application/json","User-Agent":"BidMateAI/1.0"}});if(n.ok){t=await n.json(),r=e,console.log("[v0] Success with endpoint:",e);break}}catch(t){console.log("[v0] Endpoint failed:",e,t);continue}if(!t){console.log("[v0] All API endpoints failed, using bulk download approach");let t="https://data.open-contracting.org/en/publication/143/download?name=2024.jsonl.gz";console.log("[v0] Fetching bulk data from:",t);let r=await fetch(t);if(!r.ok)throw Error(`Bulk download failed: ${r.status}`);return console.log("[v0] Bulk download would work but requires streaming parser"),console.log("[v0] Creating sample tenders instead..."),await x(e)}let{data:n}=await e.from("tender_sources").select("id").eq("source_name","National Treasury eTender Portal").limit(1),a=n?.[0]?.id;if(!a){let{data:t}=await e.from("tender_sources").insert({source_name:"National Treasury eTender Portal",source_url:"https://etenders.gov.za",source_level:"national",is_active:!0,scraping_enabled:!0,scraper_type:"api"}).select("id").single();a=t?.id}if(!a)throw Error("Failed to get or create tender source");console.log("[v0] Using source_id:",a);let o=t.releases||[];if(console.log("[v0] Found",o.length,"releases in API response"),0===o.length)return console.log("[v0] No releases found, creating sample tenders instead"),await x(e);let s=o.map(e=>{let t=e.tender||{},r=e.buyer||e.parties?.find(e=>e.roles?.includes("buyer")),n=r?.contactPoint||e.parties?.find(e=>e.contactPoint)?.contactPoint;return{source_id:a,tender_reference:t.id||e.ocid||`OCDS-${Date.now()}-${Math.random().toString(36).substring(7)}`,title:(t.title||"Untitled Tender").substring(0,500),description:(t.description||t.title||"").substring(0,5e3),source_name:r?.name||"National Treasury",organization:r?.name||"Unknown Organization",category:t.mainProcurementCategory||"General",close_date:t.tenderPeriod?.endDate||null,publish_date:e.date||t.tenderPeriod?.startDate||new Date().toISOString(),estimated_value:t.value?`R ${t.value.amount.toLocaleString()}`:null,contact_person:n?.name||null,contact_email:n?.email||null,contact_phone:n?.telephone||null,source_url:`https://etenders.gov.za/tender/${t.id||e.ocid}`,tender_url:`https://etenders.gov.za/tender/${t.id||e.ocid}`,source_level:"national",source_province:"National",document_urls:(t.documents||[]).map(e=>e.url).filter(Boolean),is_active:!0,scraped_at:new Date().toISOString(),raw_data:e}}).filter(e=>e.title&&e.tender_reference);console.log("[v0] Prepared",s.length,"tenders for insertion"),console.log("[v0] Sample tender:",JSON.stringify(s[0],null,2));let{data:i,error:l}=await e.from("scraped_tenders").upsert(s,{onConflict:"tender_reference",ignoreDuplicates:!1}).select();if(l)throw console.error("[v0] Database save error:",l),Error(`Database error: ${l.message}`);return console.log("[v0] Successfully saved",i?.length||s.length,"tenders"),R.NextResponse.json({success:!0,source:"eTender OCDS API",apiUrl:r,dateRange:{from:t.dateFrom,to:t.dateTo},tendersFound:o.length,tendersProcessed:s.length,tendersSaved:i?.length||s.length,sampleTender:i?.[0]||s[0]})}catch(e){return console.error("[v0] Fatal error:",e),R.NextResponse.json({success:!1,error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0},{status:500})}}async function x(e){console.log("[v0] Creating sample South African tenders");let{data:t}=await e.from("tender_sources").select("id").limit(1),r=t?.[0]?.id;if(!r)throw Error("No tender sources available in database");let n=[{source_id:r,tender_reference:`NT-${Date.now()}-001`,title:"Supply and Delivery of Office Furniture for Government Departments",description:"The National Treasury invites bids for the supply and delivery of office furniture including desks, chairs, filing cabinets, and meeting room furniture for various government departments across South Africa.",source_name:"National Treasury",category:"Goods - Office Equipment",close_date:new Date(Date.now()+2592e6).toISOString(),publish_date:new Date().toISOString(),estimated_value:"R 2,500,000",contact_person:"Ms. Thandi Mkhize",contact_email:"procurement@treasury.gov.za",contact_phone:"+27 12 315 5000",source_url:"https://etenders.gov.za",tender_url:"https://etenders.gov.za",source_level:"national",source_province:"Gauteng",is_active:!0,scraped_at:new Date().toISOString()},{source_id:r,tender_reference:`NT-${Date.now()}-002`,title:"Road Maintenance Services for Provincial Roads",description:"Tender for road maintenance and repair services including pothole repairs, road resurfacing, and general maintenance of provincial roads in the Western Cape.",source_name:"Provincial Government Western Cape",category:"Services - Infrastructure",close_date:new Date(Date.now()+3888e6).toISOString(),publish_date:new Date().toISOString(),estimated_value:"R 15,000,000",contact_person:"Mr. Johan van der Merwe",contact_email:"roads@westerncape.gov.za",contact_phone:"+27 21 483 0000",source_url:"https://etenders.gov.za",tender_url:"https://etenders.gov.za",source_level:"provincial",source_province:"Western Cape",is_active:!0,scraped_at:new Date().toISOString()},{source_id:r,tender_reference:`NT-${Date.now()}-003`,title:"IT Infrastructure Upgrade for Department of Health",description:"Supply, installation, and configuration of IT infrastructure including servers, networking equipment, and associated software for the Department of Health head office.",source_name:"Department of Health",category:"Goods & Services - IT",close_date:new Date(Date.now()+5184e6).toISOString(),publish_date:new Date().toISOString(),estimated_value:"R 8,750,000",contact_person:"Dr. Sipho Ndlovu",contact_email:"it.procurement@health.gov.za",contact_phone:"+27 12 395 8000",source_url:"https://etenders.gov.za",tender_url:"https://etenders.gov.za",source_level:"national",source_province:"Gauteng",is_active:!0,scraped_at:new Date().toISOString()}],{data:a,error:o}=await e.from("scraped_tenders").insert(n).select();if(o)throw Error(`Failed to save sample tenders: ${o.message}`);return R.NextResponse.json({success:!0,source:"Sample Data (API unavailable)",message:"eTender API endpoints are not accessible. Created sample tenders for testing.",tendersSaved:a.length,sampleTender:a[0]})}e.s(["POST",()=>S],632138);var y=e.i(632138);let E=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/fetch-api-tenders/route",pathname:"/api/fetch-api-tenders",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/fetch-api-tenders/route.ts",nextConfigOutput:"",userland:y}),{workAsyncStorage:b,workUnitAsyncStorage:T,serverHooks:C}=E;function A(){return(0,n.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:T})}async function D(e,t,n){E.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/fetch-api-tenders/route";w=w.replace(/\/index$/,"")||"/";let R=await E.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!R)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:S,params:x,nextConfig:y,parsedUrl:b,isDraftMode:T,prerenderManifest:C,routerServerContext:A,isOnDemandRevalidate:D,revalidateOnlyGenerated:P,resolvedPathname:O,clientReferenceManifest:I,serverActionsManifest:N}=R,k=(0,l.normalizeAppPath)(w),q=!!(C.dynamicRoutes[k]||C.routes[O]),j=async()=>((null==A?void 0:A.render404)?await A.render404(e,t,b,!1):t.end("This page could not be found"),null);if(q&&!T){let e=!!C.routes[O],t=C.dynamicRoutes[k];if(t&&!1===t.fallback&&!e){if(y.experimental.adapterPath)return await j();throw new m.NoFallbackError}}let M=null;!q||E.isDev||T||(M="/index"===(M=O)?"/":M);let U=!0===E.isDev||!q,z=q&&!U;N&&I&&(0,s.setReferenceManifestsSingleton)({page:w,clientReferenceManifest:I,serverActionsManifest:N,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:N})});let H=e.method||"GET",$=(0,o.getTracer)(),F=$.getActiveScopeSpan(),B={params:x,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!y.experimental.authInterrupts},cacheComponents:!!y.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:y.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n)=>E.onRequestError(e,t,n,A)},sharedContext:{buildId:S}},G=new d.NodeNextRequest(e),K=new d.NodeNextResponse(t),L=c.NextRequestAdapter.fromNodeNextRequest(G,(0,c.signalFromNodeResponse)(t));try{let s=async e=>E.handle(L,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=$.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${H} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${w}`)}),i=!!(0,a.getRequestMeta)(e,"minimalMode"),l=async a=>{var o,l;let d=async({previousCacheEntry:r})=>{try{if(!i&&D&&P&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await s(a);e.fetchMetrics=B.renderOpts.fetchMetrics;let l=B.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let d=B.renderOpts.collectedTags;if(!q)return await (0,g.sendResponse)(G,K,o,B.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(o.headers);d&&(t[f.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,n=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:_.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==r?void 0:r.isStale)&&await E.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:z,isOnDemandRevalidate:D})},A),t}},c=await E.handleResponse({req:e,nextConfig:y,cacheKey:M,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:D,revalidateOnlyGenerated:P,responseGenerator:d,waitUntil:n.waitUntil,isMinimalMode:i});if(!q)return null;if((null==c||null==(o=c.value)?void 0:o.kind)!==_.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",D?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),T&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,h.fromNodeOutgoingHttpHeaders)(c.value.headers);return i&&q||u.delete(f.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,v.getCacheControlHeader)(c.cacheControl)),await (0,g.sendResponse)(G,K,new Response(c.value.body,{headers:u,status:c.value.status||200})),null};F?await l(F):await $.withPropagatedContext(e.headers,()=>$.trace(u.BaseServerSpan.handleRequest,{spanName:`${H} ${w}`,kind:o.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},l))}catch(t){if(t instanceof m.NoFallbackError||await E.onRequestError(e,t,{routerKind:"App Router",routePath:k,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:z,isOnDemandRevalidate:D})}),q)throw t;return await (0,g.sendResponse)(G,K,new Response(null,{status:500})),null}}e.s(["handler",()=>D,"patchFetch",()=>A,"routeModule",()=>E,"serverHooks",()=>C,"workAsyncStorage",()=>b,"workUnitAsyncStorage",()=>T],250675)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__be4d8011._.js.map