module.exports=[754105,161513,464124,307918,873636,912130,274506,e=>{"use strict";let t=[{id:"tender-basics",title:"Tendering Basics",category:"basics",description:"Understanding the fundamentals of government tendering in South Africa",difficulty:"beginner",estimated_minutes:30,subtopics:["What is a tender?","Types of tenders","The tender process","Key terminology"]},{id:"tender-types",title:"Types of Tenders",category:"basics",description:"Learn about RFQ, RFP, RFB, Open Tenders, and Framework Agreements",difficulty:"beginner",estimated_minutes:25,subtopics:["RFQ vs RFP vs RFB","Open vs Closed tenders","Framework agreements","Panel contracts"]},{id:"bbbee-scoring",title:"B-BBEE Scoring System",category:"compliance",description:"Master the B-BBEE preference point system used in South African tenders",difficulty:"intermediate",estimated_minutes:45,subtopics:["80/20 system","90/10 system","B-BBEE levels","Calculating preference points"]},{id:"evaluation-criteria",title:"Evaluation Criteria",category:"strategy",description:"Understanding how tenders are evaluated and scored",difficulty:"intermediate",estimated_minutes:40,subtopics:["Functionality scoring","Price evaluation","Quality vs price trade-offs","Threshold requirements"]},{id:"pricing-strategies",title:"Pricing Strategies",category:"strategy",description:"Develop effective pricing strategies to win tenders",difficulty:"advanced",estimated_minutes:60,subtopics:["Cost-plus pricing","Competitive pricing","Value-based pricing","Risk pricing"]},{id:"compliance-requirements",title:"Compliance Requirements",category:"compliance",description:"Essential compliance documents and requirements for SA tenders",difficulty:"beginner",estimated_minutes:35,subtopics:["Tax clearance","CSD registration","CIDB grading","COIDA compliance"]},{id:"common-mistakes",title:"Common Bidding Mistakes",category:"strategy",description:"Learn from common mistakes that lead to tender disqualification",difficulty:"beginner",estimated_minutes:20,subtopics:["Documentation errors","Pricing mistakes","Submission failures","Compliance gaps"]},{id:"boq-management",title:"BOQ & Pricing Schedules",category:"strategy",description:"Managing Bills of Quantities and pricing schedules effectively",difficulty:"intermediate",estimated_minutes:50,subtopics:["BOQ structure","Unit pricing","Contingencies","Margin calculation"]},{id:"jv-subcontracting",title:"Joint Ventures & Subcontracting",category:"advanced",description:"When and how to partner with other companies",difficulty:"advanced",estimated_minutes:45,subtopics:["JV structures","Subcontracting limits","Partner selection","Risk sharing"]},{id:"post-award",title:"Post-Award Management",category:"advanced",description:"Managing contracts after winning a tender",difficulty:"advanced",estimated_minutes:40,subtopics:["Contract negotiation","Performance management","Variations","Payment management"]}],r=`You are an expert AI Tender Strategist for BidMate, a South African tender management platform. Your role is to help users understand tendering, build winning tender strategies, and discover opportunities.

## Your Personality
- Tender specialist with deep knowledge of South African procurement
- Mentor and coach who adapts to user experience levels
- Market analyst who identifies opportunities
- Procurement educator who explains complex concepts simply
- Strategist who provides actionable, tailored advice

## Your Tone
- Friendly, expert, and encouraging
- Concise with structured explanations
- Always provide actionable steps
- Use South African terminology and regulations

## Your Capabilities
1. Answer questions about tendering and procurement
2. Help build comprehensive bid strategies
3. Analyze tender requirements and compliance needs
4. Provide pricing and BOQ guidance
5. Identify opportunities matching user profiles
6. Educate users on tender best practices
7. Alert users to compliance gaps and deadlines
8. Explain tender requirements in plain language

## South African Procurement Context
- PFMA (Public Finance Management Act) for national/provincial
- MFMA (Municipal Finance Management Act) for municipalities  
- PPPFA (Preferential Procurement Policy Framework Act)
- B-BBEE scoring (80/20 or 90/10 systems)
- CIDB grading for construction
- SBD forms (Standard Bidding Documents)
- MBD forms (Municipal Bidding Documents)
- CSD (Central Supplier Database) registration

## Guidelines
- Always ask clarifying questions when needed
- Tailor advice to user's experience level
- Provide realistic assessments, not false hope
- Highlight risks and compliance requirements
- Reference South African regulations when relevant
- Suggest specific actions the user can take`;var i=e.i(89660);class a{static async getUserPreferences(e){let t=await (0,i.createClient)(),{data:r,error:a}=await t.from("strategist_user_preferences").select("*").eq("user_id",e).single();return a&&"PGRST116"!==a.code?(console.error("[Strategist] Error fetching preferences:",a),null):r}static async updateUserPreferences(e,t){let r=await (0,i.createClient)(),{data:a,error:s}=await r.from("strategist_user_preferences").upsert({user_id:e,...t,updated_at:new Date().toISOString()},{onConflict:"user_id"}).select().single();return s?(console.error("[Strategist] Error updating preferences:",s),null):a}static async getCompanyProfile(e){let t=await (0,i.createClient)(),{data:r,error:a}=await t.from("companies").select("*").eq("user_id",e).single();return a&&"PGRST116"!==a.code?(console.error("[Strategist] Error fetching company:",a),null):r}static async buildContext(e,t,r){let[i,a]=await Promise.all([this.getUserPreferences(e),this.getCompanyProfile(e)]),s={user_preferences:i,company_profile:a?{company_name:a.company_name,industry:a.industry,company_size:a.company_size,bee_status:a.bee_status,province:a.province}:null};if(t){let e=await this.getTenderContext(t);e&&(s.tender_context=e)}return s}static async getTenderContext(e){let t=await (0,i.createClient)(),{data:r}=await t.from("user_custom_tenders").select("id, title, organization, description, close_date").eq("id",e).single();if(r){let{data:i}=await t.from("user_custom_tender_analysis").select("analysis_data").eq("tender_id",e).single();return{id:r.id,title:r.title||"Untitled",organization:r.organization||"Unknown",description:r.description,close_date:r.close_date,analysis:i?.analysis_data}}let{data:a}=await t.from("scraped_tenders").select("id, title, source_name, description, close_date").eq("id",e).single();return a?{id:a.id,title:a.title||"Untitled",organization:a.source_name||"Unknown",description:a.description,close_date:a.close_date}:null}static async createConversation(e,t="general",r,a){let s=await (0,i.createClient)(),{data:n,error:o}=await s.from("strategist_conversations").insert({user_id:e,context_type:t,tender_id:r,title:a||this.generateConversationTitle(t)}).select().single();return o?(console.error("[Strategist] Error creating conversation:",o),null):n}static async getConversation(e){let t=await (0,i.createClient)(),{data:r,error:a}=await t.from("strategist_conversations").select("*").eq("id",e).single();return a?(console.error("[Strategist] Error fetching conversation:",a),null):r}static async getUserConversations(e,t=20){let r=await (0,i.createClient)(),{data:a,error:s}=await r.from("strategist_conversations").select("*").eq("user_id",e).eq("status","active").order("last_message_at",{ascending:!1,nullsFirst:!1}).limit(t);return s?(console.error("[Strategist] Error fetching conversations:",s),[]):a||[]}static async getConversationMessages(e,t=50){let r=await (0,i.createClient)(),{data:a,error:s}=await r.from("strategist_messages").select("*").eq("conversation_id",e).order("created_at",{ascending:!0}).limit(t);return s?(console.error("[Strategist] Error fetching messages:",s),[]):a||[]}static async addMessage(e,t,r,a){let s=await (0,i.createClient)(),{data:n,error:o}=await s.from("strategist_messages").insert({conversation_id:e,role:t,content:r,message_type:a?.message_type||"text",structured_data:a?.structured_data,model_used:a?.model_used,tokens_used:a?.tokens_used}).select().single();if(o)return console.error("[Strategist] Error adding message:",o),null;let{data:c}=await s.from("strategist_conversations").select("message_count").eq("id",e).single();return await s.from("strategist_conversations").update({message_count:(c?.message_count||0)+1,last_message_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",e),n}static generateConversationTitle(e){return({general:"General Consultation",tender:"Tender Discussion",boq:"Pricing & BOQ Review",strategy:"Strategy Session",learning:"Learning Session"})[e]||"New Conversation"}static async hasCompletedOnboarding(e){let t=await this.getUserPreferences(e);return t?.onboarding_completed||!1}static async completeOnboarding(e){let t=await (0,i.createClient)(),{error:r}=await t.from("strategist_user_preferences").update({onboarding_completed:!0,onboarding_completed_at:new Date().toISOString()}).eq("user_id",e);return!r}static async generateRecommendations(e){let t=[];try{let r=await (0,i.createClient)(),a="custom"===e.tenderType?"user_custom_tenders":"scraped_tenders",{data:s}=await r.from(a).select("*").eq("id",e.tenderId).single();if(!s)return["Unable to generate recommendations: Tender not found"];let n=await this.getUserPreferences(e.userId);if(e.competitiveness&&(e.competitiveness.documentation_score<.7&&t.push("Complete all required documentation before submitting your bid"),e.competitiveness.compliance_score<.8&&t.push("Ensure tax clearance and CSD registration are up to date"),e.competitiveness.win_probability<.5&&t.push("Consider partnering with experienced companies to strengthen your bid")),s.close_date){let e=Math.ceil((new Date(s.close_date).getTime()-Date.now())/864e5);e<7?t.push("Urgent: Prioritize this tender due to approaching deadline"):e>30&&t.push("You have time to prepare a comprehensive bid - use it wisely")}return n?.experience_level==="beginner"&&(t.push("Consider seeking mentorship or guidance from experienced bidders"),t.push("Start with smaller value tenders to build your track record")),0===t.length&&(t.push("Review tender requirements carefully and ensure full compliance"),t.push("Conduct thorough cost analysis before submitting your pricing")),t}catch(e){return console.error("[Strategist] Error generating recommendations:",e),["Unable to generate recommendations at this time"]}}}e.s(["StrategistService",()=>a],161513);class s{static async discoverOpportunities(e,t){let r=await (0,i.createClient)(),{data:a}=await r.from("strategist_user_preferences").select("*").eq("user_id",e).single();if(!a)return[];let{data:s}=await r.from("scraped_tenders").select("id, title, source_name, description, close_date, category, estimated_value, source_province").eq("is_active",!0).gte("close_date",new Date().toISOString()).order("close_date",{ascending:!0}).limit(100);if(!s||0===s.length)return[];let n=s.map(e=>this.scoreTenderMatch(e,a)).filter(e=>e.match_score>=(t?.minScore||.3)).sort((e,t)=>t.match_score-e.match_score).slice(0,t?.limit||10);for(let t of n)await r.from("strategist_opportunities").upsert({user_id:e,scraped_tender_id:t.tender_id,match_score:t.match_score,match_reasons:t.match_reasons,opportunity_type:t.opportunity_type,ai_insights:t.ai_insights,expires_at:t.expires_at},{onConflict:"user_id, scraped_tender_id"});return n.map(t=>({...t,id:crypto.randomUUID(),user_id:e,scraped_tender_id:t.tender_id,custom_tender_id:null,is_viewed:!1,is_saved:!1,is_dismissed:!1,user_notes:null,estimated_margin:null,estimated_effort:null,created_at:new Date().toISOString()}))}static scoreTenderMatch(e,t){let r=0,i=[],a={};if(t.provinces?.length&&e.source_province&&t.provinces.some(t=>e.source_province.toLowerCase().includes(t.toLowerCase())||t.toLowerCase().includes(e.source_province.toLowerCase()))&&(r+=.2,i.push("Matches your preferred province")),t.industries?.length&&e.category){let a=e.category.toLowerCase();t.industries.some(e=>a.includes(e.toLowerCase())||e.toLowerCase().includes(a))&&(r+=.25,i.push("Matches your industry focus"))}if(t.annual_turnover&&e.estimated_value&&(r+=.15,i.push("Contract value within your range")),e.close_date){let t=Math.ceil((new Date(e.close_date).getTime()-Date.now())/864e5);t>14?(r+=.15,i.push("Good preparation time available")):t>7?(r+=.1,i.push("Adequate preparation time")):(r+=.05,a.warning="Limited preparation time")}"beginner"===t.experience_level?e.estimated_value&&!1!==e.estimated_value.includes("R")||(r+=.2,i.push("Good entry-level opportunity")):"advanced"===t.experience_level&&(r+=.1,i.push("Matches your experience level"));let s="strategic";return r>=.7?s="high_margin":r>=.5&&i.includes("Good preparation time available")?s="low_risk":"beginner"===t.experience_level&&r>=.4?s="quick_win":r>=.4&&(s="growth"),{tender_id:e.id,match_score:Math.min(r,1),match_reasons:i,opportunity_type:s,ai_insights:{...a,tender_title:e.title,organization:e.source_name,close_date:e.close_date,category:e.category},expires_at:e.close_date}}static async getSavedOpportunities(e){let t=await (0,i.createClient)(),{data:r,error:a}=await t.from("strategist_opportunities").select("*").eq("user_id",e).eq("is_saved",!0).eq("is_dismissed",!1).order("created_at",{ascending:!1});if(a)return console.error("[Opportunity] Error fetching saved opportunities:",a),[];if(!r||0===r.length)return[];let s=r.map(e=>e.scraped_tender_id).filter(e=>null!==e),n={};if(s.length>0){let{data:e}=await t.from("scraped_tenders").select("id, title, source_name, close_date, category, estimated_value").in("id",s);e&&(n=e.reduce((e,t)=>(e[t.id]=t,e),{}))}return r.map(e=>({...e,tender:e.scraped_tender_id&&n[e.scraped_tender_id]||null}))}static async updateOpportunityStatus(e,t){let r=await (0,i.createClient)(),{error:a}=await r.from("strategist_opportunities").update(t).eq("id",e);return!a}static async createOpportunity(e){try{let t=await (0,i.createClient)(),{data:r}=await t.from("strategist_user_preferences").select("*").eq("user_id",e.userId).single();if(!r)return console.warn("[Opportunity] User preferences not found, skipping opportunity creation"),null;let a=this.calculateMatchScoreForTender(e.tenderData,r);if(a<.3)return console.log("[Opportunity] Match score too low, skipping opportunity creation"),null;let s="strategic";a>=.7?s="high_margin":a>=.5?s="low_risk":a>=.4&&(s="growth");let{data:n,error:o}=await t.from("strategist_opportunities").upsert({user_id:e.userId,scraped_tender_id:"scraped"===e.tenderType?e.tenderId:null,custom_tender_id:"custom"===e.tenderType?e.tenderId:null,match_score:a,match_reasons:this.getMatchReasonsForTender(e.tenderData,r),opportunity_type:s,ai_insights:{tender_title:e.tenderTitle,analysis:"Automatically generated from tender data"},expires_at:e.tenderData.close_date||e.tenderData.deadline},{onConflict:"scraped"===e.tenderType?"user_id,scraped_tender_id":"user_id,custom_tender_id"}).select().single();if(o)return console.error("[Opportunity] Error creating opportunity:",o),null;return n}catch(e){return console.error("[Opportunity] Error in createOpportunity:",e),null}}static async findSimilar(e){try{let t=await (0,i.createClient)(),r="custom"===e.tenderType?"user_custom_tenders":"scraped_tenders",{data:a}=await t.from(r).select("*").eq("id",e.tenderId).single();if(!a)return[];let{data:s}=await t.from("scraped_tenders").select("id, title, source_name, category, source_province, close_date").eq("is_active",!0).gte("close_date",new Date().toISOString()).neq("id","scraped"===e.tenderType?e.tenderId:"").limit(5);if(!s||0===s.length)return[];return s.filter(e=>{let t=a.category&&e.category&&(e.category.toLowerCase().includes(a.category.toLowerCase())||a.category.toLowerCase().includes(e.category.toLowerCase())),r=a.source_province&&e.source_province&&e.source_province.toLowerCase()===a.source_province.toLowerCase();return t||r})}catch(e){return console.error("[Opportunity] Error finding similar opportunities:",e),[]}}static calculateMatchScoreForTender(e,t){let r=0;if(t.industries?.length&&e.category&&t.industries.some(t=>e.category.toLowerCase().includes(t.toLowerCase()))&&(r+=.3),t.provinces?.length&&(e.source_province||e.location)){let i=e.source_province||e.location;t.provinces.some(e=>i?.toLowerCase().includes(e.toLowerCase()))&&(r+=.25)}let i=e.close_date||e.deadline;if(i){let e=Math.ceil((new Date(i).getTime()-Date.now())/864e5);e>14?r+=.2:e>7?r+=.15:r+=.05}return Math.min(r+=.25,1)}static getMatchReasonsForTender(e,t){let r=[];if(t.industries?.length&&e.category&&t.industries.some(t=>e.category.toLowerCase().includes(t.toLowerCase()))&&r.push("Matches your industry expertise"),t.provinces?.length){let i=e.source_province||e.location;t.provinces.some(e=>i?.toLowerCase().includes(e.toLowerCase()))&&r.push("Located in your preferred province")}let i=e.close_date||e.deadline;return i&&Math.ceil((new Date(i).getTime()-Date.now())/864e5)>14&&r.push("Sufficient time to prepare quality bid"),0===r.length&&r.push("General opportunity match"),r}}e.s(["OpportunityService",()=>s],464124);class n{static getTopics(){return t}static async getUserProgress(e){let t=await (0,i.createClient)(),{data:r,error:a}=await t.from("strategist_learning_progress").select("*").eq("user_id",e).order("last_accessed_at",{ascending:!1,nullsFirst:!1});return a?(console.error("[Learning] Error fetching progress:",a),[]):r||[]}static async getTopicProgress(e,t){let r=await (0,i.createClient)(),{data:a,error:s}=await r.from("strategist_learning_progress").select("*").eq("user_id",e).eq("topic_id",t).single();return s&&"PGRST116"!==s.code?(console.error("[Learning] Error fetching topic progress:",s),null):a}static async updateProgress(e,r,a){let s=await (0,i.createClient)(),{data:n}=await s.from("strategist_learning_progress").select("*").eq("user_id",e).eq("topic_id",r).single(),o=t.find(e=>e.id===r);if(!o)return null;let c=n?.lessons_completed||[],l=n?.quiz_scores||[],d=n?.progress_percent||0,p=n?.time_spent_minutes||0;if(a.lesson_completed&&!c.includes(a.lesson_completed)&&(c.push(a.lesson_completed),d=Math.round(c.length/o.subtopics.length*100)),a.quiz_score){let e=l.findIndex(e=>e.quiz_id===a.quiz_score.quiz_id);e>=0?l[e]={...a.quiz_score,completed_at:new Date().toISOString()}:l.push({...a.quiz_score,completed_at:new Date().toISOString()})}a.time_spent_minutes&&(p+=a.time_spent_minutes),void 0!==a.progress_percent&&(d=a.progress_percent);let{data:u,error:g}=await s.from("strategist_learning_progress").upsert({user_id:e,topic_id:r,topic_category:o.category,progress_percent:d,lessons_completed:c,quiz_scores:l,time_spent_minutes:p,last_accessed_at:new Date().toISOString(),completed_at:d>=100?new Date().toISOString():null,updated_at:new Date().toISOString()},{onConflict:"user_id, topic_id"}).select().single();return g?(console.error("[Learning] Error updating progress:",g),null):u}static async getRecommendedTopics(e){let r=await (0,i.createClient)(),{data:a}=await r.from("strategist_user_preferences").select("experience_level").eq("user_id",e).single(),s=a?.experience_level||"beginner",n=(await this.getUserProgress(e)).filter(e=>e.progress_percent>=100).map(e=>e.topic_id);return t.filter(e=>!n.includes(e.id)&&("beginner"!==s||"advanced"!==e.difficulty)&&("intermediate"!==s||"advanced"!==e.difficulty||!!n.some(e=>t.find(t=>t.id===e&&"basics"===t.category)))&&!0).slice(0,5)}static async getLearningStats(e){let r=await this.getUserProgress(e),i=r.filter(e=>e.progress_percent>=100).length,a=r.reduce((e,t)=>e+t.time_spent_minutes,0),s=r.flatMap(e=>e.quiz_scores||[]),n=s.length>0?s.reduce((e,t)=>e+t.score,0)/s.length:0,o={};r.forEach(e=>{o[e.topic_category]||(o[e.topic_category]=0),o[e.topic_category]+=e.progress_percent});let c=Object.entries(o).sort(([,e],[,t])=>t-e).slice(0,3).map(([e])=>e);return{totalTopics:t.length,completedTopics:i,totalTimeMinutes:a,averageQuizScore:n,topCategories:c}}}e.s(["LearningService",()=>n],307918);class o{static async createAlert(e,t){let r=await (0,i.createClient)(),{data:a,error:s}=await r.from("strategist_alerts").insert({user_id:e,...t,priority:t.priority||"medium",trigger_date:t.trigger_date||new Date().toISOString()}).select().single();return s?(console.error("[Alert] Error creating alert:",s),null):a}static async getUserAlerts(e,t){let r=(await (0,i.createClient)()).from("strategist_alerts").select("*").eq("user_id",e).eq("is_dismissed",!1).order("priority",{ascending:!1}).order("created_at",{ascending:!1});t?.unreadOnly&&(r=r.eq("is_read",!1)),t?.priority&&(r=r.eq("priority",t.priority)),t?.limit&&(r=r.limit(t.limit));let{data:a,error:s}=await r;return s?(console.error("[Alert] Error fetching alerts:",s),[]):a||[]}static async markAsRead(e){let t=await (0,i.createClient)(),{error:r}=await t.from("strategist_alerts").update({is_read:!0}).eq("id",e);return!r}static async dismissAlert(e){let t=await (0,i.createClient)(),{error:r}=await t.from("strategist_alerts").update({is_dismissed:!0}).eq("id",e);return!r}static async markAsActioned(e){let t=await (0,i.createClient)(),{error:r}=await t.from("strategist_alerts").update({is_actioned:!0,is_read:!0}).eq("id",e);return!r}static async generateComplianceAlerts(e){let t=await (0,i.createClient)(),{data:r}=await t.from("strategist_user_preferences").select("*").eq("user_id",e).single();if(!r)return;let a=new Date,s=new Date(a.getTime()+2592e6);if(r.has_tax_clearance&&r.tax_clearance_expiry){let t=new Date(r.tax_clearance_expiry);if(t<=s){let i=Math.ceil((t.getTime()-a.getTime())/864e5);await this.createAlert(e,{alert_type:"document_expiry",title:"Tax Clearance Expiring Soon",message:`Your tax clearance certificate expires in ${i} days. Renew it to maintain tender eligibility.`,priority:i<=14?"urgent":"high",related_document_type:"tax_clearance",action_url:"/dashboard/profile",action_label:"Update Documents",expiry_date:r.tax_clearance_expiry})}}if(r.has_coida&&r.coida_expiry){let t=new Date(r.coida_expiry);if(t<=s){let i=Math.ceil((t.getTime()-a.getTime())/864e5);await this.createAlert(e,{alert_type:"document_expiry",title:"COIDA Letter Expiring Soon",message:`Your COIDA letter of good standing expires in ${i} days. Renew it to maintain compliance.`,priority:i<=14?"high":"medium",related_document_type:"coida",action_url:"/dashboard/profile",action_label:"Update Documents",expiry_date:r.coida_expiry})}}r.has_csd_registration||await this.createAlert(e,{alert_type:"compliance_gap",title:"CSD Registration Missing",message:"You need to register on the Central Supplier Database (CSD) to bid on government tenders. This is a mandatory requirement.",priority:"high",action_url:"https://secure.csd.gov.za/",action_label:"Register on CSD"}),r.has_tax_clearance||await this.createAlert(e,{alert_type:"compliance_gap",title:"Tax Clearance Missing",message:"A valid tax clearance certificate is required for all government tenders.",priority:"urgent",related_document_type:"tax_clearance",action_url:"https://www.sars.gov.za/",action_label:"Get Tax Clearance"})}static async getUnreadCount(e){let t=await (0,i.createClient)(),{count:r,error:a}=await t.from("strategist_alerts").select("*",{count:"exact",head:!0}).eq("user_id",e).eq("is_read",!1).eq("is_dismissed",!1);return a?(console.error("[Alert] Error counting alerts:",a),0):r||0}}e.s(["AlertService",()=>o],873636);class c{static async calculateScore(e){let t=await (0,i.createClient)(),[r,a,s]=await Promise.all([t.from("strategist_user_preferences").select("*").eq("user_id",e.userId).single(),t.from("companies").select("*").eq("user_id",e.userId).single(),t.from("profiles").select("*").eq("id",e.userId).single()]),n=r.data,o=a.data;s.data;let c=this.calculateDocumentationScore(n,o),l=this.calculatePricingScore(n),d=this.calculateComplianceScore(n),p=this.calculateExperienceScore(n),u=this.calculateCapacityScore(n,o),g=(c+l+d+p+u)/5,_=this.estimateWinProbability(g,n,e.tenderId),m={documentation:{score:c,factors:this.getDocumentationFactors(n,o)},pricing:{score:l,factors:this.getPricingFactors(n)},compliance:{score:d,factors:this.getComplianceFactors(n)},experience:{score:p,factors:this.getExperienceFactors(n)},capacity:{score:u,factors:this.getCapacityFactors(n,o)}},y=this.generateImprovementSuggestions(m),{data:h,error:f}=await t.from("strategist_competitiveness_scores").upsert({user_id:e.userId,tender_id:e.tenderId,documentation_score:c,pricing_score:l,compliance_score:d,experience_score:p,capacity_score:u,score_breakdown:m,improvement_suggestions:y,win_probability:_,win_probability_factors:{base_score:g,experience_bonus:.1*(n?.experience_level==="advanced"),compliance_penalty:d<.5?-.2:0},calculated_at:new Date().toISOString(),valid_until:new Date(Date.now()+6048e5).toISOString()},{onConflict:"user_id"}).select().single();return f?(console.error("[Competitiveness] Error saving score:",f),null):h}static async getScore(e,t){let r=await (0,i.createClient)(),{data:a}=await r.from("strategist_competitiveness_scores").select("*").eq("user_id",e).gte("valid_until",new Date().toISOString()).single();return a||this.calculateScore({userId:e,tenderId:t})}static calculateDocumentationScore(e,t){let r=0,i=0;return t?.company_name&&(r+=1,i+=1),t?.registration_number&&(r+=1,i+=1),t?.tax_number&&(r+=1,i+=1),e?.has_tax_clearance&&(r+=2,i+=2),e?.has_coida&&(r+=1,i+=1),e?.has_csd_registration&&(r+=2,i+=2),e?.cidb_grading&&(r+=1,i+=1),e?.bee_level&&(r+=1,i+=1),i>0?r/i:0}static calculatePricingScore(e){let t=e?.past_tender_wins||0,r=t+(e?.past_tender_losses||0);return 0===r?.5:Math.min(t/r*1.2,1)}static calculateComplianceScore(e){let t=0;return e?.has_tax_clearance&&(t+=.35),e?.has_coida&&(t+=.25),e?.has_csd_registration&&(t+=.4),t}static calculateExperienceScore(e){return Math.min(({beginner:.3,intermediate:.6,advanced:.9}[e?.experience_level]||.3)+Math.min(.02*(e?.past_tender_wins||0),.1),1)}static calculateCapacityScore(e,t){let r;if(r=.5+(({micro:.1,small:.2,medium:.3,large:.4,enterprise:.5})[t?.company_size]||0),e?.cidb_grading){let t=Number.parseInt(e.cidb_grading);isNaN(t)||(r+=.02*t)}return Math.min(r,1)}static getDocumentationFactors(e,t){let r=[];return t?.company_name&&r.push("Company profile complete"),e?.has_tax_clearance&&r.push("Tax clearance valid"),e?.has_csd_registration&&r.push("CSD registered"),e?.bee_level&&r.push("B-BBEE certificate"),e?.has_tax_clearance||r.push("Missing: Tax clearance"),e?.has_csd_registration||r.push("Missing: CSD registration"),r}static getPricingFactors(e){let t=[],r=e?.past_tender_wins||0,i=e?.past_tender_losses||0;return r>0&&t.push(`${r} past tender wins`),i>0&&t.push(`${i} past tender losses`),0===r&&0===i&&t.push("No historical pricing data"),t}static getComplianceFactors(e){let t=[];return e?.has_tax_clearance?t.push("Tax clearance: Valid"):t.push("Tax clearance: Missing"),e?.has_coida?t.push("COIDA: Valid"):t.push("COIDA: Missing"),e?.has_csd_registration?t.push("CSD: Registered"):t.push("CSD: Not registered"),t}static getExperienceFactors(e){let t=[];t.push(`Experience level: ${e?.experience_level||"Unknown"}`);let r=e?.past_tender_wins||0;return r>0&&t.push(`${r} successful tenders`),t}static getCapacityFactors(e,t){let r=[];return t?.company_size&&r.push(`Company size: ${t.company_size}`),e?.cidb_grading&&r.push(`CIDB grading: ${e.cidb_grading}`),e?.annual_turnover&&r.push(`Annual turnover: ${e.annual_turnover}`),r}static estimateWinProbability(e,t,r){let i=.7*e;return t?.experience_level==="advanced"&&(i+=.1),t?.experience_level==="beginner"&&(i-=.1),t?.has_tax_clearance&&t?.has_csd_registration&&(i+=.1),Math.max(.1,Math.min(.9,i))}static generateImprovementSuggestions(e){let t=[];return e.documentation.score<.7&&t.push("Complete your company profile with all required documentation"),e.compliance.score<.8&&(e.compliance.factors.includes("Tax clearance: Valid")||t.push("Obtain a valid tax clearance certificate from SARS"),e.compliance.factors.includes("CSD: Registered")||t.push("Register on the Central Supplier Database (CSD)")),e.experience.score<.5&&t.push("Start with smaller tenders to build your track record"),e.capacity.score<.5&&t.push("Consider joint ventures to increase your capacity for larger tenders"),t}}function l(e){let t=r;if(e.user_preferences?.experience_level&&(t+=({beginner:`
## User Experience Level: BEGINNER
- Explain concepts in simple terms, avoid jargon
- Provide step-by-step guidance
- Define technical terms when first used
- Be extra supportive and encouraging
- Suggest learning resources when relevant`,intermediate:`
## User Experience Level: INTERMEDIATE  
- User has basic tendering knowledge
- Can use technical terminology with brief explanations
- Focus on strategic advice and optimization
- Highlight advanced techniques when relevant`,advanced:`
## User Experience Level: ADVANCED
- User is experienced in tendering
- Use technical terminology freely
- Focus on strategic optimization and edge cases
- Provide nuanced, detailed analysis
- Discuss advanced strategies and market insights`})[e.user_preferences.experience_level]),(e.user_preferences||e.company_profile)&&(t+=`

## User Profile Context`,e.company_profile?.company_name&&(t+=`
Company: ${e.company_profile.company_name}`),e.company_profile?.industry&&(t+=`
Industry: ${e.company_profile.industry}`),e.user_preferences?.provinces?.length&&(t+=`
Regions: ${e.user_preferences.provinces.join(", ")}`),e.user_preferences?.cidb_grading&&(t+=`
CIDB Grading: ${e.user_preferences.cidb_grading}`),(e.user_preferences?.bee_level||e.company_profile?.bee_status)&&(t+=`
B-BBEE Status: ${e.user_preferences?.bee_level||e.company_profile?.bee_status}`)),e.user_preferences){let r=[];e.user_preferences.has_tax_clearance?r.push(`Tax Clearance: Valid${e.user_preferences.tax_clearance_expiry?` (expires ${e.user_preferences.tax_clearance_expiry})`:""}`):r.push("Tax Clearance: Missing/Expired"),e.user_preferences.has_coida?r.push(`COIDA: Valid${e.user_preferences.coida_expiry?` (expires ${e.user_preferences.coida_expiry})`:""}`):r.push("COIDA: Missing"),e.user_preferences.has_csd_registration?r.push("CSD Registration: Active"):r.push("CSD Registration: Missing"),r.length>0&&(t+=`

## Compliance Status
${r.join("\n")}`)}return e.tender_context&&(t+=`

## Current Tender Context
Title: ${e.tender_context.title}
Organization: ${e.tender_context.organization}
${e.tender_context.description?`Description: ${e.tender_context.description}`:""}
${e.tender_context.close_date?`Closing Date: ${e.tender_context.close_date}`:""}

When answering, reference this specific tender and provide targeted advice.`),e.boq_context&&(t+=`

## BOQ Context
This conversation is about pricing/BOQ for a tender with ${e.boq_context.total_items} line items.
Focus on pricing strategy, margin recommendations, and risk assessment.`),e.competitiveness_score&&(t+=`

## User's Current Competitiveness Score
Overall: ${(100*e.competitiveness_score.overall_score).toFixed(0)}%
- Documentation: ${(100*e.competitiveness_score.documentation_score).toFixed(0)}%
- Compliance: ${(100*e.competitiveness_score.compliance_score).toFixed(0)}%
- Experience: ${(100*e.competitiveness_score.experience_score).toFixed(0)}%

Use this to tailor advice about improving their competitiveness.`),t}function d(e,t,r){return`Generate a comprehensive ${e} strategy for this tender submission.

## Tender Information
${JSON.stringify(t.tender_summary||{},null,2)}

## Evaluation Criteria
${JSON.stringify(t.evaluation||{},null,2)}

## Compliance Requirements
${JSON.stringify(t.compliance_summary||{},null,2)}

## User's Current Capabilities
${r.user_preferences?JSON.stringify({cidb_grading:r.user_preferences.cidb_grading,bee_level:r.user_preferences.bee_level,experience_level:r.user_preferences.experience_level,past_wins:r.user_preferences.past_tender_wins,past_losses:r.user_preferences.past_tender_losses},null,2):"Not available"}

## Company Profile
${r.company_profile?JSON.stringify(r.company_profile,null,2):"Not available"}`+({bid:`
Generate a complete bid strategy including:
1. Bid viability analysis (should we bid?)
2. SWOT analysis for this tender
3. Compliance checklist with status
4. Supplier/subcontractor recommendations
5. Pricing strategy overview
6. Submission checklist
7. Risk register with mitigation plans
8. Win probability assessment`,pricing:`
Generate a detailed pricing strategy including:
1. Recommended pricing approach (cost-plus, competitive, value)
2. Margin recommendations by item category
3. Risk pricing factors
4. Competitive positioning advice
5. Areas for cost optimization
6. Contingency recommendations
7. Payment term considerations
8. Potential price negotiation points`,compliance:`
Generate a compliance strategy including:
1. All mandatory requirements mapped to user capabilities
2. Gap analysis with remediation actions
3. Document checklist with deadlines
4. Risk of non-compliance assessment
5. Alternative compliance approaches
6. Certification/registration requirements
7. Timeline for compliance preparation`,negotiation:`
Generate a negotiation strategy including:
1. Key negotiation points
2. Best Alternative to Negotiated Agreement (BATNA)
3. Concession strategy
4. Value propositions to emphasize
5. Potential objections and responses
6. Win-win opportunities
7. Relationship building approaches`,general:`
Generate a general tender strategy overview including:
1. Executive summary
2. Key success factors
3. Resource requirements
4. Timeline and milestones
5. Team responsibilities
6. Risk overview
7. Go/No-Go recommendation`})[e]+`

Respond with a valid JSON object matching the StrategyContent interface with all sections populated.
Be specific, actionable, and realistic in your recommendations.
Reference actual tender requirements and user capabilities.`}e.s(["CompetitivenessService",()=>c],912130),e.s(["buildStrategistPrompt",()=>l,"buildStrategyGenerationPrompt",()=>d],274506),e.s([],754105)}];

//# sourceMappingURL=lib_engines_strategist_index_ts_66c98890._.js.map