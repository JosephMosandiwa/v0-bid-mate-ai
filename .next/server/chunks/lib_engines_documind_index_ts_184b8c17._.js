module.exports=[18444,702275,480660,293261,556274,t=>{"use strict";function e(t,i,n,o=!1){return{code:t,message:i,details:n,recoverable:o}}let i={fileTooLarge:(t,i)=>e("FILE_TOO_LARGE",`File size ${i} bytes exceeds maximum ${t} bytes`,{max_size:t,actual_size:i},!1),unsupportedFormat:t=>e("UNSUPPORTED_FORMAT",`File format '${t}' is not supported`,{format:t},!1),corruptedFile:t=>e("CORRUPTED_FILE",t||"The file appears to be corrupted or invalid",{reason:t},!1),passwordProtected:()=>e("PASSWORD_PROTECTED","The PDF is password protected. Please provide the password.",void 0,!0),invalidPassword:()=>e("INVALID_PASSWORD","The provided password is incorrect",void 0,!0),parseFailed:(t,i)=>e("PARSE_FAILED",`Failed to parse document at stage '${t}': ${i}`,{stage:t,reason:i},!1),ocrFailed:t=>e("OCR_FAILED",`OCR processing failed: ${t}`,{reason:t},!0),timeout:(t,i)=>e("TIMEOUT",`Processing timed out at stage '${t}' after ${i}ms`,{stage:t,timeout_ms:i},!0),outOfMemory:()=>e("OUT_OF_MEMORY","Document is too complex to process. Try reducing page count.",void 0,!1),serviceUnavailable:t=>e("SERVICE_UNAVAILABLE",`Service '${t}' is currently unavailable`,{service:t},!0),rateLimited:t=>e("RATE_LIMITED",`Rate limit exceeded. Please retry after ${t} seconds`,{retry_after:t},!0),quotaExceeded:t=>e("QUOTA_EXCEEDED",`Quota '${t}' has been exceeded`,{quota:t},!1),invalidRequest:t=>e("INVALID_REQUEST",`Invalid request: ${t}`,{reason:t},!1),missingRequiredField:t=>e("MISSING_REQUIRED_FIELD",`Required field '${t}' is missing`,{field:t},!1),invalidOptions:(t,i)=>e("INVALID_OPTIONS",`Invalid option '${t}': ${i}`,{option:t,reason:i},!1),documentNotFound:t=>e("DOCUMENT_NOT_FOUND",`Document '${t}' not found`,{document_id:t},!1),templateNotFound:t=>e("TEMPLATE_NOT_FOUND",`Template '${t}' not found`,{template_id:t},!1),jobNotFound:t=>e("JOB_NOT_FOUND",`Job '${t}' not found`,{job_id:t},!1)};t.s(["Errors",0,i],702275);let n=["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword","image/png","image/jpeg","image/tiff","image/webp"],o={default_language:"eng",confidence_threshold:.6,min_text_density:.01},a={min_line_length:20,max_label_distance:50,min_confidence:.5},r={tender:[/tender/i,/bid/i,/rfq/i,/request for quotation/i,/invitation to/i,/procurement/i],boq:[/bill of quantities/i,/boq/i,/schedule of quantities/i,/pricing schedule/i],contract:[/contract/i,/agreement/i,/terms and conditions/i],specification:[/specification/i,/technical requirements/i,/scope of work/i],certificate:[/certificate/i,/certification/i,/clearance/i],invoice:[/invoice/i,/tax invoice/i,/receipt/i],form:[/form/i,/application/i,/declaration/i]};function s(t,e){return{x:t.x/e.width,y:1-(t.y+t.height)/e.height,width:t.width/e.width,height:t.height/e.height}}function l(t,e){let i=Math.max(0,Math.max(t.x,e.x)-Math.min(t.x+t.width,e.x+e.width)),n=Math.max(0,Math.max(t.y,e.y)-Math.min(t.y+t.height,e.y+e.height));return Math.sqrt(i*i+n*n)}function c(t){if(0===t.length)return{x:0,y:0,width:0,height:0};let e=Math.min(...t.map(t=>t.x)),i=Math.min(...t.map(t=>t.y));return{x:e,y:i,width:Math.max(...t.map(t=>t.x+t.width))-e,height:Math.max(...t.map(t=>t.y+t.height))-i}}t.s(["API_VERSION",0,"v1","CACHE_TTL",0,{parsed_document:86400,template_list:3600,fingerprint_match:86400},"DOCUMENT_TYPE_PATTERNS",0,r,"FIELD_DETECTION",0,a,"MAX_FILE_SIZE",0,0x3200000,"MAX_PAGES",0,500,"OCR_CONFIG",0,o,"SUPPORTED_MIME_TYPES",0,n],480660);let u=null;async function h(){return u||(u=(await t.A(87683)).PDFDocument),u}async function d(e,i={}){let n,{maxPages:a}=i,r=String.fromCharCode(...(n=e instanceof ArrayBuffer?new Uint8Array(e):e instanceof Uint8Array?e:new Uint8Array(e)).slice(0,8));if(console.log("[v0] PDF header check:",r.substring(0,5),"Length:",n.length),!r.startsWith("%PDF-"))throw Error(`Invalid PDF: Expected %PDF- header but got: ${r.substring(0,10)}`);let l=await h(),c=await l.load(n,{ignoreEncryption:!0}),u=c.getPageCount();console.log("[v0] PDF loaded with pdf-lib, pages:",u);let m=a?Math.min(u,a):u,f="",_=[];try{let{getDocumentProxy:e,extractText:i}=await t.A(746382),o=n.slice(),a=await e(o),r=await i(a,{mergePages:!0});f="string"==typeof r.text?r.text:r.text.join("\n\n");let s=await i(a,{mergePages:!1});_=Array.isArray(s.text)?s.text:[s.text],console.log("[v0] Text extracted via unpdf, length:",f.length)}catch(t){console.log("[v0] unpdf extraction failed, using basic extraction:",t),_=Array(m).fill(""),f=""}let x=[],y=0;for(let t=0;t<m;t++){let e=_[t]||"",{width:i,height:n}=c.getPage(t).getSize(),a=function(t,e,i,n){let a=function(t,e,i,n){let o=[],a=t.split("\n").filter(t=>t.trim()),r=n-50;return a.forEach((t,a)=>{let l=t.trim();if(!l)return;let c={x:50,y:r,width:Math.min(7*l.length,i-100),height:14},u=function(t){let e=t.trim();return e===e.toUpperCase()&&e.length<100&&e.length>2?"heading_1":/^(\d+\.?\d*\.?\d*|\w+\s+\d+)[.:]\s/.test(e)&&e.length<80?"heading_2":e.endsWith(":")&&e.length<50?"label":/^[\u2022\u2023\u25E6\u2043\u2219â€¢\-*]\s/.test(e)||/^\d+[.)]\s/.test(e)?"list_item":/^(Page\s*)?\d+(\s*of\s*\d+)?$/i.test(e)?"page_number":"paragraph"}(l),h=function(t){switch(t){case"heading_1":return{name:"Helvetica-Bold",family:"Helvetica",size:18,weight:"bold",style:"normal",color:"#000000"};case"heading_2":return{name:"Helvetica-Bold",family:"Helvetica",size:14,weight:"bold",style:"normal",color:"#000000"};case"heading_3":return{name:"Helvetica-Bold",family:"Helvetica",size:12,weight:"bold",style:"normal",color:"#000000"};case"label":return{name:"Helvetica-Bold",family:"Helvetica",size:11,weight:"bold",style:"normal",color:"#000000"};default:return{name:"Helvetica",family:"Helvetica",size:12,weight:"normal",style:"normal",color:"#000000"}}}(u);o.push({id:`tb-${e}-${a}`,text:l,position:c,position_normalized:s(c,{width:i,height:n}),font:h,block_type:u,line_index:a,paragraph_index:Math.floor(a/5),confidence:.8,words:null}),r-=21}),o}(t,e,i,n),r=t.length<1e3*o.min_text_density;return{page_number:e,width:i,height:n,rotation:0,content:{full_text:t,text_blocks:a,lines:[],rectangles:[],images:[]},is_scanned:r,ocr_confidence:null}}(e,t+1,i,n);x.push(a),y+=e.length}let b=y/m<1e3*o.min_text_density,w=await g(n);return{metadata:await p(c,u,b,f),pages:x,formFields:w,rawText:f,isScanned:b}}async function p(t,e,i,n){try{return{title:t.getTitle()||null,author:t.getAuthor()||null,subject:t.getSubject()||null,creator:t.getCreator()||null,producer:t.getProducer()||null,creation_date:t.getCreationDate()?.toISOString()||null,modification_date:t.getModificationDate()?.toISOString()||null,page_count:e,pdf_version:null,is_encrypted:!1,is_scanned:i,detected_language:"en",detected_type:m(n)}}catch(t){return console.error("Error extracting metadata:",t),{title:null,author:null,subject:null,creator:null,producer:null,creation_date:null,modification_date:null,page_count:e,pdf_version:null,is_encrypted:!1,is_scanned:i,detected_language:"en",detected_type:m(n)}}}async function g(t){try{let e=await h(),i=await e.load(t,{ignoreEncryption:!0}),n=i.getForm().getFields(),o=[];for(let t of n){let e=t.acroField.getWidgets();if(0===e.length)continue;let n=e[0],a=n.getRectangle(),r=i.getPages().findIndex(t=>{let e=t.ref,i=n.P();return i&&e.toString()===i.toString()}),{width:l,height:c}=i.getPage(Math.max(0,r)).getSize(),u={x:a.x,y:a.y,width:a.width,height:a.height},h=function(t){switch(t.constructor.name){case"PDFTextField":default:return"text";case"PDFCheckBox":return"checkbox";case"PDFRadioGroup":return"radio";case"PDFDropdown":return"select";case"PDFSignature":return"signature";case"PDFButton":return"button"}}(t),d=function(t,e){try{switch(e){case"checkbox":return t.isChecked();case"radio":return t.getSelected()||null;case"select":return t.getSelected()||[];case"text":return t.getText()||null;default:return null}}catch{return null}}(t,h),p=function(t,e){if("select"!==e&&"radio"!==e)return[];try{return(t.getOptions?.()||[]).map((t,e)=>({value:t,label:t,is_default:0===e}))}catch{return[]}}(t,h);o.push({id:t.getName(),name:t.getName(),type:h,page:Math.max(1,r+1),position:u,position_normalized:s(u,{width:l,height:c}),value:d,default_value:null,is_required:t.isRequired(),is_readonly:t.isReadOnly(),max_length:null,options:p,font:null,text_alignment:"left",format:null})}return o}catch(t){return console.error("Error extracting form fields:",t),[]}}function m(t){let e=t.toLowerCase();for(let[t,i]of Object.entries(r))for(let n of i)if(n.test(e))return t;return"unknown"}function f(t,e){let i=t.map(t=>t.start[e]),n=[];i.sort((t,e)=>t-e);let o=[],a=-1/0;return i.forEach(t=>{t-a>5?(o.length>0&&n.push(o),o=[t]):o.push(t),a=t}),o.length>0&&n.push(o),n}function _(t){let e=[...t].sort((t,e)=>e.position.y-t.position.y),i=[],n=[],o=1/0;return e.forEach(t=>{Math.abs(t.position.y-o)>10?(n.length>0&&i.push(n.sort((t,e)=>t.position.x-e.position.x)),n=[t]):n.push(t),o=t.position.y}),n.length>0&&i.push(n.sort((t,e)=>t.position.x-e.position.x)),i}function x(t,e){return{position:c(t.map(t=>t.position)),rows:_(t).length,cols:e,hasHeader:!0}}function y(t,e,i,n,o){let a;return{id:t,label:{text:e.text.replace(/:$/,"").trim(),block_id:e.id,position:e.position,position_normalized:s(e.position,n)},input:{type:i.type,position:i.position,position_normalized:s(i.position,n),native_field_id:null},detection_method:o,confidence:function(t,e,i){let n=.5;switch(t){case"pdf_native":n=.95;break;case"line_detection":n=.8;break;case"box_detection":n=.85;break;case"pattern_matching":n=.7;break;case"ai_vision":n=.75;break;case"template_match":n=.9}let o=l(e.position,i.position);return o>30&&(n-=.1),o>50&&(n-=.1),Math.max(.3,Math.min(1,n))}(o,e,i),suggested_type:(a=e.text.toLowerCase(),/email/i.test(a)?"email":/phone|tel|mobile|cell/i.test(a)?"phone":/date|dob|birth/i.test(a)?"date":/amount|price|cost|value|total|r\s?\d/i.test(a)?"currency":/number|no\.?|#/i.test(a)?"number":/signature/i.test(a)?"signature":/address/i.test(a)?"address":/name/i.test(a)?"name":/company|business|organization/i.test(a)?"company":/id|identity|registration|vat/i.test(a)?"id_number":"text")}}function b(t){return{x:Math.min(t.start.x,t.end.x),y:Math.min(t.start.y,t.end.y),width:Math.abs(t.end.x-t.start.x)||2,height:Math.abs(t.end.y-t.start.y)||t.thickness}}var w=t.i(254799);function E(t,e,i,n){var o,a,r;let s,l,c,u,h;return{structure_hash:(o=t,(s=[]).push(`pages:${o.length}`),o.forEach((t,e)=>{let i=function(t,e){for(let[i,n]of Object.entries({a4:{w:595,h:842},letter:{w:612,h:792},legal:{w:612,h:1008},a3:{w:842,h:1191}}))if(20>Math.abs(t-n.w)&&20>Math.abs(e-n.h)||20>Math.abs(t-n.h)&&20>Math.abs(e-n.w))return i;return"custom"}(t.width,t.height),n=t.width>t.height?"landscape":"portrait";s.push(`p${e}:${i}:${n}`)}),o.forEach((t,e)=>{let i=10*Math.floor(t.content.text_blocks.length/10);s.push(`p${e}:blocks:${i}`)}),o.forEach((t,e)=>{let i=t.content.text_blocks.filter(t=>t.block_type.startsWith("heading")).length;s.push(`p${e}:headings:${i}`)}),v(s.join("|"))),layout_hash:(l=[],t.forEach((t,e)=>{let i=t.content.text_blocks;if(0===i.length)return void l.push(`p${e}:empty`);let n=Math.min(...i.map(t=>t.position_normalized.x)),o=1-Math.max(...i.map(t=>t.position_normalized.x+t.position_normalized.width)),a=Math.min(...i.map(t=>t.position_normalized.y)),r=Math.floor(10*n),s=Math.floor(10*o),c=Math.floor(10*a);l.push(`p${e}:margins:${r}:${s}:${c}`);let u=function(t){if(0===t.length)return 0;let e=[...t].sort((t,e)=>t-e),i=[];for(let t=1;t<e.length;t++)i.push(e[t]-e[t-1]);return Math.min(i.filter(t=>t>.2).length+1,4)}(i.map(t=>t.position_normalized.x));l.push(`p${e}:cols:${u}`)}),v(l.join("|"))),form_hash:e.length>0?(c=[],u={},(a=e).forEach(t=>{u[t.type]=(u[t.type]||0)+1}),Object.entries(u).sort().forEach(([t,e])=>{c.push(`type:${t}:${e}`)}),a.forEach((t,e)=>{let i=Math.floor(10*t.position_normalized.x),n=Math.floor(10*t.position_normalized.y);c.push(`f${e}:${t.page}:${i}:${n}`)}),v(c.join("|"))):null,table_hash:i.length>0?(r=i,(h=[]).push(`count:${r.length}`),r.forEach((t,e)=>{h.push(`t${e}:${t.page}:${t.row_count_estimate}x${t.column_count_estimate}`);let i=Math.floor(10*t.position_normalized.x),n=Math.floor(10*t.position_normalized.y);h.push(`t${e}:pos:${i}:${n}`)}),v(h.join("|"))):null,content_hash:n}}function M(t){return v(t.toLowerCase().replace(/\s+/g," ").trim())}function v(t){return w.default.createHash("sha256").update(t).digest("hex").substring(0,16)}function $(t,e){return e>0x3200000?{valid:!1,error:i.fileTooLarge(0x3200000,e)}:n.includes(t)?{valid:!0}:{valid:!1,error:i.unsupportedFormat(t)}}function F(t){let e=t.slice(0,8);return 37===e[0]&&80===e[1]&&68===e[2]&&70===e[3]?"application/pdf":137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]?"image/png":255===e[0]&&216===e[1]&&255===e[2]?"image/jpeg":73===e[0]&&73===e[1]&&42===e[2]&&0===e[3]||77===e[0]&&77===e[1]&&0===e[2]&&42===e[3]?"image/tiff":80===e[0]&&75===e[1]?"application/vnd.openxmlformats-officedocument.wordprocessingml.document":208===e[0]&&207===e[1]&&17===e[2]&&224===e[3]?"application/msword":null}async function D(t,e,n={}){let r=Date.now(),u=[];try{let h=$(e,t.byteLength);if(!h.valid)return{success:!1,error:h.error};if("application/pdf"!==e)return{success:!1,error:i.unsupportedFormat(e)};let p=await d(t,{extractImages:n.extract_images,maxPages:n.max_pages,password:n.password}),g=p.pages,m=!1;if(!1!==n.ocr_enabled)for(let t=0;t<g.length;t++)(function(t){let e=t.content.full_text.length,i=t.width*t.height;return e/(i/1e5)<o.min_text_density||t.is_scanned})(g[t])&&(u.push(`Page ${t+1} appears to be scanned, OCR required`),m=!0);let w=function(t,e){var i,n,o,r;let u,h,d,p,g,m,w,E,M,v,$=(i=t,u=[],h=null,d=0,i.forEach(t=>{t.content.text_blocks.forEach(e=>{if(e.block_type.startsWith("heading")){let i=Number.parseInt(e.block_type.split("_")[1])||1,n={id:`section-${d++}`,title:e.text,level:i,page_start:t.page_number,page_end:t.page_number,block_ids:[e.id],subsections:[]};1===i?(h&&u.push(h),h=n):h?2===i?h.subsections.push(n):3===i&&h.subsections.length>0&&h.subsections[h.subsections.length-1].subsections.push(n):h=n}else h&&(h.block_ids.push(e.id),h.page_end=t.page_number)})}),h&&u.push(h),u),F=function(t){if(0===t.length)return null;let e=t[0],i=e.content.text_blocks.find(t=>"heading_1"===t.block_type);if(i)return i;let n=e.content.text_blocks.filter(t=>t.position_normalized.y<.5);return 0===n.length?null:n.reduce((t,e)=>e.font.size>t.font.size?e:t)}(t),D=(n=t,p=[],g=0,n.forEach(t=>{var e;let i,n,o,a,r,l={width:t.width,height:t.height},u=function(t,e){let i=t.filter(t=>"horizontal"===t.type),n=t.filter(t=>"vertical"===t.type);if(i.length<2||n.length<2)return[];let o=f(i,"y"),a=f(n,"x"),r=[];if(o.length>=2&&a.length>=2){let t=Math.min(...n.map(t=>t.start.x)),e=Math.max(...n.map(t=>t.start.x)),s=Math.min(...i.map(t=>t.start.y)),l=Math.max(...i.map(t=>t.start.y));r.push({position:{x:t,y:s,width:e-t,height:l-s},rows:o.length-1,cols:a.length-1,hasHeader:!0})}return r}(t.content.lines,0);(function(t){if(t.length<=1)return t;let e=[];return t.forEach(t=>{let i=e.findIndex(e=>{var i,n;return i=e.position,n=t.position,!(i.x+i.width<n.x||n.x+n.width<i.x||i.y+i.height<n.y||n.y+n.height<i.y)});i>=0?e[i]={position:c([e[i].position,t.position]),rows:Math.max(e[i].rows,t.rows),cols:Math.max(e[i].cols,t.cols),hasHeader:e[i].hasHeader||t.hasHeader}:e.push(t)}),e})([...u,...(e=t.content.text_blocks,i=_(e),n=[],o=-1,a=0,r=[],i.forEach((t,e)=>{let i=function(t){if(t.length<=1)return t.length;let e=[];for(let i=1;i<t.length;i++){let n=t[i].position.x-(t[i-1].position.x+t[i-1].position.width);e.push(n)}let i=e.reduce((t,e)=>t+e,0)/e.length;return e.filter(t=>t>1.5*i).length+1}(t);i>=2?-1===o?(o=e,a=i,r=[...t]):1>=Math.abs(i-a)?r.push(...t):(r.length>=4&&n.push(x(r,a)),o=e,a=i,r=[...t]):(r.length>=4&&n.push(x(r,a)),o=-1,r=[])}),r.length>=4&&n.push(x(r,a)),n)]).forEach(e=>{p.push({id:`table-${g++}`,page:t.page_number,position:e.position,position_normalized:s(e.position,l),row_count_estimate:e.rows,column_count_estimate:e.cols,has_header:e.hasHeader,extraction_status:"pending",table_data:null})})}),p),{formRegions:P,detectedFields:T}=(o=t,m=[],w=[],E=0,M=0,o.forEach(t=>{let e={width:t.width,height:t.height},i=t.content.text_blocks.filter(t=>"label"===t.block_type||t.text.trim().endsWith(":")),n=t.content.lines.filter(t=>t.is_form_line),o=t.content.rectangles.filter(t=>"text_box"===t.rect_type),r=t.content.rectangles.filter(t=>"checkbox"===t.rect_type),u=[];if(i.forEach(i=>{var s,c,h,d,p,g,m,f;let _,x,w,E,v,$,F=(s=i,c=n,_=a.max_label_distance,x=c.filter(t=>{let e=s.position.x+s.position.width,i=s.position.y;return!!(t.start.x>=e-10&&t.start.x<=e+_&&Math.abs(t.start.y-s.position.y)<s.position.height||t.start.y<=i&&t.start.y>=i-_&&Math.abs(t.start.x-s.position.x)<_)}),0===x.length?null:x.reduce((t,e)=>{let i=l(s.position,b(t));return l(s.position,b(e))<i?e:t})),D=(h=i,d=o,w=a.max_label_distance,E=d.filter(t=>l(h.position,t.position)<w),0===E.length?null:E.reduce((t,e)=>{let i=l(h.position,t.position);return l(h.position,e.position)<i?e:t})),P=(p=i,g=r,v=2*a.max_label_distance,$=g.filter(t=>l(p.position,t.position)<v),0===$.length?null:$.reduce((t,e)=>{let i=l(p.position,t.position);return l(p.position,e.position)<i?e:t}));if(F)u.push(y(`field-${M++}`,i,{type:"text_line",position:b(F)},e,"line_detection"));else if(D)u.push(y(`field-${M++}`,i,{type:"text_box",position:D.position},e,"box_detection"));else if(P)u.push(y(`field-${M++}`,i,{type:"checkbox",position:P.position},e,"box_detection"));else{let n,o=(m=i,f=t.content.text_blocks,m.text.trim(),(n=f.find(t=>{if(t.id===m.id||t.position.y!==m.position.y)return!1;let e=t.position.x>m.position.x+m.position.width,i=/_{3,}/.test(t.text);return e&&i}))?{type:"text_line",position:n.position}:null);o&&u.push(y(`field-${M++}`,i,o,e,"pattern_matching"))}}),u.length>0){let i=c(u.flatMap(t=>[t.label.position,t.input.position]));m.push({id:`form-region-${E++}`,page:t.page_number,position:i,position_normalized:s(i,e),detected_fields:u}),w.push(...u)}}),{formRegions:m,detectedFields:w});return{layout:{document_type:e,title:F,sections:$,table_regions:D,form_regions:P,reading_order:(r=t,v=[],r.forEach(t=>{[...t.content.text_blocks].sort((t,e)=>{let i=t.position_normalized.y-e.position_normalized.y;return Math.abs(i)>.02?i:t.position_normalized.x-e.position_normalized.x}).forEach(t=>v.push(t.id))}),v)},detectedFields:T,tableRegions:D}}(g,p.metadata.detected_type),v=M(p.rawText),F=E(g,p.formFields,w.tableRegions,v),D={duration_ms:Date.now()-r,ocr_used:m,ocr_engine:m?"tesseract":null,ocr_confidence:null,warnings:u,pages_processed:g.length,pages_skipped:(n.max_pages||0)>0?Math.max(0,p.metadata.page_count-g.length):0},P={document_id:crypto.randomUUID(),status:u.length>0?"partial":"complete",metadata:p.metadata,fingerprints:F,pages:g,layout:w.layout,form_fields:p.formFields,processing:D};return{success:!0,document:P}}catch(t){return console.error("Document processing error:",t),{success:!1,error:i.parseFailed("unknown",t instanceof Error?t.message:"Unknown error")}}}t.s(["generateContentHash",()=>M,"generateFingerprints",()=>E],293261),t.s(["detectMimeType",()=>F,"validateFile",()=>$],556274),t.s(["processDocument",()=>D],18444)}];

//# sourceMappingURL=lib_engines_documind_index_ts_184b8c17._.js.map