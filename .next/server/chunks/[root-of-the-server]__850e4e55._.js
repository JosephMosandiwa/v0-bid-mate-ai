module.exports=[918622,(e,t,o)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,o)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,o)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,o)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},193695,(e,t,o)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},89660,e=>{"use strict";e.i(929961);var t=e.i(771884),o=e.i(875216);async function r(){let e=await (0,o.cookies)();return(0,t.createServerClient)("https://xqyecqkrtaydoesxnvlw.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhxeWVjcWtydGF5ZG9lc3hudmx3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEzMjM0NTgsImV4cCI6MjA3Njg5OTQ1OH0.wsb5Jz_I9RqxoNoZ6D3QPbK4aefbdGKcrGgWDfm3c4o",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:o,options:r})=>e.set(t,o,r))}catch{}}}})}e.s(["createClient",()=>r,"createServerClient",0,r])},493586,e=>{"use strict";var t=e.i(248749),o=e.i(219650),r=e.i(508677),n=e.i(615159),s=e.i(548938),l=e.i(273073),a=e.i(129714),i=e.i(403736),c=e.i(817889),d=e.i(428765),u=e.i(762198),p=e.i(117109),f=e.i(590702),g=e.i(462216),h=e.i(539401),v=e.i(222695),m=e.i(193695);e.i(31514);var R=e.i(267074),x=e.i(89660);e.i(801612);var y=e.i(430497);function F(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"").trim()}async function w(e,t){try{let{id:o}=t?.params?await t.params:t?.params??t,{documentId:r}=await e.json(),n=await (0,x.createClient)();console.log("[v0] ========================================"),console.log("[v0] FILL PDF REQUEST"),console.log("[v0] ========================================"),console.log("[v0] Filling PDF for custom tender:",o,"document:",r);let{data:{user:s}}=await n.auth.getUser();if(!s)return console.log("[v0] No user found - unauthorized"),Response.json({error:"Unauthorized"},{status:401});console.log("[v0] User ID:",s.id);let{data:l,error:a}=await n.from("user_custom_tender_responses").select("*").eq("tender_id",o).eq("user_id",s.id).single();if(console.log("[v0] Response query result:",{responseData:l,responseError:a}),a&&"PGRST116"!==a.code)return console.error("[v0] Error fetching responses:",a),Response.json({error:"Failed to fetch form responses"},{status:500});let i=l?.response_data||{};console.log("[v0] Form responses:",i),console.log("[v0] Number of saved responses:",Object.keys(i).length),console.log("[v0] Response field IDs:",Object.keys(i));let{data:c,error:d}=await n.from("user_custom_tender_documents").select("*").eq("id",r).single();if(console.log("[v0] Document query result:",{docData:c,docError:d}),d||!c)return console.error("[v0] Error fetching document:",d),Response.json({error:"Document not found"},{status:404});if(console.log("[v0] Document file type:",c.file_type),"application/pdf"!==c.file_type)return Response.json({error:"Only PDF documents can be filled"},{status:400});console.log("[v0] Downloading PDF from:",c.blob_url);let u=await fetch(c.blob_url);if(!u.ok)return console.error("[v0] Error downloading PDF from blob, status:",u.status),Response.json({error:"Failed to download PDF"},{status:500});let p=await u.arrayBuffer();console.log("[v0] PDF downloaded, size:",p.byteLength,"bytes");let f=await y.PDFDocument.load(p,{ignoreEncryption:!0}),g=f.getForm(),h=g.getFields();console.log("[v0] ========================================"),console.log("[v0] PDF FORM ANALYSIS"),console.log("[v0] ========================================"),console.log("[v0] PDF has",h.length,"form fields");let v=h.map(e=>e.getName());console.log("[v0] PDF field names:",v),console.log("[v0] ========================================");let m=0,R=[];if(Object.keys(i).length>0)for(let[e,t]of(console.log("[v0] Attempting to fill fields with improved fuzzy matching..."),Object.entries(i)))try{console.log("[v0] ----------------------------------------"),console.log("[v0] Trying to fill field:",e),console.log("[v0] Value:",t),console.log("[v0] Value type:",typeof t);let o=function(e,t){let o=F(e),r=t.find(t=>t===e);if(r)return{fieldName:r,confidence:1};let n=t.find(e=>F(e)===o);if(n)return{fieldName:n,confidence:.95};for(let e of t){let t=F(e);if(o.includes(t)||t.includes(o))return{fieldName:e,confidence:.8}}let s=o.match(/[a-z]+/g)||[],l=null;for(let e of t){let t=F(e).match(/[a-z]+/g)||[],o=s.filter(e=>t.some(t=>t.includes(e)||e.includes(t)));if(o.length>0){let r=o.length/Math.max(s.length,t.length)*.7;(!l||r>l.confidence)&&(l={fieldName:e,confidence:r})}}return l&&l.confidence>=.3?l:null}(e,v);if(o){console.log("[v0] ✓ Found matching PDF field:",o.fieldName,"confidence:",o.confidence.toFixed(2));try{let r=g.getField(o.fieldName),n=r.constructor.name;console.log("[v0] Field type:",n);let s=!1;if("PDFTextField"===n){let e=String(t||"");r.setText(e),console.log("[v0] ✓ Successfully filled text field with:",e.substring(0,50)),s=!0}else"PDFCheckBox"===n?(!0===t||"true"===t||"yes"===t||"Yes"===t||"1"===t?(r.check(),console.log("[v0] ✓ Successfully checked checkbox")):(r.uncheck(),console.log("[v0] ✓ Successfully unchecked checkbox")),s=!0):"PDFRadioGroup"===n?(r.select(String(t)),console.log("[v0] ✓ Successfully selected radio option:",t),s=!0):"PDFDropdown"===n?(r.select(String(t)),console.log("[v0] ✓ Successfully selected dropdown option:",t),s=!0):console.log("[v0] ⚠ Unsupported field type:",n);s?(m++,R.push({responseField:e,pdfField:o.fieldName,success:!0,confidence:o.confidence})):R.push({responseField:e,pdfField:o.fieldName,success:!1,confidence:o.confidence})}catch(t){console.error("[v0] Error setting field value:",t.message),R.push({responseField:e,pdfField:o.fieldName,success:!1,confidence:o.confidence})}}else console.log("[v0] ✗ No matching PDF field found for:",e),R.push({responseField:e,pdfField:null,success:!1})}catch(t){console.error("[v0] ✗ Error processing field:",e,t.message),R.push({responseField:e,pdfField:null,success:!1})}else console.log("[v0] ⚠ No form responses to fill - formResponses is empty");console.log("[v0] ========================================"),console.log("[v0] FILL SUMMARY"),console.log("[v0] ========================================"),console.log("[v0] Total responses:",Object.keys(i).length),console.log("[v0] Successfully filled:",m),console.log("[v0] Failed to fill:",Object.keys(i).length-m),console.log("[v0] Success rate:",`${(m/Math.max(Object.keys(i).length,1)*100).toFixed(1)}%`),console.log("[v0] ========================================"),console.log("[v0] FIELD MATCHING LOG:"),R.forEach(e=>{let t=e.success?"✓":"✗",o=e.confidence?` (${(100*e.confidence).toFixed(0)}% match)`:"";console.log(`[v0] ${t} ${e.responseField} → ${e.pdfField||"NO MATCH"}${o}`)}),console.log("[v0] ========================================"),0===m&&Object.keys(i).length>0&&(console.log("[v0] ⚠⚠⚠ WARNING: No fields were filled! ⚠⚠⚠"),console.log("[v0] This likely means:"),console.log("[v0] 1. The PDF has no interactive form fields, OR"),console.log("[v0] 2. The form field IDs don't match the PDF field names"),console.log("[v0] ========================================"));let w=await f.save();return new Response(w,{headers:{"Content-Type":"application/pdf","Content-Disposition":`attachment; filename="filled_${c.file_name}"`,"X-PDF-Fields-Total":String(h.length),"X-Fields-Filled":String(m),"X-Responses-Total":String(Object.keys(i).length),"X-Fill-Success-Rate":String((m/Math.max(Object.keys(i).length,1)*100).toFixed(1))}})}catch(e){return console.error("[v0] ========================================"),console.error("[v0] ERROR IN FILL PDF"),console.error("[v0] ========================================"),console.error("[v0] Error:",e),console.error("[v0] Error message:",e?.message),console.error("[v0] Error stack:",e?.stack),console.error("[v0] ========================================"),Response.json({error:e.message||"Failed to fill PDF"},{status:500})}}e.s(["POST",()=>w],288297);var E=e.i(288297);let b=new t.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/custom-tenders/[id]/fill-pdf/route",pathname:"/api/custom-tenders/[id]/fill-pdf",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/custom-tenders/[id]/fill-pdf/route.ts",nextConfigOutput:"",userland:E}),{workAsyncStorage:C,workUnitAsyncStorage:N,serverHooks:D}=b;function P(){return(0,r.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:N})}async function k(e,t,r){b.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let x="/api/custom-tenders/[id]/fill-pdf/route";x=x.replace(/\/index$/,"")||"/";let y=await b.prepare(e,t,{srcPage:x,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:F,params:w,nextConfig:E,parsedUrl:C,isDraftMode:N,prerenderManifest:D,routerServerContext:P,isOnDemandRevalidate:k,revalidateOnlyGenerated:S,resolvedPathname:O,clientReferenceManifest:I,serverActionsManifest:T}=y,j=(0,i.normalizeAppPath)(x),A=!!(D.dynamicRoutes[j]||D.routes[O]),_=async()=>((null==P?void 0:P.render404)?await P.render404(e,t,C,!1):t.end("This page could not be found"),null);if(A&&!N){let e=!!D.routes[O],t=D.dynamicRoutes[j];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await _();throw new m.NoFallbackError}}let M=null;!A||b.isDev||N||(M="/index"===(M=O)?"/":M);let q=!0===b.isDev||!A,U=A&&!q;T&&I&&(0,l.setReferenceManifestsSingleton)({page:x,clientReferenceManifest:I,serverActionsManifest:T,serverModuleMap:(0,a.createServerModuleMap)({serverActionsManifest:T})});let H=e.method||"GET",L=(0,s.getTracer)(),$=L.getActiveScopeSpan(),z={params:w,prerenderManifest:D,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:q,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,o,r)=>b.onRequestError(e,t,r,P)},sharedContext:{buildId:F}},G=new c.NodeNextRequest(e),K=new c.NodeNextResponse(t),X=d.NextRequestAdapter.fromNodeNextRequest(G,(0,d.signalFromNodeResponse)(t));try{let l=async e=>b.handle(X,z).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let o=L.getRootSpanAttributes();if(!o)return;if(o.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${o.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=o.get("next.route");if(r){let t=`${H} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${x}`)}),a=!!(0,n.getRequestMeta)(e,"minimalMode"),i=async n=>{var s,i;let c=async({previousCacheEntry:o})=>{try{if(!a&&k&&S&&!o)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await l(n);e.fetchMetrics=z.renderOpts.fetchMetrics;let i=z.renderOpts.pendingWaitUntil;i&&r.waitUntil&&(r.waitUntil(i),i=void 0);let c=z.renderOpts.collectedTags;if(!A)return await (0,f.sendResponse)(G,K,s,z.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(s.headers);c&&(t[v.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let o=void 0!==z.renderOpts.collectedRevalidate&&!(z.renderOpts.collectedRevalidate>=v.INFINITE_CACHE)&&z.renderOpts.collectedRevalidate,r=void 0===z.renderOpts.collectedExpire||z.renderOpts.collectedExpire>=v.INFINITE_CACHE?void 0:z.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:o,expire:r}}}}catch(t){throw(null==o?void 0:o.isStale)&&await b.onRequestError(e,t,{routerKind:"App Router",routePath:x,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:k})},P),t}},d=await b.handleResponse({req:e,nextConfig:E,cacheKey:M,routeKind:o.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:D,isRoutePPREnabled:!1,isOnDemandRevalidate:k,revalidateOnlyGenerated:S,responseGenerator:c,waitUntil:r.waitUntil,isMinimalMode:a});if(!A)return null;if((null==d||null==(s=d.value)?void 0:s.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(i=d.value)?void 0:i.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});a||t.setHeader("x-nextjs-cache",k?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),N&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,g.fromNodeOutgoingHttpHeaders)(d.value.headers);return a&&A||u.delete(v.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,h.getCacheControlHeader)(d.cacheControl)),await (0,f.sendResponse)(G,K,new Response(d.value.body,{headers:u,status:d.value.status||200})),null};$?await i($):await L.withPropagatedContext(e.headers,()=>L.trace(u.BaseServerSpan.handleRequest,{spanName:`${H} ${x}`,kind:s.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},i))}catch(t){if(t instanceof m.NoFallbackError||await b.onRequestError(e,t,{routerKind:"App Router",routePath:j,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:k})}),A)throw t;return await (0,f.sendResponse)(G,K,new Response(null,{status:500})),null}}e.s(["handler",()=>k,"patchFetch",()=>P,"routeModule",()=>b,"serverHooks",()=>D,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>N],493586)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__850e4e55._.js.map