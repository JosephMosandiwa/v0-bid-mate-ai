{"version":3,"sources":["../../../app/api/analyze-tender/route.ts","../../../node_modules/.pnpm/next%4016.0.10_%40opentelemetry_0d106b891cc3169ef6f583aee116eb12/node_modules/next/dist/esm/build/templates/app-route.js","../../../lib/prompts/original-analysis-prompt.ts","../../../lib/prompts/custom-analysis-prompt.ts","../../../lib/prompts/index.ts"],"sourcesContent":["import generateTextViaProvider from \"@/lib/providers\"\r\nimport { extractText } from \"unpdf\"\r\nimport { PDFDocument } from \"pdf-lib\"\r\nimport { getAnalysisPrompt } from \"@/lib/prompts\"\r\n\r\nasync function extractPdfFormFields(pdfUrl: string): Promise<{\r\n  fields: Array<{\r\n    name: string\r\n    type: string\r\n    options?: string[]\r\n    position?: { x: number; y: number; width: number; height: number; page: number }\r\n  }>\r\n  hasFormFields: boolean\r\n}> {\r\n  try {\r\n    console.log(\"[v0] Extracting PDF form fields from:\", pdfUrl)\r\n    const pdfResponse = await fetch(pdfUrl)\r\n    if (!pdfResponse.ok) {\r\n      throw new Error(`Failed to fetch PDF: ${pdfResponse.status}`)\r\n    }\r\n\r\n    const pdfBytes = await pdfResponse.arrayBuffer()\r\n    const pdfDoc = await PDFDocument.load(pdfBytes, { ignoreEncryption: true })\r\n    const form = pdfDoc.getForm()\r\n    const fields = form.getFields()\r\n    const pages = pdfDoc.getPages()\r\n\r\n    const extractedFields = fields.map((field: any) => {\r\n      const name = field.getName()\r\n      const typeName = field.constructor.name\r\n\r\n      let type = \"text\"\r\n      let options: string[] | undefined\r\n      let position: { x: number; y: number; width: number; height: number; page: number } | undefined\r\n\r\n      if (typeName === \"PDFTextField\") {\r\n        type = \"text\"\r\n      } else if (typeName === \"PDFCheckBox\") {\r\n        type = \"checkbox\"\r\n      } else if (typeName === \"PDFRadioGroup\") {\r\n        type = \"radio\"\r\n        try {\r\n          options = (field as any).getOptions?.() || []\r\n        } catch {\r\n          options = []\r\n        }\r\n      } else if (typeName === \"PDFDropdown\") {\r\n        type = \"select\"\r\n        try {\r\n          options = (field as any).getOptions?.() || []\r\n        } catch {\r\n          options = []\r\n        }\r\n      }\r\n\r\n      try {\r\n          const widgets = field.acroField.getWidgets()\r\n        if (widgets.length > 0) {\r\n          const widget = widgets[0]\r\n          const rect = widget.getRectangle()\r\n\r\n          // Find which page this widget is on\r\n          let pageIndex = 0\r\n          for (let i = 0; i < pages.length; i++) {\r\n            const pageRef = pages[i].ref\r\n            const widgetPage = widget.P()\r\n            if (widgetPage && pageRef.toString() === widgetPage.toString()) {\r\n              pageIndex = i\r\n              break\r\n            }\r\n          }\r\n\r\n          position = {\r\n            x: rect.x,\r\n            y: rect.y,\r\n            width: rect.width,\r\n            height: rect.height,\r\n            page: pageIndex + 1, // 1-based page number\r\n          }\r\n          console.log(`[v0] Field \"${name}\" position:`, position)\r\n        }\r\n      } catch (posError) {\r\n        console.log(`[v0] Could not extract position for field \"${name}\"`)\r\n      }\r\n\r\n      return { name, type, options, position }\r\n    })\r\n\r\n    console.log(\"[v0] Found\", extractedFields.length, \"PDF form fields with positions\")\r\n\r\n    return {\r\n      fields: extractedFields,\r\n      hasFormFields: extractedFields.length > 0,\r\n    }\r\n  } catch (error: any) {\r\n    console.log(\"[v0] Could not extract PDF form fields:\", error.message)\r\n    return { fields: [], hasFormFields: false }\r\n  }\r\n}\r\n\r\nexport async function POST(request: Request) {\r\n  try {\r\n    const { documentText, documentUrl, pdfFields } = await request.json()\r\n\r\n    console.log(\"[v0] ========================================\")\r\n    console.log(\"[v0] TENDER ANALYSIS REQUEST\")\r\n    console.log(\"[v0] ========================================\")\r\n    console.log(\"[v0] Document text length:\", documentText?.length || 0, \"characters\")\r\n    console.log(\"[v0] Document URL provided:\", documentUrl ? \"YES\" : \"NO\")\r\n    console.log(\"[v0] PDF fields provided:\", pdfFields?.length || 0)\r\n\r\n    if (!documentText && !documentUrl) {\r\n      return Response.json({ error: \"Either document text or document URL is required\" }, { status: 400 })\r\n    }\r\n\r\n    let pdfFormFields: Array<{\r\n      name: string\r\n      type: string\r\n      options?: string[]\r\n      position?: { x: number; y: number; width: number; height: number; page: number }\r\n    }> = []\r\n    let hasPdfFormFields = false\r\n\r\n    if (documentUrl) {\r\n      const pdfFieldsResult = await extractPdfFormFields(documentUrl)\r\n      pdfFormFields = pdfFieldsResult.fields\r\n      hasPdfFormFields = pdfFieldsResult.hasFormFields\r\n      console.log(\"[v0] PDF has interactive form fields:\", hasPdfFormFields)\r\n    }\r\n\r\n    let textToAnalyze = documentText\r\n\r\n    if (documentUrl && (!documentText || documentText === \"\")) {\r\n      console.log(\"[v0] No text provided - extracting from PDF URL using unpdf...\")\r\n      console.log(\"[v0] PDF URL:\", documentUrl)\r\n\r\n      try {\r\n        console.log(\"[v0] Step 1: Fetching PDF from blob storage...\")\r\n\r\n        const pdfResponse = await fetch(documentUrl)\r\n        if (!pdfResponse.ok) {\r\n          throw new Error(`Failed to fetch PDF: ${pdfResponse.status} ${pdfResponse.statusText}`)\r\n        }\r\n\r\n        const pdfArrayBuffer = await pdfResponse.arrayBuffer()\r\n        console.log(\"[v0] PDF fetched successfully, size:\", (pdfArrayBuffer.byteLength / 1024).toFixed(2), \"KB\")\r\n\r\n        console.log(\"[v0] Step 2: Extracting text using unpdf library...\")\r\n\r\n        const { text, totalPages } = await extractText(pdfArrayBuffer, { mergePages: true })\r\n\r\n        textToAnalyze = text\r\n        console.log(\"[v0] ✓ Text extracted successfully using unpdf\")\r\n        console.log(\"[v0] Total pages:\", totalPages)\r\n        console.log(\"[v0] Extracted text length:\", textToAnalyze.length, \"characters\")\r\n        console.log(\"[v0] First 500 characters:\", textToAnalyze.substring(0, 500))\r\n\r\n        if (!textToAnalyze || textToAnalyze.trim().length < 50) {\r\n          throw new Error(\r\n            `Insufficient text extracted from PDF - only got ${textToAnalyze?.length || 0} characters. The PDF might be scanned/image-based.`,\r\n          )\r\n        }\r\n\r\n        const wordCount = textToAnalyze.trim().split(/\\s+/).length\r\n        const avgWordsPerPage = Math.round(wordCount / totalPages)\r\n        console.log(\"[v0] Word count:\", wordCount)\r\n        console.log(\"[v0] Average words per page:\", avgWordsPerPage)\r\n\r\n        if (avgWordsPerPage < 50) {\r\n          console.warn(\"[v0] ⚠️ WARNING: Low word density - PDF might be partially scanned\")\r\n        }\r\n      } catch (extractError: any) {\r\n        console.error(\"[v0] PDF TEXT EXTRACTION FAILED\")\r\n        console.error(\"[v0] Error message:\", extractError?.message)\r\n\r\n        return Response.json(\r\n          {\r\n            error: \"Failed to extract text from PDF\",\r\n            errorType: \"pdf_extraction_error\",\r\n            details: extractError?.message || \"Could not read PDF content\",\r\n            hint: \"The PDF might be scanned/image-based, corrupted, or password-protected. Try converting it to a text-based PDF first.\",\r\n          },\r\n          { status: 500 },\r\n        )\r\n      }\r\n    }\r\n\r\n    if (!textToAnalyze || textToAnalyze.length < 50) {\r\n      return Response.json(\r\n        {\r\n          error: \"Document text is too short to analyze\",\r\n          errorType: \"insufficient_content\",\r\n          details: `Only ${textToAnalyze?.length || 0} characters available.`,\r\n        },\r\n        { status: 400 },\r\n      )\r\n    }\r\n\r\n    const truncatedText = textToAnalyze!.substring(0, 100000)\r\n    console.log(\"[v0] Using text for analysis, length:\", truncatedText.length, \"characters\")\r\n\r\n    const basePrompt = getAnalysisPrompt()\r\n\r\n    let pdfFieldsInstruction = \"\"\r\n    if (hasPdfFormFields && pdfFormFields.length > 0) {\r\n      pdfFieldsInstruction = `\r\nIMPORTANT - PDF FORM FIELDS DETECTED:\r\nThis PDF document has ${pdfFormFields.length} interactive form fields. You MUST use these EXACT field names as the \"id\" for your formFields output so they can be auto-filled in the PDF.\r\n\r\nHere are the actual PDF form field names and their types:\r\n${pdfFormFields\r\n          .map((f) => {\r\n            let info = `- \"${f.name}\" (type: ${f.type})`\r\n            if (f.options && f.options.length > 0) {\r\n              info += ` [options: ${f.options.join(\", \")}]`\r\n            }\r\n            if (f.position) {\r\n              info += ` [position: page ${f.position.page}, x ${f.position.x}, y ${f.position.y}, width ${f.position.width}, height ${f.position.height}]`\r\n            }\r\n            return info\r\n          })\r\n          .join(\"\\n\")}\r\n\r\nFor each PDF field above, create a corresponding formField entry with:\r\n- id: Use the EXACT field name from the PDF (e.g., \"${pdfFormFields[0]?.name || \"Text1\"}\")\r\n- label: A human-readable label describing what the field is for\r\n- type: Match the PDF field type (text, checkbox, select, etc.)\r\n- section: Group related fields together\r\n- required: true if the field appears mandatory\r\n- description: Help text for the user\r\n\r\nIf the PDF has fewer than 20 form fields, also add additional formFields for any information requested in the document text that doesn't have a corresponding PDF field.\r\n`\r\n    } else {\r\n      pdfFieldsInstruction = `\r\nNOTE: This PDF does not have interactive form fields. Generate formFields based on ALL fillable information requested in the document text. Create 25-50 fields covering company details, pricing, declarations, technical responses, and all SBD/MBD forms referenced in the document.\r\n`\r\n    }\r\n\r\n    console.log(\"[v0] Step 3: Calling configured AI provider via wrapper for analysis...\")\r\n\r\n    try {\r\n      const startTime = Date.now()\r\n\r\n      const { text: aiResponse } = await generateTextViaProvider({\r\n        model: \"gemini-1.5-flash\",\r\n        prompt: `${basePrompt}\r\n\r\n${pdfFieldsInstruction}\r\n\r\nIMPORTANT: You MUST respond with ONLY valid JSON. No markdown, no explanations, no code blocks. Just pure JSON.\r\n\r\n===========================================\r\nTENDER DOCUMENT TEXT\r\n===========================================\r\n\r\n${truncatedText}\r\n\r\n===========================================\r\nEND OF DOCUMENT\r\n===========================================\r\n\r\nRespond with ONLY the following JSON structure (no markdown, no code blocks, just raw JSON):\r\n\r\n{\r\n  \"tender_summary\": {\r\n    \"tender_number\": \"string or Not specified\",\r\n    \"title\": \"string or Not specified\",\r\n    \"entity\": \"string or Not specified\",\r\n    \"description\": \"string or Not specified\",\r\n    \"contract_duration\": \"string or Not specified\",\r\n    \"closing_date\": \"YYYY-MM-DD format or Not specified\",\r\n    \"submission_method\": \"string or Not specified\",\r\n    \"compulsory_briefing\": \"string or Not specified\",\r\n    \"validity_period\": \"string or Not specified\",\r\n    \"contact_email\": \"string or Not specified\"\r\n  },\r\n  \"compliance_summary\": {\r\n    \"requirements\": [\"array of requirement strings\"],\r\n    \"disqualifiers\": [\"array of disqualifier strings\"],\r\n    \"strengtheners\": [\"array of strengthener strings\"]\r\n  },\r\n  \"evaluation\": {\r\n    \"criteria\": [{\"criterion\": \"string\", \"weight\": number}],\r\n    \"threshold\": \"string or Not specified\",\r\n    \"pricing_system\": \"string or Not specified\"\r\n  },\r\n  \"action_plan\": {\r\n    \"critical_dates\": [{\"date\": \"YYYY-MM-DD\", \"event\": \"string\", \"time\": \"string\", \"location\": \"string\"}],\r\n    \"preparation_tasks\": [{\"task\": \"string\", \"priority\": \"High/Medium/Low\", \"deadline\": \"string\", \"category\": \"string\"}]\r\n  },\r\n  \"financial_requirements\": {\r\n    \"bank_guarantee\": \"string or Not specified\",\r\n    \"performance_bond\": \"string or Not specified\",\r\n    \"insurance_requirements\": [\"array of strings\"],\r\n    \"financial_turnover\": \"string or Not specified\",\r\n    \"audited_financials\": \"string or Not specified\",\r\n    \"payment_terms\": \"string or Not specified\"\r\n  },\r\n  \"legal_registration\": {\r\n    \"cidb_grading\": \"string or Not specified\",\r\n    \"cipc_registration\": \"string or Not specified\",\r\n    \"professional_registration\": [\"array of strings\"],\r\n    \"joint_venture_requirements\": \"string or Not specified\",\r\n    \"subcontracting_limitations\": \"string or Not specified\"\r\n  },\r\n  \"labour_employment\": {\r\n    \"local_content\": \"string or Not specified\",\r\n    \"subcontracting_limit\": \"string or Not specified\",\r\n    \"labour_composition\": \"string or Not specified\",\r\n    \"skills_development\": \"string or Not specified\",\r\n    \"employment_equity\": \"string or Not specified\"\r\n  },\r\n  \"technical_specs\": {\r\n    \"minimum_experience\": \"string or Not specified\",\r\n    \"project_references\": \"string or Not specified\",\r\n    \"key_personnel\": [\"array of strings\"],\r\n    \"equipment_resources\": [\"array of strings\"],\r\n    \"methodology_requirements\": \"string or Not specified\"\r\n  },\r\n  \"submission_requirements\": {\r\n    \"number_of_copies\": \"string or Not specified\",\r\n    \"formatting_requirements\": \"string or Not specified\",\r\n    \"submission_address\": \"string or Not specified\",\r\n    \"query_deadline\": \"string or Not specified\",\r\n    \"late_submission_policy\": \"string or Not specified\"\r\n  },\r\n  \"penalties_payment\": {\r\n    \"late_completion_penalty\": \"string or Not specified\",\r\n    \"non_performance_penalty\": \"string or Not specified\",\r\n    \"warranty_period\": \"string or Not specified\",\r\n    \"payment_schedule\": \"string or Not specified\",\r\n    \"retention_amount\": \"string or Not specified\",\r\n    \"payment_timeframe\": \"string or Not specified\"\r\n  },\r\n  \"formFields\": [\r\n    {\r\n      \"id\": \"unique_field_id_or_pdf_field_name\",\r\n      \"label\": \"Field Label\",\r\n      \"type\": \"text|textarea|number|date|select|checkbox|file|email|tel\",\r\n      \"required\": true/false,\r\n      \"section\": \"Section Name\",\r\n      \"placeholder\": \"optional placeholder\",\r\n      \"description\": \"optional description\",\r\n      \"options\": [\"for select fields only\"],\r\n      \"pdfFieldName\": \"original PDF field name if applicable\"\r\n    }\r\n  ],\r\n  \"pdfFormFieldsDetected\": ${hasPdfFormFields},\r\n  \"pdfFormFieldCount\": ${pdfFormFields.length}\r\n}`,\r\n      })\r\n\r\n      const endTime = Date.now()\r\n      console.log(\"[v0] AI generation completed in\", (endTime - startTime) / 1000, \"seconds\")\r\n      console.log(\"[v0] Raw AI response length:\", aiResponse.length, \"characters\")\r\n      console.log(\"[v0] First 500 chars of response:\", aiResponse.substring(0, 500))\r\n\r\n      let analysis\r\n      try {\r\n        let cleanedResponse = aiResponse.trim()\r\n        if (cleanedResponse.startsWith(\"```json\")) {\r\n          cleanedResponse = cleanedResponse.slice(7)\r\n        }\r\n        if (cleanedResponse.startsWith(\"```\")) {\r\n          cleanedResponse = cleanedResponse.slice(3)\r\n        }\r\n        if (cleanedResponse.endsWith(\"```\")) {\r\n          cleanedResponse = cleanedResponse.slice(0, -3)\r\n        }\r\n        cleanedResponse = cleanedResponse.trim()\r\n\r\n        analysis = JSON.parse(cleanedResponse)\r\n        console.log(\"[v0] ✓ JSON parsed successfully\")\r\n      } catch (parseError: any) {\r\n        console.error(\"[v0] JSON parse error:\", parseError.message)\r\n        console.error(\"[v0] Response that failed to parse:\", aiResponse.substring(0, 1000))\r\n\r\n        return Response.json(\r\n          {\r\n            error: \"Failed to parse AI response as JSON\",\r\n            errorType: \"json_parse_error\",\r\n            details: parseError.message,\r\n          },\r\n          { status: 500 },\r\n        )\r\n      }\r\n\r\n      analysis.pdfFormFieldsDetected = hasPdfFormFields\r\n      analysis.pdfFormFieldCount = pdfFormFields.length\r\n      analysis.pdfFormFields = pdfFormFields\r\n\r\n      const defaults = {\r\n        tender_summary: {\r\n          tender_number: \"Not specified\",\r\n          title: \"Not specified\",\r\n          entity: \"Not specified\",\r\n          description: \"Not specified\",\r\n          contract_duration: \"Not specified\",\r\n          closing_date: \"Not specified\",\r\n          submission_method: \"Not specified\",\r\n          compulsory_briefing: \"Not specified\",\r\n          validity_period: \"Not specified\",\r\n          contact_email: \"Not specified\",\r\n        },\r\n        compliance_summary: {\r\n          requirements: [],\r\n          disqualifiers: [],\r\n          strengtheners: [],\r\n        },\r\n        evaluation: {\r\n          criteria: [],\r\n          threshold: \"Not specified\",\r\n          pricing_system: \"Not specified\",\r\n        },\r\n        action_plan: {\r\n          critical_dates: [],\r\n          preparation_tasks: [],\r\n        },\r\n        financial_requirements: {\r\n          bank_guarantee: \"Not specified\",\r\n          performance_bond: \"Not specified\",\r\n          insurance_requirements: [],\r\n          financial_turnover: \"Not specified\",\r\n          audited_financials: \"Not specified\",\r\n          payment_terms: \"Not specified\",\r\n        },\r\n        legal_registration: {\r\n          cidb_grading: \"Not specified\",\r\n          cipc_registration: \"Not specified\",\r\n          professional_registration: [],\r\n          joint_venture_requirements: \"Not specified\",\r\n          subcontracting_limitations: \"Not specified\",\r\n        },\r\n        labour_employment: {\r\n          local_content: \"Not specified\",\r\n          subcontracting_limit: \"Not specified\",\r\n          labour_composition: \"Not specified\",\r\n          skills_development: \"Not specified\",\r\n          employment_equity: \"Not specified\",\r\n        },\r\n        technical_specs: {\r\n          minimum_experience: \"Not specified\",\r\n          project_references: \"Not specified\",\r\n          key_personnel: [],\r\n          equipment_resources: [],\r\n          methodology_requirements: \"Not specified\",\r\n        },\r\n        submission_requirements: {\r\n          number_of_copies: \"Not specified\",\r\n          formatting_requirements: \"Not specified\",\r\n          submission_address: \"Not specified\",\r\n          query_deadline: \"Not specified\",\r\n          late_submission_policy: \"Not specified\",\r\n        },\r\n        penalties_payment: {\r\n          late_completion_penalty: \"Not specified\",\r\n          non_performance_penalty: \"Not specified\",\r\n          warranty_period: \"Not specified\",\r\n          payment_schedule: \"Not specified\",\r\n          retention_amount: \"Not specified\",\r\n          payment_timeframe: \"Not specified\",\r\n        },\r\n        formFields: [],\r\n      }\r\n\r\n      for (const key of Object.keys(defaults)) {\r\n        if (!analysis[key]) {\r\n          console.log(`[v0] Adding default for missing: ${key}`)\r\n          analysis[key] = defaults[key as keyof typeof defaults]\r\n        } else if (\r\n          typeof defaults[key as keyof typeof defaults] === \"object\" &&\r\n          !Array.isArray(defaults[key as keyof typeof defaults])\r\n        ) {\r\n          analysis[key] = { ...defaults[key as keyof typeof defaults], ...analysis[key] }\r\n        }\r\n      }\r\n\r\n      console.log(\"[v0] ========================================\")\r\n      console.log(\"[v0] ANALYSIS RESULTS\")\r\n      console.log(\"[v0] ========================================\")\r\n      console.log(\"[v0] Tender title:\", analysis.tender_summary?.title)\r\n      console.log(\"[v0] Requirements count:\", analysis.compliance_summary?.requirements?.length || 0)\r\n      console.log(\"[v0] Disqualifiers count:\", analysis.compliance_summary?.disqualifiers?.length || 0)\r\n      console.log(\"[v0] Criteria count:\", analysis.evaluation?.criteria?.length || 0)\r\n      console.log(\"[v0] Form fields count:\", analysis.formFields?.length || 0)\r\n      console.log(\"[v0] PDF form fields detected:\", hasPdfFormFields)\r\n      console.log(\"[v0] PDF form field count:\", pdfFormFields.length)\r\n      console.log(\"[v0] ========================================\")\r\n\r\n      return Response.json(analysis)\r\n    } catch (aiError: any) {\r\n      console.error(\"[v0] AI GENERATION ERROR\")\r\n      console.error(\"[v0] Error message:\", aiError?.message)\r\n\r\n      // Check for OpenAI Quota Exceeded (429) and provide fallback for testing\r\n      if (aiError?.message?.includes(\"429\") || aiError?.message?.includes(\"quota\")) {\r\n        console.warn(\"[v0] ⚠️ OpenAI Quota Exceeded. Using MOCK DATA for analysis to unblock testing.\")\r\n\r\n        const mockAnalysis = {\r\n          tender_summary: {\r\n            tender_number: \"MOCK-429-TEST\",\r\n            title: \"Mock Tender (Quota Exceeded Fallback)\",\r\n            entity: \"Fallback Entity\",\r\n            description: \"This is a generated mock description because the OpenAI API key has exceeded its quota. The application flow is preserved for testing purposes.\",\r\n            closing_date: new Date(Date.now() + 86400000 * 14).toISOString().split('T')[0],\r\n            contract_duration: \"12 Months\"\r\n          },\r\n          compliance_summary: {\r\n            requirements: [\"Mock Requirement 1\", \"Mock Requirement 2\"],\r\n            disqualifiers: [\"Mock Disqualifier\"],\r\n            strengtheners: [\"Mock Strengthener\"]\r\n          },\r\n          evaluation: {\r\n            criteria: [{ \"criterion\": \"Price\", \"weight\": 80 }, { \"criterion\": \"BEE\", \"weight\": 20 }]\r\n          },\r\n          formFields: [],\r\n          pdfFormFieldsDetected: hasPdfFormFields,\r\n          pdfFormFieldCount: pdfFormFields.length,\r\n          pdfFormFields: pdfFormFields\r\n        }\r\n        return Response.json(mockAnalysis)\r\n      }\r\n\r\n      console.error(\"[v0] Error stack:\", aiError?.stack?.substring(0, 500))\r\n\r\n      return Response.json(\r\n        {\r\n          error: \"AI generation failed\",\r\n          errorType: \"ai_generation_error\",\r\n          details: aiError?.message || \"Unknown AI error\",\r\n        },\r\n        { status: 500 },\r\n      )\r\n    }\r\n  } catch (error: any) {\r\n    console.error(\"[v0] ========================================\")\r\n    console.error(\"[v0] TENDER ANALYSIS ERROR\")\r\n    console.error(\"[v0] ========================================\")\r\n    console.error(\"[v0] Error type:\", error?.constructor?.name)\r\n    console.error(\"[v0] Error message:\", error?.message)\r\n\r\n    return Response.json(\r\n      {\r\n        error: \"Failed to analyze tender document\",\r\n        details: error?.message || \"Unknown error\",\r\n        errorType: \"server_error\",\r\n      },\r\n      { status: 500 },\r\n    )\r\n  }\r\n}\r\n","import { AppRouteRouteModule } from \"next/dist/esm/server/route-modules/app-route/module.compiled\";\nimport { RouteKind } from \"next/dist/esm/server/route-kind\";\nimport { patchFetch as _patchFetch } from \"next/dist/esm/server/lib/patch-fetch\";\nimport { addRequestMeta, getRequestMeta } from \"next/dist/esm/server/request-meta\";\nimport { getTracer, SpanKind } from \"next/dist/esm/server/lib/trace/tracer\";\nimport { setReferenceManifestsSingleton } from \"next/dist/esm/server/app-render/encryption-utils\";\nimport { createServerModuleMap } from \"next/dist/esm/server/app-render/action-utils\";\nimport { normalizeAppPath } from \"next/dist/esm/shared/lib/router/utils/app-paths\";\nimport { NodeNextRequest, NodeNextResponse } from \"next/dist/esm/server/base-http/node\";\nimport { NextRequestAdapter, signalFromNodeResponse } from \"next/dist/esm/server/web/spec-extension/adapters/next-request\";\nimport { BaseServerSpan } from \"next/dist/esm/server/lib/trace/constants\";\nimport { getRevalidateReason } from \"next/dist/esm/server/instrumentation/utils\";\nimport { sendResponse } from \"next/dist/esm/server/send-response\";\nimport { fromNodeOutgoingHttpHeaders, toNodeOutgoingHttpHeaders } from \"next/dist/esm/server/web/utils\";\nimport { getCacheControlHeader } from \"next/dist/esm/server/lib/cache-control\";\nimport { INFINITE_CACHE, NEXT_CACHE_TAGS_HEADER } from \"next/dist/esm/lib/constants\";\nimport { NoFallbackError } from \"next/dist/esm/shared/lib/no-fallback-error.external\";\nimport { CachedRouteKind } from \"next/dist/esm/server/response-cache\";\nimport * as userland from \"INNER_APP_ROUTE\";\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new AppRouteRouteModule({\n    definition: {\n        kind: RouteKind.APP_ROUTE,\n        page: \"/api/analyze-tender/route\",\n        pathname: \"/api/analyze-tender\",\n        filename: \"route\",\n        bundlePath: \"\"\n    },\n    distDir: process.env.__NEXT_RELATIVE_DIST_DIR || '',\n    relativeProjectDir: process.env.__NEXT_RELATIVE_PROJECT_DIR || '',\n    resolvedPagePath: \"[project]/app/api/analyze-tender/route.ts\",\n    nextConfigOutput,\n    userland\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return _patchFetch({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\nexport { routeModule, workAsyncStorage, workUnitAsyncStorage, serverHooks, patchFetch,  };\nexport async function handler(req, res, ctx) {\n    if (routeModule.isDev) {\n        addRequestMeta(req, 'devRequestTimingInternalsEnd', process.hrtime.bigint());\n    }\n    let srcPage = \"/api/analyze-tender/route\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (process.env.TURBOPACK) {\n        srcPage = srcPage.replace(/\\/index$/, '') || '/';\n    } else if (srcPage === '/index') {\n        // we always normalize /index specifically\n        srcPage = '/';\n    }\n    const multiZoneDraftMode = process.env.__NEXT_MULTI_ZONE_DRAFT_MODE;\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage,\n        multiZoneDraftMode\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return null;\n    }\n    const { buildId, params, nextConfig, parsedUrl, isDraftMode, prerenderManifest, routerServerContext, isOnDemandRevalidate, revalidateOnlyGenerated, resolvedPathname, clientReferenceManifest, serverActionsManifest } = prepareResult;\n    const normalizedSrcPage = normalizeAppPath(srcPage);\n    let isIsr = Boolean(prerenderManifest.dynamicRoutes[normalizedSrcPage] || prerenderManifest.routes[resolvedPathname]);\n    const render404 = async ()=>{\n        // TODO: should route-module itself handle rendering the 404\n        if (routerServerContext == null ? void 0 : routerServerContext.render404) {\n            await routerServerContext.render404(req, res, parsedUrl, false);\n        } else {\n            res.end('This page could not be found');\n        }\n        return null;\n    };\n    if (isIsr && !isDraftMode) {\n        const isPrerendered = Boolean(prerenderManifest.routes[resolvedPathname]);\n        const prerenderInfo = prerenderManifest.dynamicRoutes[normalizedSrcPage];\n        if (prerenderInfo) {\n            if (prerenderInfo.fallback === false && !isPrerendered) {\n                if (nextConfig.experimental.adapterPath) {\n                    return await render404();\n                }\n                throw new NoFallbackError();\n            }\n        }\n    }\n    let cacheKey = null;\n    if (isIsr && !routeModule.isDev && !isDraftMode) {\n        cacheKey = resolvedPathname;\n        // ensure /index and / is normalized to one key\n        cacheKey = cacheKey === '/index' ? '/' : cacheKey;\n    }\n    const supportsDynamicResponse = // If we're in development, we always support dynamic HTML\n    routeModule.isDev === true || // If this is not SSG or does not have static paths, then it supports\n    // dynamic HTML.\n    !isIsr;\n    // This is a revalidation request if the request is for a static\n    // page and it is not being resumed from a postponed render and\n    // it is not a dynamic RSC request then it is a revalidation\n    // request.\n    const isStaticGeneration = isIsr && !supportsDynamicResponse;\n    // Before rendering (which initializes component tree modules), we have to\n    // set the reference manifests to our global store so Server Action's\n    // encryption util can access to them at the top level of the page module.\n    if (serverActionsManifest && clientReferenceManifest) {\n        setReferenceManifestsSingleton({\n            page: srcPage,\n            clientReferenceManifest,\n            serverActionsManifest,\n            serverModuleMap: createServerModuleMap({\n                serverActionsManifest\n            })\n        });\n    }\n    const method = req.method || 'GET';\n    const tracer = getTracer();\n    const activeSpan = tracer.getActiveScopeSpan();\n    const context = {\n        params,\n        prerenderManifest,\n        renderOpts: {\n            experimental: {\n                authInterrupts: Boolean(nextConfig.experimental.authInterrupts)\n            },\n            cacheComponents: Boolean(nextConfig.cacheComponents),\n            supportsDynamicResponse,\n            incrementalCache: getRequestMeta(req, 'incrementalCache'),\n            cacheLifeProfiles: nextConfig.cacheLife,\n            waitUntil: ctx.waitUntil,\n            onClose: (cb)=>{\n                res.on('close', cb);\n            },\n            onAfterTaskError: undefined,\n            onInstrumentationRequestError: (error, _request, errorContext)=>routeModule.onRequestError(req, error, errorContext, routerServerContext)\n        },\n        sharedContext: {\n            buildId\n        }\n    };\n    const nodeNextReq = new NodeNextRequest(req);\n    const nodeNextRes = new NodeNextResponse(res);\n    const nextReq = NextRequestAdapter.fromNodeNextRequest(nodeNextReq, signalFromNodeResponse(res));\n    try {\n        const invokeRouteModule = async (span)=>{\n            return routeModule.handle(nextReq, context).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${srcPage}`);\n                }\n            });\n        };\n        const isMinimalMode = Boolean(process.env.MINIMAL_MODE || getRequestMeta(req, 'minimalMode'));\n        const handleResponse = async (currentSpan)=>{\n            var _cacheEntry_value;\n            const responseGenerator = async ({ previousCacheEntry })=>{\n                try {\n                    if (!isMinimalMode && isOnDemandRevalidate && revalidateOnlyGenerated && !previousCacheEntry) {\n                        res.statusCode = 404;\n                        // on-demand revalidate always sets this header\n                        res.setHeader('x-nextjs-cache', 'REVALIDATED');\n                        res.end('This page could not be found');\n                        return null;\n                    }\n                    const response = await invokeRouteModule(currentSpan);\n                    req.fetchMetrics = context.renderOpts.fetchMetrics;\n                    let pendingWaitUntil = context.renderOpts.pendingWaitUntil;\n                    // Attempt using provided waitUntil if available\n                    // if it's not we fallback to sendResponse's handling\n                    if (pendingWaitUntil) {\n                        if (ctx.waitUntil) {\n                            ctx.waitUntil(pendingWaitUntil);\n                            pendingWaitUntil = undefined;\n                        }\n                    }\n                    const cacheTags = context.renderOpts.collectedTags;\n                    // If the request is for a static response, we can cache it so long\n                    // as it's not edge.\n                    if (isIsr) {\n                        const blob = await response.blob();\n                        // Copy the headers from the response.\n                        const headers = toNodeOutgoingHttpHeaders(response.headers);\n                        if (cacheTags) {\n                            headers[NEXT_CACHE_TAGS_HEADER] = cacheTags;\n                        }\n                        if (!headers['content-type'] && blob.type) {\n                            headers['content-type'] = blob.type;\n                        }\n                        const revalidate = typeof context.renderOpts.collectedRevalidate === 'undefined' || context.renderOpts.collectedRevalidate >= INFINITE_CACHE ? false : context.renderOpts.collectedRevalidate;\n                        const expire = typeof context.renderOpts.collectedExpire === 'undefined' || context.renderOpts.collectedExpire >= INFINITE_CACHE ? undefined : context.renderOpts.collectedExpire;\n                        // Create the cache entry for the response.\n                        const cacheEntry = {\n                            value: {\n                                kind: CachedRouteKind.APP_ROUTE,\n                                status: response.status,\n                                body: Buffer.from(await blob.arrayBuffer()),\n                                headers\n                            },\n                            cacheControl: {\n                                revalidate,\n                                expire\n                            }\n                        };\n                        return cacheEntry;\n                    } else {\n                        // send response without caching if not ISR\n                        await sendResponse(nodeNextReq, nodeNextRes, response, context.renderOpts.pendingWaitUntil);\n                        return null;\n                    }\n                } catch (err) {\n                    // if this is a background revalidate we need to report\n                    // the request error here as it won't be bubbled\n                    if (previousCacheEntry == null ? void 0 : previousCacheEntry.isStale) {\n                        await routeModule.onRequestError(req, err, {\n                            routerKind: 'App Router',\n                            routePath: srcPage,\n                            routeType: 'route',\n                            revalidateReason: getRevalidateReason({\n                                isStaticGeneration,\n                                isOnDemandRevalidate\n                            })\n                        }, routerServerContext);\n                    }\n                    throw err;\n                }\n            };\n            const cacheEntry = await routeModule.handleResponse({\n                req,\n                nextConfig,\n                cacheKey,\n                routeKind: RouteKind.APP_ROUTE,\n                isFallback: false,\n                prerenderManifest,\n                isRoutePPREnabled: false,\n                isOnDemandRevalidate,\n                revalidateOnlyGenerated,\n                responseGenerator,\n                waitUntil: ctx.waitUntil,\n                isMinimalMode\n            });\n            // we don't create a cacheEntry for ISR\n            if (!isIsr) {\n                return null;\n            }\n            if ((cacheEntry == null ? void 0 : (_cacheEntry_value = cacheEntry.value) == null ? void 0 : _cacheEntry_value.kind) !== CachedRouteKind.APP_ROUTE) {\n                var _cacheEntry_value1;\n                throw Object.defineProperty(new Error(`Invariant: app-route received invalid cache entry ${cacheEntry == null ? void 0 : (_cacheEntry_value1 = cacheEntry.value) == null ? void 0 : _cacheEntry_value1.kind}`), \"__NEXT_ERROR_CODE\", {\n                    value: \"E701\",\n                    enumerable: false,\n                    configurable: true\n                });\n            }\n            if (!isMinimalMode) {\n                res.setHeader('x-nextjs-cache', isOnDemandRevalidate ? 'REVALIDATED' : cacheEntry.isMiss ? 'MISS' : cacheEntry.isStale ? 'STALE' : 'HIT');\n            }\n            // Draft mode should never be cached\n            if (isDraftMode) {\n                res.setHeader('Cache-Control', 'private, no-cache, no-store, max-age=0, must-revalidate');\n            }\n            const headers = fromNodeOutgoingHttpHeaders(cacheEntry.value.headers);\n            if (!(isMinimalMode && isIsr)) {\n                headers.delete(NEXT_CACHE_TAGS_HEADER);\n            }\n            // If cache control is already set on the response we don't\n            // override it to allow users to customize it via next.config\n            if (cacheEntry.cacheControl && !res.getHeader('Cache-Control') && !headers.get('Cache-Control')) {\n                headers.set('Cache-Control', getCacheControlHeader(cacheEntry.cacheControl));\n            }\n            await sendResponse(nodeNextReq, nodeNextRes, // @ts-expect-error - Argument of type 'Buffer<ArrayBufferLike>' is not assignable to parameter of type 'BodyInit | null | undefined'.\n            new Response(cacheEntry.value.body, {\n                headers,\n                status: cacheEntry.value.status || 200\n            }));\n            return null;\n        };\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await handleResponse(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${srcPage}`,\n                    kind: SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, handleResponse));\n        }\n    } catch (err) {\n        if (!(err instanceof NoFallbackError)) {\n            await routeModule.onRequestError(req, err, {\n                routerKind: 'App Router',\n                routePath: normalizedSrcPage,\n                routeType: 'route',\n                revalidateReason: getRevalidateReason({\n                    isStaticGeneration,\n                    isOnDemandRevalidate\n                })\n            });\n        }\n        // rethrow so that we can handle serving error page\n        // If this is during static generation, throw the error again.\n        if (isIsr) throw err;\n        // Otherwise, send a 500 response.\n        await sendResponse(nodeNextReq, nodeNextRes, new Response(null, {\n            status: 500\n        }));\n        return null;\n    }\n}\n\n//# sourceMappingURL=app-route.js.map\n","/**\r\n * ORIGINAL AI ANALYSIS PROMPT\r\n *\r\n * This is the original, production-tested prompt for tender document analysis.\r\n * DO NOT MODIFY THIS FILE - it serves as a backup/reference.\r\n *\r\n * To test custom prompts, edit custom-analysis-prompt.ts instead.\r\n */\r\n\r\nexport const ORIGINAL_ANALYSIS_PROMPT = `You are an elite tender analyst with 20+ years of experience helping companies win government and corporate tenders. Your analysis must be thorough, actionable, and strategically valuable.\r\n\r\n===========================================\r\nCRITICAL METADATA EXTRACTION RULES\r\n===========================================\r\n\r\nExtract the following with ABSOLUTE PRECISION:\r\n\r\n1. TENDER TITLE:\r\n   - Extract the EXACT official title word-for-word\r\n   - Look in: Document header, \"Tender Name/Title\", \"Project Name\", \"RFP/RFQ/RFB Title\", \"Bid Number\"\r\n   - Common locations: First page header, title page, section 1\r\n   - DO NOT paraphrase, summarize, or interpret\r\n   - If multiple titles, use the most prominent/official one\r\n   - Example: \"Supply and Delivery of Medical Equipment to Provincial Hospitals\"\r\n\r\n2. ISSUING ORGANIZATION:\r\n   - Extract FULL official name including all hierarchy levels\r\n   - Look for: \"Issued by\", \"Procuring Entity\", \"Department\", \"Ministry\", \"Tender Authority\"\r\n   - Include: Department, Division, Province/Region, Country if specified\r\n   - Example: \"Department of Health, Western Cape Provincial Government, South Africa\"\r\n   - DO NOT abbreviate official names\r\n\r\n3. SUBMISSION DEADLINE:\r\n   - Extract FINAL submission date ONLY (no time component)\r\n   - Look for: \"Closing Date\", \"Submission Deadline\", \"Due Date\", \"Closing Time\", \"Tender Closes\"\r\n   - Format: YYYY-MM-DD ONLY (e.g., \"2024-03-15\")\r\n   - CRITICAL: DO NOT include time (HH:MM) in the deadline field\r\n   - If time is mentioned, include it in the deadlines array instead\r\n   - If unclear, note \"See deadlines section for details\"\r\n\r\n4. TENDER VALUE/BUDGET:\r\n   - Extract estimated contract value, budget range, or ceiling price\r\n   - Look for: \"Tender Value\", \"Estimated Budget\", \"Contract Value\", \"Price Range\", \"Maximum Price\"\r\n   - Include currency and amount: \"R 2,500,000\" or \"ZAR 2.5M\" or \"R 1M - R 3M\"\r\n   - If range, include both min and max\r\n   - If not stated: \"Not specified\" (never guess)\r\n\r\n5. CATEGORY:\r\n   - Classify accurately based on primary deliverable\r\n   - Categories: Construction, IT Services, Medical Supplies, Consulting, Professional Services, \r\n     Goods Supply, Maintenance, Security Services, Catering, Transport, Training, etc.\r\n   - Be specific: \"Medical Equipment Supply\" not just \"Supplies\"\r\n\r\n6. LOCATION:\r\n   - Extract project location, service area, or delivery address\r\n   - Look for: \"Location\", \"Project Site\", \"Delivery Address\", \"Service Area\", \"Province\"\r\n   - Include: City, Province/State, Country\r\n   - Example: \"Cape Town, Western Cape, South Africa\"\r\n\r\n===========================================\r\nCOMPREHENSIVE ANALYSIS REQUIREMENTS\r\n===========================================\r\n\r\nSUMMARY (5-7 sentences, highly informative):\r\nWrite a compelling executive summary that covers:\r\n- What is being procured (specific goods/services/works with quantities if mentioned)\r\n- Who is procuring it (organization, department, context)\r\n- Why it's being procured (background, problem being solved, objectives)\r\n- Key scope elements and main deliverables\r\n- Contract duration and key dates\r\n- Estimated value and budget considerations\r\n- Any unique or notable aspects of this tender\r\n\r\nMake it detailed enough that someone can understand the tender without reading the full document.\r\n\r\nKEY REQUIREMENTS (Extract ALL, be exhaustively specific):\r\nList EVERY requirement mentioned in the document, organized by category:\r\n\r\nMandatory Qualifications:\r\n- Professional registrations (e.g., \"Must be registered with Engineering Council of SA\")\r\n- Industry certifications (e.g., \"ISO 9001:2015 certification required\")\r\n- Licenses and permits\r\n- Minimum years in business\r\n- Minimum staff numbers\r\n\r\nTechnical Specifications:\r\n- Exact product specifications, models, standards\r\n- Technical standards to comply with (e.g., \"SANS 10142-1:2012\")\r\n- Performance requirements and KPIs\r\n- Quality standards\r\n- Testing and inspection requirements\r\n\r\nExperience Requirements:\r\n- Minimum years of relevant experience\r\n- Number of similar projects required (e.g., \"Minimum 3 similar projects in last 5 years\")\r\n- Specific industry experience\r\n- Geographic experience requirements\r\n- Project size/value experience\r\n\r\nFinancial Requirements:\r\n- Minimum annual turnover (e.g., \"R 5M annual turnover for last 3 years\")\r\n- Bank guarantees or bonds required\r\n- Insurance requirements (amounts and types)\r\n- Financial statements required\r\n- Credit rating requirements\r\n\r\nRegistration & Compliance:\r\n- Tax compliance (e.g., \"Valid tax clearance certificate\")\r\n- BBBEE requirements (level, points, certificates)\r\n- Industry body registrations\r\n- Labor compliance\r\n- Environmental compliance\r\n\r\nStaffing & Resources:\r\n- Key personnel requirements (qualifications, experience)\r\n- Minimum team size\r\n- Equipment and facilities required\r\n- Subcontracting limitations\r\n- Local content requirements\r\n\r\nDEADLINES (Extract ALL dates with full context, INCLUDING TIME):\r\nCreate a comprehensive timeline with:\r\n- Briefing session: Date, time, venue, RSVP requirements\r\n- Site visits: Dates, times, meeting points, mandatory/optional\r\n- Clarification questions deadline: Date, time, submission method\r\n- Addendum release dates\r\n- Document submission deadline: Date, time, location/method\r\n- Presentation/interview dates (if scheduled)\r\n- Contract award date (estimated)\r\n- Contract start date\r\n- Project milestones and completion dates\r\n- Payment schedule dates\r\n\r\nFormat each as: \"Action - Date Time - Details\"\r\nExample: \"Compulsory site visit - 2024-02-15 10:00 - Meet at main gate, RSVP by 2024-02-13\"\r\nExample: \"Submission deadline - 2024-03-15 11:00 - Submit to procurement office\"\r\n\r\nNOTE: Include time information in the deadlines array, but NOT in the metadata deadline field.\r\n\r\nEVALUATION CRITERIA (Extract exact scoring methodology):\r\nProvide the complete evaluation breakdown:\r\n\r\nPrice/Cost Component:\r\n- Points allocated (e.g., \"Price: 80 points\")\r\n- Calculation method (e.g., \"Lowest price gets 80 points, others pro-rata\")\r\n\r\nTechnical Component:\r\n- Technical capability points\r\n- Methodology and approach points\r\n- Project plan and timeline points\r\n- Quality assurance points\r\n\r\nExperience & Track Record:\r\n- Relevant experience points\r\n- Similar projects points\r\n- References points\r\n\r\nBBBEE/Transformation:\r\n- BBBEE points breakdown by level\r\n- Local content points\r\n- Subcontracting to SMMEs points\r\n\r\nOther Factors:\r\n- Presentation/interview points\r\n- Financial stability points\r\n- Health & safety record points\r\n\r\nMinimum Requirements:\r\n- Minimum qualifying scores\r\n- Threshold requirements\r\n- Disqualification criteria\r\n\r\nEvaluation Process:\r\n- Two-stage vs single-stage\r\n- Evaluation committee composition\r\n- Evaluation timeline\r\n\r\nRECOMMENDATIONS (Strategic, actionable advice):\r\nProvide expert strategic guidance:\r\n\r\nCritical Success Factors:\r\n- Top 3-5 factors that will determine bid success\r\n- Must-have vs nice-to-have elements\r\n- Common pitfalls to avoid\r\n\r\nCompetitive Positioning:\r\n- How to differentiate from competitors\r\n- Key value propositions to emphasize\r\n- Unique selling points to highlight\r\n\r\nRisk Mitigation:\r\n- Potential challenges and how to address them\r\n- Risk areas requiring special attention\r\n- Contingency planning needs\r\n\r\nResource Allocation:\r\n- Where to focus time and effort\r\n- Which sections need most attention\r\n- Team composition recommendations\r\n\r\nPartnership Strategy:\r\n- Whether partnerships/JVs are advisable\r\n- Types of partners to consider\r\n- Subcontracting opportunities\r\n\r\nPricing Strategy:\r\n- Pricing considerations and approach\r\n- Value engineering opportunities\r\n- Cost optimization areas\r\n\r\nCOMPLIANCE CHECKLIST (Comprehensive list):\r\nCreate a detailed checklist of ALL mandatory requirements:\r\n- Documents to submit (with quantities, e.g., \"3 original copies + 1 electronic\")\r\n- Certificates and licenses needed\r\n- Forms to complete (list each form)\r\n- Declarations to sign\r\n- Samples or prototypes required\r\n- Formatting requirements (page limits, binding, etc.)\r\n- Submission method and location\r\n- Packaging and labeling requirements\r\n\r\nACTIONABLE TASKS (Detailed, prioritized, time-bound):\r\nCreate a comprehensive task list with:\r\n\r\nHIGH PRIORITY (Critical path, early deadlines):\r\n- Tasks that must be done first\r\n- Tasks with imminent deadlines\r\n- Mandatory requirements\r\n- Long lead-time items\r\nExample: \"Obtain tax clearance certificate - Due: 2024-02-20 - Category: compliance\"\r\n\r\nMEDIUM PRIORITY (Important but not urgent):\r\n- Important preparation tasks\r\n- Standard requirements\r\n- Supporting documentation\r\nExample: \"Prepare company profile and credentials - Due: 2024-03-01 - Category: documentation\"\r\n\r\nLOW PRIORITY (Optional or later-stage):\r\n- Nice-to-have elements\r\n- Final touches\r\n- Post-submission tasks\r\nExample: \"Prepare presentation materials for interview - Due: TBD - Category: other\"\r\n\r\nFor each task include:\r\n- Specific action required\r\n- Deadline (if mentioned) - Format as YYYY-MM-DD ONLY (no time)\r\n- Category (documentation/technical/financial/compliance/other)\r\n- Priority level\r\n\r\n===========================================\r\nEXTRACTION PRINCIPLES\r\n===========================================\r\n\r\n1. ACCURACY: Extract exact information, never paraphrase official terms\r\n2. COMPLETENESS: Include ALL requirements, even minor ones\r\n3. SPECIFICITY: Provide specific details, numbers, dates, amounts\r\n4. CLARITY: Use clear, unambiguous language\r\n5. STRUCTURE: Organize information logically\r\n6. CONTEXT: Provide context for requirements\r\n7. HONESTY: If information is not found, state \"Not specified\" - never guess\r\n8. ACTIONABILITY: Make recommendations practical and implementable\r\n9. DATE FORMAT: Always use YYYY-MM-DD format for dates (no time in metadata deadline field)`\r\n","/**\r\n * CUSTOM AI ANALYSIS PROMPT\r\n *\r\n * This is your testing ground for prompt engineering.\r\n * Modify this prompt to experiment with different analysis approaches.\r\n *\r\n * To revert to the original prompt, copy from original-analysis-prompt.ts\r\n * or set USE_CUSTOM_PROMPT=false in your environment variables.\r\n */\r\n\r\nexport const CUSTOM_ANALYSIS_PROMPT = `You are BidMate AI, an intelligent tender analysis system for South African government and SOE procurement documents.\r\n\r\nYour task: Analyze the tender document and extract structured information to help users prepare winning bids.\r\n\r\n---\r\n\r\n### STEP 1 — EXTRACT TENDER SUMMARY\r\nExtract basic tender information:\r\n- tender_number: Reference/RFP number (e.g., \"RFB0094/25-26\")\r\n- title: Full tender title\r\n- entity: Issuing organization (e.g., \"Dept of Education\", \"City of Cape Town\")\r\n- description: Brief scope (2-3 sentences)\r\n- contract_duration: Contract period (e.g., \"36 months\")\r\n- closing_date: Deadline in YYYY-MM-DD format\r\n- submission_method: How to submit (e.g., \"Manual drop-off at tender box\", \"Online portal\")\r\n- compulsory_briefing: Briefing details with date/time/location, or \"None\"\r\n- validity_period: Bid validity (e.g., \"120 days\")\r\n- contact_email: Email for queries\r\n\r\nIf any field is missing, use \"Not specified\" for text or \"2024-12-31\" for dates.\r\n\r\n---\r\n\r\n### STEP 2 — IDENTIFY COMPLIANCE REQUIREMENTS\r\nCategorize requirements into three lists:\r\n\r\n**requirements**: Mandatory items that must be provided\r\n- Examples: \"Valid CSD registration\", \"Tax clearance certificate\", \"Signed MBD forms\", \"CIDB Grade 6CE or higher\"\r\n\r\n**disqualifiers**: Actions/omissions that cause automatic elimination\r\n- Examples: \"Late submission\", \"Unsigned forms\", \"Missing compulsory briefing attendance\", \"Non-compliant pricing format\"\r\n\r\n**strengtheners**: Items that improve bid quality/scoring\r\n- Examples: \"BBBEE Level 1-4 certification\", \"Relevant project references\", \"ISO certifications\", \"Local content commitment\"\r\n\r\n---\r\n\r\n### STEP 3 — EXTRACT EVALUATION CRITERIA\r\nIdentify how bids will be scored:\r\n\r\n**criteria**: List each evaluation factor with its weight as a NUMBER (not percentage)\r\n- Example: { \"criterion\": \"Price\", \"weight\": 80 }\r\n- Example: { \"criterion\": \"BBBEE Status\", \"weight\": 20 }\r\n\r\n**threshold**: Minimum qualifying score (e.g., \"70%\", \"60 points\")\r\n\r\n**pricing_system**: Preference point system (e.g., \"80/20\", \"90/10\", \"Point-based\")\r\n\r\n---\r\n\r\n### STEP 4 — CREATE ACTION PLAN\r\nGenerate two lists to help users prepare:\r\n\r\n**critical_dates**: Important dates with full details\r\n- date: YYYY-MM-DD format\r\n- event: What happens (e.g., \"Compulsory site visit\", \"Closing date\")\r\n- time: HH:MM format or \"Not specified\"\r\n- location: Physical location or \"N/A\"\r\n\r\n**preparation_tasks**: Prioritized checklist of what to do\r\n- task: Clear action item (e.g., \"Obtain tax clearance certificate\")\r\n- priority: \"High\", \"Medium\", or \"Low\"\r\n- deadline: YYYY-MM-DD or \"Before submission\"\r\n- category: \"Compliance\", \"Documentation\", \"Technical\", or \"Financial\"\r\n\r\nInclude 5-10 tasks covering all major requirements.\r\n\r\n---\r\n\r\n### STEP 5 — EXTRACT FINANCIAL REQUIREMENTS\r\nIdentify all financial obligations and requirements:\r\n\r\n- bank_guarantee: Amount and duration (e.g., \"10% of contract value for 12 months\")\r\n- performance_bond: Amount and conditions\r\n- insurance_requirements: List of required insurance types with coverage amounts\r\n- financial_turnover: Minimum annual turnover requirement\r\n- audited_financials: Period required (e.g., \"Last 3 years\")\r\n- payment_terms: Payment schedule, retention amounts, payment timeframes\r\n\r\n---\r\n\r\n### STEP 6 — EXTRACT LEGAL & REGISTRATION REQUIREMENTS\r\nIdentify all registration and legal requirements:\r\n\r\n- cidb_grading: Specific CIDB grade required (e.g., \"CE6\", \"GB4\")\r\n- cipc_registration: Company registration requirements\r\n- professional_registration: Required professional bodies (SACPCMP, ECSA, SACAP, etc.)\r\n- joint_venture_requirements: JV limitations or requirements\r\n- subcontracting_limitations: Maximum percentage allowed\r\n\r\n---\r\n\r\n### STEP 7 — EXTRACT LABOUR & EMPLOYMENT REQUIREMENTS\r\nIdentify workforce and local content requirements:\r\n\r\n- local_content: Required percentage (e.g., \"100%\", \"60%\")\r\n- subcontracting_limit: Maximum subcontracting percentage\r\n- labour_composition: Required workforce demographics\r\n- skills_development: Training or skills levy requirements\r\n- employment_equity: EE plan requirements\r\n\r\n---\r\n\r\n### STEP 8 — EXTRACT TECHNICAL SPECIFICATIONS\r\nIdentify experience and capability requirements:\r\n\r\n- minimum_experience: Years of experience required (e.g., \"5 years in similar projects\")\r\n- project_references: Number and value of similar projects required\r\n- key_personnel: Qualifications and experience for key staff\r\n- equipment_resources: Required machinery, vehicles, or equipment\r\n- methodology_requirements: Expected approach or methodology\r\n\r\n---\r\n\r\n### STEP 9 — EXTRACT SUBMISSION REQUIREMENTS\r\nIdentify how to submit the tender:\r\n\r\n- number_of_copies: Hard and soft copies required\r\n- formatting_requirements: Page limits, font sizes, binding\r\n- submission_address: Physical address or portal URL\r\n- query_deadline: Last date for questions\r\n- late_submission_policy: Whether late submissions are accepted\r\n\r\n---\r\n\r\n### STEP 10 — EXTRACT PENALTIES & PAYMENT TERMS\r\nIdentify financial penalties and payment structure:\r\n\r\n- late_completion_penalty: Daily or percentage penalty\r\n- non_performance_penalty: Penalties for not meeting KPIs\r\n- warranty_period: Defects liability period\r\n- payment_schedule: Monthly, milestone-based, etc.\r\n- retention_amount: Percentage held back\r\n- payment_timeframe: Days from invoice (e.g., \"30 days\")\r\n\r\n---\r\n\r\n### STEP 11 — EXTRACT ALL FILLABLE FORM FIELDS\r\nCRITICAL: You must scan the ENTIRE document and extract EVERY field that needs to be filled in by the bidder.\r\n\r\n**SCAN FOR THESE SPECIFIC ELEMENTS:**\r\n\r\n1. **Standard Bid Documents (SBD Forms)**:\r\n   - SBD 1: Invitation to Bid (company details, contact info, pricing totals)\r\n   - SBD 2: Tax Clearance Certificate requirements\r\n   - SBD 3.1: Pricing Schedule - Firm Prices (line items, quantities, rates, totals)\r\n   - SBD 3.2: Pricing Schedule - Non-Firm Prices\r\n   - SBD 3.3: Pricing Schedule - Professional Services\r\n   - SBD 4: Declaration of Interest (director details, relationships, conflicts)\r\n   - SBD 6.1: Preference Points Claim Form (BBBEE level, ownership)\r\n   - SBD 6.2: Local Content Declaration\r\n   - SBD 7.1: Contract Form - Purchase of Goods\r\n   - SBD 7.2: Contract Form - Rendering of Services\r\n   - SBD 7.3: Contract Form - Disposal of Assets\r\n   - SBD 8: Declaration of Bidder's Past SCM Practices\r\n   - SBD 9: Certificate of Independent Bid Determination\r\n\r\n2. **Municipal Bid Documents (MBD Forms)**:\r\n   - MBD 1: Invitation to Bid\r\n   - MBD 4: Declaration of Interest\r\n   - MBD 5: Declaration for Procurement above R10 million\r\n   - MBD 6.1: Preference Points Claim Form\r\n   - MBD 6.2: Local Content Declaration\r\n   - MBD 7.1-7.3: Contract Forms\r\n   - MBD 8: Declaration of Bidder's Past SCM Practices\r\n   - MBD 9: Certificate of Independent Bid Determination\r\n\r\n3. **Tables and Schedules to Complete**:\r\n   - Pricing schedules with columns (item, description, quantity, unit, rate, amount)\r\n   - Bill of Quantities (BOQ)\r\n   - Resource schedules (equipment, personnel)\r\n   - Project programme/timeline tables\r\n   - Experience/reference tables\r\n\r\n4. **Declaration and Certification Fields**:\r\n   - Signature blocks (name, designation, date, signature)\r\n   - Witness signatures\r\n   - Commissioner of Oaths sections\r\n   - Director/shareholder declarations\r\n   - Conflict of interest declarations\r\n\r\n5. **Company Information Fields**:\r\n   - Company name, trading name\r\n   - Registration number (CIPC)\r\n   - VAT number\r\n   - CSD MAAA number\r\n   - CIDB registration number and grading\r\n   - BBBEE certificate details (level, expiry, verification agency)\r\n   - Physical address, postal address\r\n   - Contact details (phone, fax, email)\r\n   - Banking details\r\n\r\n6. **Technical Response Fields**:\r\n   - Methodology descriptions (textarea)\r\n   - Project approach\r\n   - Implementation timeline\r\n   - Quality management approach\r\n   - Health and safety plan\r\n   - Environmental management\r\n\r\n7. **Personnel and Resources**:\r\n   - Key personnel tables (name, qualification, experience, role)\r\n   - CV summaries\r\n   - Equipment lists (type, quantity, owned/hired)\r\n   - Subcontractor details\r\n\r\n**FIELD TYPES TO USE:**\r\n- \"text\": Short text inputs (names, numbers, addresses)\r\n- \"textarea\": Long text responses (methodology, descriptions)\r\n- \"number\": Numeric values (prices, quantities, percentages)\r\n- \"date\": Date fields (YYYY-MM-DD format)\r\n- \"email\": Email addresses\r\n- \"tel\": Phone/fax numbers\r\n- \"select\": Dropdown choices (yes/no, levels, categories)\r\n- \"checkbox\": Agreement/declaration confirmations\r\n- \"file\": Document uploads (certificates, CVs)\r\n- \"table\": Repeating rows (pricing items, personnel, references)\r\n\r\n**FOR TABLE FIELDS, include:**\r\n- columns: Array of column definitions with { id, label, type }\r\n- minRows: Minimum number of rows required\r\n\r\n**GENERATE 25-50 FORM FIELDS** covering every fillable element in the document.\r\n\r\nEach field must have:\r\n- id: Unique snake_case identifier (e.g., \"sbd1_company_name\", \"pricing_item_1_rate\")\r\n- label: Display name matching the document label\r\n- type: One of the types listed above\r\n- required: true for mandatory fields, false for optional\r\n- section: Group name (e.g., \"SBD 1 - Invitation to Bid\", \"Pricing Schedule\", \"Declaration of Interest\")\r\n- placeholder: Example value or hint\r\n- description: Help text explaining what to enter\r\n- options: Array for select fields (e.g., [\"Yes\", \"No\"], [\"Level 1\", \"Level 2\", ...])\r\n- validation: Optional regex pattern for validation\r\n- columns: For table type, array of column definitions\r\n- minRows: For table type, minimum rows required\r\n\r\n**SECTION NAMES TO USE:**\r\n- \"SBD 1 - Invitation to Bid\"\r\n- \"SBD 3.1 - Pricing Schedule\"\r\n- \"SBD 4 - Declaration of Interest\"\r\n- \"SBD 6.1 - Preference Points\"\r\n- \"SBD 8 - Past SCM Practices\"\r\n- \"SBD 9 - Independent Bid\"\r\n- \"Company Information\"\r\n- \"Technical Response\"\r\n- \"Key Personnel\"\r\n- \"Equipment & Resources\"\r\n- \"Project References\"\r\n- \"Banking Details\"\r\n- \"Declarations & Signatures\"\r\n\r\n---\r\n\r\n### STEP 12 — RISK ASSESSMENT & B-BBEE ANALYSIS\r\nAnalyze the tender for risks and B-BBEE scoring potential:\r\n\r\n**risk_assessment**:\r\n- **overall_risk_score**: Number from 1-10 (1=low risk, 10=high risk)\r\n- **risk_level**: \"Low\", \"Medium\", \"High\", or \"Critical\"\r\n- **risk_factors**: Array of specific risks identified, each with:\r\n  - factor: Description of the risk\r\n  - severity: \"Low\", \"Medium\", \"High\"\r\n  - mitigation: Suggested way to address this risk\r\n- **risk_reasoning**: 2-3 sentence summary of why this risk level was assigned\r\n\r\n**bbbee_analysis**:\r\n- **points_available**: Total B-BBEE preference points available (usually 10 or 20)\r\n- **pricing_system**: \"80/20\" or \"90/10\" preference point system\r\n- **level_points_breakdown**: Array showing points per B-BBEE level:\r\n  - level: \"Level 1\", \"Level 2\", etc.\r\n  - points: Points awarded for this level\r\n- **sub_contracting_requirements**: Any mandatory subcontracting to EMEs/QSEs\r\n- **local_content_bonus**: Additional points for local content commitment\r\n- **recommendations**: Array of 3-5 actionable recommendations to maximize B-BBEE points\r\n\r\nConsider these risk factors:\r\n- Tight deadlines or unrealistic timeframes\r\n- Onerous penalty clauses\r\n- Unusual payment terms (long payment periods, high retentions)\r\n- Complex technical requirements\r\n- High financial requirements (guarantees, bonds, insurance)\r\n- Mandatory certifications or registrations you may not have\r\n- Geographic constraints or local preference requirements\r\n- Joint venture or subcontracting complexities\r\n- Ambiguous scope or specifications\r\n- History of disputes or litigation with the entity\r\n\r\n---\r\n\r\n### OUTPUT FORMAT\r\nReturn ONE valid JSON object with this exact structure:\r\n\r\n{\r\n  \"tender_summary\": { ... },\r\n  \"compliance_summary\": { ... },\r\n  \"evaluation\": { ... },\r\n  \"action_plan\": { ... },\r\n  \"financial_requirements\": {\r\n    \"bank_guarantee\": \"\",\r\n    \"performance_bond\": \"\",\r\n    \"insurance_requirements\": [],\r\n    \"financial_turnover\": \"\",\r\n    \"audited_financials\": \"\",\r\n    \"payment_terms\": \"\"\r\n  },\r\n  \"legal_registration\": {\r\n    \"cidb_grading\": \"\",\r\n    \"cipc_registration\": \"\",\r\n    \"professional_registration\": [],\r\n    \"joint_venture_requirements\": \"\",\r\n    \"subcontracting_limitations\": \"\"\r\n  },\r\n  \"labour_employment\": {\r\n    \"local_content\": \"\",\r\n    \"subcontracting_limit\": \"\",\r\n    \"labour_composition\": \"\",\r\n    \"skills_development\": \"\",\r\n    \"employment_equity\": \"\"\r\n  },\r\n  \"technical_specs\": {\r\n    \"minimum_experience\": \"\",\r\n    \"project_references\": \"\",\r\n    \"key_personnel\": [],\r\n    \"equipment_resources\": [],\r\n    \"methodology_requirements\": \"\"\r\n  },\r\n  \"submission_requirements\": {\r\n    \"number_of_copies\": \"\",\r\n    \"formatting_requirements\": \"\",\r\n    \"submission_address\": \"\",\r\n    \"query_deadline\": \"\",\r\n    \"late_submission_policy\": \"\"\r\n  },\r\n  \"penalties_payment\": {\r\n    \"late_completion_penalty\": \"\",\r\n    \"non_performance_penalty\": \"\",\r\n    \"warranty_period\": \"\",\r\n    \"payment_schedule\": \"\",\r\n    \"retention_amount\": \"\",\r\n    \"payment_timeframe\": \"\"\r\n  },\r\n  \"formFields\": [\r\n    {\r\n      \"id\": \"sbd1_company_name\",\r\n      \"label\": \"Company Name\",\r\n      \"type\": \"text\",\r\n      \"required\": true,\r\n      \"section\": \"SBD 1 - Invitation to Bid\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter the name of your company\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_trading_name\",\r\n      \"label\": \"Trading Name\",\r\n      \"type\": \"text\",\r\n      \"required\": false,\r\n      \"section\": \"SBD 1 - Invitation to Bid\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter your company's trading name if applicable\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_contact_email\",\r\n      \"label\": \"Contact Email\",\r\n      \"type\": \"email\",\r\n      \"required\": true,\r\n      \"section\": \"SBD 1 - Invitation to Bid\",\r\n      \"placeholder\": \"example@example.com\",\r\n      \"description\": \"Enter your company's contact email\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_contact_phone\",\r\n      \"label\": \"Contact Phone\",\r\n      \"type\": \"tel\",\r\n      \"required\": true,\r\n      \"section\": \"SBD 1 - Invitation to Bid\",\r\n      \"placeholder\": \"123-456-7890\",\r\n      \"description\": \"Enter your company's contact phone number\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_contact_fax\",\r\n      \"label\": \"Contact Fax\",\r\n      \"type\": \"tel\",\r\n      \"required\": false,\r\n      \"section\": \"SBD 1 - Invitation to Bid\",\r\n      \"placeholder\": \"123-456-7890\",\r\n      \"description\": \"Enter your company's contact fax number if applicable\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_physical_address\",\r\n      \"label\": \"Physical Address\",\r\n      \"type\": \"text\",\r\n      \"required\": true,\r\n      \"section\": \"SBD 1 - Invitation to Bid\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter your company's physical address\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_postal_address\",\r\n      \"label\": \"Postal Address\",\r\n      \"type\": \"text\",\r\n      \"required\": true,\r\n      \"section\": \"SBD 1 - Invitation to Bid\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter your company's postal address\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_cipc_registration\",\r\n      \"label\": \"CIPC Registration Number\",\r\n      \"type\": \"text\",\r\n      \"required\": true,\r\n      \"section\": \"Company Information\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter your company's CIPC registration number\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_vat_number\",\r\n      \"label\": \"VAT Number\",\r\n      \"type\": \"text\",\r\n      \"required\": true,\r\n      \"section\": \"Company Information\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter your company's VAT number\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_cidb_registration_number\",\r\n      \"label\": \"CIDB Registration Number\",\r\n      \"type\": \"text\",\r\n      \"required\": true,\r\n      \"section\": \"Company Information\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter your company's CIDB registration number\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_cidb_grading\",\r\n      \"label\": \"CIDB Grading\",\r\n      \"type\": \"select\",\r\n      \"required\": true,\r\n      \"section\": \"Company Information\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Select your company's CIDB grading\",\r\n      \"options\": [\"CE6\", \"GB4\", \"Other\"],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_bbbee_level\",\r\n      \"label\": \"BBBEE Level\",\r\n      \"type\": \"select\",\r\n      \"required\": true,\r\n      \"section\": \"Company Information\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Select your company's BBBEE level\",\r\n      \"options\": [\"Level 1\", \"Level 2\", \"Level 3\", \"Level 4\"],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_bbbee_expiry\",\r\n      \"label\": \"BBBEE Certificate Expiry\",\r\n      \"type\": \"date\",\r\n      \"required\": true,\r\n      \"section\": \"Company Information\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter the expiry date of your BBBEE certificate\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_bbbee_verification_agency\",\r\n      \"label\": \"BBBEE Verification Agency\",\r\n      \"type\": \"text\",\r\n      \"required\": true,\r\n      \"section\": \"Company Information\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter the name of the BBBEE verification agency\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_director_name\",\r\n      \"label\": \"Director's Name\",\r\n      \"type\": \"text\",\r\n      \"required\": true,\r\n      \"section\": \"SBD 4 - Declaration of Interest\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter the name of the director\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_director_designation\",\r\n      \"label\": \"Director's Designation\",\r\n      \"type\": \"text\",\r\n      \"required\": true,\r\n      \"section\": \"SBD 4 - Declaration of Interest\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter the designation of the director\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_director_date\",\r\n      \"label\": \"Declaration Date\",\r\n      \"type\": \"date\",\r\n      \"required\": true,\r\n      \"section\": \"SBD 4 - Declaration of Interest\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter the date of declaration\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_signature\",\r\n      \"label\": \"Signature\",\r\n      \"type\": \"file\",\r\n      \"required\": true,\r\n      \"section\": \"Declarations & Signatures\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Upload your signature\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_conflict_of_interest\",\r\n      \"label\": \"Conflict of Interest Declaration\",\r\n      \"type\": \"checkbox\",\r\n      \"required\": true,\r\n      \"section\": \"Declarations & Signatures\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Confirm that there are no conflicts of interest\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"pricing_schedule\",\r\n      \"label\": \"Pricing Schedule\",\r\n      \"type\": \"table\",\r\n      \"required\": true,\r\n      \"section\": \"SBD 3.1 - Pricing Schedule\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter pricing details\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [\r\n        { \"id\": \"item\", \"label\": \"Item\", \"type\": \"text\" },\r\n        { \"id\": \"description\", \"label\": \"Description\", \"type\": \"text\" },\r\n        { \"id\": \"quantity\", \"label\": \"Quantity\", \"type\": \"number\" },\r\n        { \"id\": \"unit\", \"label\": \"Unit\", \"type\": \"text\" },\r\n        { \"id\": \"rate\", \"label\": \"Rate\", \"type\": \"number\" },\r\n        { \"id\": \"amount\", \"label\": \"Amount\", \"type\": \"number\" }\r\n      ],\r\n      \"minRows\": 5\r\n    },\r\n    {\r\n      \"id\": \"project_references\",\r\n      \"label\": \"Project References\",\r\n      \"type\": \"table\",\r\n      \"required\": true,\r\n      \"section\": \"Project References\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter your project references\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [\r\n        { \"id\": \"project_name\", \"label\": \"Project Name\", \"type\": \"text\" },\r\n        { \"id\": \"project_value\", \"label\": \"Project Value\", \"type\": \"number\" },\r\n        { \"id\": \"project_duration\", \"label\": \"Project Duration\", \"type\": \"text\" }\r\n      ],\r\n      \"minRows\": 3\r\n    },\r\n    {\r\n      \"id\": \"key_personnel\",\r\n      \"label\": \"Key Personnel\",\r\n      \"type\": \"table\",\r\n      \"required\": true,\r\n      \"section\": \"Key Personnel\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter details of key personnel\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [\r\n        { \"id\": \"name\", \"label\": \"Name\", \"type\": \"text\" },\r\n        { \"id\": \"qualification\", \"label\": \"Qualification\", \"type\": \"text\" },\r\n        { \"id\": \"experience\", \"label\": \"Experience\", \"type\": \"number\" },\r\n        { \"id\": \"role\", \"label\": \"Role\", \"type\": \"text\" }\r\n      ],\r\n      \"minRows\": 2\r\n    },\r\n    {\r\n      \"id\": \"equipment_resources\",\r\n      \"label\": \"Equipment & Resources\",\r\n      \"type\": \"table\",\r\n      \"required\": true,\r\n      \"section\": \"Equipment & Resources\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter details of required equipment and resources\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [\r\n        { \"id\": \"type\", \"label\": \"Type\", \"type\": \"text\" },\r\n        { \"id\": \"quantity\", \"label\": \"Quantity\", \"type\": \"number\" },\r\n        { \"id\": \"owned_hired\", \"label\": \"Owned/Hired\", \"type\": \"select\", \"options\": [\"Owned\", \"Hired\"] }\r\n      ],\r\n      \"minRows\": 3\r\n    },\r\n    {\r\n      \"id\": \"technical_response_methodology\",\r\n      \"label\": \"Methodology Description\",\r\n      \"type\": \"textarea\",\r\n      \"required\": true,\r\n      \"section\": \"Technical Response\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Describe your methodology for the project\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"technical_response_project_approach\",\r\n      \"label\": \"Project Approach\",\r\n      \"type\": \"text\",\r\n      \"required\": true,\r\n      \"section\": \"Technical Response\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter your project approach\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"technical_response_timeline\",\r\n      \"label\": \"Implementation Timeline\",\r\n      \"type\": \"textarea\",\r\n      \"required\": true,\r\n      \"section\": \"Technical Response\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter your implementation timeline\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"technical_response_quality_management\",\r\n      \"label\": \"Quality Management Approach\",\r\n      \"type\": \"textarea\",\r\n      \"required\": true,\r\n      \"section\": \"Technical Response\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Describe your quality management approach\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"technical_response_health_safety\",\r\n      \"label\": \"Health and Safety Plan\",\r\n      \"type\": \"textarea\",\r\n      \"required\": true,\r\n      \"section\": \"Technical Response\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Describe your health and safety plan\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"technical_response_environmental\",\r\n      \"label\": \"Environmental Management\",\r\n      \"type\": \"textarea\",\r\n      \"required\": true,\r\n      \"section\": \"Technical Response\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Describe your environmental management strategy\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"banking_details\",\r\n      \"label\": \"Banking Details\",\r\n      \"type\": \"textarea\",\r\n      \"required\": true,\r\n      \"section\": \"Banking Details\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter your banking details\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    }\r\n  ],\r\n  \"risk_assessment\": {\r\n    \"overall_risk_score\": 0,\r\n    \"risk_level\": \"\",\r\n    \"risk_factors\": [],\r\n    \"risk_reasoning\": \"\"\r\n  },\r\n  \"bbbee_analysis\": {\r\n    \"points_available\": 0,\r\n    \"pricing_system\": \"\",\r\n    \"level_points_breakdown\": [],\r\n    \"sub_contracting_requirements\": \"\",\r\n    \"local_content_bonus\": \"\",\r\n    \"recommendations\": []\r\n  }\r\n}\r\n\r\nCRITICAL RULES:\r\n- Return ONLY valid JSON, no additional text\r\n- Use South African terminology (CSD, CIDB, BBBEE, MBD, SBD)\r\n- All dates must be YYYY-MM-DD format\r\n- Weights must be numbers, not strings\r\n- If information is unclear, provide sensible defaults\r\n- Include at least one item in each array\r\n- Use \"Not specified\" for missing fields`\r\n","/**\r\n * Prompt Management System\r\n *\r\n * This module manages AI analysis prompts and allows switching between\r\n * the original production prompt and custom test prompts.\r\n *\r\n * Usage:\r\n * - Set USE_CUSTOM_PROMPT=true in environment variables to use custom prompt\r\n * - Set USE_CUSTOM_PROMPT=false (or omit) to use original prompt\r\n * - Edit custom-analysis-prompt.ts to test new prompts\r\n * - Original prompt is always preserved in original-analysis-prompt.ts\r\n */\r\n\r\nimport { ORIGINAL_ANALYSIS_PROMPT } from \"./original-analysis-prompt\"\r\nimport { CUSTOM_ANALYSIS_PROMPT } from \"./custom-analysis-prompt\"\r\n\r\nexport function getAnalysisPrompt(): string {\r\n  const useCustomPrompt = process.env.USE_CUSTOM_PROMPT === \"true\"\r\n\r\n  if (useCustomPrompt) {\r\n    console.log(\"[v0] Using CUSTOM analysis prompt\")\r\n    return CUSTOM_ANALYSIS_PROMPT\r\n  }\r\n\r\n  console.log(\"[v0] Using ORIGINAL analysis prompt\")\r\n  return ORIGINAL_ANALYSIS_PROMPT\r\n}\r\n\r\nexport function getFormFieldsInstruction(pdfFields?: any[]): string {\r\n  if (pdfFields && pdfFields.length > 0) {\r\n    return `\r\nCRITICAL: The PDF has ${pdfFields.length} interactive form fields. You MUST use these EXACT field names as the 'id' property.\r\n\r\nPDF Form Fields:\r\n${pdfFields.map((f: any, idx: number) => `${idx + 1}. \"${f.name}\" (${f.type})`).join(\"\\n\")}\r\n\r\nFORM FIELD GENERATION RULES:\r\n1. For EACH PDF field above, create a corresponding form field entry\r\n2. Use the EXACT field name from the PDF as the 'id' (case-sensitive)\r\n3. Create a human-readable label by:\r\n   - Converting CamelCase to spaces (e.g., \"CompanyName\" → \"Company Name\")\r\n   - Converting snake_case to spaces (e.g., \"company_name\" → \"Company Name\")\r\n   - Capitalizing appropriately\r\n4. Map the PDF field type to the appropriate form field type:\r\n   - PDFTextField → \"text\" or \"textarea\" (use textarea for long text fields)\r\n   - PDFCheckBox → \"checkbox\"\r\n   - PDFRadioGroup → \"radio\"\r\n   - PDFDropdown → \"select\"\r\n5. Mark fields as required if they appear mandatory in the document\r\n6. Add helpful descriptions based on the document context\r\n7. Group fields into logical sections (Company Info, Financial, Technical, etc.)\r\n\r\nExample:\r\nPDF Field: \"CompanyRegistrationNumber\" (PDFTextField)\r\nForm Field:\r\n{\r\n  \"id\": \"CompanyRegistrationNumber\",\r\n  \"label\": \"Company Registration Number\",\r\n  \"type\": \"text\",\r\n  \"required\": true,\r\n  \"placeholder\": \"e.g., 2021/123456/07\",\r\n  \"description\": \"Your company's official registration number\",\r\n  \"section\": \"Company Information\"\r\n}\r\n`\r\n  }\r\n\r\n  return `\r\nFORM FIELD GENERATION (No PDF fields detected - create comprehensive form):\r\n\r\nExtract EVERY piece of information requested in the tender document and create appropriate form fields.\r\nBe thorough and detailed - include ALL information requirements mentioned.\r\n\r\nREQUIRED SECTIONS TO COVER:\r\n1. Company Information:\r\n   - Company name, registration number, VAT number\r\n   - Physical and postal addresses\r\n   - Contact person details (name, email, phone)\r\n   - Company type, years in business\r\n   - Website, social media\r\n\r\n2. Financial Information:\r\n   - Annual turnover (last 3 years)\r\n   - Bank details (name, branch, account)\r\n   - Tax clearance certificate\r\n   - Financial statements\r\n   - Credit references\r\n\r\n3. Technical Capabilities:\r\n   - Relevant experience (years)\r\n   - Similar projects completed\r\n   - Technical staff qualifications\r\n   - Equipment and resources\r\n   - Quality certifications (ISO, etc.)\r\n\r\n4. Compliance & Legal:\r\n   - BBBEE certificate and level\r\n   - Professional indemnity insurance\r\n   - Public liability insurance\r\n   - Health and safety compliance\r\n   - Industry-specific licenses\r\n\r\n5. Project-Specific:\r\n   - Methodology and approach\r\n   - Project timeline\r\n   - Resource allocation\r\n   - Risk management plan\r\n   - Quality assurance procedures\r\n\r\n6. Pricing:\r\n   - Detailed cost breakdown\r\n   - Payment terms\r\n   - Validity period\r\n   - Assumptions and exclusions\r\n\r\n7. References:\r\n   - Client references (minimum 3)\r\n   - Contact details for references\r\n   - Project descriptions\r\n\r\n8. Supporting Documents:\r\n   - Company profile\r\n   - Certificates and licenses\r\n   - Previous work samples\r\n   - CVs of key personnel\r\n\r\nFor each field, provide:\r\n- Unique, descriptive ID (use snake_case)\r\n- Clear, concise label\r\n- Appropriate type (text, email, tel, number, date, textarea, select, checkbox, file)\r\n- Whether it's required\r\n- Helpful placeholder text\r\n- Detailed description of what's needed\r\n- Logical section grouping\r\n- Options array for select/checkbox/radio fields\r\n`\r\n}\r\n\r\n// Export both prompts for reference\r\nexport { ORIGINAL_ANALYSIS_PROMPT, CUSTOM_ANALYSIS_PROMPT }\r\n"],"names":[],"mappings":"wCCAA,IAAA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,QDjBA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,CAAA,CAAA,QAAA,IAAA,EAAA,EAAA,CAAA,CAAA,QEOO,IAAM,EAA2B,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;2FA4PkD,CAAC,CC3P/E,EAAyB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;wCAywBC,CAAC,CH9wBzC,eAAe,EAAqB,CAAc,EAShD,GAAI,CACF,QAAQ,GAAG,CAAC,wCAAyC,GACrD,IAAM,EAAc,MAAM,MAAM,GAChC,GAAI,CAAC,EAAY,EAAE,CACjB,CADmB,KACb,AAAI,MAAM,CAAC,qBAAqB,EAAE,EAAY,MAAM,CAAA,CAAE,EAG9D,IAAM,EAAW,MAAM,EAAY,WAAW,GACxC,EAAS,MAAM,EAAA,WAAW,CAAC,IAAI,CAAC,EAAU,CAAE,iBAAkB,EAAK,GAEnE,EADO,AACE,EADK,OAAO,GACP,SAAS,GACvB,EAAQ,EAAO,QAAQ,GAEvB,EAAkB,EAAO,GAAG,CAAE,AAAD,IACjC,IAII,EACA,EALE,EAAO,EAAM,OAAO,GACpB,EAAW,EAAM,WAAW,CAAC,IAAI,CAEnC,EAAO,OAIX,GAAiB,gBAAgB,CAA7B,EACF,EAAO,YACF,GAAiB,eAAe,CAA5B,EACT,EAAO,gBACF,GAAiB,kBAAb,EAA8B,CACvC,EAAO,QACP,GAAI,CACF,EAAW,EAAc,UAAU,MAAQ,EAAE,AAC/C,CAAE,KAAM,CACN,EAAU,EAAE,AACd,CACF,MAAO,GAAI,AAAa,kBAAe,CACrC,EAAO,SACP,GAAI,CACF,EAAW,EAAc,UAAU,MAAQ,EAAE,AAC/C,CAAE,KAAM,CACN,EAAU,EAAE,AACd,CACF,CAEA,GAAI,CACA,IAAM,EAAU,EAAM,SAAS,CAAC,UAAU,GAC5C,GAAI,EAAQ,MAAM,CAAG,EAAG,CACtB,IAAM,EAAS,CAAO,CAAC,EAAE,CACnB,EAAO,EAAO,YAAY,GAG5B,EAAY,EAChB,IAAK,IAAI,EAAI,EAAG,EAAI,EAAM,MAAM,CAAE,IAAK,CACrC,IAAM,EAAU,CAAK,CAAC,EAAE,CAAC,GAAG,CACtB,EAAa,EAAO,CAAC,GAC3B,GAAI,GAAc,EAAQ,QAAQ,KAAO,EAAW,QAAQ,GAAI,CAC9D,EAAY,EACZ,KACF,CACF,CAEA,EAAW,CACT,EAAG,EAAK,CAAC,CACT,EAAG,EAAK,CAAC,CACT,MAAO,EAAK,KAAK,CACjB,OAAQ,EAAK,MAAM,CACnB,KAAM,EAAY,CACpB,EACA,QAAQ,GAAG,CAAC,CAAC,YAAY,EAAE,EAAK,WAAW,CAAC,CAAE,EAChD,CACF,CAAE,MAAO,EAAU,CACjB,QAAQ,GAAG,CAAC,CAAC,2CAA2C,EAAE,EAAK,CAAC,CAAC,CACnE,CAEA,MAAO,MAAE,OAAM,UAAM,WAAS,CAAS,CACzC,GAIA,OAFA,QAAQ,GAAG,CAAC,aAAc,EAAgB,MAAM,CAAE,kCAE3C,CACL,OAAQ,EACR,cAAe,EAAgB,MAAM,CAAG,CAC1C,CACF,CAAE,MAAO,EAAY,CAEnB,OADA,QAAQ,GAAG,CAAC,0CAA2C,EAAM,OAAO,EAC7D,CAAE,OAAQ,EAAE,CAAE,eAAe,CAAM,CAC5C,CACF,CAEO,eAAe,EAAK,CAAgB,EACzC,GAAI,CACF,GAAM,cAAE,CAAY,aAAE,CAAW,WAAE,CAAS,CAAE,CAAG,MAAM,EAAQ,IAAI,GASnE,GAPA,QAAQ,GAAG,CAAC,iDACZ,QAAQ,GAAG,CAAC,gCACZ,QAAQ,GAAG,CAAC,iDACZ,QAAQ,GAAG,CAAC,6BAA8B,GAAc,QAAU,EAAG,cACrE,QAAQ,GAAG,CAAC,8BAA+B,EAAc,MAAQ,MACjE,QAAQ,GAAG,CAAC,4BAA6B,GAAW,QAAU,GAE1D,CAAC,GAAgB,CAAC,EACpB,OAAO,IAD0B,KACjB,IAAI,CAAC,CAAE,MAAO,kDAAmD,EAAG,CAAE,OAAQ,GAAI,GAGpG,IAAI,EAKC,EAAE,CACH,GAAmB,EAEvB,GAAI,EAAa,CACf,IAAM,EAAkB,MAAM,EAAqB,GACnD,EAAgB,EAAgB,MAAM,CACtC,EAAmB,EAAgB,aAAa,CAChD,QAAQ,GAAG,CAAC,wCAAyC,EACvD,CAEA,IAAI,EAAgB,EAEpB,GAAI,IAAgB,CAAC,GAAiC,KAAjB,CAAiB,CAAnC,AAAqC,CAAG,CACzD,QAAQ,GAAG,CAAC,kEACZ,QAAQ,GAAG,CAAC,gBAAiB,GAE7B,GAAI,CACF,QAAQ,GAAG,CAAC,kDAEZ,IAAM,EAAc,MAAM,MAAM,GAChC,GAAI,CAAC,EAAY,EAAE,CACjB,CADmB,KACb,AAAI,MAAM,CAAC,qBAAqB,EAAE,EAAY,MAAM,CAAC,CAAC,EAAE,EAAY,UAAU,CAAA,CAAE,EAGxF,IAAM,EAAiB,MAAM,EAAY,WAAW,GACpD,QAAQ,GAAG,CAAC,uCAAwC,CAAC,EAAe,UAAU,CAAG,IAAA,CAAI,CAAE,OAAO,CAAC,GAAI,MAEnG,QAAQ,GAAG,CAAC,uDAEZ,GAAM,MAAE,CAAI,YAAE,CAAU,CAAE,CAAG,MAAM,CAAA,EAAA,EAAA,WAAA,AAAW,EAAC,EAAgB,CAAE,YAAY,CAAK,GAQlF,GANA,EAAgB,EAChB,QAAQ,GAAG,CAAC,kDACZ,QAAQ,GAAG,CAAC,oBAAqB,GACjC,QAAQ,GAAG,CAAC,8BAA+B,EAAc,MAAM,CAAE,cACjE,QAAQ,GAAG,CAAC,6BAA8B,EAAc,SAAS,CAAC,EAAG,MAEjE,CAAC,GAAiB,EAAc,IAAI,GAAG,MAAM,CAAG,GAClD,CADsD,KAChD,AAAI,MACR,CAAC,gDAAgD,EAAE,GAAe,QAAU,EAAE,kDAAkD,CAAC,EAIrI,IAAM,EAAY,EAAc,IAAI,GAAG,KAAK,CAAC,OAAO,MAAM,CACpD,EAAkB,KAAK,KAAK,CAAC,EAAY,GAC/C,QAAQ,GAAG,CAAC,mBAAoB,GAChC,QAAQ,GAAG,CAAC,+BAAgC,GAExC,EAAkB,IAAI,AACxB,QAAQ,IAAI,CAAC,qEAEjB,CAAE,MAAO,EAAmB,CAI1B,OAHA,QAAQ,KAAK,CAAC,mCACd,QAAQ,KAAK,CAAC,sBAAuB,GAAc,SAE5C,SAAS,IAAI,CAClB,CACE,MAAO,kCACP,UAAW,uBACX,QAAS,GAAc,SAAW,6BAClC,KAAM,sHACR,EACA,CAAE,OAAQ,GAAI,EAElB,CACF,CAEA,GAAI,CAAC,GAAiB,EAAc,MAAM,CAAG,GAC3C,CAD+C,MACxC,SAAS,IAAI,CAClB,CACE,MAAO,wCACP,UAAW,uBACX,QAAS,CAAC,KAAK,EAAE,GAAe,QAAU,EAAE,sBAAsB,CAAC,AACrE,EACA,CAAE,OAAQ,GAAI,GAIlB,IAAM,EAAgB,EAAe,SAAS,CAAC,EAAG,KAClD,QAAQ,GAAG,CAAC,wCAAyC,EAAc,MAAM,CAAE,cAE3E,IAAM,EIxLkD,AAE1D,IAAI,KAFoB,EJwLH,MIxLW,GAAG,CAEd,AAFe,iBAAiB,EAGnD,QAAQ,GAAG,CAAC,qCACL,IAGT,QAAQ,GAAG,CAAC,uCACL,GJkLD,EAAuB,GAEzB,EADE,GAAoB,EAAc,MAAM,CAAG,EACtB,CADyB,AACxB;;sBAER,EAAE,EAAc,MAAM,CAAC;;;AAG7C,EAAE,EACS,GAAG,CAAC,AAAC,IACJ,IAAI,EAAO,CAAC,GAAG,EAAE,EAAE,IAAI,CAAC,SAAS,EAAE,EAAE,IAAI,CAAC,CAAC,CAAC,CAO5C,OANI,EAAE,OAAO,EAAI,EAAE,OAAO,CAAC,MAAM,CAAG,GAAG,CACrC,GAAQ,CAAC,WAAW,EAAE,EAAE,OAAO,CAAC,IAAI,CAAC,MAAM,EAAC,AAAC,EAE3C,EAAE,QAAQ,EAAE,CACd,GAAQ,CAAC,iBAAiB,EAAE,EAAE,QAAQ,CAAC,IAAI,CAAC,IAAI,EAAE,EAAE,QAAQ,CAAC,CAAC,CAAC,IAAI,EAAE,EAAE,QAAQ,CAAC,CAAC,CAAC,QAAQ,EAAE,EAAE,QAAQ,CAAC,KAAK,CAAC,SAAS,EAAE,EAAE,QAAQ,CAAC,MAAM,CAAC,EAAC,AAAC,EAEvI,CACT,GACC,IAAI,CAAC,MAAM;;;oDAG8B,EAAE,CAAa,CAAC,EAAE,EAAE,MAAQ,QAAQ;;;;;;;;AAQxF,CAAC,CAE4B,CAAC;;AAE9B,CAAC,CAGG,QAAQ,GAAG,CAAC,2EAEZ,GAAI,CACF,IAoHI,EApHE,EAAY,KAAK,GAAG,GAEpB,CAAE,KAAM,CAAU,CAAE,CAAG,MAAM,CAAA,EAAA,EAAA,OAAA,AAAuB,EAAC,CACzD,MAAO,mBACP,OAAQ,CAAA,EAAG,WAAW;;AAE9B,EAAE,qBAAqB;;;;;;;;AAQvB,EAAE,cAAc;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;2BA4FW,EAAE,EAAiB;uBACvB,EAAE,EAAc,MAAM,CAAC;CAC7C,CAAC,AACI,GAEM,EAAU,KAAK,GAAG,GACxB,QAAQ,GAAG,CAAC,kCAAmC,CAAC,EAAU,CAAA,CAAS,CAAI,IAAM,WAC7E,QAAQ,GAAG,CAAC,+BAAgC,EAAW,MAAM,CAAE,cAC/D,QAAQ,GAAG,CAAC,oCAAqC,EAAW,SAAS,CAAC,EAAG,MAGzE,GAAI,CACF,IAAI,EAAkB,EAAW,IAAI,GACjC,EAAgB,UAAU,CAAC,YAAY,CACzC,EAAkB,EAAgB,KAAK,CAAC,EAAA,EAEtC,EAAgB,UAAU,CAAC,QAAQ,CACrC,EAAkB,EAAgB,KAAK,CAAC,EAAA,EAEtC,EAAgB,QAAQ,CAAC,QAAQ,CACnC,EAAkB,EAAgB,KAAK,CAAC,EAAG,CAAC,EAAA,EAE9C,EAAkB,EAAgB,IAAI,GAEtC,EAAW,KAAK,KAAK,CAAC,GACtB,QAAQ,GAAG,CAAC,kCACd,CAAE,MAAO,EAAiB,CAIxB,OAHA,QAAQ,KAAK,CAAC,yBAA0B,EAAW,OAAO,EAC1D,QAAQ,KAAK,CAAC,sCAAuC,EAAW,SAAS,CAAC,EAAG,MAEtE,SAAS,IAAI,CAClB,CACE,MAAO,sCACP,UAAW,mBACX,QAAS,EAAW,OAAO,AAC7B,EACA,CAAE,OAAQ,GAAI,EAElB,CAEA,EAAS,qBAAqB,CAAG,EACjC,EAAS,iBAAiB,CAAG,EAAc,MAAM,CACjD,EAAS,aAAa,CAAG,EAEzB,IAAM,EAAW,CACf,eAAgB,CACd,cAAe,gBACf,MAAO,gBACP,OAAQ,gBACR,YAAa,gBACb,kBAAmB,gBACnB,aAAc,gBACd,kBAAmB,gBACnB,oBAAqB,gBACrB,gBAAiB,gBACjB,cAAe,eACjB,EACA,mBAAoB,CAClB,aAAc,EAAE,CAChB,cAAe,EAAE,CACjB,cAAe,EAAE,AACnB,EACA,WAAY,CACV,SAAU,EAAE,CACZ,UAAW,gBACX,eAAgB,eAClB,EACA,YAAa,CACX,eAAgB,EAAE,CAClB,kBAAmB,EAAE,AACvB,EACA,uBAAwB,CACtB,eAAgB,gBAChB,iBAAkB,gBAClB,uBAAwB,EAAE,CAC1B,mBAAoB,gBACpB,mBAAoB,gBACpB,cAAe,eACjB,EACA,mBAAoB,CAClB,aAAc,gBACd,kBAAmB,gBACnB,0BAA2B,EAAE,CAC7B,2BAA4B,gBAC5B,2BAA4B,eAC9B,EACA,kBAAmB,CACjB,cAAe,gBACf,qBAAsB,gBACtB,mBAAoB,gBACpB,mBAAoB,gBACpB,kBAAmB,eACrB,EACA,gBAAiB,CACf,mBAAoB,gBACpB,mBAAoB,gBACpB,cAAe,EAAE,CACjB,oBAAqB,EAAE,CACvB,yBAA0B,eAC5B,EACA,wBAAyB,CACvB,iBAAkB,gBAClB,wBAAyB,gBACzB,mBAAoB,gBACpB,eAAgB,gBAChB,uBAAwB,eAC1B,EACA,kBAAmB,CACjB,wBAAyB,gBACzB,wBAAyB,gBACzB,gBAAiB,gBACjB,iBAAkB,gBAClB,iBAAkB,gBAClB,kBAAmB,eACrB,EACA,WAAY,EAAE,AAChB,EAEA,IAAK,IAAM,KAAO,OAAO,IAAI,CAAC,GACvB,CAAQ,CAAC,EAAI,CAIkC,CAJhC,CADmB,QAKrC,EACA,KADO,CAAQ,CAAC,EAA6B,EAC5C,MAAM,OAAO,CAAC,CAAQ,CAAC,EAA6B,GACrD,CACA,CAAQ,CAAC,EAAI,CAAG,CAAE,GAAG,CAAQ,CAAC,EAA6B,CAAE,GAAG,CAAQ,CAAC,EAAI,CAAC,GAN9E,QAAQ,GAAG,CAAC,CAAC,iCAAiC,EAAE,EAAA,CAAK,EACrD,CAAQ,CAAC,EAAI,CAAG,CAAQ,CAAC,EAA6B,EAqB1D,OAZA,QAAQ,GAAG,CAAC,iDACZ,QAAQ,GAAG,CAAC,yBACZ,QAAQ,GAAG,CAAC,iDACZ,QAAQ,GAAG,CAAC,qBAAsB,EAAS,cAAc,EAAE,OAC3D,QAAQ,GAAG,CAAC,2BAA4B,EAAS,kBAAkB,EAAE,cAAc,QAAU,GAC7F,QAAQ,GAAG,CAAC,4BAA6B,EAAS,kBAAkB,EAAE,eAAe,QAAU,GAC/F,QAAQ,GAAG,CAAC,uBAAwB,EAAS,UAAU,EAAE,UAAU,QAAU,GAC7E,QAAQ,GAAG,CAAC,0BAA2B,EAAS,UAAU,EAAE,QAAU,GACtE,QAAQ,GAAG,CAAC,iCAAkC,GAC9C,QAAQ,GAAG,CAAC,6BAA8B,EAAc,MAAM,EAC9D,QAAQ,GAAG,CAAC,iDAEL,SAAS,IAAI,CAAC,EACvB,CAAE,MAAO,EAAc,CAKrB,GAJA,QAAQ,KAAK,CAAC,4BACd,QAAQ,KAAK,CAAC,sBAAuB,GAAS,SAG1C,GAAS,SAAS,SAAS,QAAU,GAAS,SAAS,SAAS,SAAU,CAC5E,QAAQ,IAAI,CAAC,mFAEb,IAAM,EAAe,CACnB,eAAgB,CACd,cAAe,gBACf,MAAO,wCACP,OAAQ,kBACR,YAAa,kJACb,aAAc,IAAI,KAAK,KAAK,GAAG,GAAK,SAAe,EAAJ,SAAe,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE,CAC9E,kBAAmB,WACrB,EACA,mBAAoB,CAClB,aAAc,CAAC,qBAAsB,qBAAqB,CAC1D,cAAe,CAAC,oBAAoB,CACpC,cAAe,CAAC,oBAAoB,AACtC,EACA,WAAY,CACV,SAAU,CAAC,CAAE,UAAa,QAAS,OAAU,EAAG,EAAG,CAAE,UAAa,MAAO,OAAU,EAAG,EAAE,AAC1F,EACA,WAAY,EAAE,CACd,sBAAuB,EACvB,kBAAmB,EAAc,MAAM,CACvC,cAAe,CACjB,EACA,OAAO,SAAS,IAAI,CAAC,EACvB,CAIA,OAFA,QAAQ,KAAK,CAAC,oBAAqB,GAAS,OAAO,UAAU,EAAG,MAEzD,SAAS,IAAI,CAClB,CACE,MAAO,uBACP,UAAW,sBACX,QAAS,GAAS,SAAW,kBAC/B,EACA,CAAE,OAAQ,GAAI,EAElB,CACF,CAAE,MAAO,EAAY,CAOnB,OANA,QAAQ,KAAK,CAAC,iDACd,QAAQ,KAAK,CAAC,8BACd,QAAQ,KAAK,CAAC,iDACd,QAAQ,KAAK,CAAC,mBAAoB,GAAO,aAAa,MACtD,QAAQ,KAAK,CAAC,sBAAuB,GAAO,SAErC,SAAS,IAAI,CAClB,CACE,MAAO,oCACP,QAAS,GAAO,SAAW,gBAC3B,UAAW,cACb,EACA,CAAE,OAAQ,GAAI,EAElB,CACF,4BCrhBA,IAAA,EAAA,EAAA,CAAA,CAAA,QAIA,IAAM,EAAc,IAAI,EAAA,mBAAmB,CAAC,CACxC,WAAY,CACR,KAAM,EAAA,SAAS,CAAC,SAAS,CACzB,KAAM,4BACN,SAAU,sBACV,SAAU,QACV,WAAY,EAChB,EACA,QAAS,CAAA,OACT,IADiD,eACc,CAA3C,EACpB,iBAAkB,4CAClB,iBAZqB,GAarB,SAAA,CACJ,GAIM,CAAE,kBAAgB,CAAE,sBAAoB,aAAE,CAAW,CAAE,CAAG,EAChE,SAAS,IACL,MAAO,CAAA,EAAA,EAAA,UAAA,AAAW,EAAC,CACf,wCACA,CACJ,EACJ,CAEO,eAAe,EAAQ,CAAG,CAAE,CAAG,CAAE,CAAG,EACnC,EAAY,KAAK,EACjB,AADmB,CACnB,EAAA,EAAA,cAAA,AAAc,EAAC,EAAK,+BAAgC,QAAQ,MAAM,CAAC,MAAM,IAE7E,IAAI,EAAU,4BAKV,EAAU,EAAQ,OAAO,CAAC,WAAY,KAAO,IAMjD,IAAM,EAAgB,MAAM,EAAY,OAAO,CAAC,EAAK,EAAK,CACtD,UACA,mBAHE,CAAA,CAIN,GACA,GAAI,CAAC,EAID,OAHA,EAAI,IADY,MACF,CAAG,IACjB,EAAI,GAAG,CAAC,eACS,MAAjB,CAAwB,CAApB,IAAyB,KAAhB,EAAoB,EAAI,SAAS,CAAC,IAAI,CAAC,EAAK,QAAQ,OAAO,IACjE,KAEX,GAAM,SAAE,CAAO,QAAE,CAAM,YAAE,CAAU,WAAE,CAAS,aAAE,CAAW,mBAAE,CAAiB,qBAAE,CAAmB,sBAAE,CAAoB,CAAE,yBAAuB,kBAAE,CAAgB,yBAAE,CAAuB,uBAAE,CAAqB,CAAE,CAAG,EACnN,EAAoB,CAAA,EAAA,EAAA,gBAAA,AAAgB,EAAC,GACvC,EAAQ,GAAQ,EAAkB,aAAa,CAAC,EAAkB,EAAI,EAAkB,MAAM,CAAC,EAAiB,AAAjB,EAC7F,EAAY,WAEa,MAAvB,EAA8B,KAAK,EAAI,EAAoB,SAAA,AAAS,EAAE,AACtE,MAAM,EAAoB,SAAS,CAAC,EAAK,EAAK,GAAW,GAEzD,EAAI,GAAG,CAAC,gCAEL,MAEX,GAAI,GAAS,CAAC,EAAa,CACvB,IAAM,GAAgB,CAAQ,EAAkB,MAAM,CAAC,EAAiB,CAClE,EAAgB,EAAkB,aAAa,CAAC,EAAkB,CACxE,GAAI,IAC+B,IAA3B,EAAc,KADH,GACW,EAAc,CAAC,EAAe,CACpD,GAAI,EAAW,YAAY,CAAC,WAAW,CACnC,CADqC,MAC9B,MAAM,GAEjB,OAAM,IAAI,EAAA,eACd,AAD6B,CAGrC,CACA,IAAI,EAAW,MACX,GAAU,EAAY,IAAb,CAAkB,EAAK,EAAD,EAG/B,EAAW,AAAa,OAHqB,KAC7C,EAAW,CAAA,EAEwB,IAAM,CAAA,EAE7C,IAAM,GACgB,IAAtB,EAAY,EAAkB,GAAb,EAEjB,CAAC,EAKK,EAAqB,GAAS,CAAC,EAIjC,GAAyB,GACzB,CAAA,EAAA,EAAA,iBADkD,aAClD,AAA8B,EAAC,CAC3B,KAAM,EACN,EAd2F,8CAe3F,EACA,gBAAiB,CAAA,EAAA,EAAA,qBAAA,AAAqB,EAAC,uBACnC,CACJ,EACJ,GAEJ,IAAM,EAAS,EAAI,MAAM,EAAI,MACvB,EAAS,CAAA,EAAA,EAAA,SAAS,AAAT,IACT,EAAa,EAAO,kBAAkB,GACtC,EAAU,QACZ,oBACA,EACA,WAAY,CACR,aAAc,CACV,eAAgB,EAAQ,EAAW,YAAY,CAAC,cAAc,AAClE,EACA,iBAAiB,CAAQ,EAAW,eAAe,yBACnD,EACA,iBAAkB,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,EAAK,oBACtC,kBAAmB,EAAW,SAAS,CACvC,UAAW,EAAI,SAAS,CACxB,QAAS,AAAC,IACN,EAAI,EAAE,CAAC,QAAS,EACpB,EACA,iBAAkB,OAClB,8BAA+B,CAAC,EAAO,EAAU,IAAe,EAAY,cAAc,CAAC,EAAK,EAAO,EAAc,EACzH,EACA,cAAe,SACX,CACJ,CACJ,EACM,EAAc,IAAI,EAAA,eAAe,CAAC,GAClC,EAAc,IAAI,EAAA,gBAAgB,CAAC,GACnC,EAAU,EAAA,kBAAkB,CAAC,mBAAmB,CAAC,EAAa,CAAA,EAAA,EAAA,sBAAA,AAAsB,EAAC,IAC3F,GAAI,CACA,IAAM,EAAoB,MAAO,GACtB,EAAY,MAAM,CAAC,EAAS,GAAS,OAAO,CAAC,KAChD,GAAI,CAAC,EAAM,OACX,EAAK,aAAa,CAAC,CACf,mBAAoB,EAAI,UAAU,CAClC,YAAY,CAChB,GACA,IAAM,EAAqB,EAAO,qBAAqB,GAEvD,GAAI,CAAC,EACD,OAEJ,GAAI,EAAmB,GAAG,CAAC,EAHF,kBAGwB,EAAA,cAAc,CAAC,aAAa,CAAE,YAC3E,QAAQ,IAAI,CAAC,CAAC,2BAA2B,EAAE,EAAmB,GAAG,CAAC,kBAAkB,qEAAqE,CAAC,EAG9J,IAAM,EAAQ,EAAmB,GAAG,CAAC,cACrC,GAAI,EAAO,CACP,IAAM,EAAO,CAAA,EAAG,EAAO,CAAC,EAAE,EAAA,CAAO,CACjC,EAAK,aAAa,CAAC,CACf,aAAc,EACd,aAAc,EACd,iBAAkB,CACtB,GACA,EAAK,UAAU,CAAC,EACpB,MACI,CADG,CACE,UAAU,CAAC,CAAA,EAAG,EAAO,CAAC,EAAE,EAAA,CAAS,CAE9C,GAEE,GAAgB,CAAoC,CAAA,EAAA,EAAA,EAA5B,YAA4B,AAAc,EAAC,EAAK,eACxE,EAAiB,MAAO,QACtB,EA2FI,EA1FR,IAAM,EAAoB,MAAO,oBAAE,CAAkB,CAAE,IACnD,GAAI,CACA,GAAI,CAAC,GAAiB,GAAwB,GAA2B,CAAC,EAKtE,OAJA,EAAI,SADsF,CAC5E,CAAG,IAEjB,EAAI,SAAS,CAAC,iBAAkB,eAChC,EAAI,GAAG,CAAC,gCACD,KAEX,IAAM,EAAW,MAAM,EAAkB,GACzC,EAAI,YAAY,CAAG,EAAQ,UAAU,CAAC,YAAY,CAClD,IAAI,EAAmB,EAAQ,UAAU,CAAC,gBAAgB,CAGtD,GACI,EAAI,SAAS,EAAE,CACf,CAFc,CAEV,SAAS,CAAC,GACd,OAAmB,GAG3B,IAAM,EAAY,EAAQ,UAAU,CAAC,aAAa,CAGlD,IAAI,EA6BA,OADA,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,EAAC,EAAa,EAAa,EAAU,EAAQ,UAAU,CAAC,gBAAgB,EACnF,IA7BA,EACP,IAAM,EAAO,MAAM,EAAS,IAAI,GAE1B,EAAU,CAAA,EAAA,EAAA,yBAAA,AAAyB,EAAC,EAAS,OAAO,EACtD,IACA,CAAO,CAAC,EAAA,GADG,mBACmB,CAAC,CAAG,CAAA,EAElC,CAAC,CAAO,CAAC,eAAe,EAAI,EAAK,IAAI,EAAE,CACvC,CAAO,CAAC,eAAe,CAAG,EAAK,IAAA,AAAI,EAEvC,IAAM,EAAa,KAAkD,IAA3C,EAAQ,UAAU,CAAC,mBAAmB,IAAoB,EAAQ,UAAU,CAAC,mBAAmB,EAAI,EAAA,cAAA,AAAc,GAAG,AAAQ,EAAQ,UAAU,CAAC,mBAAmB,CACvL,EAAS,KAA8C,IAAvC,EAAQ,UAAU,CAAC,eAAe,EAAoB,EAAQ,UAAU,CAAC,eAAe,EAAI,EAAA,cAAc,MAAG,EAAY,EAAQ,UAAU,CAAC,eAAe,CAcjL,MAZmB,CAYZ,AAXH,MAAO,CACH,KAAM,EAAA,eAAe,CAAC,SAAS,CAC/B,OAAQ,EAAS,MAAM,CACvB,KAAM,OAAO,IAAI,CAAC,MAAM,EAAK,WAAW,YACxC,CACJ,EACA,aAAc,YACV,SACA,CACJ,CACJ,CAEJ,CAKJ,CAAE,KALS,CAKF,EAAK,CAcV,MAX0B,MAAtB,EAA6B,KAAK,EAAI,EAAmB,OAAA,AAAO,EAAE,CAClE,MAAM,EAAY,cAAc,CAAC,EAAK,EAAK,CACvC,WAAY,aACZ,UAAW,EACX,UAAW,QACX,iBAAkB,CAAA,EAAA,EAAA,mBAAA,AAAmB,EAAC,oBAClC,uBACA,CACJ,EACJ,EAAG,GAED,CACV,CACJ,EACM,EAAa,MAAM,EAAY,cAAc,CAAC,KAChD,aACA,WACA,EACA,UAAW,EAAA,SAAS,CAAC,SAAS,CAC9B,WAAY,qBACZ,EACA,mBAAmB,uBACnB,0BACA,oBACA,EACA,UAAW,EAAI,SAAS,eACxB,CACJ,GAEA,GAAI,CAAC,EACD,KADQ,EACD,KAEX,GAAI,CAAe,MAAd,CAAqB,EAAS,AAA0C,GAA9C,IAAK,EAAoB,EAAW,KAAK,AAAL,EAAiB,KAAK,EAAI,EAAkB,IAAI,IAAM,EAAA,eAAe,CAAC,SAAS,CAE9I,CAFgJ,KAE1I,OAAO,cAAc,CAAC,AAAI,MAAM,CAAC,kDAAkD,EAAgB,MAAd,CAAqB,EAAS,AAA2C,GAA/C,IAAK,EAAqB,EAAW,KAAA,AAAK,EAAY,KAAK,EAAI,EAAmB,IAAI,CAAA,CAAE,EAAG,oBAAqB,CACjO,MAAO,OACP,YAAY,EACZ,cAAc,CAClB,EAEA,CAAC,GACD,EAAI,SAAS,CAAC,AADE,iBACgB,EAAuB,cAAgB,EAAW,MAAM,CAAG,OAAS,EAAW,OAAO,CAAG,QAAU,OAGnI,GACA,EAAI,QADS,CACA,CAAC,gBAAiB,2DAEnC,IAAM,EAAU,CAAA,EAAA,EAAA,2BAAA,AAA2B,EAAC,EAAW,KAAK,CAAC,OAAO,EAcpE,OAbM,AAAF,CAAC,EAAkB,GACnB,EADwB,AAChB,GADmB,GACb,CAAC,EAAA,sBAAsB,GAIrC,EAAW,YAAY,EAAK,EAAD,AAAK,SAAS,CAAC,kBAAqB,EAAD,AAAS,GAAG,CAAC,kBAC3E,AAD6F,EACrF,GAAG,CAAC,gBAAiB,CAAA,EAAA,EAAA,qBAAA,AAAqB,EAAC,EAAW,YAAY,GAE9E,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,EAAC,EAAa,EAChC,IAAI,SAAS,EAAW,KAAK,CAAC,IAAI,CAAE,SAChC,EACA,OAAQ,EAAW,KAAK,CAAC,MAAM,EAAI,GACvC,IACO,IACX,EAGI,EACA,MAAM,EAAe,EADT,CAGZ,MAAM,EAAO,qBAAqB,CAAC,EAAI,OAAO,CAAE,IAAI,EAAO,KAAK,CAAC,EAAA,cAAc,CAAC,aAAa,CAAE,CACvF,SAAU,CAAA,EAAG,EAAO,CAAC,EAAE,EAAA,CAAS,CAChC,KAAM,EAAA,QAAQ,CAAC,MAAM,CACrB,WAAY,CACR,cAAe,EACf,cAAe,EAAI,GAAG,AAC1B,CACJ,EAAG,GAEf,CAAE,MAAO,EAAK,CAcV,GAbI,AAAE,CAAD,YAAgB,EAAA,eAAe,EAChC,CADmC,KAC7B,EAAY,cAAc,CAAC,EAAK,EAAK,CACvC,WAAY,aACZ,UAAW,EACX,UAAW,QACX,iBAAkB,CAAA,EAAA,EAAA,mBAAA,AAAmB,EAAC,oBAClC,uBACA,CACJ,EACJ,GAIA,EAAO,MAAM,EAKjB,OAHA,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,EAAC,EAAa,EAAa,IAAI,SAAS,KAAM,CAC5D,OAAQ,GACZ,IACO,IACX,CACJ,EAEA,qCAAqC","ignoreList":[1]}