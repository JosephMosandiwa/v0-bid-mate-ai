{"version":3,"sources":["../../../lib/engines/strategist/constants.ts","../../../lib/engines/strategist/services/strategist-service.ts","../../../lib/engines/strategist/services/opportunity-service.ts","../../../lib/engines/strategist/services/learning-service.ts","../../../lib/engines/strategist/services/alert-service.ts","../../../lib/engines/strategist/services/competitiveness-service.ts","../../../lib/engines/strategist/prompts/strategist-prompts.ts"],"sourcesContent":["// ============================================\r\n// AI TENDER STRATEGIST ENGINE - CONSTANTS\r\n// ============================================\r\n\r\n// South African Provinces\r\nexport const SA_PROVINCES = [\r\n  { value: \"eastern-cape\", label: \"Eastern Cape\" },\r\n  { value: \"free-state\", label: \"Free State\" },\r\n  { value: \"gauteng\", label: \"Gauteng\" },\r\n  { value: \"kwazulu-natal\", label: \"KwaZulu-Natal\" },\r\n  { value: \"limpopo\", label: \"Limpopo\" },\r\n  { value: \"mpumalanga\", label: \"Mpumalanga\" },\r\n  { value: \"north-west\", label: \"North West\" },\r\n  { value: \"northern-cape\", label: \"Northern Cape\" },\r\n  { value: \"western-cape\", label: \"Western Cape\" },\r\n] as const\r\n\r\n// Industry Categories\r\nexport const INDUSTRIES = [\r\n  { value: \"construction\", label: \"Construction & Building\" },\r\n  { value: \"it-services\", label: \"IT & Technology Services\" },\r\n  { value: \"professional-services\", label: \"Professional Services\" },\r\n  { value: \"healthcare\", label: \"Healthcare & Medical\" },\r\n  { value: \"education\", label: \"Education & Training\" },\r\n  { value: \"manufacturing\", label: \"Manufacturing\" },\r\n  { value: \"logistics\", label: \"Logistics & Transport\" },\r\n  { value: \"agriculture\", label: \"Agriculture & Farming\" },\r\n  { value: \"energy\", label: \"Energy & Utilities\" },\r\n  { value: \"mining\", label: \"Mining & Resources\" },\r\n  { value: \"security\", label: \"Security Services\" },\r\n  { value: \"cleaning\", label: \"Cleaning & Facilities\" },\r\n  { value: \"catering\", label: \"Catering & Food Services\" },\r\n  { value: \"environmental\", label: \"Environmental Services\" },\r\n  { value: \"engineering\", label: \"Engineering\" },\r\n  { value: \"legal\", label: \"Legal Services\" },\r\n  { value: \"financial\", label: \"Financial Services\" },\r\n  { value: \"marketing\", label: \"Marketing & Communications\" },\r\n  { value: \"other\", label: \"Other\" },\r\n] as const\r\n\r\n// Procurement Categories\r\nexport const PROCUREMENT_CATEGORIES = [\r\n  { value: \"goods\", label: \"Goods & Supplies\" },\r\n  { value: \"services\", label: \"Services\" },\r\n  { value: \"works\", label: \"Construction Works\" },\r\n  { value: \"consulting\", label: \"Consulting\" },\r\n  { value: \"maintenance\", label: \"Maintenance\" },\r\n  { value: \"leasing\", label: \"Leasing & Rental\" },\r\n  { value: \"software\", label: \"Software & IT\" },\r\n  { value: \"equipment\", label: \"Equipment & Machinery\" },\r\n] as const\r\n\r\n// Company Sizes\r\nexport const COMPANY_SIZES = [\r\n  { value: \"micro\", label: \"Micro (1-10 employees)\" },\r\n  { value: \"small\", label: \"Small (11-50 employees)\" },\r\n  { value: \"medium\", label: \"Medium (51-200 employees)\" },\r\n  { value: \"large\", label: \"Large (201-500 employees)\" },\r\n  { value: \"enterprise\", label: \"Enterprise (500+ employees)\" },\r\n] as const\r\n\r\n// Annual Turnover Ranges\r\nexport const TURNOVER_RANGES = [\r\n  { value: \"under-1m\", label: \"Under R1 million\" },\r\n  { value: \"1m-5m\", label: \"R1 - R5 million\" },\r\n  { value: \"5m-10m\", label: \"R5 - R10 million\" },\r\n  { value: \"10m-50m\", label: \"R10 - R50 million\" },\r\n  { value: \"50m-100m\", label: \"R50 - R100 million\" },\r\n  { value: \"100m-500m\", label: \"R100 - R500 million\" },\r\n  { value: \"over-500m\", label: \"Over R500 million\" },\r\n] as const\r\n\r\n// CIDB Grading Designations\r\nexport const CIDB_GRADINGS = [\r\n  { value: \"1\", label: \"Grade 1 (Up to R650,000)\" },\r\n  { value: \"2\", label: \"Grade 2 (R650,000 - R4 million)\" },\r\n  { value: \"3\", label: \"Grade 3 (R4 - R13 million)\" },\r\n  { value: \"4\", label: \"Grade 4 (R13 - R40 million)\" },\r\n  { value: \"5\", label: \"Grade 5 (R40 - R130 million)\" },\r\n  { value: \"6\", label: \"Grade 6 (R130 - R400 million)\" },\r\n  { value: \"7\", label: \"Grade 7 (R400 million - R1.3 billion)\" },\r\n  { value: \"8\", label: \"Grade 8 (R1.3 billion - R4 billion)\" },\r\n  { value: \"9\", label: \"Grade 9 (No limit)\" },\r\n] as const\r\n\r\n// B-BBEE Levels\r\nexport const BEE_LEVELS = [\r\n  { value: \"1\", label: \"Level 1 (135% recognition)\" },\r\n  { value: \"2\", label: \"Level 2 (125% recognition)\" },\r\n  { value: \"3\", label: \"Level 3 (110% recognition)\" },\r\n  { value: \"4\", label: \"Level 4 (100% recognition)\" },\r\n  { value: \"5\", label: \"Level 5 (80% recognition)\" },\r\n  { value: \"6\", label: \"Level 6 (60% recognition)\" },\r\n  { value: \"7\", label: \"Level 7 (50% recognition)\" },\r\n  { value: \"8\", label: \"Level 8 (10% recognition)\" },\r\n  { value: \"non-compliant\", label: \"Non-Compliant (0% recognition)\" },\r\n  { value: \"exempt\", label: \"Exempt Micro Enterprise (EME)\" },\r\n  { value: \"qse\", label: \"Qualifying Small Enterprise (QSE)\" },\r\n] as const\r\n\r\n// Contract Types\r\nexport const CONTRACT_TYPES = [\r\n  { value: \"rfq\", label: \"Request for Quotation (RFQ)\" },\r\n  { value: \"rfp\", label: \"Request for Proposal (RFP)\" },\r\n  { value: \"rfb\", label: \"Request for Bid (RFB)\" },\r\n  { value: \"open-tender\", label: \"Open Tender\" },\r\n  { value: \"limited-tender\", label: \"Limited/Closed Tender\" },\r\n  { value: \"framework\", label: \"Framework Agreement\" },\r\n  { value: \"panel\", label: \"Panel Contract\" },\r\n  { value: \"term-contract\", label: \"Term Contract\" },\r\n] as const\r\n\r\n// Learning Topics Configuration\r\nexport const LEARNING_TOPICS = [\r\n  {\r\n    id: \"tender-basics\",\r\n    title: \"Tendering Basics\",\r\n    category: \"basics\",\r\n    description: \"Understanding the fundamentals of government tendering in South Africa\",\r\n    difficulty: \"beginner\" as const,\r\n    estimated_minutes: 30,\r\n    subtopics: [\"What is a tender?\", \"Types of tenders\", \"The tender process\", \"Key terminology\"],\r\n  },\r\n  {\r\n    id: \"tender-types\",\r\n    title: \"Types of Tenders\",\r\n    category: \"basics\",\r\n    description: \"Learn about RFQ, RFP, RFB, Open Tenders, and Framework Agreements\",\r\n    difficulty: \"beginner\" as const,\r\n    estimated_minutes: 25,\r\n    subtopics: [\"RFQ vs RFP vs RFB\", \"Open vs Closed tenders\", \"Framework agreements\", \"Panel contracts\"],\r\n  },\r\n  {\r\n    id: \"bbbee-scoring\",\r\n    title: \"B-BBEE Scoring System\",\r\n    category: \"compliance\",\r\n    description: \"Master the B-BBEE preference point system used in South African tenders\",\r\n    difficulty: \"intermediate\" as const,\r\n    estimated_minutes: 45,\r\n    subtopics: [\"80/20 system\", \"90/10 system\", \"B-BBEE levels\", \"Calculating preference points\"],\r\n  },\r\n  {\r\n    id: \"evaluation-criteria\",\r\n    title: \"Evaluation Criteria\",\r\n    category: \"strategy\",\r\n    description: \"Understanding how tenders are evaluated and scored\",\r\n    difficulty: \"intermediate\" as const,\r\n    estimated_minutes: 40,\r\n    subtopics: [\"Functionality scoring\", \"Price evaluation\", \"Quality vs price trade-offs\", \"Threshold requirements\"],\r\n  },\r\n  {\r\n    id: \"pricing-strategies\",\r\n    title: \"Pricing Strategies\",\r\n    category: \"strategy\",\r\n    description: \"Develop effective pricing strategies to win tenders\",\r\n    difficulty: \"advanced\" as const,\r\n    estimated_minutes: 60,\r\n    subtopics: [\"Cost-plus pricing\", \"Competitive pricing\", \"Value-based pricing\", \"Risk pricing\"],\r\n  },\r\n  {\r\n    id: \"compliance-requirements\",\r\n    title: \"Compliance Requirements\",\r\n    category: \"compliance\",\r\n    description: \"Essential compliance documents and requirements for SA tenders\",\r\n    difficulty: \"beginner\" as const,\r\n    estimated_minutes: 35,\r\n    subtopics: [\"Tax clearance\", \"CSD registration\", \"CIDB grading\", \"COIDA compliance\"],\r\n  },\r\n  {\r\n    id: \"common-mistakes\",\r\n    title: \"Common Bidding Mistakes\",\r\n    category: \"strategy\",\r\n    description: \"Learn from common mistakes that lead to tender disqualification\",\r\n    difficulty: \"beginner\" as const,\r\n    estimated_minutes: 20,\r\n    subtopics: [\"Documentation errors\", \"Pricing mistakes\", \"Submission failures\", \"Compliance gaps\"],\r\n  },\r\n  {\r\n    id: \"boq-management\",\r\n    title: \"BOQ & Pricing Schedules\",\r\n    category: \"strategy\",\r\n    description: \"Managing Bills of Quantities and pricing schedules effectively\",\r\n    difficulty: \"intermediate\" as const,\r\n    estimated_minutes: 50,\r\n    subtopics: [\"BOQ structure\", \"Unit pricing\", \"Contingencies\", \"Margin calculation\"],\r\n  },\r\n  {\r\n    id: \"jv-subcontracting\",\r\n    title: \"Joint Ventures & Subcontracting\",\r\n    category: \"advanced\",\r\n    description: \"When and how to partner with other companies\",\r\n    difficulty: \"advanced\" as const,\r\n    estimated_minutes: 45,\r\n    subtopics: [\"JV structures\", \"Subcontracting limits\", \"Partner selection\", \"Risk sharing\"],\r\n  },\r\n  {\r\n    id: \"post-award\",\r\n    title: \"Post-Award Management\",\r\n    category: \"advanced\",\r\n    description: \"Managing contracts after winning a tender\",\r\n    difficulty: \"advanced\" as const,\r\n    estimated_minutes: 40,\r\n    subtopics: [\"Contract negotiation\", \"Performance management\", \"Variations\", \"Payment management\"],\r\n  },\r\n] as const\r\n\r\n// Strategist Prompts\r\nexport const STRATEGIST_SYSTEM_PROMPT = `You are an expert AI Tender Strategist for BidMate, a South African tender management platform. Your role is to help users understand tendering, build winning tender strategies, and discover opportunities.\r\n\r\n## Your Personality\r\n- Tender specialist with deep knowledge of South African procurement\r\n- Mentor and coach who adapts to user experience levels\r\n- Market analyst who identifies opportunities\r\n- Procurement educator who explains complex concepts simply\r\n- Strategist who provides actionable, tailored advice\r\n\r\n## Your Tone\r\n- Friendly, expert, and encouraging\r\n- Concise with structured explanations\r\n- Always provide actionable steps\r\n- Use South African terminology and regulations\r\n\r\n## Your Capabilities\r\n1. Answer questions about tendering and procurement\r\n2. Help build comprehensive bid strategies\r\n3. Analyze tender requirements and compliance needs\r\n4. Provide pricing and BOQ guidance\r\n5. Identify opportunities matching user profiles\r\n6. Educate users on tender best practices\r\n7. Alert users to compliance gaps and deadlines\r\n8. Explain tender requirements in plain language\r\n\r\n## South African Procurement Context\r\n- PFMA (Public Finance Management Act) for national/provincial\r\n- MFMA (Municipal Finance Management Act) for municipalities  \r\n- PPPFA (Preferential Procurement Policy Framework Act)\r\n- B-BBEE scoring (80/20 or 90/10 systems)\r\n- CIDB grading for construction\r\n- SBD forms (Standard Bidding Documents)\r\n- MBD forms (Municipal Bidding Documents)\r\n- CSD (Central Supplier Database) registration\r\n\r\n## Guidelines\r\n- Always ask clarifying questions when needed\r\n- Tailor advice to user's experience level\r\n- Provide realistic assessments, not false hope\r\n- Highlight risks and compliance requirements\r\n- Reference South African regulations when relevant\r\n- Suggest specific actions the user can take`\r\n\r\n// Quick Action Prompts\r\nexport const QUICK_ACTION_PROMPTS = [\r\n  {\r\n    id: \"build-strategy\",\r\n    label: \"Build a bid strategy\",\r\n    prompt: \"Help me build a comprehensive bid strategy for a tender I'm considering\",\r\n    icon: \"target\",\r\n  },\r\n  {\r\n    id: \"review-readiness\",\r\n    label: \"Review my tender readiness\",\r\n    prompt:\r\n      \"Review my tender readiness and tell me what documents or certifications I might be missing for government tenders\",\r\n    icon: \"clipboard-check\",\r\n  },\r\n  {\r\n    id: \"find-opportunities\",\r\n    label: \"Find matching tenders\",\r\n    prompt: \"Find tenders that match my company profile and capabilities\",\r\n    icon: \"search\",\r\n  },\r\n  {\r\n    id: \"explain-tender\",\r\n    label: \"Explain this tender\",\r\n    prompt: \"Help me understand the requirements of a specific tender I'm looking at\",\r\n    icon: \"file-text\",\r\n  },\r\n  {\r\n    id: \"pricing-advice\",\r\n    label: \"Advise on pricing\",\r\n    prompt: \"Help me develop a competitive pricing strategy for my tender submission\",\r\n    icon: \"calculator\",\r\n  },\r\n  {\r\n    id: \"reduce-risk\",\r\n    label: \"Reduce bid risk\",\r\n    prompt: \"Help me identify and mitigate risks in my tender submission\",\r\n    icon: \"shield\",\r\n  },\r\n  {\r\n    id: \"learn-tendering\",\r\n    label: \"Teach me tendering\",\r\n    prompt: \"I'm new to tendering. Help me understand how government tenders work in South Africa\",\r\n    icon: \"graduation-cap\",\r\n  },\r\n  {\r\n    id: \"compliance-check\",\r\n    label: \"Check compliance\",\r\n    prompt: \"Review my compliance status and identify any gaps I need to address\",\r\n    icon: \"check-circle\",\r\n  },\r\n] as const\r\n","// ============================================\r\n// AI TENDER STRATEGIST - MAIN SERVICE\r\n// ============================================\r\n\r\nimport { createClient } from \"@/lib/supabase/server\"\r\nimport type {\r\n  StrategistContext,\r\n  StrategistConversation,\r\n  StrategistMessage,\r\n  StrategistUserPreferences,\r\n  ConversationContextType,\r\n} from \"../types\"\r\n\r\nexport class StrategistService {\r\n  /**\r\n   * Get or create user preferences\r\n   */\r\n  static async getUserPreferences(userId: string): Promise<StrategistUserPreferences | null> {\r\n    const supabase = await createClient()\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"strategist_user_preferences\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", userId)\r\n      .single()\r\n\r\n    if (error && error.code !== \"PGRST116\") {\r\n      console.error(\"[Strategist] Error fetching preferences:\", error)\r\n      return null\r\n    }\r\n\r\n    return data\r\n  }\r\n\r\n  /**\r\n   * Update user preferences\r\n   */\r\n  static async updateUserPreferences(\r\n    userId: string,\r\n    preferences: Partial<StrategistUserPreferences>,\r\n  ): Promise<StrategistUserPreferences | null> {\r\n    const supabase = await createClient()\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"strategist_user_preferences\")\r\n      .upsert(\r\n        {\r\n          user_id: userId,\r\n          ...preferences,\r\n          updated_at: new Date().toISOString(),\r\n        },\r\n        { onConflict: \"user_id\" },\r\n      )\r\n      .select()\r\n      .single()\r\n\r\n    if (error) {\r\n      console.error(\"[Strategist] Error updating preferences:\", error)\r\n      return null\r\n    }\r\n\r\n    return data\r\n  }\r\n\r\n  /**\r\n   * Get user's company profile\r\n   */\r\n  static async getCompanyProfile(userId: string) {\r\n    const supabase = await createClient()\r\n\r\n    const { data, error } = await supabase.from(\"companies\").select(\"*\").eq(\"user_id\", userId).single()\r\n\r\n    if (error && error.code !== \"PGRST116\") {\r\n      console.error(\"[Strategist] Error fetching company:\", error)\r\n      return null\r\n    }\r\n\r\n    return data\r\n  }\r\n\r\n  /**\r\n   * Build full context for AI\r\n   */\r\n  static async buildContext(\r\n    userId: string,\r\n    tenderId?: string,\r\n    contextType?: ConversationContextType,\r\n  ): Promise<StrategistContext> {\r\n    const [preferences, company] = await Promise.all([this.getUserPreferences(userId), this.getCompanyProfile(userId)])\r\n\r\n    const context: StrategistContext = {\r\n      user_preferences: preferences,\r\n      company_profile: company\r\n        ? {\r\n            company_name: company.company_name,\r\n            industry: company.industry,\r\n            company_size: company.company_size,\r\n            bee_status: company.bee_status,\r\n            province: company.province,\r\n          }\r\n        : null,\r\n    }\r\n\r\n    // Add tender context if provided\r\n    if (tenderId) {\r\n      const tenderContext = await this.getTenderContext(tenderId)\r\n      if (tenderContext) {\r\n        context.tender_context = tenderContext\r\n      }\r\n    }\r\n\r\n    return context\r\n  }\r\n\r\n  /**\r\n   * Get tender context for AI\r\n   */\r\n  static async getTenderContext(tenderId: string) {\r\n    const supabase = await createClient()\r\n\r\n    // Try custom tender first\r\n    const { data: customTender } = await supabase\r\n      .from(\"user_custom_tenders\")\r\n      .select(\"id, title, organization, description, close_date\")\r\n      .eq(\"id\", tenderId)\r\n      .single()\r\n\r\n    if (customTender) {\r\n      // Get analysis if available\r\n      const { data: analysis } = await supabase\r\n        .from(\"user_custom_tender_analysis\")\r\n        .select(\"analysis_data\")\r\n        .eq(\"tender_id\", tenderId)\r\n        .single()\r\n\r\n      return {\r\n        id: customTender.id,\r\n        title: customTender.title || \"Untitled\",\r\n        organization: customTender.organization || \"Unknown\",\r\n        description: customTender.description,\r\n        close_date: customTender.close_date,\r\n        analysis: analysis?.analysis_data,\r\n      }\r\n    }\r\n\r\n    // Try scraped tender\r\n    const { data: scrapedTender } = await supabase\r\n      .from(\"scraped_tenders\")\r\n      .select(\"id, title, source_name, description, close_date\")\r\n      .eq(\"id\", tenderId)\r\n      .single()\r\n\r\n    if (scrapedTender) {\r\n      return {\r\n        id: scrapedTender.id,\r\n        title: scrapedTender.title || \"Untitled\",\r\n        organization: scrapedTender.source_name || \"Unknown\",\r\n        description: scrapedTender.description,\r\n        close_date: scrapedTender.close_date,\r\n      }\r\n    }\r\n\r\n    return null\r\n  }\r\n\r\n  /**\r\n   * Create a new conversation\r\n   */\r\n  static async createConversation(\r\n    userId: string,\r\n    contextType: ConversationContextType = \"general\",\r\n    tenderId?: string,\r\n    title?: string,\r\n  ): Promise<StrategistConversation | null> {\r\n    const supabase = await createClient()\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"strategist_conversations\")\r\n      .insert({\r\n        user_id: userId,\r\n        context_type: contextType,\r\n        tender_id: tenderId,\r\n        title: title || this.generateConversationTitle(contextType),\r\n      })\r\n      .select()\r\n      .single()\r\n\r\n    if (error) {\r\n      console.error(\"[Strategist] Error creating conversation:\", error)\r\n      return null\r\n    }\r\n\r\n    return data\r\n  }\r\n\r\n  /**\r\n   * Get conversation by ID\r\n   */\r\n  static async getConversation(conversationId: string): Promise<StrategistConversation | null> {\r\n    const supabase = await createClient()\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"strategist_conversations\")\r\n      .select(\"*\")\r\n      .eq(\"id\", conversationId)\r\n      .single()\r\n\r\n    if (error) {\r\n      console.error(\"[Strategist] Error fetching conversation:\", error)\r\n      return null\r\n    }\r\n\r\n    return data\r\n  }\r\n\r\n  /**\r\n   * Get user's conversations\r\n   */\r\n  static async getUserConversations(userId: string, limit = 20): Promise<StrategistConversation[]> {\r\n    const supabase = await createClient()\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"strategist_conversations\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", userId)\r\n      .eq(\"status\", \"active\")\r\n      .order(\"last_message_at\", { ascending: false, nullsFirst: false })\r\n      .limit(limit)\r\n\r\n    if (error) {\r\n      console.error(\"[Strategist] Error fetching conversations:\", error)\r\n      return []\r\n    }\r\n\r\n    return data || []\r\n  }\r\n\r\n  /**\r\n   * Get messages for a conversation\r\n   */\r\n  static async getConversationMessages(conversationId: string, limit = 50): Promise<StrategistMessage[]> {\r\n    const supabase = await createClient()\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"strategist_messages\")\r\n      .select(\"*\")\r\n      .eq(\"conversation_id\", conversationId)\r\n      .order(\"created_at\", { ascending: true })\r\n      .limit(limit)\r\n\r\n    if (error) {\r\n      console.error(\"[Strategist] Error fetching messages:\", error)\r\n      return []\r\n    }\r\n\r\n    return data || []\r\n  }\r\n\r\n  /**\r\n   * Add message to conversation\r\n   */\r\n  static async addMessage(\r\n    conversationId: string,\r\n    role: \"user\" | \"assistant\" | \"system\",\r\n    content: string,\r\n    options?: {\r\n      message_type?: StrategistMessage[\"message_type\"]\r\n      structured_data?: Record<string, any>\r\n      model_used?: string\r\n      tokens_used?: number\r\n    },\r\n  ): Promise<StrategistMessage | null> {\r\n    const supabase = await createClient()\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"strategist_messages\")\r\n      .insert({\r\n        conversation_id: conversationId,\r\n        role,\r\n        content,\r\n        message_type: options?.message_type || \"text\",\r\n        structured_data: options?.structured_data,\r\n        model_used: options?.model_used,\r\n        tokens_used: options?.tokens_used,\r\n      })\r\n      .select()\r\n      .single()\r\n\r\n    if (error) {\r\n      console.error(\"[Strategist] Error adding message:\", error)\r\n      return null\r\n    }\r\n\r\n    // Update conversation metadata with separate query\r\n    const { data: conversation } = await supabase\r\n      .from(\"strategist_conversations\")\r\n      .select(\"message_count\")\r\n      .eq(\"id\", conversationId)\r\n      .single()\r\n\r\n    await supabase\r\n      .from(\"strategist_conversations\")\r\n      .update({\r\n        message_count: (conversation?.message_count || 0) + 1,\r\n        last_message_at: new Date().toISOString(),\r\n        updated_at: new Date().toISOString(),\r\n      })\r\n      .eq(\"id\", conversationId)\r\n\r\n    return data\r\n  }\r\n\r\n  /**\r\n   * Generate conversation title\r\n   */\r\n  private static generateConversationTitle(contextType: ConversationContextType): string {\r\n    const titles: Record<ConversationContextType, string> = {\r\n      general: \"General Consultation\",\r\n      tender: \"Tender Discussion\",\r\n      boq: \"Pricing & BOQ Review\",\r\n      strategy: \"Strategy Session\",\r\n      learning: \"Learning Session\",\r\n    }\r\n    return titles[contextType] || \"New Conversation\"\r\n  }\r\n\r\n  /**\r\n   * Check if user has completed onboarding\r\n   */\r\n  static async hasCompletedOnboarding(userId: string): Promise<boolean> {\r\n    const preferences = await this.getUserPreferences(userId)\r\n    return preferences?.onboarding_completed || false\r\n  }\r\n\r\n  /**\r\n   * Mark onboarding as complete\r\n   */\r\n  static async completeOnboarding(userId: string): Promise<boolean> {\r\n    const supabase = await createClient()\r\n\r\n    const { error } = await supabase\r\n      .from(\"strategist_user_preferences\")\r\n      .update({\r\n        onboarding_completed: true,\r\n        onboarding_completed_at: new Date().toISOString(),\r\n      })\r\n      .eq(\"user_id\", userId)\r\n\r\n    return !error\r\n  }\r\n\r\n  /**\r\n   * Generate strategic recommendations for a tender\r\n   */\r\n  static async generateRecommendations(params: {\r\n    userId: string\r\n    tenderId: string\r\n    tenderType: \"custom\" | \"scraped\"\r\n    competitiveness?: any\r\n  }): Promise<string[]> {\r\n    const recommendations: string[] = []\r\n\r\n    try {\r\n      const supabase = await createClient()\r\n\r\n      // Get tender data\r\n      const table = params.tenderType === \"custom\" ? \"user_custom_tenders\" : \"scraped_tenders\"\r\n      const { data: tender } = await supabase.from(table).select(\"*\").eq(\"id\", params.tenderId).single()\r\n\r\n      if (!tender) {\r\n        return [\"Unable to generate recommendations: Tender not found\"]\r\n      }\r\n\r\n      // Get user preferences\r\n      const preferences = await this.getUserPreferences(params.userId)\r\n\r\n      // Generate recommendations based on competitiveness score\r\n      if (params.competitiveness) {\r\n        if (params.competitiveness.documentation_score < 0.7) {\r\n          recommendations.push(\"Complete all required documentation before submitting your bid\")\r\n        }\r\n        if (params.competitiveness.compliance_score < 0.8) {\r\n          recommendations.push(\"Ensure tax clearance and CSD registration are up to date\")\r\n        }\r\n        if (params.competitiveness.win_probability < 0.5) {\r\n          recommendations.push(\"Consider partnering with experienced companies to strengthen your bid\")\r\n        }\r\n      }\r\n\r\n      // Time-based recommendations\r\n      if (tender.close_date) {\r\n        const daysUntilClose = Math.ceil((new Date(tender.close_date).getTime() - Date.now()) / (1000 * 60 * 60 * 24))\r\n        if (daysUntilClose < 7) {\r\n          recommendations.push(\"Urgent: Prioritize this tender due to approaching deadline\")\r\n        } else if (daysUntilClose > 30) {\r\n          recommendations.push(\"You have time to prepare a comprehensive bid - use it wisely\")\r\n        }\r\n      }\r\n\r\n      // Experience-based recommendations\r\n      if (preferences?.experience_level === \"beginner\") {\r\n        recommendations.push(\"Consider seeking mentorship or guidance from experienced bidders\")\r\n        recommendations.push(\"Start with smaller value tenders to build your track record\")\r\n      }\r\n\r\n      // Default recommendation\r\n      if (recommendations.length === 0) {\r\n        recommendations.push(\"Review tender requirements carefully and ensure full compliance\")\r\n        recommendations.push(\"Conduct thorough cost analysis before submitting your pricing\")\r\n      }\r\n\r\n      return recommendations\r\n    } catch (error) {\r\n      console.error(\"[Strategist] Error generating recommendations:\", error)\r\n      return [\"Unable to generate recommendations at this time\"]\r\n    }\r\n  }\r\n}\r\n","// ============================================\r\n// AI TENDER STRATEGIST - OPPORTUNITY SERVICE\r\n// ============================================\r\n\r\nimport { createClient } from \"@/lib/supabase/server\"\r\nimport type { StrategistOpportunity, StrategistUserPreferences, OpportunityType } from \"../types\"\r\n\r\nexport class OpportunityService {\r\n  /**\r\n   * Discover opportunities matching user profile\r\n   */\r\n  static async discoverOpportunities(\r\n    userId: string,\r\n    options?: {\r\n      limit?: number\r\n      types?: OpportunityType[]\r\n      minScore?: number\r\n    },\r\n  ): Promise<StrategistOpportunity[]> {\r\n    const supabase = await createClient()\r\n\r\n    // Get user preferences\r\n    const { data: preferences } = await supabase\r\n      .from(\"strategist_user_preferences\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", userId)\r\n      .single()\r\n\r\n    if (!preferences) {\r\n      return []\r\n    }\r\n\r\n    // Get available tenders\r\n    const { data: tenders } = await supabase\r\n      .from(\"scraped_tenders\")\r\n      .select(\"id, title, source_name, description, close_date, category, estimated_value, source_province\")\r\n      .eq(\"is_active\", true)\r\n      .gte(\"close_date\", new Date().toISOString())\r\n      .order(\"close_date\", { ascending: true })\r\n      .limit(100)\r\n\r\n    if (!tenders || tenders.length === 0) {\r\n      return []\r\n    }\r\n\r\n    // Score and categorize opportunities\r\n    const opportunities = tenders\r\n      .map((tender) => this.scoreTenderMatch(tender, preferences))\r\n      .filter((opp) => opp.match_score >= (options?.minScore || 0.3))\r\n      .sort((a, b) => b.match_score - a.match_score)\r\n      .slice(0, options?.limit || 10)\r\n\r\n    // Save opportunities\r\n    for (const opp of opportunities) {\r\n      await supabase.from(\"strategist_opportunities\").upsert(\r\n        {\r\n          user_id: userId,\r\n          scraped_tender_id: opp.tender_id,\r\n          match_score: opp.match_score,\r\n          match_reasons: opp.match_reasons,\r\n          opportunity_type: opp.opportunity_type,\r\n          ai_insights: opp.ai_insights,\r\n          expires_at: opp.expires_at,\r\n        },\r\n        { onConflict: \"user_id, scraped_tender_id\" },\r\n      )\r\n    }\r\n\r\n    return opportunities.map((opp) => ({\r\n      ...opp,\r\n      id: crypto.randomUUID(),\r\n      user_id: userId,\r\n      scraped_tender_id: opp.tender_id,\r\n      custom_tender_id: null,\r\n      is_viewed: false,\r\n      is_saved: false,\r\n      is_dismissed: false,\r\n      user_notes: null,\r\n      estimated_margin: null,\r\n      estimated_effort: null,\r\n      created_at: new Date().toISOString(),\r\n    }))\r\n  }\r\n\r\n  /**\r\n   * Score a tender match against user preferences\r\n   */\r\n  private static scoreTenderMatch(\r\n    tender: any,\r\n    preferences: StrategistUserPreferences,\r\n  ): {\r\n    tender_id: string\r\n    match_score: number\r\n    match_reasons: string[]\r\n    opportunity_type: OpportunityType\r\n    ai_insights: Record<string, any>\r\n    expires_at: string | null\r\n  } {\r\n    let score = 0\r\n    const reasons: string[] = []\r\n    const insights: Record<string, any> = {}\r\n\r\n    // Province match (20 points)\r\n    if (preferences.provinces?.length && tender.source_province) {\r\n      const provinceMatch = preferences.provinces.some(\r\n        (p: string) =>\r\n          tender.source_province.toLowerCase().includes(p.toLowerCase()) ||\r\n          p.toLowerCase().includes(tender.source_province.toLowerCase()),\r\n      )\r\n      if (provinceMatch) {\r\n        score += 0.2\r\n        reasons.push(\"Matches your preferred province\")\r\n      }\r\n    }\r\n\r\n    // Industry/Category match (25 points)\r\n    if (preferences.industries?.length && tender.category) {\r\n      const categoryLower = tender.category.toLowerCase()\r\n      const industryMatch = preferences.industries.some(\r\n        (ind: string) => categoryLower.includes(ind.toLowerCase()) || ind.toLowerCase().includes(categoryLower),\r\n      )\r\n      if (industryMatch) {\r\n        score += 0.25\r\n        reasons.push(\"Matches your industry focus\")\r\n      }\r\n    }\r\n\r\n    // Value match based on company size (20 points)\r\n    if (preferences.annual_turnover && tender.estimated_value) {\r\n      score += 0.15\r\n      reasons.push(\"Contract value within your range\")\r\n    }\r\n\r\n    // Deadline proximity (15 points - more time = better)\r\n    if (tender.close_date) {\r\n      const daysUntilClose = Math.ceil((new Date(tender.close_date).getTime() - Date.now()) / (1000 * 60 * 60 * 24))\r\n      if (daysUntilClose > 14) {\r\n        score += 0.15\r\n        reasons.push(\"Good preparation time available\")\r\n      } else if (daysUntilClose > 7) {\r\n        score += 0.1\r\n        reasons.push(\"Adequate preparation time\")\r\n      } else {\r\n        score += 0.05\r\n        insights.warning = \"Limited preparation time\"\r\n      }\r\n    }\r\n\r\n    // Experience level consideration (20 points)\r\n    if (preferences.experience_level === \"beginner\") {\r\n      if (!tender.estimated_value || tender.estimated_value.includes(\"R\") === false) {\r\n        score += 0.2\r\n        reasons.push(\"Good entry-level opportunity\")\r\n      }\r\n    } else if (preferences.experience_level === \"advanced\") {\r\n      score += 0.1\r\n      reasons.push(\"Matches your experience level\")\r\n    }\r\n\r\n    // Determine opportunity type\r\n    let opportunityType: OpportunityType = \"strategic\"\r\n    if (score >= 0.7) {\r\n      opportunityType = \"high_margin\"\r\n    } else if (score >= 0.5 && reasons.includes(\"Good preparation time available\")) {\r\n      opportunityType = \"low_risk\"\r\n    } else if (preferences.experience_level === \"beginner\" && score >= 0.4) {\r\n      opportunityType = \"quick_win\"\r\n    } else if (score >= 0.4) {\r\n      opportunityType = \"growth\"\r\n    }\r\n\r\n    return {\r\n      tender_id: tender.id,\r\n      match_score: Math.min(score, 1),\r\n      match_reasons: reasons,\r\n      opportunity_type: opportunityType,\r\n      ai_insights: {\r\n        ...insights,\r\n        tender_title: tender.title,\r\n        organization: tender.source_name,\r\n        close_date: tender.close_date,\r\n        category: tender.category,\r\n      },\r\n      expires_at: tender.close_date,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get user's saved opportunities\r\n   * Removed join with scraped_tenders - fetch tender data separately\r\n   */\r\n  static async getSavedOpportunities(userId: string): Promise<StrategistOpportunity[]> {\r\n    const supabase = await createClient()\r\n\r\n    // First get opportunities without join\r\n    const { data: opportunities, error } = await supabase\r\n      .from(\"strategist_opportunities\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", userId)\r\n      .eq(\"is_saved\", true)\r\n      .eq(\"is_dismissed\", false)\r\n      .order(\"created_at\", { ascending: false })\r\n\r\n    if (error) {\r\n      console.error(\"[Opportunity] Error fetching saved opportunities:\", error)\r\n      return []\r\n    }\r\n\r\n    if (!opportunities || opportunities.length === 0) {\r\n      return []\r\n    }\r\n\r\n    // Get tender IDs and fetch tender data separately\r\n    const tenderIds = opportunities.map((opp) => opp.scraped_tender_id).filter((id): id is string => id !== null)\r\n\r\n    let tendersMap: Record<string, any> = {}\r\n\r\n    if (tenderIds.length > 0) {\r\n      const { data: tenders } = await supabase\r\n        .from(\"scraped_tenders\")\r\n        .select(\"id, title, source_name, close_date, category, estimated_value\")\r\n        .in(\"id\", tenderIds)\r\n\r\n      if (tenders) {\r\n        tendersMap = tenders.reduce(\r\n          (acc, tender) => {\r\n            acc[tender.id] = tender\r\n            return acc\r\n          },\r\n          {} as Record<string, any>,\r\n        )\r\n      }\r\n    }\r\n\r\n    // Combine opportunities with tender data\r\n    return opportunities.map((opp) => ({\r\n      ...opp,\r\n      tender: opp.scraped_tender_id ? tendersMap[opp.scraped_tender_id] || null : null,\r\n    }))\r\n  }\r\n\r\n  /**\r\n   * Update opportunity status\r\n   */\r\n  static async updateOpportunityStatus(\r\n    opportunityId: string,\r\n    updates: {\r\n      is_viewed?: boolean\r\n      is_saved?: boolean\r\n      is_dismissed?: boolean\r\n      user_notes?: string\r\n    },\r\n  ): Promise<boolean> {\r\n    const supabase = await createClient()\r\n\r\n    const { error } = await supabase.from(\"strategist_opportunities\").update(updates).eq(\"id\", opportunityId)\r\n\r\n    return !error\r\n  }\r\n\r\n  /**\r\n   * Create an opportunity from tender data\r\n   */\r\n  static async createOpportunity(params: {\r\n    userId: string\r\n    tenderId: string\r\n    tenderType: \"custom\" | \"scraped\"\r\n    tenderTitle: string\r\n    tenderData: any\r\n  }): Promise<any> {\r\n    try {\r\n      const supabase = await createClient()\r\n\r\n      // Get user preferences for scoring\r\n      const { data: preferences } = await supabase\r\n        .from(\"strategist_user_preferences\")\r\n        .select(\"*\")\r\n        .eq(\"user_id\", params.userId)\r\n        .single()\r\n\r\n      if (!preferences) {\r\n        console.warn(\"[Opportunity] User preferences not found, skipping opportunity creation\")\r\n        return null\r\n      }\r\n\r\n      // Calculate match score\r\n      const matchScore = this.calculateMatchScoreForTender(params.tenderData, preferences)\r\n\r\n      if (matchScore < 0.3) {\r\n        console.log(\"[Opportunity] Match score too low, skipping opportunity creation\")\r\n        return null\r\n      }\r\n\r\n      // Determine opportunity type\r\n      let opportunityType: \"high_margin\" | \"strategic\" | \"quick_win\" | \"low_risk\" | \"growth\" = \"strategic\"\r\n      if (matchScore >= 0.7) opportunityType = \"high_margin\"\r\n      else if (matchScore >= 0.5) opportunityType = \"low_risk\"\r\n      else if (matchScore >= 0.4) opportunityType = \"growth\"\r\n\r\n      // Create opportunity\r\n      const { data, error } = await supabase\r\n        .from(\"strategist_opportunities\")\r\n        .upsert(\r\n          {\r\n            user_id: params.userId,\r\n            scraped_tender_id: params.tenderType === \"scraped\" ? params.tenderId : null,\r\n            custom_tender_id: params.tenderType === \"custom\" ? params.tenderId : null,\r\n            match_score: matchScore,\r\n            match_reasons: this.getMatchReasonsForTender(params.tenderData, preferences),\r\n            opportunity_type: opportunityType,\r\n            ai_insights: {\r\n              tender_title: params.tenderTitle,\r\n              analysis: \"Automatically generated from tender data\",\r\n            },\r\n            expires_at: params.tenderData.close_date || params.tenderData.deadline,\r\n          },\r\n          {\r\n            onConflict: params.tenderType === \"scraped\" ? \"user_id,scraped_tender_id\" : \"user_id,custom_tender_id\",\r\n          },\r\n        )\r\n        .select()\r\n        .single()\r\n\r\n      if (error) {\r\n        console.error(\"[Opportunity] Error creating opportunity:\", error)\r\n        return null\r\n      }\r\n\r\n      return data\r\n    } catch (error) {\r\n      console.error(\"[Opportunity] Error in createOpportunity:\", error)\r\n      return null\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find similar opportunities for a tender\r\n   */\r\n  static async findSimilar(params: {\r\n    userId: string\r\n    tenderId: string\r\n    tenderType: \"custom\" | \"scraped\"\r\n  }): Promise<any[]> {\r\n    try {\r\n      const supabase = await createClient()\r\n\r\n      // Get the source tender\r\n      const table = params.tenderType === \"custom\" ? \"user_custom_tenders\" : \"scraped_tenders\"\r\n      const { data: sourceTender } = await supabase.from(table).select(\"*\").eq(\"id\", params.tenderId).single()\r\n\r\n      if (!sourceTender) {\r\n        return []\r\n      }\r\n\r\n      // Find similar tenders based on category and location\r\n      const { data: similarTenders } = await supabase\r\n        .from(\"scraped_tenders\")\r\n        .select(\"id, title, source_name, category, source_province, close_date\")\r\n        .eq(\"is_active\", true)\r\n        .gte(\"close_date\", new Date().toISOString())\r\n        .neq(\"id\", params.tenderType === \"scraped\" ? params.tenderId : \"\")\r\n        .limit(5)\r\n\r\n      if (!similarTenders || similarTenders.length === 0) {\r\n        return []\r\n      }\r\n\r\n      // Filter by similarity (category or province match)\r\n      const similar = similarTenders.filter((tender) => {\r\n        const categoryMatch =\r\n          sourceTender.category &&\r\n          tender.category &&\r\n          (tender.category.toLowerCase().includes(sourceTender.category.toLowerCase()) ||\r\n            sourceTender.category.toLowerCase().includes(tender.category.toLowerCase()))\r\n\r\n        const provinceMatch =\r\n          sourceTender.source_province &&\r\n          tender.source_province &&\r\n          tender.source_province.toLowerCase() === sourceTender.source_province.toLowerCase()\r\n\r\n        return categoryMatch || provinceMatch\r\n      })\r\n\r\n      return similar\r\n    } catch (error) {\r\n      console.error(\"[Opportunity] Error finding similar opportunities:\", error)\r\n      return []\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Calculate match score for a tender\r\n   */\r\n  private static calculateMatchScoreForTender(tender: any, preferences: any): number {\r\n    let score = 0\r\n\r\n    // Category/Industry match\r\n    if (preferences.industries?.length && tender.category) {\r\n      const categoryMatch = preferences.industries.some((ind: string) =>\r\n        tender.category.toLowerCase().includes(ind.toLowerCase()),\r\n      )\r\n      if (categoryMatch) score += 0.3\r\n    }\r\n\r\n    // Province match\r\n    if (preferences.provinces?.length && (tender.source_province || tender.location)) {\r\n      const province = tender.source_province || tender.location\r\n      const provinceMatch = preferences.provinces.some((p: string) => province?.toLowerCase().includes(p.toLowerCase()))\r\n      if (provinceMatch) score += 0.25\r\n    }\r\n\r\n    // Deadline consideration\r\n    const deadline = tender.close_date || tender.deadline\r\n    if (deadline) {\r\n      const daysUntilClose = Math.ceil((new Date(deadline).getTime() - Date.now()) / (1000 * 60 * 60 * 24))\r\n      if (daysUntilClose > 14) score += 0.2\r\n      else if (daysUntilClose > 7) score += 0.15\r\n      else score += 0.05\r\n    }\r\n\r\n    // Base score for any tender\r\n    score += 0.25\r\n\r\n    return Math.min(score, 1)\r\n  }\r\n\r\n  /**\r\n   * Get match reasons for a tender\r\n   */\r\n  private static getMatchReasonsForTender(tender: any, preferences: any): string[] {\r\n    const reasons: string[] = []\r\n\r\n    if (preferences.industries?.length && tender.category) {\r\n      const categoryMatch = preferences.industries.some((ind: string) =>\r\n        tender.category.toLowerCase().includes(ind.toLowerCase()),\r\n      )\r\n      if (categoryMatch) reasons.push(\"Matches your industry expertise\")\r\n    }\r\n\r\n    if (preferences.provinces?.length) {\r\n      const province = tender.source_province || tender.location\r\n      const provinceMatch = preferences.provinces.some((p: string) => province?.toLowerCase().includes(p.toLowerCase()))\r\n      if (provinceMatch) reasons.push(\"Located in your preferred province\")\r\n    }\r\n\r\n    const deadline = tender.close_date || tender.deadline\r\n    if (deadline) {\r\n      const daysUntilClose = Math.ceil((new Date(deadline).getTime() - Date.now()) / (1000 * 60 * 60 * 24))\r\n      if (daysUntilClose > 14) reasons.push(\"Sufficient time to prepare quality bid\")\r\n    }\r\n\r\n    if (reasons.length === 0) {\r\n      reasons.push(\"General opportunity match\")\r\n    }\r\n\r\n    return reasons\r\n  }\r\n}\r\n","// ============================================\r\n// AI TENDER STRATEGIST - LEARNING SERVICE\r\n// ============================================\r\n\r\nimport { createClient } from \"@/lib/supabase/server\"\r\nimport { LEARNING_TOPICS } from \"../constants\"\r\nimport type { StrategistLearningProgress } from \"../types\"\r\n\r\nexport class LearningService {\r\n  /**\r\n   * Get all learning topics\r\n   */\r\n  static getTopics(): typeof LEARNING_TOPICS {\r\n    return LEARNING_TOPICS\r\n  }\r\n\r\n  /**\r\n   * Get learning progress for a user\r\n   */\r\n  static async getUserProgress(userId: string): Promise<StrategistLearningProgress[]> {\r\n    const supabase = await createClient()\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"strategist_learning_progress\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", userId)\r\n      .order(\"last_accessed_at\", { ascending: false, nullsFirst: false })\r\n\r\n    if (error) {\r\n      console.error(\"[Learning] Error fetching progress:\", error)\r\n      return []\r\n    }\r\n\r\n    return data || []\r\n  }\r\n\r\n  /**\r\n   * Get progress for a specific topic\r\n   */\r\n  static async getTopicProgress(userId: string, topicId: string): Promise<StrategistLearningProgress | null> {\r\n    const supabase = await createClient()\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"strategist_learning_progress\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", userId)\r\n      .eq(\"topic_id\", topicId)\r\n      .single()\r\n\r\n    if (error && error.code !== \"PGRST116\") {\r\n      console.error(\"[Learning] Error fetching topic progress:\", error)\r\n      return null\r\n    }\r\n\r\n    return data\r\n  }\r\n\r\n  /**\r\n   * Update learning progress\r\n   */\r\n  static async updateProgress(\r\n    userId: string,\r\n    topicId: string,\r\n    updates: {\r\n      progress_percent?: number\r\n      lesson_completed?: string\r\n      quiz_score?: { quiz_id: string; score: number }\r\n      time_spent_minutes?: number\r\n    },\r\n  ): Promise<StrategistLearningProgress | null> {\r\n    const supabase = await createClient()\r\n\r\n    // Get current progress\r\n    const { data: current } = await supabase\r\n      .from(\"strategist_learning_progress\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", userId)\r\n      .eq(\"topic_id\", topicId)\r\n      .single()\r\n\r\n    const topic = LEARNING_TOPICS.find((t) => t.id === topicId)\r\n    if (!topic) return null\r\n\r\n    const lessonsCompleted = current?.lessons_completed || []\r\n    const quizScores = current?.quiz_scores || []\r\n    let progressPercent = current?.progress_percent || 0\r\n    let timeSpent = current?.time_spent_minutes || 0\r\n\r\n    // Update lessons completed\r\n    if (updates.lesson_completed && !lessonsCompleted.includes(updates.lesson_completed)) {\r\n      lessonsCompleted.push(updates.lesson_completed)\r\n      // Calculate progress based on subtopics\r\n      progressPercent = Math.round((lessonsCompleted.length / topic.subtopics.length) * 100)\r\n    }\r\n\r\n    // Update quiz scores\r\n    if (updates.quiz_score) {\r\n      const existingIndex = quizScores.findIndex((q: any) => q.quiz_id === updates.quiz_score!.quiz_id)\r\n      if (existingIndex >= 0) {\r\n        quizScores[existingIndex] = { ...updates.quiz_score, completed_at: new Date().toISOString() }\r\n      } else {\r\n        quizScores.push({ ...updates.quiz_score, completed_at: new Date().toISOString() })\r\n      }\r\n    }\r\n\r\n    // Update time spent\r\n    if (updates.time_spent_minutes) {\r\n      timeSpent += updates.time_spent_minutes\r\n    }\r\n\r\n    // Override progress if explicitly set\r\n    if (updates.progress_percent !== undefined) {\r\n      progressPercent = updates.progress_percent\r\n    }\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"strategist_learning_progress\")\r\n      .upsert(\r\n        {\r\n          user_id: userId,\r\n          topic_id: topicId,\r\n          topic_category: topic.category,\r\n          progress_percent: progressPercent,\r\n          lessons_completed: lessonsCompleted,\r\n          quiz_scores: quizScores,\r\n          time_spent_minutes: timeSpent,\r\n          last_accessed_at: new Date().toISOString(),\r\n          completed_at: progressPercent >= 100 ? new Date().toISOString() : null,\r\n          updated_at: new Date().toISOString(),\r\n        },\r\n        { onConflict: \"user_id, topic_id\" },\r\n      )\r\n      .select()\r\n      .single()\r\n\r\n    if (error) {\r\n      console.error(\"[Learning] Error updating progress:\", error)\r\n      return null\r\n    }\r\n\r\n    return data\r\n  }\r\n\r\n  /**\r\n   * Get recommended topics for user\r\n   */\r\n  static async getRecommendedTopics(userId: string): Promise<(typeof LEARNING_TOPICS)[number][]> {\r\n    const supabase = await createClient()\r\n\r\n    // Get user's experience level\r\n    const { data: preferences } = await supabase\r\n      .from(\"strategist_user_preferences\")\r\n      .select(\"experience_level\")\r\n      .eq(\"user_id\", userId)\r\n      .single()\r\n\r\n    const experienceLevel = preferences?.experience_level || \"beginner\"\r\n\r\n    // Get completed topics\r\n    const progress = await this.getUserProgress(userId)\r\n    const completedTopicIds = progress.filter((p) => p.progress_percent >= 100).map((p) => p.topic_id)\r\n\r\n    // Filter and prioritize topics\r\n    const recommendations = LEARNING_TOPICS.filter((topic) => {\r\n      // Exclude completed\r\n      if (completedTopicIds.includes(topic.id)) return false\r\n\r\n      // Match difficulty to experience\r\n      if (experienceLevel === \"beginner\" && topic.difficulty === \"advanced\") return false\r\n      if (experienceLevel === \"intermediate\" && topic.difficulty === \"advanced\") {\r\n        // Only show advanced if basics are done\r\n        const hasBasics = completedTopicIds.some((id) =>\r\n          LEARNING_TOPICS.find((t) => t.id === id && t.category === \"basics\"),\r\n        )\r\n        if (!hasBasics) return false\r\n      }\r\n\r\n      return true\r\n    }).slice(0, 5)\r\n\r\n    return recommendations\r\n  }\r\n\r\n  /**\r\n   * Get overall learning statistics\r\n   */\r\n  static async getLearningStats(userId: string): Promise<{\r\n    totalTopics: number\r\n    completedTopics: number\r\n    totalTimeMinutes: number\r\n    averageQuizScore: number\r\n    topCategories: string[]\r\n  }> {\r\n    const progress = await this.getUserProgress(userId)\r\n\r\n    const completedTopics = progress.filter((p) => p.progress_percent >= 100).length\r\n    const totalTimeMinutes = progress.reduce((sum, p) => sum + p.time_spent_minutes, 0)\r\n\r\n    const allQuizScores = progress.flatMap((p) => p.quiz_scores || [])\r\n    const averageQuizScore =\r\n      allQuizScores.length > 0 ? allQuizScores.reduce((sum, q: any) => sum + q.score, 0) / allQuizScores.length : 0\r\n\r\n    // Find top categories by progress\r\n    const categoryProgress: Record<string, number> = {}\r\n    progress.forEach((p) => {\r\n      if (!categoryProgress[p.topic_category]) {\r\n        categoryProgress[p.topic_category] = 0\r\n      }\r\n      categoryProgress[p.topic_category] += p.progress_percent\r\n    })\r\n\r\n    const topCategories = Object.entries(categoryProgress)\r\n      .sort(([, a], [, b]) => b - a)\r\n      .slice(0, 3)\r\n      .map(([category]) => category)\r\n\r\n    return {\r\n      totalTopics: LEARNING_TOPICS.length,\r\n      completedTopics,\r\n      totalTimeMinutes,\r\n      averageQuizScore,\r\n      topCategories,\r\n    }\r\n  }\r\n}\r\n","// ============================================\r\n// AI TENDER STRATEGIST - ALERT SERVICE\r\n// ============================================\r\n\r\nimport { createClient } from \"@/lib/supabase/server\"\r\nimport type { StrategistAlert, AlertType, AlertPriority } from \"../types\"\r\n\r\nexport class AlertService {\r\n  /**\r\n   * Create a new alert\r\n   */\r\n  static async createAlert(\r\n    userId: string,\r\n    alert: {\r\n      alert_type: AlertType\r\n      title: string\r\n      message: string\r\n      priority?: AlertPriority\r\n      related_tender_id?: string\r\n      related_document_type?: string\r\n      action_url?: string\r\n      action_label?: string\r\n      trigger_date?: string\r\n      expiry_date?: string\r\n    },\r\n  ): Promise<StrategistAlert | null> {\r\n    const supabase = await createClient()\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"strategist_alerts\")\r\n      .insert({\r\n        user_id: userId,\r\n        ...alert,\r\n        priority: alert.priority || \"medium\",\r\n        trigger_date: alert.trigger_date || new Date().toISOString(),\r\n      })\r\n      .select()\r\n      .single()\r\n\r\n    if (error) {\r\n      console.error(\"[Alert] Error creating alert:\", error)\r\n      return null\r\n    }\r\n\r\n    return data\r\n  }\r\n\r\n  /**\r\n   * Get user's alerts\r\n   */\r\n  static async getUserAlerts(\r\n    userId: string,\r\n    options?: {\r\n      unreadOnly?: boolean\r\n      priority?: AlertPriority\r\n      limit?: number\r\n    },\r\n  ): Promise<StrategistAlert[]> {\r\n    const supabase = await createClient()\r\n\r\n    let query = supabase\r\n      .from(\"strategist_alerts\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", userId)\r\n      .eq(\"is_dismissed\", false)\r\n      .order(\"priority\", { ascending: false })\r\n      .order(\"created_at\", { ascending: false })\r\n\r\n    if (options?.unreadOnly) {\r\n      query = query.eq(\"is_read\", false)\r\n    }\r\n\r\n    if (options?.priority) {\r\n      query = query.eq(\"priority\", options.priority)\r\n    }\r\n\r\n    if (options?.limit) {\r\n      query = query.limit(options.limit)\r\n    }\r\n\r\n    const { data, error } = await query\r\n\r\n    if (error) {\r\n      console.error(\"[Alert] Error fetching alerts:\", error)\r\n      return []\r\n    }\r\n\r\n    return data || []\r\n  }\r\n\r\n  /**\r\n   * Mark alert as read\r\n   */\r\n  static async markAsRead(alertId: string): Promise<boolean> {\r\n    const supabase = await createClient()\r\n\r\n    const { error } = await supabase.from(\"strategist_alerts\").update({ is_read: true }).eq(\"id\", alertId)\r\n\r\n    return !error\r\n  }\r\n\r\n  /**\r\n   * Dismiss alert\r\n   */\r\n  static async dismissAlert(alertId: string): Promise<boolean> {\r\n    const supabase = await createClient()\r\n\r\n    const { error } = await supabase.from(\"strategist_alerts\").update({ is_dismissed: true }).eq(\"id\", alertId)\r\n\r\n    return !error\r\n  }\r\n\r\n  /**\r\n   * Mark alert as actioned\r\n   */\r\n  static async markAsActioned(alertId: string): Promise<boolean> {\r\n    const supabase = await createClient()\r\n\r\n    const { error } = await supabase\r\n      .from(\"strategist_alerts\")\r\n      .update({ is_actioned: true, is_read: true })\r\n      .eq(\"id\", alertId)\r\n\r\n    return !error\r\n  }\r\n\r\n  /**\r\n   * Generate compliance alerts for user\r\n   */\r\n  static async generateComplianceAlerts(userId: string): Promise<void> {\r\n    const supabase = await createClient()\r\n\r\n    // Get user preferences\r\n    const { data: preferences } = await supabase\r\n      .from(\"strategist_user_preferences\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", userId)\r\n      .single()\r\n\r\n    if (!preferences) return\r\n\r\n    const now = new Date()\r\n    const thirtyDaysFromNow = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000)\r\n\r\n    // Check tax clearance expiry\r\n    if (preferences.has_tax_clearance && preferences.tax_clearance_expiry) {\r\n      const expiryDate = new Date(preferences.tax_clearance_expiry)\r\n      if (expiryDate <= thirtyDaysFromNow) {\r\n        const daysUntilExpiry = Math.ceil((expiryDate.getTime() - now.getTime()) / (1000 * 60 * 60 * 24))\r\n\r\n        await this.createAlert(userId, {\r\n          alert_type: \"document_expiry\",\r\n          title: \"Tax Clearance Expiring Soon\",\r\n          message: `Your tax clearance certificate expires in ${daysUntilExpiry} days. Renew it to maintain tender eligibility.`,\r\n          priority: daysUntilExpiry <= 14 ? \"urgent\" : \"high\",\r\n          related_document_type: \"tax_clearance\",\r\n          action_url: \"/dashboard/profile\",\r\n          action_label: \"Update Documents\",\r\n          expiry_date: preferences.tax_clearance_expiry,\r\n        })\r\n      }\r\n    }\r\n\r\n    // Check COIDA expiry\r\n    if (preferences.has_coida && preferences.coida_expiry) {\r\n      const expiryDate = new Date(preferences.coida_expiry)\r\n      if (expiryDate <= thirtyDaysFromNow) {\r\n        const daysUntilExpiry = Math.ceil((expiryDate.getTime() - now.getTime()) / (1000 * 60 * 60 * 24))\r\n\r\n        await this.createAlert(userId, {\r\n          alert_type: \"document_expiry\",\r\n          title: \"COIDA Letter Expiring Soon\",\r\n          message: `Your COIDA letter of good standing expires in ${daysUntilExpiry} days. Renew it to maintain compliance.`,\r\n          priority: daysUntilExpiry <= 14 ? \"high\" : \"medium\",\r\n          related_document_type: \"coida\",\r\n          action_url: \"/dashboard/profile\",\r\n          action_label: \"Update Documents\",\r\n          expiry_date: preferences.coida_expiry,\r\n        })\r\n      }\r\n    }\r\n\r\n    // Check for missing CSD registration\r\n    if (!preferences.has_csd_registration) {\r\n      await this.createAlert(userId, {\r\n        alert_type: \"compliance_gap\",\r\n        title: \"CSD Registration Missing\",\r\n        message:\r\n          \"You need to register on the Central Supplier Database (CSD) to bid on government tenders. This is a mandatory requirement.\",\r\n        priority: \"high\",\r\n        action_url: \"https://secure.csd.gov.za/\",\r\n        action_label: \"Register on CSD\",\r\n      })\r\n    }\r\n\r\n    // Check for missing tax clearance\r\n    if (!preferences.has_tax_clearance) {\r\n      await this.createAlert(userId, {\r\n        alert_type: \"compliance_gap\",\r\n        title: \"Tax Clearance Missing\",\r\n        message: \"A valid tax clearance certificate is required for all government tenders.\",\r\n        priority: \"urgent\",\r\n        related_document_type: \"tax_clearance\",\r\n        action_url: \"https://www.sars.gov.za/\",\r\n        action_label: \"Get Tax Clearance\",\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get unread alert count\r\n   */\r\n  static async getUnreadCount(userId: string): Promise<number> {\r\n    const supabase = await createClient()\r\n\r\n    const { count, error } = await supabase\r\n      .from(\"strategist_alerts\")\r\n      .select(\"*\", { count: \"exact\", head: true })\r\n      .eq(\"user_id\", userId)\r\n      .eq(\"is_read\", false)\r\n      .eq(\"is_dismissed\", false)\r\n\r\n    if (error) {\r\n      console.error(\"[Alert] Error counting alerts:\", error)\r\n      return 0\r\n    }\r\n\r\n    return count || 0\r\n  }\r\n}\r\n","// ============================================\r\n// AI TENDER STRATEGIST - COMPETITIVENESS SERVICE\r\n// ============================================\r\n\r\nimport { createClient } from \"@/lib/supabase/server\"\r\nimport type { StrategistCompetitivenessScore } from \"../types\"\r\n\r\nexport class CompetitivenessService {\r\n  /**\r\n   * Calculate competitiveness score for a user\r\n   */\r\n  static async calculateScore(params: {\r\n    userId: string\r\n    tenderId?: string\r\n    tenderType?: \"custom\" | \"scraped\"\r\n  }): Promise<StrategistCompetitivenessScore | null> {\r\n    const supabase = await createClient()\r\n\r\n    // Get user data\r\n    const [preferencesResult, companyResult, profileResult] = await Promise.all([\r\n      supabase.from(\"strategist_user_preferences\").select(\"*\").eq(\"user_id\", params.userId).single(),\r\n      supabase.from(\"companies\").select(\"*\").eq(\"user_id\", params.userId).single(),\r\n      supabase.from(\"profiles\").select(\"*\").eq(\"id\", params.userId).single(),\r\n    ])\r\n\r\n    const preferences = preferencesResult.data\r\n    const company = companyResult.data\r\n    const profile = profileResult.data\r\n\r\n    // Calculate component scores\r\n    const documentationScore = this.calculateDocumentationScore(preferences, company)\r\n    const pricingScore = this.calculatePricingScore(preferences)\r\n    const complianceScore = this.calculateComplianceScore(preferences)\r\n    const experienceScore = this.calculateExperienceScore(preferences)\r\n    const capacityScore = this.calculateCapacityScore(preferences, company)\r\n\r\n    // Calculate overall and win probability\r\n    const overallScore = (documentationScore + pricingScore + complianceScore + experienceScore + capacityScore) / 5\r\n\r\n    const winProbability = this.estimateWinProbability(overallScore, preferences, params.tenderId)\r\n\r\n    // Build score breakdown\r\n    const scoreBreakdown = {\r\n      documentation: {\r\n        score: documentationScore,\r\n        factors: this.getDocumentationFactors(preferences, company),\r\n      },\r\n      pricing: {\r\n        score: pricingScore,\r\n        factors: this.getPricingFactors(preferences),\r\n      },\r\n      compliance: {\r\n        score: complianceScore,\r\n        factors: this.getComplianceFactors(preferences),\r\n      },\r\n      experience: {\r\n        score: experienceScore,\r\n        factors: this.getExperienceFactors(preferences),\r\n      },\r\n      capacity: {\r\n        score: capacityScore,\r\n        factors: this.getCapacityFactors(preferences, company),\r\n      },\r\n    }\r\n\r\n    // Generate improvement suggestions\r\n    const improvementSuggestions = this.generateImprovementSuggestions(scoreBreakdown)\r\n\r\n    // Save score\r\n    const { data, error } = await supabase\r\n      .from(\"strategist_competitiveness_scores\")\r\n      .upsert(\r\n        {\r\n          user_id: params.userId,\r\n          tender_id: params.tenderId,\r\n          documentation_score: documentationScore,\r\n          pricing_score: pricingScore,\r\n          compliance_score: complianceScore,\r\n          experience_score: experienceScore,\r\n          capacity_score: capacityScore,\r\n          score_breakdown: scoreBreakdown,\r\n          improvement_suggestions: improvementSuggestions,\r\n          win_probability: winProbability,\r\n          win_probability_factors: {\r\n            base_score: overallScore,\r\n            experience_bonus: preferences?.experience_level === \"advanced\" ? 0.1 : 0,\r\n            compliance_penalty: complianceScore < 0.5 ? -0.2 : 0,\r\n          },\r\n          calculated_at: new Date().toISOString(),\r\n          valid_until: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(), // Valid for 7 days\r\n        },\r\n        { onConflict: \"user_id\" },\r\n      )\r\n      .select()\r\n      .single()\r\n\r\n    if (error) {\r\n      console.error(\"[Competitiveness] Error saving score:\", error)\r\n      return null\r\n    }\r\n\r\n    return data\r\n  }\r\n\r\n  /**\r\n   * Get cached score or calculate new one\r\n   */\r\n  static async getScore(userId: string, tenderId?: string): Promise<StrategistCompetitivenessScore | null> {\r\n    const supabase = await createClient()\r\n\r\n    // Check for valid cached score\r\n    const { data: cached } = await supabase\r\n      .from(\"strategist_competitiveness_scores\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", userId)\r\n      .gte(\"valid_until\", new Date().toISOString())\r\n      .single()\r\n\r\n    if (cached) {\r\n      return cached\r\n    }\r\n\r\n    // Calculate new score\r\n    return this.calculateScore({ userId, tenderId })\r\n  }\r\n\r\n  // Score calculation helpers\r\n  private static calculateDocumentationScore(preferences: any, company: any): number {\r\n    let score = 0\r\n    let total = 0\r\n\r\n    // Check various documentation\r\n    if (company?.company_name) {\r\n      score += 1\r\n      total += 1\r\n    }\r\n    if (company?.registration_number) {\r\n      score += 1\r\n      total += 1\r\n    }\r\n    if (company?.tax_number) {\r\n      score += 1\r\n      total += 1\r\n    }\r\n    if (preferences?.has_tax_clearance) {\r\n      score += 2\r\n      total += 2\r\n    }\r\n    if (preferences?.has_coida) {\r\n      score += 1\r\n      total += 1\r\n    }\r\n    if (preferences?.has_csd_registration) {\r\n      score += 2\r\n      total += 2\r\n    }\r\n    if (preferences?.cidb_grading) {\r\n      score += 1\r\n      total += 1\r\n    }\r\n    if (preferences?.bee_level) {\r\n      score += 1\r\n      total += 1\r\n    }\r\n\r\n    return total > 0 ? score / total : 0\r\n  }\r\n\r\n  private static calculatePricingScore(preferences: any): number {\r\n    // Based on past performance\r\n    const wins = preferences?.past_tender_wins || 0\r\n    const losses = preferences?.past_tender_losses || 0\r\n    const total = wins + losses\r\n\r\n    if (total === 0) return 0.5 // Neutral for new users\r\n\r\n    const winRate = wins / total\r\n    return Math.min(winRate * 1.2, 1) // Slight bonus for good win rate\r\n  }\r\n\r\n  private static calculateComplianceScore(preferences: any): number {\r\n    let score = 0\r\n\r\n    if (preferences?.has_tax_clearance) score += 0.35\r\n    if (preferences?.has_coida) score += 0.25\r\n    if (preferences?.has_csd_registration) score += 0.4\r\n\r\n    return score\r\n  }\r\n\r\n  private static calculateExperienceScore(preferences: any): number {\r\n    const levelScores: Record<string, number> = {\r\n      beginner: 0.3,\r\n      intermediate: 0.6,\r\n      advanced: 0.9,\r\n    }\r\n\r\n    const baseScore = levelScores[preferences?.experience_level] || 0.3\r\n\r\n    // Bonus for past wins\r\n    const wins = preferences?.past_tender_wins || 0\r\n    const winBonus = Math.min(wins * 0.02, 0.1)\r\n\r\n    return Math.min(baseScore + winBonus, 1)\r\n  }\r\n\r\n  private static calculateCapacityScore(preferences: any, company: any): number {\r\n    let score = 0.5 // Base score\r\n\r\n    // Company size factor\r\n    const sizeScores: Record<string, number> = {\r\n      micro: 0.1,\r\n      small: 0.2,\r\n      medium: 0.3,\r\n      large: 0.4,\r\n      enterprise: 0.5,\r\n    }\r\n    score += sizeScores[company?.company_size] || 0\r\n\r\n    // CIDB grading factor (for construction)\r\n    if (preferences?.cidb_grading) {\r\n      const grading = Number.parseInt(preferences.cidb_grading)\r\n      if (!isNaN(grading)) {\r\n        score += grading * 0.02\r\n      }\r\n    }\r\n\r\n    return Math.min(score, 1)\r\n  }\r\n\r\n  // Factor breakdown helpers\r\n  private static getDocumentationFactors(preferences: any, company: any): string[] {\r\n    const factors: string[] = []\r\n    if (company?.company_name) factors.push(\"Company profile complete\")\r\n    if (preferences?.has_tax_clearance) factors.push(\"Tax clearance valid\")\r\n    if (preferences?.has_csd_registration) factors.push(\"CSD registered\")\r\n    if (preferences?.bee_level) factors.push(\"B-BBEE certificate\")\r\n    if (!preferences?.has_tax_clearance) factors.push(\"Missing: Tax clearance\")\r\n    if (!preferences?.has_csd_registration) factors.push(\"Missing: CSD registration\")\r\n    return factors\r\n  }\r\n\r\n  private static getPricingFactors(preferences: any): string[] {\r\n    const factors: string[] = []\r\n    const wins = preferences?.past_tender_wins || 0\r\n    const losses = preferences?.past_tender_losses || 0\r\n    if (wins > 0) factors.push(`${wins} past tender wins`)\r\n    if (losses > 0) factors.push(`${losses} past tender losses`)\r\n    if (wins === 0 && losses === 0) factors.push(\"No historical pricing data\")\r\n    return factors\r\n  }\r\n\r\n  private static getComplianceFactors(preferences: any): string[] {\r\n    const factors: string[] = []\r\n    if (preferences?.has_tax_clearance) factors.push(\"Tax clearance: Valid\")\r\n    else factors.push(\"Tax clearance: Missing\")\r\n    if (preferences?.has_coida) factors.push(\"COIDA: Valid\")\r\n    else factors.push(\"COIDA: Missing\")\r\n    if (preferences?.has_csd_registration) factors.push(\"CSD: Registered\")\r\n    else factors.push(\"CSD: Not registered\")\r\n    return factors\r\n  }\r\n\r\n  private static getExperienceFactors(preferences: any): string[] {\r\n    const factors: string[] = []\r\n    factors.push(`Experience level: ${preferences?.experience_level || \"Unknown\"}`)\r\n    const wins = preferences?.past_tender_wins || 0\r\n    if (wins > 0) factors.push(`${wins} successful tenders`)\r\n    return factors\r\n  }\r\n\r\n  private static getCapacityFactors(preferences: any, company: any): string[] {\r\n    const factors: string[] = []\r\n    if (company?.company_size) factors.push(`Company size: ${company.company_size}`)\r\n    if (preferences?.cidb_grading) factors.push(`CIDB grading: ${preferences.cidb_grading}`)\r\n    if (preferences?.annual_turnover) factors.push(`Annual turnover: ${preferences.annual_turnover}`)\r\n    return factors\r\n  }\r\n\r\n  private static estimateWinProbability(overallScore: number, preferences: any, tenderId?: string): number {\r\n    let probability = overallScore * 0.7 // Base from overall score\r\n\r\n    // Adjustments\r\n    if (preferences?.experience_level === \"advanced\") probability += 0.1\r\n    if (preferences?.experience_level === \"beginner\") probability -= 0.1\r\n    if (preferences?.has_tax_clearance && preferences?.has_csd_registration) probability += 0.1\r\n\r\n    // Cap between 0.1 and 0.9\r\n    return Math.max(0.1, Math.min(0.9, probability))\r\n  }\r\n\r\n  private static generateImprovementSuggestions(breakdown: Record<string, any>): string[] {\r\n    const suggestions: string[] = []\r\n\r\n    if (breakdown.documentation.score < 0.7) {\r\n      suggestions.push(\"Complete your company profile with all required documentation\")\r\n    }\r\n    if (breakdown.compliance.score < 0.8) {\r\n      if (!breakdown.compliance.factors.includes(\"Tax clearance: Valid\")) {\r\n        suggestions.push(\"Obtain a valid tax clearance certificate from SARS\")\r\n      }\r\n      if (!breakdown.compliance.factors.includes(\"CSD: Registered\")) {\r\n        suggestions.push(\"Register on the Central Supplier Database (CSD)\")\r\n      }\r\n    }\r\n    if (breakdown.experience.score < 0.5) {\r\n      suggestions.push(\"Start with smaller tenders to build your track record\")\r\n    }\r\n    if (breakdown.capacity.score < 0.5) {\r\n      suggestions.push(\"Consider joint ventures to increase your capacity for larger tenders\")\r\n    }\r\n\r\n    return suggestions\r\n  }\r\n}\r\n","// ============================================\r\n// AI TENDER STRATEGIST - PROMPT BUILDERS\r\n// ============================================\r\n\r\nimport { STRATEGIST_SYSTEM_PROMPT } from \"../constants\"\r\nimport type { StrategistContext, ExperienceLevel, StrategyType } from \"../types\"\r\n\r\n/**\r\n * Build the system prompt with user context\r\n */\r\nexport function buildStrategistPrompt(context: StrategistContext): string {\r\n  let prompt = STRATEGIST_SYSTEM_PROMPT\r\n\r\n  // Add user experience level context\r\n  if (context.user_preferences?.experience_level) {\r\n    const levelInstructions: Record<ExperienceLevel, string> = {\r\n      beginner: `\r\n## User Experience Level: BEGINNER\r\n- Explain concepts in simple terms, avoid jargon\r\n- Provide step-by-step guidance\r\n- Define technical terms when first used\r\n- Be extra supportive and encouraging\r\n- Suggest learning resources when relevant`,\r\n      intermediate: `\r\n## User Experience Level: INTERMEDIATE  \r\n- User has basic tendering knowledge\r\n- Can use technical terminology with brief explanations\r\n- Focus on strategic advice and optimization\r\n- Highlight advanced techniques when relevant`,\r\n      advanced: `\r\n## User Experience Level: ADVANCED\r\n- User is experienced in tendering\r\n- Use technical terminology freely\r\n- Focus on strategic optimization and edge cases\r\n- Provide nuanced, detailed analysis\r\n- Discuss advanced strategies and market insights`,\r\n    }\r\n    prompt += levelInstructions[context.user_preferences.experience_level]\r\n  }\r\n\r\n  // Add user profile context\r\n  if (context.user_preferences || context.company_profile) {\r\n    prompt += `\r\n\r\n## User Profile Context`\r\n\r\n    if (context.company_profile?.company_name) {\r\n      prompt += `\r\nCompany: ${context.company_profile.company_name}`\r\n    }\r\n    if (context.company_profile?.industry) {\r\n      prompt += `\r\nIndustry: ${context.company_profile.industry}`\r\n    }\r\n    if (context.user_preferences?.provinces?.length) {\r\n      prompt += `\r\nRegions: ${context.user_preferences.provinces.join(\", \")}`\r\n    }\r\n    if (context.user_preferences?.cidb_grading) {\r\n      prompt += `\r\nCIDB Grading: ${context.user_preferences.cidb_grading}`\r\n    }\r\n    if (context.user_preferences?.bee_level || context.company_profile?.bee_status) {\r\n      prompt += `\r\nB-BBEE Status: ${context.user_preferences?.bee_level || context.company_profile?.bee_status}`\r\n    }\r\n  }\r\n\r\n  // Add compliance status\r\n  if (context.user_preferences) {\r\n    const complianceItems: string[] = []\r\n    if (context.user_preferences.has_tax_clearance) {\r\n      complianceItems.push(\r\n        `Tax Clearance: Valid${context.user_preferences.tax_clearance_expiry ? ` (expires ${context.user_preferences.tax_clearance_expiry})` : \"\"}`,\r\n      )\r\n    } else {\r\n      complianceItems.push(\"Tax Clearance: Missing/Expired\")\r\n    }\r\n    if (context.user_preferences.has_coida) {\r\n      complianceItems.push(\r\n        `COIDA: Valid${context.user_preferences.coida_expiry ? ` (expires ${context.user_preferences.coida_expiry})` : \"\"}`,\r\n      )\r\n    } else {\r\n      complianceItems.push(\"COIDA: Missing\")\r\n    }\r\n    if (context.user_preferences.has_csd_registration) {\r\n      complianceItems.push(\"CSD Registration: Active\")\r\n    } else {\r\n      complianceItems.push(\"CSD Registration: Missing\")\r\n    }\r\n\r\n    if (complianceItems.length > 0) {\r\n      prompt += `\r\n\r\n## Compliance Status\r\n${complianceItems.join(\"\\n\")}`\r\n    }\r\n  }\r\n\r\n  // Add tender context if present\r\n  if (context.tender_context) {\r\n    prompt += `\r\n\r\n## Current Tender Context\r\nTitle: ${context.tender_context.title}\r\nOrganization: ${context.tender_context.organization}\r\n${context.tender_context.description ? `Description: ${context.tender_context.description}` : \"\"}\r\n${context.tender_context.close_date ? `Closing Date: ${context.tender_context.close_date}` : \"\"}\r\n\r\nWhen answering, reference this specific tender and provide targeted advice.`\r\n  }\r\n\r\n  // Add BOQ context if present\r\n  if (context.boq_context) {\r\n    prompt += `\r\n\r\n## BOQ Context\r\nThis conversation is about pricing/BOQ for a tender with ${context.boq_context.total_items} line items.\r\nFocus on pricing strategy, margin recommendations, and risk assessment.`\r\n  }\r\n\r\n  // Add competitiveness score if available\r\n  if (context.competitiveness_score) {\r\n    prompt += `\r\n\r\n## User's Current Competitiveness Score\r\nOverall: ${(context.competitiveness_score.overall_score * 100).toFixed(0)}%\r\n- Documentation: ${(context.competitiveness_score.documentation_score * 100).toFixed(0)}%\r\n- Compliance: ${(context.competitiveness_score.compliance_score * 100).toFixed(0)}%\r\n- Experience: ${(context.competitiveness_score.experience_score * 100).toFixed(0)}%\r\n\r\nUse this to tailor advice about improving their competitiveness.`\r\n  }\r\n\r\n  return prompt\r\n}\r\n\r\n/**\r\n * Build prompt for strategy generation\r\n */\r\nexport function buildStrategyGenerationPrompt(\r\n  strategyType: StrategyType,\r\n  tenderAnalysis: Record<string, any>,\r\n  userContext: StrategistContext,\r\n): string {\r\n  const basePrompt = `Generate a comprehensive ${strategyType} strategy for this tender submission.\r\n\r\n## Tender Information\r\n${JSON.stringify(tenderAnalysis.tender_summary || {}, null, 2)}\r\n\r\n## Evaluation Criteria\r\n${JSON.stringify(tenderAnalysis.evaluation || {}, null, 2)}\r\n\r\n## Compliance Requirements\r\n${JSON.stringify(tenderAnalysis.compliance_summary || {}, null, 2)}\r\n\r\n## User's Current Capabilities\r\n${\r\n  userContext.user_preferences\r\n    ? JSON.stringify(\r\n        {\r\n          cidb_grading: userContext.user_preferences.cidb_grading,\r\n          bee_level: userContext.user_preferences.bee_level,\r\n          experience_level: userContext.user_preferences.experience_level,\r\n          past_wins: userContext.user_preferences.past_tender_wins,\r\n          past_losses: userContext.user_preferences.past_tender_losses,\r\n        },\r\n        null,\r\n        2,\r\n      )\r\n    : \"Not available\"\r\n}\r\n\r\n## Company Profile\r\n${userContext.company_profile ? JSON.stringify(userContext.company_profile, null, 2) : \"Not available\"}`\r\n\r\n  const strategyInstructions: Record<StrategyType, string> = {\r\n    bid: `\r\nGenerate a complete bid strategy including:\r\n1. Bid viability analysis (should we bid?)\r\n2. SWOT analysis for this tender\r\n3. Compliance checklist with status\r\n4. Supplier/subcontractor recommendations\r\n5. Pricing strategy overview\r\n6. Submission checklist\r\n7. Risk register with mitigation plans\r\n8. Win probability assessment`,\r\n\r\n    pricing: `\r\nGenerate a detailed pricing strategy including:\r\n1. Recommended pricing approach (cost-plus, competitive, value)\r\n2. Margin recommendations by item category\r\n3. Risk pricing factors\r\n4. Competitive positioning advice\r\n5. Areas for cost optimization\r\n6. Contingency recommendations\r\n7. Payment term considerations\r\n8. Potential price negotiation points`,\r\n\r\n    compliance: `\r\nGenerate a compliance strategy including:\r\n1. All mandatory requirements mapped to user capabilities\r\n2. Gap analysis with remediation actions\r\n3. Document checklist with deadlines\r\n4. Risk of non-compliance assessment\r\n5. Alternative compliance approaches\r\n6. Certification/registration requirements\r\n7. Timeline for compliance preparation`,\r\n\r\n    negotiation: `\r\nGenerate a negotiation strategy including:\r\n1. Key negotiation points\r\n2. Best Alternative to Negotiated Agreement (BATNA)\r\n3. Concession strategy\r\n4. Value propositions to emphasize\r\n5. Potential objections and responses\r\n6. Win-win opportunities\r\n7. Relationship building approaches`,\r\n\r\n    general: `\r\nGenerate a general tender strategy overview including:\r\n1. Executive summary\r\n2. Key success factors\r\n3. Resource requirements\r\n4. Timeline and milestones\r\n5. Team responsibilities\r\n6. Risk overview\r\n7. Go/No-Go recommendation`,\r\n  }\r\n\r\n  return (\r\n    basePrompt +\r\n    strategyInstructions[strategyType] +\r\n    `\r\n\r\nRespond with a valid JSON object matching the StrategyContent interface with all sections populated.\r\nBe specific, actionable, and realistic in your recommendations.\r\nReference actual tender requirements and user capabilities.`\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}