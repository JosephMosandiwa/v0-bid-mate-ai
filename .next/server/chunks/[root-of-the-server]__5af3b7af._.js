module.exports=[918622,(e,t,n)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,n)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,n)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,n)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},193695,(e,t,n)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},89660,e=>{"use strict";e.i(929961);var t=e.i(771884),n=e.i(875216);async function r(){let e=await (0,n.cookies)();return(0,t.createServerClient)("https://xqyecqkrtaydoesxnvlw.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhxeWVjcWtydGF5ZG9lc3hudmx3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEzMjM0NTgsImV4cCI6MjA3Njg5OTQ1OH0.wsb5Jz_I9RqxoNoZ6D3QPbK4aefbdGKcrGgWDfm3c4o",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:n,options:r})=>e.set(t,n,r))}catch{}}}})}e.s(["createClient",()=>r,"createServerClient",0,r])},254799,(e,t,n)=>{t.exports=e.x("crypto",()=>require("crypto"))},666680,(e,t,n)=>{t.exports=e.x("node:crypto",()=>require("node:crypto"))},132162,139512,e=>{"use strict";var t=e.i(477911),n=e.i(480660);let r=null;function a(){if(!r){if(!process.env.KV_REST_API_URL||!process.env.KV_REST_API_TOKEN)throw Error("Redis environment variables not configured");r=new t.Redis({url:process.env.KV_REST_API_URL,token:process.env.KV_REST_API_TOKEN})}return r}let i=e=>`documind:doc:${e}`,s=e=>`documind:hash:${e}`,o=e=>`documind:templates:${e||"all"}`,c=e=>`documind:match:${e}`;async function l(e,t,r){let o=a().pipeline();o.set(i(e),JSON.stringify(t),{ex:n.CACHE_TTL.parsed_document}),o.set(s(r),e,{ex:n.CACHE_TTL.parsed_document}),await o.exec()}async function d(e){let t=a(),n=await t.get(i(e));if(!n)return null;try{return"string"==typeof n?JSON.parse(n):n}catch{return null}}async function u(e){return a().get(s(e))}async function p(e,t){let n=a().pipeline();n.del(i(e)),n.del(c(e)),t&&n.del(s(t)),await n.exec()}async function _(e,t){let r=a();await r.set(o(t),JSON.stringify(e),{ex:n.CACHE_TTL.template_list})}async function m(e){let t=a(),n=await t.get(o(e));if(!n)return null;try{return"string"==typeof n?JSON.parse(n):n}catch{return null}}async function h(e,t){let r=a();await r.set(c(e),JSON.stringify(t),{ex:n.CACHE_TTL.fingerprint_match})}async function f(e){let t=a(),n=await t.get(c(e));if(!n)return null;try{return"string"==typeof n?JSON.parse(n):n}catch{return null}}e.s(["cacheDocument",()=>l,"cacheTemplateList",()=>_,"cacheTemplateMatch",()=>h,"deleteCachedDocument",()=>p,"getCachedDocument",()=>d,"getCachedTemplateList",()=>m,"getCachedTemplateMatch",()=>f,"getDocumentIdByHash",()=>u],132162);var g=e.i(89660),E=e.i(702275);async function C(e,t,n="bidmate-ai"){let r=await (0,g.createClient)();try{let{data:a,error:i}=await r.from("documind_documents").insert({id:e.document_id,app_id:n,original_filename:e.metadata.title||"unknown",mime_type:"application/pdf",file_size:0,storage_url:t,content_hash:e.fingerprints.content_hash,fingerprint_structure:e.fingerprints.structure_hash,fingerprint_layout:e.fingerprints.layout_hash,fingerprint_form:e.fingerprints.form_hash,fingerprint_table:e.fingerprints.table_hash,metadata:e.metadata,page_count:e.metadata.page_count,is_scanned:e.metadata.is_scanned,detected_type:e.metadata.detected_type,status:e.status,processing_duration_ms:e.processing.duration_ms,ocr_used:e.processing.ocr_used,ocr_engine:e.processing.ocr_engine,ocr_confidence:e.processing.ocr_confidence,parsed_content:e,layout:e.layout}).select().single();if(i)return console.error("Error saving document:",i),{success:!1,error:E.Errors.parseFailed("database",i.message)};let s=e.pages.map(t=>({document_id:e.document_id,page_number:t.page_number,width:t.width,height:t.height,rotation:t.rotation,full_text:t.content.full_text,text_blocks:t.content.text_blocks,lines:t.content.lines,rectangles:t.content.rectangles,images:t.content.images,is_scanned:t.is_scanned,ocr_confidence:t.ocr_confidence}));if(s.length>0){let{error:e}=await r.from("documind_pages").insert(s);e&&console.error("Error saving pages:",e)}let o=[];if(e.layout.form_regions.forEach(t=>{t.detected_fields.forEach(n=>{o.push({document_id:e.document_id,page_number:t.page,field_name:n.id,label_text:n.label.text,field_type:n.suggested_type,input_type:n.input.type,suggested_data_type:n.suggested_type,position_x:n.input.position.x,position_y:n.input.position.y,position_width:n.input.position.width,position_height:n.input.position.height,position_norm_x:n.input.position_normalized.x,position_norm_y:n.input.position_normalized.y,position_norm_width:n.input.position_normalized.width,position_norm_height:n.input.position_normalized.height,label_position:n.label,detection_method:n.detection_method,confidence:n.confidence,is_native_field:null!==n.input.native_field_id,native_field_name:n.input.native_field_id})})}),e.form_fields.forEach(t=>{o.push({document_id:e.document_id,page_number:t.page,field_name:t.name,label_text:t.name,field_type:t.type,input_type:"native_field",suggested_data_type:t.type,position_x:t.position.x,position_y:t.position.y,position_width:t.position.width,position_height:t.position.height,position_norm_x:t.position_normalized.x,position_norm_y:t.position_normalized.y,position_norm_width:t.position_normalized.width,position_norm_height:t.position_normalized.height,font_name:t.font?.name,font_size:t.font?.size,detection_method:"pdf_native",confidence:1,is_native_field:!0,native_field_name:t.name,native_field_value:t.value?.toString()})}),o.length>0){let{error:e}=await r.from("documind_fields").insert(o);e&&console.error("Error saving fields:",e)}return{success:!0}}catch(e){return console.error("Database error:",e),{success:!1,error:E.Errors.parseFailed("database",e instanceof Error?e.message:"Unknown error")}}}async function D(e){let t=await (0,g.createClient)(),{data:n,error:r}=await t.from("documind_documents").select("parsed_content").eq("id",e).single();return r||!n?null:n.parsed_content}async function I(e){let t=await (0,g.createClient)(),{error:n}=await t.from("documind_documents").delete().eq("id",e);return n?{success:!1,error:E.Errors.parseFailed("database",n.message)}:{success:!0}}async function R(e,t=20,n=0){let r=(await (0,g.createClient)()).from("documind_templates").select("*",{count:"exact"});e&&(r=r.eq("category",e));let{data:a,error:i,count:s}=await r.order("usage_count",{ascending:!1}).range(n,n+t-1);return i?(console.error("Error fetching templates:",i),{templates:[],total:0}):{templates:a||[],total:s||0}}async function T(e,t=.5,n){let r=await (0,g.createClient)(),{data:a}=await r.from("documind_templates").select("*").order("usage_count",{ascending:!1});if(!a||0===a.length)return[];let i=[];for(let r of a){let a=0,s=0,o=r.field_mappings||[];if(r.fingerprint_structure===e)a=1,s=o.length;else if(n){let e=n.toUpperCase(),t={SBD1:["SBD 1","SBD1","INVITATION TO BID","PART A: INVITATION TO BID"],SBD2:["SBD 2","SBD2","TAX CLEARANCE","TAX COMPLIANCE"],"SBD3.1":["SBD 3.1","SBD3.1","PRICING SCHEDULE","FIRM PRICES"],"SBD3.2":["SBD 3.2","SBD3.2","PRICING SCHEDULE","NON-FIRM PRICES"],"SBD3.3":["SBD 3.3","SBD3.3","PRICING SCHEDULE","PROFESSIONAL SERVICES"],SBD4:["SBD 4","SBD4","DECLARATION OF INTEREST"],SBD5:["SBD 5","SBD5","NATIONAL INDUSTRIAL PARTICIPATION"],"SBD6.1":["SBD 6.1","SBD6.1","PREFERENCE POINTS CLAIM","B-BBEE STATUS"],"SBD6.2":["SBD 6.2","SBD6.2","LOCAL PRODUCTION AND CONTENT"],"SBD7.1":["SBD 7.1","SBD7.1","CONTRACT FORM","PURCHASE OF GOODS"],"SBD7.2":["SBD 7.2","SBD7.2","CONTRACT FORM","RENDERING OF SERVICES"],SBD8:["SBD 8","SBD8","DECLARATION OF PAST","SCM PRACTICES"],SBD9:["SBD 9","SBD9","CERTIFICATE OF INDEPENDENT BID","INDEPENDENT BID DETERMINATION"],MBD1:["MBD 1","MBD1","MUNICIPAL BID","INVITATION TO BID"],MBD4:["MBD 4","MBD4","MUNICIPAL DECLARATION","DECLARATION OF INTEREST"],MBD5:["MBD 5","MBD5","NATIONAL INDUSTRIAL"],"MBD6.1":["MBD 6.1","MBD6.1","PREFERENCE POINTS"],MBD8:["MBD 8","MBD8","DECLARATION OF PAST"],MBD9:["MBD 9","MBD9","CERTIFICATE OF INDEPENDENT"],CSD:["CSD","CENTRAL SUPPLIER DATABASE","MAAA","SUPPLIER NUMBER"],BOQ:["BILL OF QUANTITIES","BOQ","SCHEDULE OF QUANTITIES"],GCC:["GENERAL CONDITIONS OF CONTRACT","GCC"],CIDB:["CIDB","CONSTRUCTION INDUSTRY"],NEC:["NEC CONTRACT","NEW ENGINEERING CONTRACT"],JBCC:["JBCC","JOINT BUILDING CONTRACTS"],FIDIC:["FIDIC"]}[r.code?.toUpperCase()||""]||[],i=0;for(let n of t)e.includes(n)&&i++;for(let t of(i>0&&(a+=.4*Math.min(i/2,1)),o))if(t.label_pattern)try{RegExp(t.label_pattern,"i").test(n)&&s++}catch{e.includes(t.label_pattern.toUpperCase())&&s++}o.length>0&&(a+=.6*(s/o.length))}a>=t&&i.push({template_id:r.id,template_name:r.name,template_code:r.code,match_score:Math.min(a,1),matched_fields:s,total_fields:o.length,field_matches:[]})}return i.sort((e,t)=>t.match_score-e.match_score)}async function N(e,t,n,r,a){let i=await (0,g.createClient)();await i.from("documind_template_matches").upsert({document_id:e,template_id:t,match_score:n,matched_fields:r,total_fields:a})}async function S(e){let t=await (0,g.createClient)();await t.rpc("increment_template_usage",{template_id:e})}async function y(e,t){let n=await (0,g.createClient)();await n.from("documind_error_logs").insert({document_id:t.document_id,job_id:t.job_id,app_id:t.app_id,request_id:t.request_id,error_code:e.code,error_message:e.message,processing_stage:t.processing_stage,file_info:t.file_info})}e.s(["deleteDocument",()=>I,"findMatchingTemplates",()=>T,"getDocument",()=>D,"getTemplates",()=>R,"incrementTemplateUsage",()=>S,"logError",()=>y,"saveDocument",()=>C,"saveTemplateMatch",()=>N],139512)},590249,e=>{"use strict";var t=e.i(248749),n=e.i(219650),r=e.i(508677),a=e.i(615159),i=e.i(548938),s=e.i(273073),o=e.i(129714),c=e.i(403736),l=e.i(817889),d=e.i(428765),u=e.i(762198),p=e.i(117109),_=e.i(590702),m=e.i(462216),h=e.i(539401),f=e.i(222695),g=e.i(193695);e.i(31514);var E=e.i(267074),C=e.i(490788);e.i(18444);var D=e.i(702275),I=e.i(132162),R=e.i(139512);async function T(e){let t=Date.now(),n=crypto.randomUUID();try{let r,a,{document_id:i,fingerprint:s}=await e.json();if(!i&&!s)return C.NextResponse.json({success:!1,error:D.Errors.invalidRequest("Must provide document_id or fingerprint"),meta:{request_id:n,processing_time_ms:Date.now()-t}},{status:400});if(i){let e=await (0,I.getCachedTemplateMatch)(i);if(e)return C.NextResponse.json({success:!0,data:{matches:e,best_match:e.length>0?e[0]:null},meta:{request_id:n,processing_time_ms:Date.now()-t}},{headers:{"X-Cache":"HIT"}});let s=await (0,I.getCachedDocument)(i);if(s||(s=await (0,R.getDocument)(i)),!s)return C.NextResponse.json({success:!1,error:D.Errors.documentNotFound(i),meta:{request_id:n,processing_time_ms:Date.now()-t}},{status:404});r=s.fingerprints.structure_hash,a=s.pages.map(e=>e.content.full_text||"").join("\n")}else r=s;let o=await (0,R.findMatchingTemplates)(r,.3,a);if(i)for(let e of(await (0,I.cacheTemplateMatch)(i,o),o))await (0,R.saveTemplateMatch)(i,e.template_id,e.match_score,e.matched_fields,e.total_fields),e.match_score>.7&&await (0,R.incrementTemplateUsage)(e.template_id);return C.NextResponse.json({success:!0,data:{matches:o,best_match:o.length>0?o[0]:null},meta:{request_id:n,processing_time_ms:Date.now()-t}},{headers:{"X-Cache":"MISS"}})}catch(e){return console.error("Match error:",e),C.NextResponse.json({success:!1,error:D.Errors.parseFailed("match",e instanceof Error?e.message:"Unknown error"),meta:{request_id:n,processing_time_ms:Date.now()-t}},{status:500})}}e.s(["POST",()=>T,"dynamic",0,"force-dynamic"],148330);var N=e.i(148330);let S=new t.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/v1/documind/match/route",pathname:"/api/v1/documind/match",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/v1/documind/match/route.ts",nextConfigOutput:"",userland:N}),{workAsyncStorage:y,workUnitAsyncStorage:v,serverHooks:x}=S;function A(){return(0,r.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:v})}async function w(e,t,r){S.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let C="/api/v1/documind/match/route";C=C.replace(/\/index$/,"")||"/";let D=await S.prepare(e,t,{srcPage:C,multiZoneDraftMode:!1});if(!D)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:I,params:R,nextConfig:T,parsedUrl:N,isDraftMode:y,prerenderManifest:v,routerServerContext:x,isOnDemandRevalidate:A,revalidateOnlyGenerated:w,resolvedPathname:O,clientReferenceManifest:B,serverActionsManifest:b}=D,M=(0,c.normalizeAppPath)(C),P=!!(v.dynamicRoutes[M]||v.routes[O]),U=async()=>((null==x?void 0:x.render404)?await x.render404(e,t,N,!1):t.end("This page could not be found"),null);if(P&&!y){let e=!!v.routes[O],t=v.dynamicRoutes[M];if(t&&!1===t.fallback&&!e){if(T.experimental.adapterPath)return await U();throw new g.NoFallbackError}}let L=null;!P||S.isDev||y||(L="/index"===(L=O)?"/":L);let F=!0===S.isDev||!P,j=P&&!F;b&&B&&(0,s.setReferenceManifestsSingleton)({page:C,clientReferenceManifest:B,serverActionsManifest:b,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:b})});let k=e.method||"GET",q=(0,i.getTracer)(),H=q.getActiveScopeSpan(),G={params:R,prerenderManifest:v,renderOpts:{experimental:{authInterrupts:!!T.experimental.authInterrupts},cacheComponents:!!T.cacheComponents,supportsDynamicResponse:F,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:T.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,r)=>S.onRequestError(e,t,r,x)},sharedContext:{buildId:I}},z=new l.NodeNextRequest(e),J=new l.NodeNextResponse(t),K=d.NextRequestAdapter.fromNodeNextRequest(z,(0,d.signalFromNodeResponse)(t));try{let s=async e=>S.handle(K,G).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=q.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=n.get("next.route");if(r){let t=`${k} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${k} ${C}`)}),o=!!(0,a.getRequestMeta)(e,"minimalMode"),c=async a=>{var i,c;let l=async({previousCacheEntry:n})=>{try{if(!o&&A&&w&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await s(a);e.fetchMetrics=G.renderOpts.fetchMetrics;let c=G.renderOpts.pendingWaitUntil;c&&r.waitUntil&&(r.waitUntil(c),c=void 0);let l=G.renderOpts.collectedTags;if(!P)return await (0,_.sendResponse)(z,J,i,G.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(i.headers);l&&(t[f.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==G.renderOpts.collectedRevalidate&&!(G.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&G.renderOpts.collectedRevalidate,r=void 0===G.renderOpts.collectedExpire||G.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:G.renderOpts.collectedExpire;return{value:{kind:E.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:r}}}}catch(t){throw(null==n?void 0:n.isStale)&&await S.onRequestError(e,t,{routerKind:"App Router",routePath:C,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:A})},x),t}},d=await S.handleResponse({req:e,nextConfig:T,cacheKey:L,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:v,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:w,responseGenerator:l,waitUntil:r.waitUntil,isMinimalMode:o});if(!P)return null;if((null==d||null==(i=d.value)?void 0:i.kind)!==E.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(c=d.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",A?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),y&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,m.fromNodeOutgoingHttpHeaders)(d.value.headers);return o&&P||u.delete(f.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,h.getCacheControlHeader)(d.cacheControl)),await (0,_.sendResponse)(z,J,new Response(d.value.body,{headers:u,status:d.value.status||200})),null};H?await c(H):await q.withPropagatedContext(e.headers,()=>q.trace(u.BaseServerSpan.handleRequest,{spanName:`${k} ${C}`,kind:i.SpanKind.SERVER,attributes:{"http.method":k,"http.target":e.url}},c))}catch(t){if(t instanceof g.NoFallbackError||await S.onRequestError(e,t,{routerKind:"App Router",routePath:M,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:A})}),P)throw t;return await (0,_.sendResponse)(z,J,new Response(null,{status:500})),null}}e.s(["handler",()=>w,"patchFetch",()=>A,"routeModule",()=>S,"serverHooks",()=>x,"workAsyncStorage",()=>y,"workUnitAsyncStorage",()=>v],590249)},87683,e=>{e.v(t=>Promise.all(["server/chunks/6726b_pdf-lib_es_index_e43914b4.js","server/chunks/node_modules__pnpm_29933faf._.js"].map(t=>e.l(t))).then(()=>t(644674)))},746382,e=>{e.v(t=>Promise.all(["server/chunks/0c5e6_unpdf_dist_37260536._.js"].map(t=>e.l(t))).then(()=>t(278893)))},318896,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__3a8b8f05._.js","server/chunks/[root-of-the-server]__68a19f2b._.js"].map(t=>e.l(t))).then(()=>t(771214)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__5af3b7af._.js.map