module.exports=[674093,a=>{"use strict";var b=a.i(526689),c=a.i(125712),d=a.i(703130),e=a.i(340695),f=a.i(254161),g=a.i(205522),h=a.i(588237),i=a.i(887682),j=a.i(550349);let k=(0,j.default)("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]),l=(0,j.default)("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);var m=a.i(506702),n=a.i(674864),o=a.i(583958),p=a.i(137387),q=a.i(674375),r=a.i(765393),s=a.i(167305),t=a.i(861084),u=a.i(277687),v=a.i(131483);function w(){let[a,j]=(0,c.useState)([]),[w,x]=(0,c.useState)(null),[y,z]=(0,c.useState)(!0),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)(""),[E,F]=(0,c.useState)("all"),[G,H]=(0,c.useState)(null),{toast:I}=(0,u.useToast)();(0,c.useEffect)(()=>{J()},[]);let J=async()=>{z(!0);try{let[a,b]=await Promise.all([fetch("/api/scraping/sources"),fetch("/api/scraping/stats")]);if(a.ok){let b=await a.json();j(b.sources||[])}if(b.ok){let a=await b.json();x(a)}}catch(a){console.error("[v0] Error loading data:",a),I({title:"Error",description:"Failed to load scraping data",variant:"destructive"})}finally{z(!1)}},K=async(a,b)=>{try{if(!(await fetch("/api/scraping/sources",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({sourceId:a,updates:{scraping_enabled:b}})})).ok)throw Error("Failed to update source");I({title:"Success",description:`Scraping ${b?"enabled":"disabled"} for source`}),J()}catch(a){I({title:"Error",description:"Failed to update source",variant:"destructive"})}},L=async a=>{B(a);try{console.log("[v0] Starting scrape for source:",a);let b=await fetch("/api/scraping/trigger",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sourceId:a})});console.log("[v0] Scrape response status:",b.status);let c=await b.json();if(console.log("[v0] Scrape response data:",c),!b.ok)throw Error(c.error||c.details||"Failed to trigger scraping");let d=c.scrapedCount>0?`Successfully scraped ${c.scrapedCount} tender${1!==c.scrapedCount?"s":""}`:c.error?`Scraping completed but found no tenders. Error: ${c.error}`:"Scraping completed but found no tenders";I({title:c.scrapedCount>0?"Scraping Complete":"No Tenders Found",description:d,variant:c.scrapedCount>0?"default":"destructive"}),J()}catch(a){console.error("[v0] Scraping error:",a),I({title:"Scraping Error",description:a instanceof Error?a.message:"Failed to scrape source",variant:"destructive"})}finally{B(null)}},M=async a=>{let b=setInterval(async()=>{try{console.log("[v0] Polling progress for ID:",a);let c=await fetch(`/api/scraping/progress/${a}`);if(c.ok){let a=await c.json();console.log("[v0] Progress data:",a),H({currentSource:a.current_source,completedSources:a.completed_sources,totalSources:a.total_sources,totalTenders:a.total_tenders}),("completed"===a.status||"failed"===a.status)&&(console.log("[v0] Scraping finished with status:",a.status),clearInterval(b),H(null),B(null),"completed"===a.status?I.success(`Scraping completed - Found ${a.total_tenders} tenders from ${a.completed_sources} sources`):I.error(`Scraping failed - ${a.error_message||"An error occurred during scraping"}`),J())}}catch(a){console.error("[v0] Error polling progress:",a)}},1e3);return b},N=async()=>{B(-1),H({currentSource:"Initializing...",completedSources:0,totalSources:0,totalTenders:0});try{console.log("[v0] Starting scrape for all sources");let b=a.filter(a=>a.is_active&&a.scraping_enabled).length;if(console.log("[v0] Active sources available for scraping:",b),0===b){I({title:"No Active Sources",description:"There are no enabled tender sources to scrape. Please enable at least one source first.",variant:"destructive"}),B(null),H(null);return}let c=await fetch("/api/scraping/trigger",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({scrapeAll:!0})});if(console.log("[v0] Scrape all response status:",c.status),!c.ok){let a=await c.text();throw console.error("[v0] Scrape all error response:",a),Error(`Server responded with ${c.status}: ${a}`)}let d=await c.json();if(console.log("[v0] Scrape all response data:",d),d.progressId){console.log("[v0] Starting progress polling for ID:",d.progressId),M(d.progressId);return}let e=d.successfulSources||0,f=d.sourcesScraped||0,g=d.totalScraped||0,h=g>0?`Found ${g} tender${1!==g?"s":""} from ${e}/${f} sources`:`Scraped ${f} sources but found no tenders`;I({title:g>0?"Scraping Complete":"No Tenders Found",description:h,variant:g>0?"default":"destructive"}),H(null),B(null),J()}catch(a){console.error("[v0] Scraping all error:",a),I({title:"Scraping Error",description:a instanceof Error?a.message:"Failed to scrape all sources",variant:"destructive"}),H(null),B(null)}},O=a.filter(a=>{let b=""===C||a.name.toLowerCase().includes(C.toLowerCase())||a.tender_page_url.toLowerCase().includes(C.toLowerCase()),c="all"===E||a.level===E;return b&&c});return y?(0,b.jsxs)("div",{className:"flex min-h-screen bg-background",children:[(0,b.jsx)(v.AdminNav,{}),(0,b.jsx)("main",{className:"flex-1 lg:ml-0",children:(0,b.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,b.jsx)(t.Loader2,{className:"h-8 w-8 animate-spin text-primary"})})})]}):(0,b.jsxs)("div",{className:"flex min-h-screen bg-background",children:[(0,b.jsx)(v.AdminNav,{}),(0,b.jsx)("main",{className:"flex-1 lg:ml-0",children:(0,b.jsxs)("div",{className:"container mx-auto px-4 py-8 space-y-6 max-w-7xl",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"Scraping Administration"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Manage tender sources and scraping operations"})]}),w&&(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(d.CardTitle,{className:"text-sm font-medium",children:"Total Sources"}),(0,b.jsx)(p.Database,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:w.totalSources}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[w.activeSources," active"]})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(d.CardTitle,{className:"text-sm font-medium",children:"Total Tenders"}),(0,b.jsx)(o.TrendingUp,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:w.totalTenders}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[w.activeTenders," active"]})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(d.CardTitle,{className:"text-sm font-medium",children:"Recent Scrapes"}),(0,b.jsx)(s.Clock,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:w.recentScrapes.length}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Last 10 operations"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(d.CardTitle,{className:"text-sm font-medium",children:"Success Rate"}),(0,b.jsx)(q.CheckCircle2,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsxs)("div",{className:"text-2xl font-bold",children:[w.recentScrapes.length>0?Math.round(w.recentScrapes.filter(a=>"success"===a.last_scrape_status).length/w.recentScrapes.length*100):0,"%"]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"From recent scrapes"})]})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"Scraping Actions"}),(0,b.jsx)(d.CardDescription,{children:"Trigger scraping operations for all or individual sources"})]}),(0,b.jsxs)(d.CardContent,{className:"space-y-4",children:[(0,b.jsx)(e.Button,{onClick:N,disabled:null!==A,size:"lg",children:-1===A?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(t.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Scraping All Sources..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(m.RefreshCw,{className:"h-4 w-4 mr-2"}),"Scrape All Active Sources"]})}),G&&(0,b.jsxs)("div",{className:"mt-4 p-4 border rounded-lg space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm font-medium",children:[(0,b.jsx)(t.Loader2,{className:"h-4 w-4 animate-spin"}),(0,b.jsxs)("span",{children:["Currently scraping: ",G.currentSource||"Initializing..."]})]}),(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Progress: ",G.completedSources," / ",G.totalSources," sources completed"]}),G.totalTenders>0&&(0,b.jsxs)("div",{className:"text-sm text-green-600",children:["Found ",G.totalTenders," tender",1!==G.totalTenders?"s":""," so far"]})]})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"Tender Sources"}),(0,b.jsx)(d.CardDescription,{children:"Manage individual tender sources and their scraping configuration"})]}),(0,b.jsxs)(d.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsx)(g.Input,{placeholder:"Search sources...",value:C,onChange:a=>D(a.target.value),className:"max-w-sm"})}),(0,b.jsxs)(i.Select,{value:E,onValueChange:F,children:[(0,b.jsx)(i.SelectTrigger,{className:"w-[180px]",children:(0,b.jsx)(i.SelectValue,{placeholder:"Filter by level"})}),(0,b.jsxs)(i.SelectContent,{children:[(0,b.jsx)(i.SelectItem,{value:"all",children:"All Levels"}),(0,b.jsx)(i.SelectItem,{value:"National",children:"National"}),(0,b.jsx)(i.SelectItem,{value:"Provincial",children:"Provincial"}),(0,b.jsx)(i.SelectItem,{value:"Metro",children:"Metro"}),(0,b.jsx)(i.SelectItem,{value:"SOE",children:"SOE"}),(0,b.jsx)(i.SelectItem,{value:"Public Entity",children:"Public Entity"})]})]})]}),(0,b.jsx)("div",{className:"rounded-md border",children:(0,b.jsxs)(h.Table,{children:[(0,b.jsx)(h.TableHeader,{children:(0,b.jsxs)(h.TableRow,{children:[(0,b.jsx)(h.TableHead,{children:"Source"}),(0,b.jsx)(h.TableHead,{children:"Level"}),(0,b.jsx)(h.TableHead,{children:"Scraper Type"}),(0,b.jsx)(h.TableHead,{children:"Status"}),(0,b.jsx)(h.TableHead,{children:"Last Scraped"}),(0,b.jsx)(h.TableHead,{children:"Tenders"}),(0,b.jsx)(h.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(h.TableBody,{children:O.map(a=>(0,b.jsxs)(h.TableRow,{children:[(0,b.jsx)(h.TableCell,{children:(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:a.name}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:a.province||"All"})]})}),(0,b.jsx)(h.TableCell,{children:(0,b.jsx)(f.Badge,{variant:"outline",children:a.level})}),(0,b.jsx)(h.TableCell,{children:a.scraper_type?.includes("api")?(0,b.jsxs)(f.Badge,{className:"bg-blue-500/10 text-blue-600 border-blue-200",children:[(0,b.jsx)(p.Database,{className:"h-3 w-3 mr-1"}),"API"]}):(0,b.jsxs)(f.Badge,{variant:"secondary",children:[(0,b.jsx)(n.Search,{className:"h-3 w-3 mr-1"}),"HTML"]})}),(0,b.jsx)(h.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[a.scraping_enabled?(0,b.jsxs)(f.Badge,{className:"bg-green-500/10 text-green-500",children:[(0,b.jsx)(q.CheckCircle2,{className:"h-3 w-3 mr-1"}),"Enabled"]}):(0,b.jsxs)(f.Badge,{variant:"secondary",children:[(0,b.jsx)(l,{className:"h-3 w-3 mr-1"}),"Disabled"]}),"success"===a.last_scrape_status&&(0,b.jsx)(q.CheckCircle2,{className:"h-4 w-4 text-green-500"}),"failed"===a.last_scrape_status&&(0,b.jsx)(r.XCircle,{className:"h-4 w-4 text-red-500"})]})}),(0,b.jsx)(h.TableCell,{children:a.last_scraped_at?new Date(a.last_scraped_at).toLocaleString():"Never"}),(0,b.jsx)(h.TableCell,{children:a.total_tenders_scraped}),(0,b.jsx)(h.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(e.Button,{size:"sm",variant:"outline",onClick:()=>K(a.id,!a.scraping_enabled),children:a.scraping_enabled?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l,{className:"h-3 w-3 mr-1"}),"Disable"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k,{className:"h-3 w-3 mr-1"}),"Enable"]})}),(0,b.jsx)(e.Button,{size:"sm",onClick:()=>L(a.id),disabled:A===a.id||!a.scraping_enabled,children:A===a.id?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(t.Loader2,{className:"h-3 w-3 mr-1 animate-spin"}),"Scraping..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(m.RefreshCw,{className:"h-3 w-3 mr-1"}),"Scrape"]})})]})})]},a.id))})]})}),0===O.length&&(0,b.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,b.jsx)(n.Search,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,b.jsx)("p",{children:"No sources found matching your filters"})]})]})]})]})})]})}a.s(["default",()=>w],674093)}];

//# sourceMappingURL=app_admin_scraping_page_tsx_b47e859b._.js.map