module.exports=[839266,a=>{"use strict";var b=a.i(526689),c=a.i(125712),d=a.i(340695),e=a.i(703130),f=a.i(265602),g=a.i(861084),h=a.i(318851),i=a.i(807518),j=a.i(765393);let k=(0,a.i(550349).default)("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]);function l(){let[a,l]=(0,c.useState)(!1),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)([]),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(null),[A,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)(null),E=async()=>{l(!0),p(null),n(null),v(["ðŸš€ Starting API fetch..."]);try{v(a=>[...a,"ðŸ“¡ Calling /api/fetch-all-api-tenders..."]);let a=await fetch("/api/fetch-all-api-tenders",{method:"POST"});v(b=>[...b,`âœ… API responded with status: ${a.status}`]);let b=await a.json();if(v(a=>[...a,`ðŸ“¦ Received data: ${JSON.stringify(b).substring(0,200)}...`]),!a.ok||!b.success&&0===b.totalSaved){p(b.error||"Failed to fetch tenders"),b.sources&&b.sources.length>0&&n(b),v(a=>[...a,`âŒ Fetch failed: ${b.error}`]);return}v(a=>[...a,`âœ… Success! Fetched ${b.totalFetched}, Saved ${b.totalSaved}`]),n(b)}catch(b){console.error("[v0] Error:",b);let a=b instanceof Error?b.message:"Unknown error";p(a),v(b=>[...b,`âŒ Exception: ${a}`])}finally{l(!1),v(a=>[...a,"ðŸ Fetch complete"])}},F=async()=>{r(!0),t(null);try{console.log("[v0] Running pipeline test...");let a=await fetch("/api/test-tender-flow",{method:"POST"}),b=await a.json();console.log("[v0] Test result:",b),t(b)}catch(a){console.error("[v0] Test error:",a),t({success:!1,error:a instanceof Error?a.message:"Unknown error"})}finally{r(!1)}},G=async()=>{x(!0),z(null),p(null);try{let a=await fetch("/api/etender-simple-fetch"),b=await a.json();z(b),b.success||p(b.error||"Simple fetch failed")}catch(b){console.error("[v0] Simple fetch error:",b);let a=b instanceof Error?b.message:"Unknown error";p(a),z({success:!1,error:a})}finally{x(!1)}},H=async()=>{B(!0),D(null),p(null);try{let a=await fetch("/api/admin/trigger-etender-api-scrape",{method:"POST"}),b=await a.json();D(b),b.success||p(b.error||"Engine scrape failed")}catch(b){console.error("[v0] Engine scrape error:",b);let a=b instanceof Error?b.message:"Unknown error";p(a),D({success:!1,error:a})}finally{B(!1)}};return(0,b.jsxs)("div",{className:"container mx-auto p-6 max-w-4xl",children:[(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"API Tender Fetcher"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-2",children:"Fetch tenders from all available South African tender APIs (eTender, EasyTenders, and more)"})]}),(0,b.jsxs)(e.Card,{className:"mb-6 border-blue-500",children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{children:"Engine-Integrated eTender Scrape (Recommended)"}),(0,b.jsx)(e.CardDescription,{children:"Fetch tenders through the full engine pipeline: eTender API â†’ TenderEngine (validation) â†’ Documind (documents) â†’ Strategist (opportunity matching) â†’ User alerts"})]}),(0,b.jsx)(e.CardContent,{children:(0,b.jsx)(d.Button,{onClick:H,disabled:A,size:"lg",className:"w-full",children:A?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(g.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing through Engine Pipeline..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(h.Download,{className:"mr-2 h-4 w-4"}),"Fetch via Engine Pipeline"]})})})]}),C&&(0,b.jsxs)(e.Card,{className:"mb-6",children:[(0,b.jsx)(e.CardHeader,{children:(0,b.jsx)(e.CardTitle,{className:"flex items-center gap-2",children:C.success?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(i.CheckCircle,{className:"h-5 w-5 text-green-500"}),"Engine Pipeline Success"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(j.XCircle,{className:"h-5 w-5 text-red-500"}),"Engine Pipeline Failed"]})})}),(0,b.jsx)(e.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-3",children:[C.message&&(0,b.jsx)(f.Alert,{className:C.success?"border-green-500":"border-red-500",children:(0,b.jsx)(f.AlertDescription,{children:C.message})}),C.data&&(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Source:"})," ",C.data.sourceName]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Scraped:"})," ",C.data.scrapedCount," tenders"]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Saved:"})," ",C.data.savedCount," tenders"]})]}),C.error&&(0,b.jsx)(f.Alert,{variant:"destructive",children:(0,b.jsx)(f.AlertDescription,{children:C.error})}),C.instructions&&(0,b.jsx)(f.Alert,{className:"border-yellow-500 bg-yellow-50",children:(0,b.jsxs)(f.AlertDescription,{className:"text-yellow-900",children:[(0,b.jsx)("strong",{children:"Setup Required:"})," ",C.instructions]})})]})})]}),(0,b.jsxs)(e.Card,{className:"mb-6",children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{children:"Pipeline Diagnostic Test"}),(0,b.jsx)(e.CardDescription,{children:"Test the entire tender pipeline to identify any issues before fetching real data"})]}),(0,b.jsx)(e.CardContent,{children:(0,b.jsx)(d.Button,{onClick:F,disabled:q,size:"lg",className:"w-full bg-transparent",variant:"outline",children:q?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(g.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Running Tests..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k,{className:"mr-2 h-4 w-4"}),"Run Full Pipeline Test"]})})})]}),s&&(0,b.jsxs)(e.Card,{className:"mb-6",children:[(0,b.jsx)(e.CardHeader,{children:(0,b.jsx)(e.CardTitle,{className:"flex items-center gap-2",children:s.success?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(i.CheckCircle,{className:"h-5 w-5 text-green-500"}),"All Tests Passed"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(j.XCircle,{className:"h-5 w-5 text-red-500"}),"Tests Failed"]})})}),(0,b.jsx)(e.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-3",children:[s.steps?.map(a=>(0,b.jsxs)("div",{className:"flex items-start gap-3 p-3 border rounded-lg",children:["passed"===a.status?(0,b.jsx)(i.CheckCircle,{className:"h-5 w-5 text-green-500 flex-shrink-0 mt-0.5"}):"failed"===a.status?(0,b.jsx)(j.XCircle,{className:"h-5 w-5 text-red-500 flex-shrink-0 mt-0.5"}):(0,b.jsx)(g.Loader2,{className:"h-5 w-5 text-blue-500 animate-spin flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"font-semibold",children:["Step ",a.step,": ",a.name]}),a.error&&(0,b.jsx)("div",{className:"text-sm text-red-500 mt-1",children:a.error}),void 0!==a.currentCount&&(0,b.jsxs)("div",{className:"text-sm text-muted-foreground mt-1",children:["Current count: ",a.currentCount]}),a.tenderId&&(0,b.jsxs)("div",{className:"text-sm text-muted-foreground mt-1",children:["Created tender ID: ",a.tenderId]}),void 0!==a.totalTenders&&(0,b.jsxs)("div",{className:"text-sm text-muted-foreground mt-1",children:["Total tenders: ",a.totalTenders]})]})]},a.step)),s.message&&(0,b.jsx)(f.Alert,{className:s.success?"border-green-500":"border-red-500",children:(0,b.jsx)(f.AlertDescription,{children:s.message})})]})})]}),(0,b.jsxs)(e.Card,{className:"mb-6",children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{children:"Simple eTender Fetch (Direct)"}),(0,b.jsx)(e.CardDescription,{children:"Direct simplified fetch from eTenders API only - bypasses complex logic"})]}),(0,b.jsx)(e.CardContent,{children:(0,b.jsx)(d.Button,{onClick:G,disabled:w,size:"lg",className:"w-full",children:w?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(g.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Fetching from eTenders..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(h.Download,{className:"mr-2 h-4 w-4"}),"Simple eTender Fetch"]})})})]}),y&&(0,b.jsxs)(e.Card,{className:"mb-6",children:[(0,b.jsx)(e.CardHeader,{children:(0,b.jsx)(e.CardTitle,{className:"flex items-center gap-2",children:y.success?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(i.CheckCircle,{className:"h-5 w-5 text-green-500"}),"Simple Fetch Success"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(j.XCircle,{className:"h-5 w-5 text-red-500"}),"Simple Fetch Failed"]})})}),(0,b.jsx)(e.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-3",children:[y.message&&(0,b.jsx)(f.Alert,{className:y.success?"border-green-500":"border-red-500",children:(0,b.jsx)(f.AlertDescription,{children:y.message})}),void 0!==y.fetched&&(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("strong",{children:"Fetched:"})," ",y.fetched," tenders"]}),void 0!==y.saved&&(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("strong",{children:"Saved:"})," ",y.saved," tenders"]}),y.sampleTender&&(0,b.jsxs)("details",{className:"text-xs",children:[(0,b.jsx)("summary",{className:"cursor-pointer font-semibold",children:"Sample Tender Data"}),(0,b.jsx)("pre",{className:"mt-2 p-2 bg-gray-100 rounded overflow-auto max-h-60",children:JSON.stringify(y.sampleTender,null,2)})]}),y.error&&(0,b.jsx)(f.Alert,{variant:"destructive",children:(0,b.jsx)(f.AlertDescription,{children:y.error})})]})})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{children:"Fetch Latest Tenders from All API Sources"}),(0,b.jsx)(e.CardDescription,{children:"This will fetch tenders from all available APIs (eTender OCDS, EasyTenders) from the last 30 days"})]}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)(d.Button,{onClick:E,disabled:a,size:"lg",className:"w-full",children:a?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(g.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Fetching from All API Sources..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(h.Download,{className:"mr-2 h-4 w-4"}),"Fetch from All APIs"]})}),u.length>0&&(0,b.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg border",children:[(0,b.jsx)("h4",{className:"font-semibold mb-2 text-sm",children:"Live Progress:"}),(0,b.jsx)("div",{className:"space-y-1 text-sm font-mono max-h-60 overflow-y-auto",children:u.map((a,c)=>(0,b.jsx)("div",{className:"text-gray-700",children:a},c))})]})]})]}),o&&(0,b.jsxs)(f.Alert,{variant:"destructive",className:"mt-6",children:[(0,b.jsx)(j.XCircle,{className:"h-4 w-4"}),(0,b.jsxs)(f.AlertDescription,{children:[(0,b.jsx)("strong",{children:"Error:"})," ",o]})]}),m&&(0,b.jsxs)(e.Card,{className:"mt-6",children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{className:"flex items-center gap-2",children:m.success?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(i.CheckCircle,{className:"h-5 w-5 text-green-500"}),"Success!"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(j.XCircle,{className:"h-5 w-5 text-yellow-500"}),"Partial Success"]})}),(0,b.jsxs)(e.CardDescription,{children:["Database had ",m.beforeCount," tenders before fetch. After fetching ",m.totalFetched," tenders from APIs and saving ",m.totalSaved,", database now has ",m.afterCount," tenders (",m.newTenders," ","new, ",m.totalSaved-m.newTenders," updated)."]})]}),(0,b.jsx)(e.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-4",children:[0===m.newTenders&&m.totalSaved>0&&(0,b.jsx)(f.Alert,{className:"border-blue-500 bg-blue-50",children:(0,b.jsxs)(f.AlertDescription,{className:"text-blue-900",children:[(0,b.jsx)("strong",{children:"Note:"})," All ",m.totalSaved," tenders from the API already existed in the database and were updated. No genuinely new tenders were added. This means the system is working correctly and preventing duplicates."]})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold mb-3",children:"Results by Source"}),(0,b.jsx)("div",{className:"space-y-3",children:m.sources?.map((a,c)=>(0,b.jsx)("div",{className:`p-4 rounded-lg border ${a.error?"border-red-200 bg-red-50":a.saved>0?"border-green-200 bg-green-50":"border-gray-200 bg-gray-50"}`,children:(0,b.jsx)("div",{className:"flex items-start justify-between",children:(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"font-semibold flex items-center gap-2",children:[a.error?(0,b.jsx)(j.XCircle,{className:"h-4 w-4 text-red-500"}):a.saved>0?(0,b.jsx)(i.CheckCircle,{className:"h-4 w-4 text-green-500"}):(0,b.jsx)(j.XCircle,{className:"h-4 w-4 text-gray-400"}),a.name]}),a.error?(0,b.jsx)("div",{className:"text-sm text-red-600 mt-1",children:a.error}):(0,b.jsxs)("div",{className:"text-sm text-muted-foreground mt-1",children:["Fetched: ",a.fetched," | Saved: ",a.saved]})]})})},c))})]}),(0,b.jsx)(f.Alert,{children:(0,b.jsxs)(f.AlertDescription,{children:["Go to ",(0,b.jsx)("strong",{children:"/dashboard/search"})," to view the newly fetched tenders"]})})]})})]})]})}a.s(["default",()=>l],839266)}];

//# sourceMappingURL=app_admin_etender-fetch_page_tsx_e4df5b19._.js.map