{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Repo/LogsOfN/v0-bid-mate-ai/components/ui/card.tsx"],"sourcesContent":["import * as React from 'react'\r\n\r\nimport { cn } from '@/lib/utils'\r\n\r\nfunction Card({ className, ...props }: React.ComponentProps<'div'>) {\r\n  return (\r\n    <div\r\n      data-slot=\"card\"\r\n      className={cn(\r\n        'bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm',\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction CardHeader({ className, ...props }: React.ComponentProps<'div'>) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-header\"\r\n      className={cn(\r\n        '@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6',\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction CardTitle({ className, ...props }: React.ComponentProps<'div'>) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-title\"\r\n      className={cn('leading-none font-semibold', className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction CardDescription({ className, ...props }: React.ComponentProps<'div'>) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-description\"\r\n      className={cn('text-muted-foreground text-sm', className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction CardAction({ className, ...props }: React.ComponentProps<'div'>) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-action\"\r\n      className={cn(\r\n        'col-start-2 row-span-2 row-start-1 self-start justify-self-end',\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction CardContent({ className, ...props }: React.ComponentProps<'div'>) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-content\"\r\n      className={cn('px-6', className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nfunction CardFooter({ className, ...props }: React.ComponentProps<'div'>) {\r\n  return (\r\n    <div\r\n      data-slot=\"card-footer\"\r\n      className={cn('flex items-center px-6 [.border-t]:pt-6', className)}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nexport {\r\n  Card,\r\n  CardHeader,\r\n  CardFooter,\r\n  CardTitle,\r\n  CardAction,\r\n  CardDescription,\r\n  CardContent,\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAEA;;;AAEA,SAAS,KAAK,EAAE,SAAS,EAAE,GAAG,OAAoC;IAChE,qBACE,mSAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,qFACA;QAED,GAAG,KAAK;;;;;;AAGf;KAXS;AAaT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,mSAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,4JACA;QAED,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,UAAU,EAAE,SAAS,EAAE,GAAG,OAAoC;IACrE,qBACE,mSAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,gBAAgB,EAAE,SAAS,EAAE,GAAG,OAAoC;IAC3E,qBACE,mSAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,mSAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,kEACA;QAED,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,YAAY,EAAE,SAAS,EAAE,GAAG,OAAoC;IACvE,qBACE,mSAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,QAAQ;QACrB,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,mSAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,2CAA2C;QACxD,GAAG,KAAK;;;;;;AAGf;MARS"}},
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///C:/Repo/LogsOfN/v0-bid-mate-ai/components/ui/input.tsx"],"sourcesContent":["import * as React from 'react'\r\n\r\nimport { cn } from '@/lib/utils'\r\n\r\nfunction Input({ className, type, ...props }: React.ComponentProps<'input'>) {\r\n  return (\r\n    <input\r\n      type={type}\r\n      data-slot=\"input\"\r\n      className={cn(\r\n        'file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm',\r\n        'focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]',\r\n        'aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive',\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nexport { Input }\r\n"],"names":[],"mappings":";;;;;AAEA;;;AAEA,SAAS,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,OAAsC;IACzE,qBACE,mSAAC;QACC,MAAM;QACN,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,8bACA,iFACA,0GACA;QAED,GAAG,KAAK;;;;;;AAGf;KAdS"}},
    {"offset": {"line": 155, "column": 0}, "map": {"version":3,"sources":["file:///C:/Repo/LogsOfN/v0-bid-mate-ai/app/actions/tender-actions.ts"],"sourcesContent":["\"use server\"\r\n\r\nimport { createClient } from \"@/lib/supabase/server\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { PinTenderOptions } from \"@/lib/types\"\r\nimport { redirect } from \"next/navigation\"\r\nimport { AnalyzedTender } from \"@/lib/types/tender\"\r\nimport { orchestrateTenderAnalysis } from \"@/lib/engines/orchestrator/tender-orchestrator\"\r\n\r\n\r\nexport interface TenderDocument {\r\n  id?: string\r\n  title: string\r\n  url: string\r\n  documentType?: string\r\n  format?: string\r\n  description?: string\r\n}\r\n\r\nexport interface TenderData {\r\n  tenderId: string\r\n  title: string\r\n  organization: string\r\n  publishDate?: string\r\n  closeDate?: string\r\n  value?: string\r\n  category?: string\r\n  description?: string\r\n  url?: string\r\n  documents?: TenderDocument[] // Add documents array\r\n}\r\n\r\nexport async function addTenderToUser(tenderData: TenderData) {\r\n  const supabase = await createClient()\r\n\r\n  // Get current user\r\n  const {\r\n    data: { user },\r\n    error: userError,\r\n  } = await supabase.auth.getUser()\r\n\r\n  if (userError || !user) {\r\n    return { success: false, error: \"Not authenticated\" }\r\n  }\r\n\r\n  // Insert tender\r\n  const { data, error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .insert({\r\n      user_id: user.id,\r\n      tender_id: tenderData.tenderId,\r\n      title: tenderData.title,\r\n      organization: tenderData.organization,\r\n      publish_date: tenderData.publishDate,\r\n      close_date: tenderData.closeDate,\r\n      value: tenderData.value,\r\n      category: tenderData.category,\r\n      description: tenderData.description,\r\n      url: tenderData.url,\r\n      status: \"draft\",\r\n    })\r\n    .select()\r\n    .single()\r\n\r\n  if (error) {\r\n    // Check if it's a duplicate\r\n    if (error.code === \"23505\") {\r\n      return { success: false, error: \"Tender already added\" }\r\n    }\r\n    console.error(\"[v0] Error adding tender:\", error)\r\n    return { success: false, error: \"Failed to add tender\" }\r\n  }\r\n\r\n  if (tenderData.documents && tenderData.documents.length > 0 && data) {\r\n    console.log(\"[v0] Adding\", tenderData.documents.length, \"documents to tender\", data.id)\r\n    console.log(\"[v0] Document data:\", JSON.stringify(tenderData.documents, null, 2))\r\n\r\n    const documentsToInsert = tenderData.documents.map((doc) => ({\r\n      user_tender_id: data.id, // Changed from tender_id\r\n      user_id: user.id,\r\n      file_name: doc.title, // Changed from name\r\n      storage_path: doc.url, // Changed from file_url - external URLs stored as storage_path\r\n      file_type: doc.format || \"application/pdf\",\r\n      file_size: 0, // Unknown size for external documents\r\n      // Removed document_type and description as they don't exist in schema\r\n    }))\r\n\r\n    console.log(\"[v0] Inserting documents:\", JSON.stringify(documentsToInsert, null, 2))\r\n\r\n    const { data: insertedDocs, error: docsError } = await supabase\r\n      .from(\"tender_documents\")\r\n      .insert(documentsToInsert)\r\n      .select()\r\n\r\n    if (docsError) {\r\n      console.error(\"[v0] Error adding documents:\", docsError)\r\n      console.error(\"[v0] Error details:\", JSON.stringify(docsError, null, 2))\r\n      // Don't fail the whole operation if documents fail, just log it\r\n    } else {\r\n      console.log(\"[v0] Successfully added\", insertedDocs?.length || 0, \"documents\")\r\n      console.log(\r\n        \"[v0] Inserted document IDs:\",\r\n        insertedDocs?.map((d) => d.id),\r\n      )\r\n    }\r\n  } else {\r\n    console.log(\"[v0] No documents to add for this tender\")\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  return { success: true, data }\r\n}\r\n\r\nexport async function toggleTenderPin(tenderId: string, isPinned: boolean) {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  const { error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .update({ is_pinned: isPinned })\r\n    .eq(\"id\", tenderId)\r\n    .eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error toggling pin:\", error)\r\n    return { success: false, error: \"Failed to update tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  revalidatePath(\"/dashboard/search\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function toggleTenderFavourite(tenderId: string, isFavourited: boolean) {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  const { error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .update({ is_favourited: isFavourited })\r\n    .eq(\"id\", tenderId)\r\n    .eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error toggling favourite:\", error)\r\n    return { success: false, error: \"Failed to update tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  revalidatePath(\"/dashboard/search\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function toggleTenderWishlist(tenderId: string, isWishlisted: boolean) {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  const { error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .update({ is_wishlisted: isWishlisted })\r\n    .eq(\"id\", tenderId)\r\n    .eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error toggling wishlist:\", error)\r\n    return { success: false, error: \"Failed to update tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function getUserTenders() {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\", tenders: [] }\r\n\r\n  // Fetch all tenders from user_tenders (both scraped and custom)\r\n  const { data: tenders, error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .select(\"*\")\r\n    .eq(\"user_id\", user.id)\r\n    .order(\"created_at\", { ascending: false })\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error fetching tenders:\", error)\r\n    return { success: false, error: \"Failed to fetch tenders\", tenders: [] }\r\n  }\r\n\r\n  // Normalize data for frontend\r\n  const normalizedTenders = (tenders || []).map((tender) => ({\r\n    id: tender.id,\r\n    tender_id: tender.tender_id || `custom-${tender.id}`, // Fallback for custom tenders\r\n    title: tender.title,\r\n    organization: tender.organization,\r\n    status: tender.status,\r\n    close_date: tender.close_date || tender.deadline, // Use deadline if close_date is null\r\n    value: tender.value,\r\n    category: tender.category,\r\n    is_pinned: tender.is_pinned || false,\r\n    is_favourited: tender.is_favourited || false,\r\n    is_wishlisted: tender.is_wishlisted || false,\r\n    created_at: tender.created_at,\r\n    tender_type: tender.tender_type || \"scraped\", // Default to scraped if null\r\n    location: tender.location,\r\n  }))\r\n\r\n  return { success: true, tenders: normalizedTenders }\r\n}\r\n\r\nexport async function deleteTender(tenderId: string, tenderType?: \"scraped\" | \"custom\") {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  // Simply delete from user_tenders table\r\n  const { error } = await supabase.from(\"user_tenders\").delete().eq(\"id\", tenderId).eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error deleting tender:\", error)\r\n    return { success: false, error: \"Failed to delete tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function saveScrapedTenderToUser(scrapedTender: {\r\n  id: string\r\n  title: string\r\n  source_name: string\r\n  description?: string\r\n  publish_date?: string\r\n  close_date?: string\r\n  estimated_value?: string\r\n  category?: string\r\n  tender_url?: string\r\n}) {\r\n  const supabase = await createClient()\r\n\r\n  // Get current user\r\n  const {\r\n    data: { user },\r\n    error: userError,\r\n  } = await supabase.auth.getUser()\r\n\r\n  if (userError || !user) {\r\n    return { success: false, error: \"Not authenticated\" }\r\n  }\r\n\r\n  // Check if tender already exists for this user\r\n  const { data: existing } = await supabase\r\n    .from(\"user_tenders\")\r\n    .select(\"id, status\")\r\n    .eq(\"user_id\", user.id)\r\n    .eq(\"tender_id\", scrapedTender.id)\r\n    .single()\r\n\r\n  if (existing) {\r\n    // If already exists and is draft, update to in-progress\r\n    if (existing.status === \"draft\") {\r\n      const { error: updateError } = await supabase\r\n        .from(\"user_tenders\")\r\n        .update({ status: \"in-progress\" })\r\n        .eq(\"id\", existing.id)\r\n\r\n      if (updateError) {\r\n        console.error(\"[v0] Error updating tender status:\", updateError)\r\n        return { success: false, error: \"Failed to update tender status\" }\r\n      }\r\n\r\n      revalidatePath(\"/dashboard/tenders\")\r\n      return { success: true, message: \"Tender status updated to in-progress\", isNew: false }\r\n    }\r\n\r\n    // Already exists and not draft, no need to update\r\n    return { success: true, message: \"Tender already in your list\", isNew: false }\r\n  }\r\n\r\n  // Insert new tender with in-progress status\r\n  const { data, error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .insert({\r\n      user_id: user.id,\r\n      tender_id: scrapedTender.id,\r\n      title: scrapedTender.title,\r\n      organization: scrapedTender.source_name,\r\n      publish_date: scrapedTender.publish_date,\r\n      close_date: scrapedTender.close_date,\r\n      value: scrapedTender.estimated_value,\r\n      category: scrapedTender.category,\r\n      description: scrapedTender.description,\r\n      url: scrapedTender.tender_url,\r\n      status: \"in-progress\",\r\n      tender_type: \"scraped\",\r\n    })\r\n    .select()\r\n    .single()\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error saving tender:\", error)\r\n    return { success: false, error: \"Failed to save tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  return { success: true, message: \"Tender saved to My Tenders\", isNew: true, data }\r\n}\r\n\r\nexport async function createCustomTender(tenderData: {\r\n  title: string\r\n  organization: string\r\n  deadline: string\r\n  value: string\r\n  description: string\r\n  category?: string\r\n  location?: string\r\n  uploadedFile?: File\r\n  analysis?: any\r\n}) {\r\n  console.log(\"[v0] createCustomTender called with data:\", {\r\n    title: tenderData.title,\r\n    organization: tenderData.organization,\r\n    deadline: tenderData.deadline,\r\n    hasFile: !!tenderData.uploadedFile,\r\n    hasAnalysis: !!tenderData.analysis,\r\n  })\r\n\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n    error: userError,\r\n  } = await supabase.auth.getUser()\r\n\r\n  if (userError || !user) {\r\n    console.error(\"[v0] Auth error:\", userError)\r\n    return { success: false, error: \"Not authenticated\" }\r\n  }\r\n\r\n  console.log(\"[v0] User authenticated:\", user.id)\r\n\r\n  try {\r\n    console.log(\"[v0] Creating custom tender record...\")\r\n\r\n    const { data: customTender, error: customTenderError } = await supabase\r\n      .from(\"user_tenders\")\r\n      .insert({\r\n        user_id: user.id,\r\n        title: tenderData.title,\r\n        organization: tenderData.organization,\r\n        deadline: tenderData.deadline,\r\n        value: tenderData.value,\r\n        category: tenderData.category || \"Custom\",\r\n        description: tenderData.description,\r\n        location: tenderData.location,\r\n        status: \"in-progress\",\r\n        tender_type: \"custom\",\r\n      })\r\n      .select()\r\n      .single()\r\n\r\n    if (customTenderError) {\r\n      console.error(\"[v0] Error creating custom tender:\", customTenderError)\r\n      return { success: false, error: \"Failed to create tender: \" + customTenderError.message }\r\n    }\r\n\r\n    console.log(\"[v0] Custom tender created successfully:\", customTender.id)\r\n\r\n    let documentSaved = false\r\n    let documentError: string | null = null\r\n    let uploadData: any = null // Declare uploadData here to be accessible later\r\n\r\n    if (tenderData.uploadedFile) {\r\n      console.log(\"[v0] Processing existing document...\")\r\n\r\n      try {\r\n        const file = tenderData.uploadedFile\r\n        const fileName = `${user.id}/${customTender.id}/${file.name}`\r\n\r\n        const { data: uploaded, error: uploadError } = await supabase.storage\r\n          .from(\"tender-documents\")\r\n          .upload(fileName, file)\r\n        uploadData = uploaded // Assign to the outer scope variable\r\n\r\n        if (uploadError) {\r\n          console.error(\"[v0] Error uploading file to Supabase:\", uploadError)\r\n          documentError = \"Failed to upload file to permanent storage\"\r\n        } else {\r\n          const documentData = {\r\n            tender_id: customTender.id,\r\n            file_name: file.name,\r\n            file_type: file.type,\r\n            file_size: file.size,\r\n            storage_path: uploadData.path,\r\n            blob_url: uploadData.path,\r\n          }\r\n\r\n          const { data: insertedDoc, error: docError } = await supabase\r\n            .from(\"user_tender_documents\")\r\n            .insert(documentData)\r\n            .select()\r\n            .single()\r\n\r\n          if (docError) {\r\n            console.error(\"[v0] Error saving doc ref:\", docError)\r\n            documentError = \"Failed to save document reference\"\r\n          } else {\r\n            documentSaved = true\r\n          }\r\n        }\r\n      } catch (err: any) {\r\n        console.error(\"[v0] Upload error:\", err)\r\n        documentError = err.message\r\n      }\r\n    } else {\r\n      console.log(\"[v0] No file to upload\")\r\n    }\r\n\r\n    let analysisSaved = false\r\n    let analysisError: string | null = null\r\n    let orchestrationId: string | null = null\r\n\r\n    if (tenderData.analysis) {\r\n      console.log(\"[v0] Saving analysis data...\")\r\n\r\n      const analysisData = {\r\n        tender_id: customTender.id,\r\n        analysis_data: tenderData.analysis,\r\n      }\r\n\r\n      console.log(\"[v0] Inserting analysis with tender_id:\", customTender.id)\r\n\r\n      const { data: insertedAnalysis, error: analysisErr } = await supabase\r\n        .from(\"user_tender_analysis\") // Updated table name\r\n        .insert(analysisData)\r\n        .select()\r\n        .single()\r\n\r\n      if (analysisErr) {\r\n        console.error(\"[v0] Error saving analysis:\", analysisErr)\r\n        analysisError = analysisErr.message\r\n      } else {\r\n        console.log(\"[v0] Analysis saved successfully\")\r\n        analysisSaved = true\r\n\r\n        // Trigger multi-engine orchestration for deep analysis\r\n        console.log(\"[v0] Triggering multi-engine orchestration...\")\r\n        try {\r\n          // Get document URL if file was uploaded\r\n          let documentUrl: string | undefined\r\n          if (documentSaved) {\r\n            const { data: { publicUrl } } = supabase.storage\r\n              .from('tender-documents')\r\n              .getPublicUrl(uploadData?.path || '')\r\n            documentUrl = publicUrl\r\n          }\r\n\r\n          const orchestrationResult = await orchestrateTenderAnalysis(\r\n            customTender.id,\r\n            user.id,\r\n            documentUrl\r\n          )\r\n\r\n          orchestrationId = orchestrationResult.orchestrationId\r\n          console.log(`[v0] Orchestration started: ${orchestrationId}`)\r\n        } catch (orchError: any) {\r\n          console.error(\"[v0] Orchestration failed:\", orchError)\r\n          // Don't fail the entire operation if orchestration fails, just log it\r\n        }\r\n      }\r\n    } else {\r\n      console.log(\"[v0] No analysis data provided\")\r\n    }\r\n\r\n    // Return success with tender ID and orchestration ID\r\n    console.log(\"[v0] Returning success for tender:\", customTender.id)\r\n\r\n    revalidatePath(\"/dashboard/tenders\")\r\n    revalidatePath(\"/dashboard/custom-tenders\")\r\n\r\n    return {\r\n      success: true,\r\n      tenderId: customTender.id,\r\n      orchestrationId,\r\n      documentSaved,\r\n      documentError,\r\n      analysisSaved,\r\n      analysisError,\r\n    }\r\n  } catch (error) {\r\n    console.error(\"[v0] Error in createCustomTender:\", error)\r\n    return { success: false, error: \"Failed to create tender: \" + (error as Error).message }\r\n  }\r\n}\r\n\r\nexport async function getDashboardStats() {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  try {\r\n    // Get all tenders count for this user\r\n    const { count: totalTenders } = await supabase\r\n      .from(\"user_tenders\")\r\n      .select(\"*\", { count: \"exact\", head: true })\r\n      .eq(\"user_id\", user.id)\r\n\r\n    // Get analyzed tenders count (where we have analysis data)\r\n    // RLS ensures we only see our own analyses\r\n    const { count: analyzedCount } = await supabase\r\n      .from(\"user_tender_analysis\")\r\n      .select(\"tender_id\", { count: \"exact\", head: true })\r\n    // Wait, user_tender_analysis doesn't have user_id in my migration?\r\n    // Let's check migration script...\r\n    // user_custom_tender_analysis didn't have user_id in the original schema I saw in 031?\r\n    // L131: WHERE id = tender_id AND user_id = auth.uid() -> checking parent tender.\r\n    // So user_tender_analysis table assumes linking to user_tenders.\r\n    // query:\r\n    // select count(*) from user_tender_analysis join user_tenders on ... where user_tenders.user_id = ...\r\n\r\n    // Alternative: Just query user_tenders where tender_type='custom' (proxy for analyzed?)\r\n    // Or just fetching recent activity from unified table.\r\n\r\n    // Get recent activity (last 5 tenders)\r\n    const { data: recentTenders } = await supabase\r\n      .from(\"user_tenders\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", user.id)\r\n      .order(\"created_at\", { ascending: false })\r\n      .limit(5)\r\n\r\n    const recentActivity = (recentTenders || []).map((tender) => ({\r\n      id: tender.id,\r\n      title: tender.title,\r\n      organization: tender.organization,\r\n      type: tender.tender_type === \"custom\" ? (\"analyzed\" as const) : (\"saved\" as const),\r\n      created_at: tender.created_at,\r\n    }))\r\n\r\n    // Get tenders closing soon (next 7 days)\r\n    const sevenDaysFromNow = new Date()\r\n    sevenDaysFromNow.setDate(sevenDaysFromNow.getDate() + 7)\r\n\r\n    // Check both close_date (scraped) and deadline (custom, if parsed?)\r\n    // For now, relying on close_date. My migration copied deadline to close_date if I recall?\r\n    // No, I copied close_date to close_date. Custom tenders might rely on 'deadline' text column.\r\n    // This is tricky for sorting. Ideally we parse deadline to close_date.\r\n    // Assuming close_date is populated for meaningful deadlines.\r\n\r\n    const { data: closingSoon } = await supabase\r\n      .from(\"user_tenders\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", user.id)\r\n      .not(\"close_date\", \"is\", null)\r\n      .gte(\"close_date\", new Date().toISOString())\r\n      .lte(\"close_date\", sevenDaysFromNow.toISOString())\r\n      .order(\"close_date\", { ascending: true })\r\n      .limit(5)\r\n\r\n    return {\r\n      success: true,\r\n      stats: {\r\n        totalTenders: totalTenders || 0,\r\n        analyzedTenders: analyzedCount || 0, // This might be inaccurate without join, but acceptable for now or I can do a join query if needed.\r\n        // Actually, let's try to get substantial analyzed count if possible.\r\n        // For now 0 is fine or just count custom tenders?\r\n        closingSoon: closingSoon?.length || 0,\r\n        recentActivity,\r\n        upcomingDeadlines: closingSoon || [],\r\n      },\r\n    }\r\n  } catch (error) {\r\n    console.error(\"[v0] Error fetching dashboard stats:\", error)\r\n    return { success: false, error: \"Failed to fetch dashboard statistics\" }\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;IAwLsB,iBAAA,WAAA,GAAA,IAAA,wVAAA,EAAA,8CAAA,6UAAA,EAAA,KAAA,GAAA,mVAAA,EAAA"}},
    {"offset": {"line": 170, "column": 0}, "map": {"version":3,"sources":["file:///C:/Repo/LogsOfN/v0-bid-mate-ai/app/actions/tender-actions.ts"],"sourcesContent":["\"use server\"\r\n\r\nimport { createClient } from \"@/lib/supabase/server\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { PinTenderOptions } from \"@/lib/types\"\r\nimport { redirect } from \"next/navigation\"\r\nimport { AnalyzedTender } from \"@/lib/types/tender\"\r\nimport { orchestrateTenderAnalysis } from \"@/lib/engines/orchestrator/tender-orchestrator\"\r\n\r\n\r\nexport interface TenderDocument {\r\n  id?: string\r\n  title: string\r\n  url: string\r\n  documentType?: string\r\n  format?: string\r\n  description?: string\r\n}\r\n\r\nexport interface TenderData {\r\n  tenderId: string\r\n  title: string\r\n  organization: string\r\n  publishDate?: string\r\n  closeDate?: string\r\n  value?: string\r\n  category?: string\r\n  description?: string\r\n  url?: string\r\n  documents?: TenderDocument[] // Add documents array\r\n}\r\n\r\nexport async function addTenderToUser(tenderData: TenderData) {\r\n  const supabase = await createClient()\r\n\r\n  // Get current user\r\n  const {\r\n    data: { user },\r\n    error: userError,\r\n  } = await supabase.auth.getUser()\r\n\r\n  if (userError || !user) {\r\n    return { success: false, error: \"Not authenticated\" }\r\n  }\r\n\r\n  // Insert tender\r\n  const { data, error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .insert({\r\n      user_id: user.id,\r\n      tender_id: tenderData.tenderId,\r\n      title: tenderData.title,\r\n      organization: tenderData.organization,\r\n      publish_date: tenderData.publishDate,\r\n      close_date: tenderData.closeDate,\r\n      value: tenderData.value,\r\n      category: tenderData.category,\r\n      description: tenderData.description,\r\n      url: tenderData.url,\r\n      status: \"draft\",\r\n    })\r\n    .select()\r\n    .single()\r\n\r\n  if (error) {\r\n    // Check if it's a duplicate\r\n    if (error.code === \"23505\") {\r\n      return { success: false, error: \"Tender already added\" }\r\n    }\r\n    console.error(\"[v0] Error adding tender:\", error)\r\n    return { success: false, error: \"Failed to add tender\" }\r\n  }\r\n\r\n  if (tenderData.documents && tenderData.documents.length > 0 && data) {\r\n    console.log(\"[v0] Adding\", tenderData.documents.length, \"documents to tender\", data.id)\r\n    console.log(\"[v0] Document data:\", JSON.stringify(tenderData.documents, null, 2))\r\n\r\n    const documentsToInsert = tenderData.documents.map((doc) => ({\r\n      user_tender_id: data.id, // Changed from tender_id\r\n      user_id: user.id,\r\n      file_name: doc.title, // Changed from name\r\n      storage_path: doc.url, // Changed from file_url - external URLs stored as storage_path\r\n      file_type: doc.format || \"application/pdf\",\r\n      file_size: 0, // Unknown size for external documents\r\n      // Removed document_type and description as they don't exist in schema\r\n    }))\r\n\r\n    console.log(\"[v0] Inserting documents:\", JSON.stringify(documentsToInsert, null, 2))\r\n\r\n    const { data: insertedDocs, error: docsError } = await supabase\r\n      .from(\"tender_documents\")\r\n      .insert(documentsToInsert)\r\n      .select()\r\n\r\n    if (docsError) {\r\n      console.error(\"[v0] Error adding documents:\", docsError)\r\n      console.error(\"[v0] Error details:\", JSON.stringify(docsError, null, 2))\r\n      // Don't fail the whole operation if documents fail, just log it\r\n    } else {\r\n      console.log(\"[v0] Successfully added\", insertedDocs?.length || 0, \"documents\")\r\n      console.log(\r\n        \"[v0] Inserted document IDs:\",\r\n        insertedDocs?.map((d) => d.id),\r\n      )\r\n    }\r\n  } else {\r\n    console.log(\"[v0] No documents to add for this tender\")\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  return { success: true, data }\r\n}\r\n\r\nexport async function toggleTenderPin(tenderId: string, isPinned: boolean) {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  const { error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .update({ is_pinned: isPinned })\r\n    .eq(\"id\", tenderId)\r\n    .eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error toggling pin:\", error)\r\n    return { success: false, error: \"Failed to update tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  revalidatePath(\"/dashboard/search\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function toggleTenderFavourite(tenderId: string, isFavourited: boolean) {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  const { error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .update({ is_favourited: isFavourited })\r\n    .eq(\"id\", tenderId)\r\n    .eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error toggling favourite:\", error)\r\n    return { success: false, error: \"Failed to update tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  revalidatePath(\"/dashboard/search\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function toggleTenderWishlist(tenderId: string, isWishlisted: boolean) {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  const { error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .update({ is_wishlisted: isWishlisted })\r\n    .eq(\"id\", tenderId)\r\n    .eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error toggling wishlist:\", error)\r\n    return { success: false, error: \"Failed to update tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function getUserTenders() {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\", tenders: [] }\r\n\r\n  // Fetch all tenders from user_tenders (both scraped and custom)\r\n  const { data: tenders, error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .select(\"*\")\r\n    .eq(\"user_id\", user.id)\r\n    .order(\"created_at\", { ascending: false })\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error fetching tenders:\", error)\r\n    return { success: false, error: \"Failed to fetch tenders\", tenders: [] }\r\n  }\r\n\r\n  // Normalize data for frontend\r\n  const normalizedTenders = (tenders || []).map((tender) => ({\r\n    id: tender.id,\r\n    tender_id: tender.tender_id || `custom-${tender.id}`, // Fallback for custom tenders\r\n    title: tender.title,\r\n    organization: tender.organization,\r\n    status: tender.status,\r\n    close_date: tender.close_date || tender.deadline, // Use deadline if close_date is null\r\n    value: tender.value,\r\n    category: tender.category,\r\n    is_pinned: tender.is_pinned || false,\r\n    is_favourited: tender.is_favourited || false,\r\n    is_wishlisted: tender.is_wishlisted || false,\r\n    created_at: tender.created_at,\r\n    tender_type: tender.tender_type || \"scraped\", // Default to scraped if null\r\n    location: tender.location,\r\n  }))\r\n\r\n  return { success: true, tenders: normalizedTenders }\r\n}\r\n\r\nexport async function deleteTender(tenderId: string, tenderType?: \"scraped\" | \"custom\") {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  // Simply delete from user_tenders table\r\n  const { error } = await supabase.from(\"user_tenders\").delete().eq(\"id\", tenderId).eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error deleting tender:\", error)\r\n    return { success: false, error: \"Failed to delete tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function saveScrapedTenderToUser(scrapedTender: {\r\n  id: string\r\n  title: string\r\n  source_name: string\r\n  description?: string\r\n  publish_date?: string\r\n  close_date?: string\r\n  estimated_value?: string\r\n  category?: string\r\n  tender_url?: string\r\n}) {\r\n  const supabase = await createClient()\r\n\r\n  // Get current user\r\n  const {\r\n    data: { user },\r\n    error: userError,\r\n  } = await supabase.auth.getUser()\r\n\r\n  if (userError || !user) {\r\n    return { success: false, error: \"Not authenticated\" }\r\n  }\r\n\r\n  // Check if tender already exists for this user\r\n  const { data: existing } = await supabase\r\n    .from(\"user_tenders\")\r\n    .select(\"id, status\")\r\n    .eq(\"user_id\", user.id)\r\n    .eq(\"tender_id\", scrapedTender.id)\r\n    .single()\r\n\r\n  if (existing) {\r\n    // If already exists and is draft, update to in-progress\r\n    if (existing.status === \"draft\") {\r\n      const { error: updateError } = await supabase\r\n        .from(\"user_tenders\")\r\n        .update({ status: \"in-progress\" })\r\n        .eq(\"id\", existing.id)\r\n\r\n      if (updateError) {\r\n        console.error(\"[v0] Error updating tender status:\", updateError)\r\n        return { success: false, error: \"Failed to update tender status\" }\r\n      }\r\n\r\n      revalidatePath(\"/dashboard/tenders\")\r\n      return { success: true, message: \"Tender status updated to in-progress\", isNew: false }\r\n    }\r\n\r\n    // Already exists and not draft, no need to update\r\n    return { success: true, message: \"Tender already in your list\", isNew: false }\r\n  }\r\n\r\n  // Insert new tender with in-progress status\r\n  const { data, error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .insert({\r\n      user_id: user.id,\r\n      tender_id: scrapedTender.id,\r\n      title: scrapedTender.title,\r\n      organization: scrapedTender.source_name,\r\n      publish_date: scrapedTender.publish_date,\r\n      close_date: scrapedTender.close_date,\r\n      value: scrapedTender.estimated_value,\r\n      category: scrapedTender.category,\r\n      description: scrapedTender.description,\r\n      url: scrapedTender.tender_url,\r\n      status: \"in-progress\",\r\n      tender_type: \"scraped\",\r\n    })\r\n    .select()\r\n    .single()\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error saving tender:\", error)\r\n    return { success: false, error: \"Failed to save tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  return { success: true, message: \"Tender saved to My Tenders\", isNew: true, data }\r\n}\r\n\r\nexport async function createCustomTender(tenderData: {\r\n  title: string\r\n  organization: string\r\n  deadline: string\r\n  value: string\r\n  description: string\r\n  category?: string\r\n  location?: string\r\n  uploadedFile?: File\r\n  analysis?: any\r\n}) {\r\n  console.log(\"[v0] createCustomTender called with data:\", {\r\n    title: tenderData.title,\r\n    organization: tenderData.organization,\r\n    deadline: tenderData.deadline,\r\n    hasFile: !!tenderData.uploadedFile,\r\n    hasAnalysis: !!tenderData.analysis,\r\n  })\r\n\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n    error: userError,\r\n  } = await supabase.auth.getUser()\r\n\r\n  if (userError || !user) {\r\n    console.error(\"[v0] Auth error:\", userError)\r\n    return { success: false, error: \"Not authenticated\" }\r\n  }\r\n\r\n  console.log(\"[v0] User authenticated:\", user.id)\r\n\r\n  try {\r\n    console.log(\"[v0] Creating custom tender record...\")\r\n\r\n    const { data: customTender, error: customTenderError } = await supabase\r\n      .from(\"user_tenders\")\r\n      .insert({\r\n        user_id: user.id,\r\n        title: tenderData.title,\r\n        organization: tenderData.organization,\r\n        deadline: tenderData.deadline,\r\n        value: tenderData.value,\r\n        category: tenderData.category || \"Custom\",\r\n        description: tenderData.description,\r\n        location: tenderData.location,\r\n        status: \"in-progress\",\r\n        tender_type: \"custom\",\r\n      })\r\n      .select()\r\n      .single()\r\n\r\n    if (customTenderError) {\r\n      console.error(\"[v0] Error creating custom tender:\", customTenderError)\r\n      return { success: false, error: \"Failed to create tender: \" + customTenderError.message }\r\n    }\r\n\r\n    console.log(\"[v0] Custom tender created successfully:\", customTender.id)\r\n\r\n    let documentSaved = false\r\n    let documentError: string | null = null\r\n    let uploadData: any = null // Declare uploadData here to be accessible later\r\n\r\n    if (tenderData.uploadedFile) {\r\n      console.log(\"[v0] Processing existing document...\")\r\n\r\n      try {\r\n        const file = tenderData.uploadedFile\r\n        const fileName = `${user.id}/${customTender.id}/${file.name}`\r\n\r\n        const { data: uploaded, error: uploadError } = await supabase.storage\r\n          .from(\"tender-documents\")\r\n          .upload(fileName, file)\r\n        uploadData = uploaded // Assign to the outer scope variable\r\n\r\n        if (uploadError) {\r\n          console.error(\"[v0] Error uploading file to Supabase:\", uploadError)\r\n          documentError = \"Failed to upload file to permanent storage\"\r\n        } else {\r\n          const documentData = {\r\n            tender_id: customTender.id,\r\n            file_name: file.name,\r\n            file_type: file.type,\r\n            file_size: file.size,\r\n            storage_path: uploadData.path,\r\n            blob_url: uploadData.path,\r\n          }\r\n\r\n          const { data: insertedDoc, error: docError } = await supabase\r\n            .from(\"user_tender_documents\")\r\n            .insert(documentData)\r\n            .select()\r\n            .single()\r\n\r\n          if (docError) {\r\n            console.error(\"[v0] Error saving doc ref:\", docError)\r\n            documentError = \"Failed to save document reference\"\r\n          } else {\r\n            documentSaved = true\r\n          }\r\n        }\r\n      } catch (err: any) {\r\n        console.error(\"[v0] Upload error:\", err)\r\n        documentError = err.message\r\n      }\r\n    } else {\r\n      console.log(\"[v0] No file to upload\")\r\n    }\r\n\r\n    let analysisSaved = false\r\n    let analysisError: string | null = null\r\n    let orchestrationId: string | null = null\r\n\r\n    if (tenderData.analysis) {\r\n      console.log(\"[v0] Saving analysis data...\")\r\n\r\n      const analysisData = {\r\n        tender_id: customTender.id,\r\n        analysis_data: tenderData.analysis,\r\n      }\r\n\r\n      console.log(\"[v0] Inserting analysis with tender_id:\", customTender.id)\r\n\r\n      const { data: insertedAnalysis, error: analysisErr } = await supabase\r\n        .from(\"user_tender_analysis\") // Updated table name\r\n        .insert(analysisData)\r\n        .select()\r\n        .single()\r\n\r\n      if (analysisErr) {\r\n        console.error(\"[v0] Error saving analysis:\", analysisErr)\r\n        analysisError = analysisErr.message\r\n      } else {\r\n        console.log(\"[v0] Analysis saved successfully\")\r\n        analysisSaved = true\r\n\r\n        // Trigger multi-engine orchestration for deep analysis\r\n        console.log(\"[v0] Triggering multi-engine orchestration...\")\r\n        try {\r\n          // Get document URL if file was uploaded\r\n          let documentUrl: string | undefined\r\n          if (documentSaved) {\r\n            const { data: { publicUrl } } = supabase.storage\r\n              .from('tender-documents')\r\n              .getPublicUrl(uploadData?.path || '')\r\n            documentUrl = publicUrl\r\n          }\r\n\r\n          const orchestrationResult = await orchestrateTenderAnalysis(\r\n            customTender.id,\r\n            user.id,\r\n            documentUrl\r\n          )\r\n\r\n          orchestrationId = orchestrationResult.orchestrationId\r\n          console.log(`[v0] Orchestration started: ${orchestrationId}`)\r\n        } catch (orchError: any) {\r\n          console.error(\"[v0] Orchestration failed:\", orchError)\r\n          // Don't fail the entire operation if orchestration fails, just log it\r\n        }\r\n      }\r\n    } else {\r\n      console.log(\"[v0] No analysis data provided\")\r\n    }\r\n\r\n    // Return success with tender ID and orchestration ID\r\n    console.log(\"[v0] Returning success for tender:\", customTender.id)\r\n\r\n    revalidatePath(\"/dashboard/tenders\")\r\n    revalidatePath(\"/dashboard/custom-tenders\")\r\n\r\n    return {\r\n      success: true,\r\n      tenderId: customTender.id,\r\n      orchestrationId,\r\n      documentSaved,\r\n      documentError,\r\n      analysisSaved,\r\n      analysisError,\r\n    }\r\n  } catch (error) {\r\n    console.error(\"[v0] Error in createCustomTender:\", error)\r\n    return { success: false, error: \"Failed to create tender: \" + (error as Error).message }\r\n  }\r\n}\r\n\r\nexport async function getDashboardStats() {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  try {\r\n    // Get all tenders count for this user\r\n    const { count: totalTenders } = await supabase\r\n      .from(\"user_tenders\")\r\n      .select(\"*\", { count: \"exact\", head: true })\r\n      .eq(\"user_id\", user.id)\r\n\r\n    // Get analyzed tenders count (where we have analysis data)\r\n    // RLS ensures we only see our own analyses\r\n    const { count: analyzedCount } = await supabase\r\n      .from(\"user_tender_analysis\")\r\n      .select(\"tender_id\", { count: \"exact\", head: true })\r\n    // Wait, user_tender_analysis doesn't have user_id in my migration?\r\n    // Let's check migration script...\r\n    // user_custom_tender_analysis didn't have user_id in the original schema I saw in 031?\r\n    // L131: WHERE id = tender_id AND user_id = auth.uid() -> checking parent tender.\r\n    // So user_tender_analysis table assumes linking to user_tenders.\r\n    // query:\r\n    // select count(*) from user_tender_analysis join user_tenders on ... where user_tenders.user_id = ...\r\n\r\n    // Alternative: Just query user_tenders where tender_type='custom' (proxy for analyzed?)\r\n    // Or just fetching recent activity from unified table.\r\n\r\n    // Get recent activity (last 5 tenders)\r\n    const { data: recentTenders } = await supabase\r\n      .from(\"user_tenders\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", user.id)\r\n      .order(\"created_at\", { ascending: false })\r\n      .limit(5)\r\n\r\n    const recentActivity = (recentTenders || []).map((tender) => ({\r\n      id: tender.id,\r\n      title: tender.title,\r\n      organization: tender.organization,\r\n      type: tender.tender_type === \"custom\" ? (\"analyzed\" as const) : (\"saved\" as const),\r\n      created_at: tender.created_at,\r\n    }))\r\n\r\n    // Get tenders closing soon (next 7 days)\r\n    const sevenDaysFromNow = new Date()\r\n    sevenDaysFromNow.setDate(sevenDaysFromNow.getDate() + 7)\r\n\r\n    // Check both close_date (scraped) and deadline (custom, if parsed?)\r\n    // For now, relying on close_date. My migration copied deadline to close_date if I recall?\r\n    // No, I copied close_date to close_date. Custom tenders might rely on 'deadline' text column.\r\n    // This is tricky for sorting. Ideally we parse deadline to close_date.\r\n    // Assuming close_date is populated for meaningful deadlines.\r\n\r\n    const { data: closingSoon } = await supabase\r\n      .from(\"user_tenders\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", user.id)\r\n      .not(\"close_date\", \"is\", null)\r\n      .gte(\"close_date\", new Date().toISOString())\r\n      .lte(\"close_date\", sevenDaysFromNow.toISOString())\r\n      .order(\"close_date\", { ascending: true })\r\n      .limit(5)\r\n\r\n    return {\r\n      success: true,\r\n      stats: {\r\n        totalTenders: totalTenders || 0,\r\n        analyzedTenders: analyzedCount || 0, // This might be inaccurate without join, but acceptable for now or I can do a join query if needed.\r\n        // Actually, let's try to get substantial analyzed count if possible.\r\n        // For now 0 is fine or just count custom tenders?\r\n        closingSoon: closingSoon?.length || 0,\r\n        recentActivity,\r\n        upcomingDeadlines: closingSoon || [],\r\n      },\r\n    }\r\n  } catch (error) {\r\n    console.error(\"[v0] Error fetching dashboard stats:\", error)\r\n    return { success: false, error: \"Failed to fetch dashboard statistics\" }\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;IAiOsB,eAAA,WAAA,GAAA,IAAA,wVAAA,EAAA,8CAAA,6UAAA,EAAA,KAAA,GAAA,mVAAA,EAAA"}},
    {"offset": {"line": 185, "column": 0}, "map": {"version":3,"sources":["file:///C:/Repo/LogsOfN/v0-bid-mate-ai/app/actions/tender-actions.ts"],"sourcesContent":["\"use server\"\r\n\r\nimport { createClient } from \"@/lib/supabase/server\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { PinTenderOptions } from \"@/lib/types\"\r\nimport { redirect } from \"next/navigation\"\r\nimport { AnalyzedTender } from \"@/lib/types/tender\"\r\nimport { orchestrateTenderAnalysis } from \"@/lib/engines/orchestrator/tender-orchestrator\"\r\n\r\n\r\nexport interface TenderDocument {\r\n  id?: string\r\n  title: string\r\n  url: string\r\n  documentType?: string\r\n  format?: string\r\n  description?: string\r\n}\r\n\r\nexport interface TenderData {\r\n  tenderId: string\r\n  title: string\r\n  organization: string\r\n  publishDate?: string\r\n  closeDate?: string\r\n  value?: string\r\n  category?: string\r\n  description?: string\r\n  url?: string\r\n  documents?: TenderDocument[] // Add documents array\r\n}\r\n\r\nexport async function addTenderToUser(tenderData: TenderData) {\r\n  const supabase = await createClient()\r\n\r\n  // Get current user\r\n  const {\r\n    data: { user },\r\n    error: userError,\r\n  } = await supabase.auth.getUser()\r\n\r\n  if (userError || !user) {\r\n    return { success: false, error: \"Not authenticated\" }\r\n  }\r\n\r\n  // Insert tender\r\n  const { data, error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .insert({\r\n      user_id: user.id,\r\n      tender_id: tenderData.tenderId,\r\n      title: tenderData.title,\r\n      organization: tenderData.organization,\r\n      publish_date: tenderData.publishDate,\r\n      close_date: tenderData.closeDate,\r\n      value: tenderData.value,\r\n      category: tenderData.category,\r\n      description: tenderData.description,\r\n      url: tenderData.url,\r\n      status: \"draft\",\r\n    })\r\n    .select()\r\n    .single()\r\n\r\n  if (error) {\r\n    // Check if it's a duplicate\r\n    if (error.code === \"23505\") {\r\n      return { success: false, error: \"Tender already added\" }\r\n    }\r\n    console.error(\"[v0] Error adding tender:\", error)\r\n    return { success: false, error: \"Failed to add tender\" }\r\n  }\r\n\r\n  if (tenderData.documents && tenderData.documents.length > 0 && data) {\r\n    console.log(\"[v0] Adding\", tenderData.documents.length, \"documents to tender\", data.id)\r\n    console.log(\"[v0] Document data:\", JSON.stringify(tenderData.documents, null, 2))\r\n\r\n    const documentsToInsert = tenderData.documents.map((doc) => ({\r\n      user_tender_id: data.id, // Changed from tender_id\r\n      user_id: user.id,\r\n      file_name: doc.title, // Changed from name\r\n      storage_path: doc.url, // Changed from file_url - external URLs stored as storage_path\r\n      file_type: doc.format || \"application/pdf\",\r\n      file_size: 0, // Unknown size for external documents\r\n      // Removed document_type and description as they don't exist in schema\r\n    }))\r\n\r\n    console.log(\"[v0] Inserting documents:\", JSON.stringify(documentsToInsert, null, 2))\r\n\r\n    const { data: insertedDocs, error: docsError } = await supabase\r\n      .from(\"tender_documents\")\r\n      .insert(documentsToInsert)\r\n      .select()\r\n\r\n    if (docsError) {\r\n      console.error(\"[v0] Error adding documents:\", docsError)\r\n      console.error(\"[v0] Error details:\", JSON.stringify(docsError, null, 2))\r\n      // Don't fail the whole operation if documents fail, just log it\r\n    } else {\r\n      console.log(\"[v0] Successfully added\", insertedDocs?.length || 0, \"documents\")\r\n      console.log(\r\n        \"[v0] Inserted document IDs:\",\r\n        insertedDocs?.map((d) => d.id),\r\n      )\r\n    }\r\n  } else {\r\n    console.log(\"[v0] No documents to add for this tender\")\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  return { success: true, data }\r\n}\r\n\r\nexport async function toggleTenderPin(tenderId: string, isPinned: boolean) {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  const { error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .update({ is_pinned: isPinned })\r\n    .eq(\"id\", tenderId)\r\n    .eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error toggling pin:\", error)\r\n    return { success: false, error: \"Failed to update tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  revalidatePath(\"/dashboard/search\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function toggleTenderFavourite(tenderId: string, isFavourited: boolean) {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  const { error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .update({ is_favourited: isFavourited })\r\n    .eq(\"id\", tenderId)\r\n    .eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error toggling favourite:\", error)\r\n    return { success: false, error: \"Failed to update tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  revalidatePath(\"/dashboard/search\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function toggleTenderWishlist(tenderId: string, isWishlisted: boolean) {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  const { error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .update({ is_wishlisted: isWishlisted })\r\n    .eq(\"id\", tenderId)\r\n    .eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error toggling wishlist:\", error)\r\n    return { success: false, error: \"Failed to update tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function getUserTenders() {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\", tenders: [] }\r\n\r\n  // Fetch all tenders from user_tenders (both scraped and custom)\r\n  const { data: tenders, error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .select(\"*\")\r\n    .eq(\"user_id\", user.id)\r\n    .order(\"created_at\", { ascending: false })\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error fetching tenders:\", error)\r\n    return { success: false, error: \"Failed to fetch tenders\", tenders: [] }\r\n  }\r\n\r\n  // Normalize data for frontend\r\n  const normalizedTenders = (tenders || []).map((tender) => ({\r\n    id: tender.id,\r\n    tender_id: tender.tender_id || `custom-${tender.id}`, // Fallback for custom tenders\r\n    title: tender.title,\r\n    organization: tender.organization,\r\n    status: tender.status,\r\n    close_date: tender.close_date || tender.deadline, // Use deadline if close_date is null\r\n    value: tender.value,\r\n    category: tender.category,\r\n    is_pinned: tender.is_pinned || false,\r\n    is_favourited: tender.is_favourited || false,\r\n    is_wishlisted: tender.is_wishlisted || false,\r\n    created_at: tender.created_at,\r\n    tender_type: tender.tender_type || \"scraped\", // Default to scraped if null\r\n    location: tender.location,\r\n  }))\r\n\r\n  return { success: true, tenders: normalizedTenders }\r\n}\r\n\r\nexport async function deleteTender(tenderId: string, tenderType?: \"scraped\" | \"custom\") {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  // Simply delete from user_tenders table\r\n  const { error } = await supabase.from(\"user_tenders\").delete().eq(\"id\", tenderId).eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error deleting tender:\", error)\r\n    return { success: false, error: \"Failed to delete tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function saveScrapedTenderToUser(scrapedTender: {\r\n  id: string\r\n  title: string\r\n  source_name: string\r\n  description?: string\r\n  publish_date?: string\r\n  close_date?: string\r\n  estimated_value?: string\r\n  category?: string\r\n  tender_url?: string\r\n}) {\r\n  const supabase = await createClient()\r\n\r\n  // Get current user\r\n  const {\r\n    data: { user },\r\n    error: userError,\r\n  } = await supabase.auth.getUser()\r\n\r\n  if (userError || !user) {\r\n    return { success: false, error: \"Not authenticated\" }\r\n  }\r\n\r\n  // Check if tender already exists for this user\r\n  const { data: existing } = await supabase\r\n    .from(\"user_tenders\")\r\n    .select(\"id, status\")\r\n    .eq(\"user_id\", user.id)\r\n    .eq(\"tender_id\", scrapedTender.id)\r\n    .single()\r\n\r\n  if (existing) {\r\n    // If already exists and is draft, update to in-progress\r\n    if (existing.status === \"draft\") {\r\n      const { error: updateError } = await supabase\r\n        .from(\"user_tenders\")\r\n        .update({ status: \"in-progress\" })\r\n        .eq(\"id\", existing.id)\r\n\r\n      if (updateError) {\r\n        console.error(\"[v0] Error updating tender status:\", updateError)\r\n        return { success: false, error: \"Failed to update tender status\" }\r\n      }\r\n\r\n      revalidatePath(\"/dashboard/tenders\")\r\n      return { success: true, message: \"Tender status updated to in-progress\", isNew: false }\r\n    }\r\n\r\n    // Already exists and not draft, no need to update\r\n    return { success: true, message: \"Tender already in your list\", isNew: false }\r\n  }\r\n\r\n  // Insert new tender with in-progress status\r\n  const { data, error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .insert({\r\n      user_id: user.id,\r\n      tender_id: scrapedTender.id,\r\n      title: scrapedTender.title,\r\n      organization: scrapedTender.source_name,\r\n      publish_date: scrapedTender.publish_date,\r\n      close_date: scrapedTender.close_date,\r\n      value: scrapedTender.estimated_value,\r\n      category: scrapedTender.category,\r\n      description: scrapedTender.description,\r\n      url: scrapedTender.tender_url,\r\n      status: \"in-progress\",\r\n      tender_type: \"scraped\",\r\n    })\r\n    .select()\r\n    .single()\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error saving tender:\", error)\r\n    return { success: false, error: \"Failed to save tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  return { success: true, message: \"Tender saved to My Tenders\", isNew: true, data }\r\n}\r\n\r\nexport async function createCustomTender(tenderData: {\r\n  title: string\r\n  organization: string\r\n  deadline: string\r\n  value: string\r\n  description: string\r\n  category?: string\r\n  location?: string\r\n  uploadedFile?: File\r\n  analysis?: any\r\n}) {\r\n  console.log(\"[v0] createCustomTender called with data:\", {\r\n    title: tenderData.title,\r\n    organization: tenderData.organization,\r\n    deadline: tenderData.deadline,\r\n    hasFile: !!tenderData.uploadedFile,\r\n    hasAnalysis: !!tenderData.analysis,\r\n  })\r\n\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n    error: userError,\r\n  } = await supabase.auth.getUser()\r\n\r\n  if (userError || !user) {\r\n    console.error(\"[v0] Auth error:\", userError)\r\n    return { success: false, error: \"Not authenticated\" }\r\n  }\r\n\r\n  console.log(\"[v0] User authenticated:\", user.id)\r\n\r\n  try {\r\n    console.log(\"[v0] Creating custom tender record...\")\r\n\r\n    const { data: customTender, error: customTenderError } = await supabase\r\n      .from(\"user_tenders\")\r\n      .insert({\r\n        user_id: user.id,\r\n        title: tenderData.title,\r\n        organization: tenderData.organization,\r\n        deadline: tenderData.deadline,\r\n        value: tenderData.value,\r\n        category: tenderData.category || \"Custom\",\r\n        description: tenderData.description,\r\n        location: tenderData.location,\r\n        status: \"in-progress\",\r\n        tender_type: \"custom\",\r\n      })\r\n      .select()\r\n      .single()\r\n\r\n    if (customTenderError) {\r\n      console.error(\"[v0] Error creating custom tender:\", customTenderError)\r\n      return { success: false, error: \"Failed to create tender: \" + customTenderError.message }\r\n    }\r\n\r\n    console.log(\"[v0] Custom tender created successfully:\", customTender.id)\r\n\r\n    let documentSaved = false\r\n    let documentError: string | null = null\r\n    let uploadData: any = null // Declare uploadData here to be accessible later\r\n\r\n    if (tenderData.uploadedFile) {\r\n      console.log(\"[v0] Processing existing document...\")\r\n\r\n      try {\r\n        const file = tenderData.uploadedFile\r\n        const fileName = `${user.id}/${customTender.id}/${file.name}`\r\n\r\n        const { data: uploaded, error: uploadError } = await supabase.storage\r\n          .from(\"tender-documents\")\r\n          .upload(fileName, file)\r\n        uploadData = uploaded // Assign to the outer scope variable\r\n\r\n        if (uploadError) {\r\n          console.error(\"[v0] Error uploading file to Supabase:\", uploadError)\r\n          documentError = \"Failed to upload file to permanent storage\"\r\n        } else {\r\n          const documentData = {\r\n            tender_id: customTender.id,\r\n            file_name: file.name,\r\n            file_type: file.type,\r\n            file_size: file.size,\r\n            storage_path: uploadData.path,\r\n            blob_url: uploadData.path,\r\n          }\r\n\r\n          const { data: insertedDoc, error: docError } = await supabase\r\n            .from(\"user_tender_documents\")\r\n            .insert(documentData)\r\n            .select()\r\n            .single()\r\n\r\n          if (docError) {\r\n            console.error(\"[v0] Error saving doc ref:\", docError)\r\n            documentError = \"Failed to save document reference\"\r\n          } else {\r\n            documentSaved = true\r\n          }\r\n        }\r\n      } catch (err: any) {\r\n        console.error(\"[v0] Upload error:\", err)\r\n        documentError = err.message\r\n      }\r\n    } else {\r\n      console.log(\"[v0] No file to upload\")\r\n    }\r\n\r\n    let analysisSaved = false\r\n    let analysisError: string | null = null\r\n    let orchestrationId: string | null = null\r\n\r\n    if (tenderData.analysis) {\r\n      console.log(\"[v0] Saving analysis data...\")\r\n\r\n      const analysisData = {\r\n        tender_id: customTender.id,\r\n        analysis_data: tenderData.analysis,\r\n      }\r\n\r\n      console.log(\"[v0] Inserting analysis with tender_id:\", customTender.id)\r\n\r\n      const { data: insertedAnalysis, error: analysisErr } = await supabase\r\n        .from(\"user_tender_analysis\") // Updated table name\r\n        .insert(analysisData)\r\n        .select()\r\n        .single()\r\n\r\n      if (analysisErr) {\r\n        console.error(\"[v0] Error saving analysis:\", analysisErr)\r\n        analysisError = analysisErr.message\r\n      } else {\r\n        console.log(\"[v0] Analysis saved successfully\")\r\n        analysisSaved = true\r\n\r\n        // Trigger multi-engine orchestration for deep analysis\r\n        console.log(\"[v0] Triggering multi-engine orchestration...\")\r\n        try {\r\n          // Get document URL if file was uploaded\r\n          let documentUrl: string | undefined\r\n          if (documentSaved) {\r\n            const { data: { publicUrl } } = supabase.storage\r\n              .from('tender-documents')\r\n              .getPublicUrl(uploadData?.path || '')\r\n            documentUrl = publicUrl\r\n          }\r\n\r\n          const orchestrationResult = await orchestrateTenderAnalysis(\r\n            customTender.id,\r\n            user.id,\r\n            documentUrl\r\n          )\r\n\r\n          orchestrationId = orchestrationResult.orchestrationId\r\n          console.log(`[v0] Orchestration started: ${orchestrationId}`)\r\n        } catch (orchError: any) {\r\n          console.error(\"[v0] Orchestration failed:\", orchError)\r\n          // Don't fail the entire operation if orchestration fails, just log it\r\n        }\r\n      }\r\n    } else {\r\n      console.log(\"[v0] No analysis data provided\")\r\n    }\r\n\r\n    // Return success with tender ID and orchestration ID\r\n    console.log(\"[v0] Returning success for tender:\", customTender.id)\r\n\r\n    revalidatePath(\"/dashboard/tenders\")\r\n    revalidatePath(\"/dashboard/custom-tenders\")\r\n\r\n    return {\r\n      success: true,\r\n      tenderId: customTender.id,\r\n      orchestrationId,\r\n      documentSaved,\r\n      documentError,\r\n      analysisSaved,\r\n      analysisError,\r\n    }\r\n  } catch (error) {\r\n    console.error(\"[v0] Error in createCustomTender:\", error)\r\n    return { success: false, error: \"Failed to create tender: \" + (error as Error).message }\r\n  }\r\n}\r\n\r\nexport async function getDashboardStats() {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  try {\r\n    // Get all tenders count for this user\r\n    const { count: totalTenders } = await supabase\r\n      .from(\"user_tenders\")\r\n      .select(\"*\", { count: \"exact\", head: true })\r\n      .eq(\"user_id\", user.id)\r\n\r\n    // Get analyzed tenders count (where we have analysis data)\r\n    // RLS ensures we only see our own analyses\r\n    const { count: analyzedCount } = await supabase\r\n      .from(\"user_tender_analysis\")\r\n      .select(\"tender_id\", { count: \"exact\", head: true })\r\n    // Wait, user_tender_analysis doesn't have user_id in my migration?\r\n    // Let's check migration script...\r\n    // user_custom_tender_analysis didn't have user_id in the original schema I saw in 031?\r\n    // L131: WHERE id = tender_id AND user_id = auth.uid() -> checking parent tender.\r\n    // So user_tender_analysis table assumes linking to user_tenders.\r\n    // query:\r\n    // select count(*) from user_tender_analysis join user_tenders on ... where user_tenders.user_id = ...\r\n\r\n    // Alternative: Just query user_tenders where tender_type='custom' (proxy for analyzed?)\r\n    // Or just fetching recent activity from unified table.\r\n\r\n    // Get recent activity (last 5 tenders)\r\n    const { data: recentTenders } = await supabase\r\n      .from(\"user_tenders\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", user.id)\r\n      .order(\"created_at\", { ascending: false })\r\n      .limit(5)\r\n\r\n    const recentActivity = (recentTenders || []).map((tender) => ({\r\n      id: tender.id,\r\n      title: tender.title,\r\n      organization: tender.organization,\r\n      type: tender.tender_type === \"custom\" ? (\"analyzed\" as const) : (\"saved\" as const),\r\n      created_at: tender.created_at,\r\n    }))\r\n\r\n    // Get tenders closing soon (next 7 days)\r\n    const sevenDaysFromNow = new Date()\r\n    sevenDaysFromNow.setDate(sevenDaysFromNow.getDate() + 7)\r\n\r\n    // Check both close_date (scraped) and deadline (custom, if parsed?)\r\n    // For now, relying on close_date. My migration copied deadline to close_date if I recall?\r\n    // No, I copied close_date to close_date. Custom tenders might rely on 'deadline' text column.\r\n    // This is tricky for sorting. Ideally we parse deadline to close_date.\r\n    // Assuming close_date is populated for meaningful deadlines.\r\n\r\n    const { data: closingSoon } = await supabase\r\n      .from(\"user_tenders\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", user.id)\r\n      .not(\"close_date\", \"is\", null)\r\n      .gte(\"close_date\", new Date().toISOString())\r\n      .lte(\"close_date\", sevenDaysFromNow.toISOString())\r\n      .order(\"close_date\", { ascending: true })\r\n      .limit(5)\r\n\r\n    return {\r\n      success: true,\r\n      stats: {\r\n        totalTenders: totalTenders || 0,\r\n        analyzedTenders: analyzedCount || 0, // This might be inaccurate without join, but acceptable for now or I can do a join query if needed.\r\n        // Actually, let's try to get substantial analyzed count if possible.\r\n        // For now 0 is fine or just count custom tenders?\r\n        closingSoon: closingSoon?.length || 0,\r\n        recentActivity,\r\n        upcomingDeadlines: closingSoon || [],\r\n      },\r\n    }\r\n  } catch (error) {\r\n    console.error(\"[v0] Error fetching dashboard stats:\", error)\r\n    return { success: false, error: \"Failed to fetch dashboard statistics\" }\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;IAiHsB,kBAAA,WAAA,GAAA,IAAA,wVAAA,EAAA,8CAAA,6UAAA,EAAA,KAAA,GAAA,mVAAA,EAAA"}},
    {"offset": {"line": 200, "column": 0}, "map": {"version":3,"sources":["file:///C:/Repo/LogsOfN/v0-bid-mate-ai/app/actions/tender-actions.ts"],"sourcesContent":["\"use server\"\r\n\r\nimport { createClient } from \"@/lib/supabase/server\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { PinTenderOptions } from \"@/lib/types\"\r\nimport { redirect } from \"next/navigation\"\r\nimport { AnalyzedTender } from \"@/lib/types/tender\"\r\nimport { orchestrateTenderAnalysis } from \"@/lib/engines/orchestrator/tender-orchestrator\"\r\n\r\n\r\nexport interface TenderDocument {\r\n  id?: string\r\n  title: string\r\n  url: string\r\n  documentType?: string\r\n  format?: string\r\n  description?: string\r\n}\r\n\r\nexport interface TenderData {\r\n  tenderId: string\r\n  title: string\r\n  organization: string\r\n  publishDate?: string\r\n  closeDate?: string\r\n  value?: string\r\n  category?: string\r\n  description?: string\r\n  url?: string\r\n  documents?: TenderDocument[] // Add documents array\r\n}\r\n\r\nexport async function addTenderToUser(tenderData: TenderData) {\r\n  const supabase = await createClient()\r\n\r\n  // Get current user\r\n  const {\r\n    data: { user },\r\n    error: userError,\r\n  } = await supabase.auth.getUser()\r\n\r\n  if (userError || !user) {\r\n    return { success: false, error: \"Not authenticated\" }\r\n  }\r\n\r\n  // Insert tender\r\n  const { data, error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .insert({\r\n      user_id: user.id,\r\n      tender_id: tenderData.tenderId,\r\n      title: tenderData.title,\r\n      organization: tenderData.organization,\r\n      publish_date: tenderData.publishDate,\r\n      close_date: tenderData.closeDate,\r\n      value: tenderData.value,\r\n      category: tenderData.category,\r\n      description: tenderData.description,\r\n      url: tenderData.url,\r\n      status: \"draft\",\r\n    })\r\n    .select()\r\n    .single()\r\n\r\n  if (error) {\r\n    // Check if it's a duplicate\r\n    if (error.code === \"23505\") {\r\n      return { success: false, error: \"Tender already added\" }\r\n    }\r\n    console.error(\"[v0] Error adding tender:\", error)\r\n    return { success: false, error: \"Failed to add tender\" }\r\n  }\r\n\r\n  if (tenderData.documents && tenderData.documents.length > 0 && data) {\r\n    console.log(\"[v0] Adding\", tenderData.documents.length, \"documents to tender\", data.id)\r\n    console.log(\"[v0] Document data:\", JSON.stringify(tenderData.documents, null, 2))\r\n\r\n    const documentsToInsert = tenderData.documents.map((doc) => ({\r\n      user_tender_id: data.id, // Changed from tender_id\r\n      user_id: user.id,\r\n      file_name: doc.title, // Changed from name\r\n      storage_path: doc.url, // Changed from file_url - external URLs stored as storage_path\r\n      file_type: doc.format || \"application/pdf\",\r\n      file_size: 0, // Unknown size for external documents\r\n      // Removed document_type and description as they don't exist in schema\r\n    }))\r\n\r\n    console.log(\"[v0] Inserting documents:\", JSON.stringify(documentsToInsert, null, 2))\r\n\r\n    const { data: insertedDocs, error: docsError } = await supabase\r\n      .from(\"tender_documents\")\r\n      .insert(documentsToInsert)\r\n      .select()\r\n\r\n    if (docsError) {\r\n      console.error(\"[v0] Error adding documents:\", docsError)\r\n      console.error(\"[v0] Error details:\", JSON.stringify(docsError, null, 2))\r\n      // Don't fail the whole operation if documents fail, just log it\r\n    } else {\r\n      console.log(\"[v0] Successfully added\", insertedDocs?.length || 0, \"documents\")\r\n      console.log(\r\n        \"[v0] Inserted document IDs:\",\r\n        insertedDocs?.map((d) => d.id),\r\n      )\r\n    }\r\n  } else {\r\n    console.log(\"[v0] No documents to add for this tender\")\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  return { success: true, data }\r\n}\r\n\r\nexport async function toggleTenderPin(tenderId: string, isPinned: boolean) {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  const { error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .update({ is_pinned: isPinned })\r\n    .eq(\"id\", tenderId)\r\n    .eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error toggling pin:\", error)\r\n    return { success: false, error: \"Failed to update tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  revalidatePath(\"/dashboard/search\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function toggleTenderFavourite(tenderId: string, isFavourited: boolean) {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  const { error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .update({ is_favourited: isFavourited })\r\n    .eq(\"id\", tenderId)\r\n    .eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error toggling favourite:\", error)\r\n    return { success: false, error: \"Failed to update tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  revalidatePath(\"/dashboard/search\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function toggleTenderWishlist(tenderId: string, isWishlisted: boolean) {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  const { error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .update({ is_wishlisted: isWishlisted })\r\n    .eq(\"id\", tenderId)\r\n    .eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error toggling wishlist:\", error)\r\n    return { success: false, error: \"Failed to update tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function getUserTenders() {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\", tenders: [] }\r\n\r\n  // Fetch all tenders from user_tenders (both scraped and custom)\r\n  const { data: tenders, error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .select(\"*\")\r\n    .eq(\"user_id\", user.id)\r\n    .order(\"created_at\", { ascending: false })\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error fetching tenders:\", error)\r\n    return { success: false, error: \"Failed to fetch tenders\", tenders: [] }\r\n  }\r\n\r\n  // Normalize data for frontend\r\n  const normalizedTenders = (tenders || []).map((tender) => ({\r\n    id: tender.id,\r\n    tender_id: tender.tender_id || `custom-${tender.id}`, // Fallback for custom tenders\r\n    title: tender.title,\r\n    organization: tender.organization,\r\n    status: tender.status,\r\n    close_date: tender.close_date || tender.deadline, // Use deadline if close_date is null\r\n    value: tender.value,\r\n    category: tender.category,\r\n    is_pinned: tender.is_pinned || false,\r\n    is_favourited: tender.is_favourited || false,\r\n    is_wishlisted: tender.is_wishlisted || false,\r\n    created_at: tender.created_at,\r\n    tender_type: tender.tender_type || \"scraped\", // Default to scraped if null\r\n    location: tender.location,\r\n  }))\r\n\r\n  return { success: true, tenders: normalizedTenders }\r\n}\r\n\r\nexport async function deleteTender(tenderId: string, tenderType?: \"scraped\" | \"custom\") {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  // Simply delete from user_tenders table\r\n  const { error } = await supabase.from(\"user_tenders\").delete().eq(\"id\", tenderId).eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error deleting tender:\", error)\r\n    return { success: false, error: \"Failed to delete tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function saveScrapedTenderToUser(scrapedTender: {\r\n  id: string\r\n  title: string\r\n  source_name: string\r\n  description?: string\r\n  publish_date?: string\r\n  close_date?: string\r\n  estimated_value?: string\r\n  category?: string\r\n  tender_url?: string\r\n}) {\r\n  const supabase = await createClient()\r\n\r\n  // Get current user\r\n  const {\r\n    data: { user },\r\n    error: userError,\r\n  } = await supabase.auth.getUser()\r\n\r\n  if (userError || !user) {\r\n    return { success: false, error: \"Not authenticated\" }\r\n  }\r\n\r\n  // Check if tender already exists for this user\r\n  const { data: existing } = await supabase\r\n    .from(\"user_tenders\")\r\n    .select(\"id, status\")\r\n    .eq(\"user_id\", user.id)\r\n    .eq(\"tender_id\", scrapedTender.id)\r\n    .single()\r\n\r\n  if (existing) {\r\n    // If already exists and is draft, update to in-progress\r\n    if (existing.status === \"draft\") {\r\n      const { error: updateError } = await supabase\r\n        .from(\"user_tenders\")\r\n        .update({ status: \"in-progress\" })\r\n        .eq(\"id\", existing.id)\r\n\r\n      if (updateError) {\r\n        console.error(\"[v0] Error updating tender status:\", updateError)\r\n        return { success: false, error: \"Failed to update tender status\" }\r\n      }\r\n\r\n      revalidatePath(\"/dashboard/tenders\")\r\n      return { success: true, message: \"Tender status updated to in-progress\", isNew: false }\r\n    }\r\n\r\n    // Already exists and not draft, no need to update\r\n    return { success: true, message: \"Tender already in your list\", isNew: false }\r\n  }\r\n\r\n  // Insert new tender with in-progress status\r\n  const { data, error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .insert({\r\n      user_id: user.id,\r\n      tender_id: scrapedTender.id,\r\n      title: scrapedTender.title,\r\n      organization: scrapedTender.source_name,\r\n      publish_date: scrapedTender.publish_date,\r\n      close_date: scrapedTender.close_date,\r\n      value: scrapedTender.estimated_value,\r\n      category: scrapedTender.category,\r\n      description: scrapedTender.description,\r\n      url: scrapedTender.tender_url,\r\n      status: \"in-progress\",\r\n      tender_type: \"scraped\",\r\n    })\r\n    .select()\r\n    .single()\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error saving tender:\", error)\r\n    return { success: false, error: \"Failed to save tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  return { success: true, message: \"Tender saved to My Tenders\", isNew: true, data }\r\n}\r\n\r\nexport async function createCustomTender(tenderData: {\r\n  title: string\r\n  organization: string\r\n  deadline: string\r\n  value: string\r\n  description: string\r\n  category?: string\r\n  location?: string\r\n  uploadedFile?: File\r\n  analysis?: any\r\n}) {\r\n  console.log(\"[v0] createCustomTender called with data:\", {\r\n    title: tenderData.title,\r\n    organization: tenderData.organization,\r\n    deadline: tenderData.deadline,\r\n    hasFile: !!tenderData.uploadedFile,\r\n    hasAnalysis: !!tenderData.analysis,\r\n  })\r\n\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n    error: userError,\r\n  } = await supabase.auth.getUser()\r\n\r\n  if (userError || !user) {\r\n    console.error(\"[v0] Auth error:\", userError)\r\n    return { success: false, error: \"Not authenticated\" }\r\n  }\r\n\r\n  console.log(\"[v0] User authenticated:\", user.id)\r\n\r\n  try {\r\n    console.log(\"[v0] Creating custom tender record...\")\r\n\r\n    const { data: customTender, error: customTenderError } = await supabase\r\n      .from(\"user_tenders\")\r\n      .insert({\r\n        user_id: user.id,\r\n        title: tenderData.title,\r\n        organization: tenderData.organization,\r\n        deadline: tenderData.deadline,\r\n        value: tenderData.value,\r\n        category: tenderData.category || \"Custom\",\r\n        description: tenderData.description,\r\n        location: tenderData.location,\r\n        status: \"in-progress\",\r\n        tender_type: \"custom\",\r\n      })\r\n      .select()\r\n      .single()\r\n\r\n    if (customTenderError) {\r\n      console.error(\"[v0] Error creating custom tender:\", customTenderError)\r\n      return { success: false, error: \"Failed to create tender: \" + customTenderError.message }\r\n    }\r\n\r\n    console.log(\"[v0] Custom tender created successfully:\", customTender.id)\r\n\r\n    let documentSaved = false\r\n    let documentError: string | null = null\r\n    let uploadData: any = null // Declare uploadData here to be accessible later\r\n\r\n    if (tenderData.uploadedFile) {\r\n      console.log(\"[v0] Processing existing document...\")\r\n\r\n      try {\r\n        const file = tenderData.uploadedFile\r\n        const fileName = `${user.id}/${customTender.id}/${file.name}`\r\n\r\n        const { data: uploaded, error: uploadError } = await supabase.storage\r\n          .from(\"tender-documents\")\r\n          .upload(fileName, file)\r\n        uploadData = uploaded // Assign to the outer scope variable\r\n\r\n        if (uploadError) {\r\n          console.error(\"[v0] Error uploading file to Supabase:\", uploadError)\r\n          documentError = \"Failed to upload file to permanent storage\"\r\n        } else {\r\n          const documentData = {\r\n            tender_id: customTender.id,\r\n            file_name: file.name,\r\n            file_type: file.type,\r\n            file_size: file.size,\r\n            storage_path: uploadData.path,\r\n            blob_url: uploadData.path,\r\n          }\r\n\r\n          const { data: insertedDoc, error: docError } = await supabase\r\n            .from(\"user_tender_documents\")\r\n            .insert(documentData)\r\n            .select()\r\n            .single()\r\n\r\n          if (docError) {\r\n            console.error(\"[v0] Error saving doc ref:\", docError)\r\n            documentError = \"Failed to save document reference\"\r\n          } else {\r\n            documentSaved = true\r\n          }\r\n        }\r\n      } catch (err: any) {\r\n        console.error(\"[v0] Upload error:\", err)\r\n        documentError = err.message\r\n      }\r\n    } else {\r\n      console.log(\"[v0] No file to upload\")\r\n    }\r\n\r\n    let analysisSaved = false\r\n    let analysisError: string | null = null\r\n    let orchestrationId: string | null = null\r\n\r\n    if (tenderData.analysis) {\r\n      console.log(\"[v0] Saving analysis data...\")\r\n\r\n      const analysisData = {\r\n        tender_id: customTender.id,\r\n        analysis_data: tenderData.analysis,\r\n      }\r\n\r\n      console.log(\"[v0] Inserting analysis with tender_id:\", customTender.id)\r\n\r\n      const { data: insertedAnalysis, error: analysisErr } = await supabase\r\n        .from(\"user_tender_analysis\") // Updated table name\r\n        .insert(analysisData)\r\n        .select()\r\n        .single()\r\n\r\n      if (analysisErr) {\r\n        console.error(\"[v0] Error saving analysis:\", analysisErr)\r\n        analysisError = analysisErr.message\r\n      } else {\r\n        console.log(\"[v0] Analysis saved successfully\")\r\n        analysisSaved = true\r\n\r\n        // Trigger multi-engine orchestration for deep analysis\r\n        console.log(\"[v0] Triggering multi-engine orchestration...\")\r\n        try {\r\n          // Get document URL if file was uploaded\r\n          let documentUrl: string | undefined\r\n          if (documentSaved) {\r\n            const { data: { publicUrl } } = supabase.storage\r\n              .from('tender-documents')\r\n              .getPublicUrl(uploadData?.path || '')\r\n            documentUrl = publicUrl\r\n          }\r\n\r\n          const orchestrationResult = await orchestrateTenderAnalysis(\r\n            customTender.id,\r\n            user.id,\r\n            documentUrl\r\n          )\r\n\r\n          orchestrationId = orchestrationResult.orchestrationId\r\n          console.log(`[v0] Orchestration started: ${orchestrationId}`)\r\n        } catch (orchError: any) {\r\n          console.error(\"[v0] Orchestration failed:\", orchError)\r\n          // Don't fail the entire operation if orchestration fails, just log it\r\n        }\r\n      }\r\n    } else {\r\n      console.log(\"[v0] No analysis data provided\")\r\n    }\r\n\r\n    // Return success with tender ID and orchestration ID\r\n    console.log(\"[v0] Returning success for tender:\", customTender.id)\r\n\r\n    revalidatePath(\"/dashboard/tenders\")\r\n    revalidatePath(\"/dashboard/custom-tenders\")\r\n\r\n    return {\r\n      success: true,\r\n      tenderId: customTender.id,\r\n      orchestrationId,\r\n      documentSaved,\r\n      documentError,\r\n      analysisSaved,\r\n      analysisError,\r\n    }\r\n  } catch (error) {\r\n    console.error(\"[v0] Error in createCustomTender:\", error)\r\n    return { success: false, error: \"Failed to create tender: \" + (error as Error).message }\r\n  }\r\n}\r\n\r\nexport async function getDashboardStats() {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  try {\r\n    // Get all tenders count for this user\r\n    const { count: totalTenders } = await supabase\r\n      .from(\"user_tenders\")\r\n      .select(\"*\", { count: \"exact\", head: true })\r\n      .eq(\"user_id\", user.id)\r\n\r\n    // Get analyzed tenders count (where we have analysis data)\r\n    // RLS ensures we only see our own analyses\r\n    const { count: analyzedCount } = await supabase\r\n      .from(\"user_tender_analysis\")\r\n      .select(\"tender_id\", { count: \"exact\", head: true })\r\n    // Wait, user_tender_analysis doesn't have user_id in my migration?\r\n    // Let's check migration script...\r\n    // user_custom_tender_analysis didn't have user_id in the original schema I saw in 031?\r\n    // L131: WHERE id = tender_id AND user_id = auth.uid() -> checking parent tender.\r\n    // So user_tender_analysis table assumes linking to user_tenders.\r\n    // query:\r\n    // select count(*) from user_tender_analysis join user_tenders on ... where user_tenders.user_id = ...\r\n\r\n    // Alternative: Just query user_tenders where tender_type='custom' (proxy for analyzed?)\r\n    // Or just fetching recent activity from unified table.\r\n\r\n    // Get recent activity (last 5 tenders)\r\n    const { data: recentTenders } = await supabase\r\n      .from(\"user_tenders\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", user.id)\r\n      .order(\"created_at\", { ascending: false })\r\n      .limit(5)\r\n\r\n    const recentActivity = (recentTenders || []).map((tender) => ({\r\n      id: tender.id,\r\n      title: tender.title,\r\n      organization: tender.organization,\r\n      type: tender.tender_type === \"custom\" ? (\"analyzed\" as const) : (\"saved\" as const),\r\n      created_at: tender.created_at,\r\n    }))\r\n\r\n    // Get tenders closing soon (next 7 days)\r\n    const sevenDaysFromNow = new Date()\r\n    sevenDaysFromNow.setDate(sevenDaysFromNow.getDate() + 7)\r\n\r\n    // Check both close_date (scraped) and deadline (custom, if parsed?)\r\n    // For now, relying on close_date. My migration copied deadline to close_date if I recall?\r\n    // No, I copied close_date to close_date. Custom tenders might rely on 'deadline' text column.\r\n    // This is tricky for sorting. Ideally we parse deadline to close_date.\r\n    // Assuming close_date is populated for meaningful deadlines.\r\n\r\n    const { data: closingSoon } = await supabase\r\n      .from(\"user_tenders\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", user.id)\r\n      .not(\"close_date\", \"is\", null)\r\n      .gte(\"close_date\", new Date().toISOString())\r\n      .lte(\"close_date\", sevenDaysFromNow.toISOString())\r\n      .order(\"close_date\", { ascending: true })\r\n      .limit(5)\r\n\r\n    return {\r\n      success: true,\r\n      stats: {\r\n        totalTenders: totalTenders || 0,\r\n        analyzedTenders: analyzedCount || 0, // This might be inaccurate without join, but acceptable for now or I can do a join query if needed.\r\n        // Actually, let's try to get substantial analyzed count if possible.\r\n        // For now 0 is fine or just count custom tenders?\r\n        closingSoon: closingSoon?.length || 0,\r\n        recentActivity,\r\n        upcomingDeadlines: closingSoon || [],\r\n      },\r\n    }\r\n  } catch (error) {\r\n    console.error(\"[v0] Error fetching dashboard stats:\", error)\r\n    return { success: false, error: \"Failed to fetch dashboard statistics\" }\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;IAyIsB,wBAAA,WAAA,GAAA,IAAA,wVAAA,EAAA,8CAAA,6UAAA,EAAA,KAAA,GAAA,mVAAA,EAAA"}},
    {"offset": {"line": 215, "column": 0}, "map": {"version":3,"sources":["file:///C:/Repo/LogsOfN/v0-bid-mate-ai/app/actions/tender-actions.ts"],"sourcesContent":["\"use server\"\r\n\r\nimport { createClient } from \"@/lib/supabase/server\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { PinTenderOptions } from \"@/lib/types\"\r\nimport { redirect } from \"next/navigation\"\r\nimport { AnalyzedTender } from \"@/lib/types/tender\"\r\nimport { orchestrateTenderAnalysis } from \"@/lib/engines/orchestrator/tender-orchestrator\"\r\n\r\n\r\nexport interface TenderDocument {\r\n  id?: string\r\n  title: string\r\n  url: string\r\n  documentType?: string\r\n  format?: string\r\n  description?: string\r\n}\r\n\r\nexport interface TenderData {\r\n  tenderId: string\r\n  title: string\r\n  organization: string\r\n  publishDate?: string\r\n  closeDate?: string\r\n  value?: string\r\n  category?: string\r\n  description?: string\r\n  url?: string\r\n  documents?: TenderDocument[] // Add documents array\r\n}\r\n\r\nexport async function addTenderToUser(tenderData: TenderData) {\r\n  const supabase = await createClient()\r\n\r\n  // Get current user\r\n  const {\r\n    data: { user },\r\n    error: userError,\r\n  } = await supabase.auth.getUser()\r\n\r\n  if (userError || !user) {\r\n    return { success: false, error: \"Not authenticated\" }\r\n  }\r\n\r\n  // Insert tender\r\n  const { data, error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .insert({\r\n      user_id: user.id,\r\n      tender_id: tenderData.tenderId,\r\n      title: tenderData.title,\r\n      organization: tenderData.organization,\r\n      publish_date: tenderData.publishDate,\r\n      close_date: tenderData.closeDate,\r\n      value: tenderData.value,\r\n      category: tenderData.category,\r\n      description: tenderData.description,\r\n      url: tenderData.url,\r\n      status: \"draft\",\r\n    })\r\n    .select()\r\n    .single()\r\n\r\n  if (error) {\r\n    // Check if it's a duplicate\r\n    if (error.code === \"23505\") {\r\n      return { success: false, error: \"Tender already added\" }\r\n    }\r\n    console.error(\"[v0] Error adding tender:\", error)\r\n    return { success: false, error: \"Failed to add tender\" }\r\n  }\r\n\r\n  if (tenderData.documents && tenderData.documents.length > 0 && data) {\r\n    console.log(\"[v0] Adding\", tenderData.documents.length, \"documents to tender\", data.id)\r\n    console.log(\"[v0] Document data:\", JSON.stringify(tenderData.documents, null, 2))\r\n\r\n    const documentsToInsert = tenderData.documents.map((doc) => ({\r\n      user_tender_id: data.id, // Changed from tender_id\r\n      user_id: user.id,\r\n      file_name: doc.title, // Changed from name\r\n      storage_path: doc.url, // Changed from file_url - external URLs stored as storage_path\r\n      file_type: doc.format || \"application/pdf\",\r\n      file_size: 0, // Unknown size for external documents\r\n      // Removed document_type and description as they don't exist in schema\r\n    }))\r\n\r\n    console.log(\"[v0] Inserting documents:\", JSON.stringify(documentsToInsert, null, 2))\r\n\r\n    const { data: insertedDocs, error: docsError } = await supabase\r\n      .from(\"tender_documents\")\r\n      .insert(documentsToInsert)\r\n      .select()\r\n\r\n    if (docsError) {\r\n      console.error(\"[v0] Error adding documents:\", docsError)\r\n      console.error(\"[v0] Error details:\", JSON.stringify(docsError, null, 2))\r\n      // Don't fail the whole operation if documents fail, just log it\r\n    } else {\r\n      console.log(\"[v0] Successfully added\", insertedDocs?.length || 0, \"documents\")\r\n      console.log(\r\n        \"[v0] Inserted document IDs:\",\r\n        insertedDocs?.map((d) => d.id),\r\n      )\r\n    }\r\n  } else {\r\n    console.log(\"[v0] No documents to add for this tender\")\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  return { success: true, data }\r\n}\r\n\r\nexport async function toggleTenderPin(tenderId: string, isPinned: boolean) {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  const { error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .update({ is_pinned: isPinned })\r\n    .eq(\"id\", tenderId)\r\n    .eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error toggling pin:\", error)\r\n    return { success: false, error: \"Failed to update tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  revalidatePath(\"/dashboard/search\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function toggleTenderFavourite(tenderId: string, isFavourited: boolean) {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  const { error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .update({ is_favourited: isFavourited })\r\n    .eq(\"id\", tenderId)\r\n    .eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error toggling favourite:\", error)\r\n    return { success: false, error: \"Failed to update tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  revalidatePath(\"/dashboard/search\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function toggleTenderWishlist(tenderId: string, isWishlisted: boolean) {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  const { error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .update({ is_wishlisted: isWishlisted })\r\n    .eq(\"id\", tenderId)\r\n    .eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error toggling wishlist:\", error)\r\n    return { success: false, error: \"Failed to update tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function getUserTenders() {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\", tenders: [] }\r\n\r\n  // Fetch all tenders from user_tenders (both scraped and custom)\r\n  const { data: tenders, error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .select(\"*\")\r\n    .eq(\"user_id\", user.id)\r\n    .order(\"created_at\", { ascending: false })\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error fetching tenders:\", error)\r\n    return { success: false, error: \"Failed to fetch tenders\", tenders: [] }\r\n  }\r\n\r\n  // Normalize data for frontend\r\n  const normalizedTenders = (tenders || []).map((tender) => ({\r\n    id: tender.id,\r\n    tender_id: tender.tender_id || `custom-${tender.id}`, // Fallback for custom tenders\r\n    title: tender.title,\r\n    organization: tender.organization,\r\n    status: tender.status,\r\n    close_date: tender.close_date || tender.deadline, // Use deadline if close_date is null\r\n    value: tender.value,\r\n    category: tender.category,\r\n    is_pinned: tender.is_pinned || false,\r\n    is_favourited: tender.is_favourited || false,\r\n    is_wishlisted: tender.is_wishlisted || false,\r\n    created_at: tender.created_at,\r\n    tender_type: tender.tender_type || \"scraped\", // Default to scraped if null\r\n    location: tender.location,\r\n  }))\r\n\r\n  return { success: true, tenders: normalizedTenders }\r\n}\r\n\r\nexport async function deleteTender(tenderId: string, tenderType?: \"scraped\" | \"custom\") {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  // Simply delete from user_tenders table\r\n  const { error } = await supabase.from(\"user_tenders\").delete().eq(\"id\", tenderId).eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error deleting tender:\", error)\r\n    return { success: false, error: \"Failed to delete tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function saveScrapedTenderToUser(scrapedTender: {\r\n  id: string\r\n  title: string\r\n  source_name: string\r\n  description?: string\r\n  publish_date?: string\r\n  close_date?: string\r\n  estimated_value?: string\r\n  category?: string\r\n  tender_url?: string\r\n}) {\r\n  const supabase = await createClient()\r\n\r\n  // Get current user\r\n  const {\r\n    data: { user },\r\n    error: userError,\r\n  } = await supabase.auth.getUser()\r\n\r\n  if (userError || !user) {\r\n    return { success: false, error: \"Not authenticated\" }\r\n  }\r\n\r\n  // Check if tender already exists for this user\r\n  const { data: existing } = await supabase\r\n    .from(\"user_tenders\")\r\n    .select(\"id, status\")\r\n    .eq(\"user_id\", user.id)\r\n    .eq(\"tender_id\", scrapedTender.id)\r\n    .single()\r\n\r\n  if (existing) {\r\n    // If already exists and is draft, update to in-progress\r\n    if (existing.status === \"draft\") {\r\n      const { error: updateError } = await supabase\r\n        .from(\"user_tenders\")\r\n        .update({ status: \"in-progress\" })\r\n        .eq(\"id\", existing.id)\r\n\r\n      if (updateError) {\r\n        console.error(\"[v0] Error updating tender status:\", updateError)\r\n        return { success: false, error: \"Failed to update tender status\" }\r\n      }\r\n\r\n      revalidatePath(\"/dashboard/tenders\")\r\n      return { success: true, message: \"Tender status updated to in-progress\", isNew: false }\r\n    }\r\n\r\n    // Already exists and not draft, no need to update\r\n    return { success: true, message: \"Tender already in your list\", isNew: false }\r\n  }\r\n\r\n  // Insert new tender with in-progress status\r\n  const { data, error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .insert({\r\n      user_id: user.id,\r\n      tender_id: scrapedTender.id,\r\n      title: scrapedTender.title,\r\n      organization: scrapedTender.source_name,\r\n      publish_date: scrapedTender.publish_date,\r\n      close_date: scrapedTender.close_date,\r\n      value: scrapedTender.estimated_value,\r\n      category: scrapedTender.category,\r\n      description: scrapedTender.description,\r\n      url: scrapedTender.tender_url,\r\n      status: \"in-progress\",\r\n      tender_type: \"scraped\",\r\n    })\r\n    .select()\r\n    .single()\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error saving tender:\", error)\r\n    return { success: false, error: \"Failed to save tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  return { success: true, message: \"Tender saved to My Tenders\", isNew: true, data }\r\n}\r\n\r\nexport async function createCustomTender(tenderData: {\r\n  title: string\r\n  organization: string\r\n  deadline: string\r\n  value: string\r\n  description: string\r\n  category?: string\r\n  location?: string\r\n  uploadedFile?: File\r\n  analysis?: any\r\n}) {\r\n  console.log(\"[v0] createCustomTender called with data:\", {\r\n    title: tenderData.title,\r\n    organization: tenderData.organization,\r\n    deadline: tenderData.deadline,\r\n    hasFile: !!tenderData.uploadedFile,\r\n    hasAnalysis: !!tenderData.analysis,\r\n  })\r\n\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n    error: userError,\r\n  } = await supabase.auth.getUser()\r\n\r\n  if (userError || !user) {\r\n    console.error(\"[v0] Auth error:\", userError)\r\n    return { success: false, error: \"Not authenticated\" }\r\n  }\r\n\r\n  console.log(\"[v0] User authenticated:\", user.id)\r\n\r\n  try {\r\n    console.log(\"[v0] Creating custom tender record...\")\r\n\r\n    const { data: customTender, error: customTenderError } = await supabase\r\n      .from(\"user_tenders\")\r\n      .insert({\r\n        user_id: user.id,\r\n        title: tenderData.title,\r\n        organization: tenderData.organization,\r\n        deadline: tenderData.deadline,\r\n        value: tenderData.value,\r\n        category: tenderData.category || \"Custom\",\r\n        description: tenderData.description,\r\n        location: tenderData.location,\r\n        status: \"in-progress\",\r\n        tender_type: \"custom\",\r\n      })\r\n      .select()\r\n      .single()\r\n\r\n    if (customTenderError) {\r\n      console.error(\"[v0] Error creating custom tender:\", customTenderError)\r\n      return { success: false, error: \"Failed to create tender: \" + customTenderError.message }\r\n    }\r\n\r\n    console.log(\"[v0] Custom tender created successfully:\", customTender.id)\r\n\r\n    let documentSaved = false\r\n    let documentError: string | null = null\r\n    let uploadData: any = null // Declare uploadData here to be accessible later\r\n\r\n    if (tenderData.uploadedFile) {\r\n      console.log(\"[v0] Processing existing document...\")\r\n\r\n      try {\r\n        const file = tenderData.uploadedFile\r\n        const fileName = `${user.id}/${customTender.id}/${file.name}`\r\n\r\n        const { data: uploaded, error: uploadError } = await supabase.storage\r\n          .from(\"tender-documents\")\r\n          .upload(fileName, file)\r\n        uploadData = uploaded // Assign to the outer scope variable\r\n\r\n        if (uploadError) {\r\n          console.error(\"[v0] Error uploading file to Supabase:\", uploadError)\r\n          documentError = \"Failed to upload file to permanent storage\"\r\n        } else {\r\n          const documentData = {\r\n            tender_id: customTender.id,\r\n            file_name: file.name,\r\n            file_type: file.type,\r\n            file_size: file.size,\r\n            storage_path: uploadData.path,\r\n            blob_url: uploadData.path,\r\n          }\r\n\r\n          const { data: insertedDoc, error: docError } = await supabase\r\n            .from(\"user_tender_documents\")\r\n            .insert(documentData)\r\n            .select()\r\n            .single()\r\n\r\n          if (docError) {\r\n            console.error(\"[v0] Error saving doc ref:\", docError)\r\n            documentError = \"Failed to save document reference\"\r\n          } else {\r\n            documentSaved = true\r\n          }\r\n        }\r\n      } catch (err: any) {\r\n        console.error(\"[v0] Upload error:\", err)\r\n        documentError = err.message\r\n      }\r\n    } else {\r\n      console.log(\"[v0] No file to upload\")\r\n    }\r\n\r\n    let analysisSaved = false\r\n    let analysisError: string | null = null\r\n    let orchestrationId: string | null = null\r\n\r\n    if (tenderData.analysis) {\r\n      console.log(\"[v0] Saving analysis data...\")\r\n\r\n      const analysisData = {\r\n        tender_id: customTender.id,\r\n        analysis_data: tenderData.analysis,\r\n      }\r\n\r\n      console.log(\"[v0] Inserting analysis with tender_id:\", customTender.id)\r\n\r\n      const { data: insertedAnalysis, error: analysisErr } = await supabase\r\n        .from(\"user_tender_analysis\") // Updated table name\r\n        .insert(analysisData)\r\n        .select()\r\n        .single()\r\n\r\n      if (analysisErr) {\r\n        console.error(\"[v0] Error saving analysis:\", analysisErr)\r\n        analysisError = analysisErr.message\r\n      } else {\r\n        console.log(\"[v0] Analysis saved successfully\")\r\n        analysisSaved = true\r\n\r\n        // Trigger multi-engine orchestration for deep analysis\r\n        console.log(\"[v0] Triggering multi-engine orchestration...\")\r\n        try {\r\n          // Get document URL if file was uploaded\r\n          let documentUrl: string | undefined\r\n          if (documentSaved) {\r\n            const { data: { publicUrl } } = supabase.storage\r\n              .from('tender-documents')\r\n              .getPublicUrl(uploadData?.path || '')\r\n            documentUrl = publicUrl\r\n          }\r\n\r\n          const orchestrationResult = await orchestrateTenderAnalysis(\r\n            customTender.id,\r\n            user.id,\r\n            documentUrl\r\n          )\r\n\r\n          orchestrationId = orchestrationResult.orchestrationId\r\n          console.log(`[v0] Orchestration started: ${orchestrationId}`)\r\n        } catch (orchError: any) {\r\n          console.error(\"[v0] Orchestration failed:\", orchError)\r\n          // Don't fail the entire operation if orchestration fails, just log it\r\n        }\r\n      }\r\n    } else {\r\n      console.log(\"[v0] No analysis data provided\")\r\n    }\r\n\r\n    // Return success with tender ID and orchestration ID\r\n    console.log(\"[v0] Returning success for tender:\", customTender.id)\r\n\r\n    revalidatePath(\"/dashboard/tenders\")\r\n    revalidatePath(\"/dashboard/custom-tenders\")\r\n\r\n    return {\r\n      success: true,\r\n      tenderId: customTender.id,\r\n      orchestrationId,\r\n      documentSaved,\r\n      documentError,\r\n      analysisSaved,\r\n      analysisError,\r\n    }\r\n  } catch (error) {\r\n    console.error(\"[v0] Error in createCustomTender:\", error)\r\n    return { success: false, error: \"Failed to create tender: \" + (error as Error).message }\r\n  }\r\n}\r\n\r\nexport async function getDashboardStats() {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  try {\r\n    // Get all tenders count for this user\r\n    const { count: totalTenders } = await supabase\r\n      .from(\"user_tenders\")\r\n      .select(\"*\", { count: \"exact\", head: true })\r\n      .eq(\"user_id\", user.id)\r\n\r\n    // Get analyzed tenders count (where we have analysis data)\r\n    // RLS ensures we only see our own analyses\r\n    const { count: analyzedCount } = await supabase\r\n      .from(\"user_tender_analysis\")\r\n      .select(\"tender_id\", { count: \"exact\", head: true })\r\n    // Wait, user_tender_analysis doesn't have user_id in my migration?\r\n    // Let's check migration script...\r\n    // user_custom_tender_analysis didn't have user_id in the original schema I saw in 031?\r\n    // L131: WHERE id = tender_id AND user_id = auth.uid() -> checking parent tender.\r\n    // So user_tender_analysis table assumes linking to user_tenders.\r\n    // query:\r\n    // select count(*) from user_tender_analysis join user_tenders on ... where user_tenders.user_id = ...\r\n\r\n    // Alternative: Just query user_tenders where tender_type='custom' (proxy for analyzed?)\r\n    // Or just fetching recent activity from unified table.\r\n\r\n    // Get recent activity (last 5 tenders)\r\n    const { data: recentTenders } = await supabase\r\n      .from(\"user_tenders\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", user.id)\r\n      .order(\"created_at\", { ascending: false })\r\n      .limit(5)\r\n\r\n    const recentActivity = (recentTenders || []).map((tender) => ({\r\n      id: tender.id,\r\n      title: tender.title,\r\n      organization: tender.organization,\r\n      type: tender.tender_type === \"custom\" ? (\"analyzed\" as const) : (\"saved\" as const),\r\n      created_at: tender.created_at,\r\n    }))\r\n\r\n    // Get tenders closing soon (next 7 days)\r\n    const sevenDaysFromNow = new Date()\r\n    sevenDaysFromNow.setDate(sevenDaysFromNow.getDate() + 7)\r\n\r\n    // Check both close_date (scraped) and deadline (custom, if parsed?)\r\n    // For now, relying on close_date. My migration copied deadline to close_date if I recall?\r\n    // No, I copied close_date to close_date. Custom tenders might rely on 'deadline' text column.\r\n    // This is tricky for sorting. Ideally we parse deadline to close_date.\r\n    // Assuming close_date is populated for meaningful deadlines.\r\n\r\n    const { data: closingSoon } = await supabase\r\n      .from(\"user_tenders\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", user.id)\r\n      .not(\"close_date\", \"is\", null)\r\n      .gte(\"close_date\", new Date().toISOString())\r\n      .lte(\"close_date\", sevenDaysFromNow.toISOString())\r\n      .order(\"close_date\", { ascending: true })\r\n      .limit(5)\r\n\r\n    return {\r\n      success: true,\r\n      stats: {\r\n        totalTenders: totalTenders || 0,\r\n        analyzedTenders: analyzedCount || 0, // This might be inaccurate without join, but acceptable for now or I can do a join query if needed.\r\n        // Actually, let's try to get substantial analyzed count if possible.\r\n        // For now 0 is fine or just count custom tenders?\r\n        closingSoon: closingSoon?.length || 0,\r\n        recentActivity,\r\n        upcomingDeadlines: closingSoon || [],\r\n      },\r\n    }\r\n  } catch (error) {\r\n    console.error(\"[v0] Error fetching dashboard stats:\", error)\r\n    return { success: false, error: \"Failed to fetch dashboard statistics\" }\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;IAiKsB,uBAAA,WAAA,GAAA,IAAA,wVAAA,EAAA,8CAAA,6UAAA,EAAA,KAAA,GAAA,mVAAA,EAAA"}},
    {"offset": {"line": 230, "column": 0}, "map": {"version":3,"sources":["file:///C:/Repo/LogsOfN/v0-bid-mate-ai/hooks/use-toast.ts"],"sourcesContent":["'use client'\r\n\r\n// Inspired by react-hot-toast library\r\nimport * as React from 'react'\r\n\r\nimport type { ToastActionElement, ToastProps } from '@/components/ui/toast'\r\n\r\nconst TOAST_LIMIT = 1\r\nconst TOAST_REMOVE_DELAY = 1000000\r\n\r\ntype ToasterToast = ToastProps & {\r\n  id: string\r\n  title?: React.ReactNode\r\n  description?: React.ReactNode\r\n  action?: ToastActionElement\r\n}\r\n\r\nconst actionTypes = {\r\n  ADD_TOAST: 'ADD_TOAST',\r\n  UPDATE_TOAST: 'UPDATE_TOAST',\r\n  DISMISS_TOAST: 'DISMISS_TOAST',\r\n  REMOVE_TOAST: 'REMOVE_TOAST',\r\n} as const\r\n\r\nlet count = 0\r\n\r\nfunction genId() {\r\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\r\n  return count.toString()\r\n}\r\n\r\ntype ActionType = typeof actionTypes\r\n\r\ntype Action =\r\n  | {\r\n      type: ActionType['ADD_TOAST']\r\n      toast: ToasterToast\r\n    }\r\n  | {\r\n      type: ActionType['UPDATE_TOAST']\r\n      toast: Partial<ToasterToast>\r\n    }\r\n  | {\r\n      type: ActionType['DISMISS_TOAST']\r\n      toastId?: ToasterToast['id']\r\n    }\r\n  | {\r\n      type: ActionType['REMOVE_TOAST']\r\n      toastId?: ToasterToast['id']\r\n    }\r\n\r\ninterface State {\r\n  toasts: ToasterToast[]\r\n}\r\n\r\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\r\n\r\nconst addToRemoveQueue = (toastId: string) => {\r\n  if (toastTimeouts.has(toastId)) {\r\n    return\r\n  }\r\n\r\n  const timeout = setTimeout(() => {\r\n    toastTimeouts.delete(toastId)\r\n    dispatch({\r\n      type: 'REMOVE_TOAST',\r\n      toastId: toastId,\r\n    })\r\n  }, TOAST_REMOVE_DELAY)\r\n\r\n  toastTimeouts.set(toastId, timeout)\r\n}\r\n\r\nexport const reducer = (state: State, action: Action): State => {\r\n  switch (action.type) {\r\n    case 'ADD_TOAST':\r\n      return {\r\n        ...state,\r\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\r\n      }\r\n\r\n    case 'UPDATE_TOAST':\r\n      return {\r\n        ...state,\r\n        toasts: state.toasts.map((t) =>\r\n          t.id === action.toast.id ? { ...t, ...action.toast } : t,\r\n        ),\r\n      }\r\n\r\n    case 'DISMISS_TOAST': {\r\n      const { toastId } = action\r\n\r\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\r\n      // but I'll keep it here for simplicity\r\n      if (toastId) {\r\n        addToRemoveQueue(toastId)\r\n      } else {\r\n        state.toasts.forEach((toast) => {\r\n          addToRemoveQueue(toast.id)\r\n        })\r\n      }\r\n\r\n      return {\r\n        ...state,\r\n        toasts: state.toasts.map((t) =>\r\n          t.id === toastId || toastId === undefined\r\n            ? {\r\n                ...t,\r\n                open: false,\r\n              }\r\n            : t,\r\n        ),\r\n      }\r\n    }\r\n    case 'REMOVE_TOAST':\r\n      if (action.toastId === undefined) {\r\n        return {\r\n          ...state,\r\n          toasts: [],\r\n        }\r\n      }\r\n      return {\r\n        ...state,\r\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\r\n      }\r\n  }\r\n}\r\n\r\nconst listeners: Array<(state: State) => void> = []\r\n\r\nlet memoryState: State = { toasts: [] }\r\n\r\nfunction dispatch(action: Action) {\r\n  memoryState = reducer(memoryState, action)\r\n  listeners.forEach((listener) => {\r\n    listener(memoryState)\r\n  })\r\n}\r\n\r\ntype Toast = Omit<ToasterToast, 'id'>\r\n\r\nfunction toast({ ...props }: Toast) {\r\n  const id = genId()\r\n\r\n  const update = (props: ToasterToast) =>\r\n    dispatch({\r\n      type: 'UPDATE_TOAST',\r\n      toast: { ...props, id },\r\n    })\r\n  const dismiss = () => dispatch({ type: 'DISMISS_TOAST', toastId: id })\r\n\r\n  dispatch({\r\n    type: 'ADD_TOAST',\r\n    toast: {\r\n      ...props,\r\n      id,\r\n      open: true,\r\n      onOpenChange: (open) => {\r\n        if (!open) dismiss()\r\n      },\r\n    },\r\n  })\r\n\r\n  return {\r\n    id: id,\r\n    dismiss,\r\n    update,\r\n  }\r\n}\r\n\r\nfunction useToast() {\r\n  const [state, setState] = React.useState<State>(memoryState)\r\n\r\n  React.useEffect(() => {\r\n    listeners.push(setState)\r\n    return () => {\r\n      const index = listeners.indexOf(setState)\r\n      if (index > -1) {\r\n        listeners.splice(index, 1)\r\n      }\r\n    }\r\n  }, [state])\r\n\r\n  return {\r\n    ...state,\r\n    toast: (toastWithHelpers as any),\r\n    dismiss: (toastId?: string) => dispatch({ type: 'DISMISS_TOAST', toastId }),\r\n  }\r\n}\r\n\r\nexport { useToast }\r\n\r\n// Add convenience helpers to match common usage: `toast.success()` / `toast.error()`\r\ntype ToastReturn = ReturnType<typeof toast>\r\n\r\ntype ToastWithHelpers = typeof toast & {\r\n  success: (title: string, props?: Omit<Toast, 'title'>) => ToastReturn\r\n  error: (title: string, props?: Omit<Toast, 'title'>) => ToastReturn\r\n}\r\n\r\nconst toastWithHelpers = toast as ToastWithHelpers\r\n\r\ntoastWithHelpers.success = (title, props) =>\r\n  toast({ title, ...(props ?? {}), variant: 'default' })\r\n\r\ntoastWithHelpers.error = (title, props) =>\r\n  toast({ title, ...(props ?? {}), variant: 'destructive' })\r\n\r\nexport { toastWithHelpers as toast }\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 409, "column": 0}, "map": {"version":3,"sources":["file:///C:/Repo/LogsOfN/v0-bid-mate-ai/app/dashboard/tenders/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport {\r\n  FileText,\r\n  Search,\r\n  Calendar,\r\n  Building2,\r\n  DollarSign,\r\n  Eye,\r\n  Trash2,\r\n  Plus,\r\n  Pin,\r\n  Heart,\r\n  Star,\r\n  Loader2,\r\n} from \"lucide-react\"\r\nimport Link from \"next/link\"\r\nimport {\r\n  getUserTenders,\r\n  deleteTender,\r\n  toggleTenderPin,\r\n  toggleTenderFavourite,\r\n  toggleTenderWishlist,\r\n} from \"@/app/actions/tender-actions\"\r\nimport { useToast } from \"@/hooks/use-toast\"\r\n\r\ninterface UserTender {\r\n  id: string\r\n  tender_id: string\r\n  title: string\r\n  organization: string\r\n  status: string\r\n  close_date: string\r\n  value?: string\r\n  category?: string\r\n  is_pinned: boolean\r\n  is_favourited: boolean\r\n  is_wishlisted: boolean\r\n  created_at: string\r\n  tender_type?: \"scraped\" | \"custom\" // Added tender_type to interface\r\n}\r\n\r\nexport default function TendersPage() {\r\n  const [searchQuery, setSearchQuery] = useState(\"\")\r\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\")\r\n  const [showPinned, setShowPinned] = useState(false)\r\n  const [showFavourited, setShowFavourited] = useState(false)\r\n  const [showWishlisted, setShowWishlisted] = useState(false)\r\n  const [tenders, setTenders] = useState<UserTender[]>([])\r\n  const [loading, setLoading] = useState(true)\r\n  const [updatingTender, setUpdatingTender] = useState<string | null>(null)\r\n  const { toast } = useToast()\r\n\r\n  useEffect(() => {\r\n    loadTenders()\r\n  }, [])\r\n\r\n  const loadTenders = async () => {\r\n    setLoading(true)\r\n    const result = await getUserTenders()\r\n    if (result.success) {\r\n      setTenders(result.tenders as UserTender[])\r\n    } else {\r\n      toast({\r\n        title: \"Error\",\r\n        description: result.error || \"Failed to load tenders\",\r\n        variant: \"destructive\",\r\n      })\r\n    }\r\n    setLoading(false)\r\n  }\r\n\r\n  const filteredTenders = tenders.filter((tender) => {\r\n    const matchesSearch =\r\n      tender.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n      tender.organization.toLowerCase().includes(searchQuery.toLowerCase())\r\n    const matchesStatus = statusFilter === \"all\" || tender.status === statusFilter\r\n    const matchesPinned = !showPinned || tender.is_pinned\r\n    const matchesFavourited = !showFavourited || tender.is_favourited\r\n    const matchesWishlisted = !showWishlisted || tender.is_wishlisted\r\n    return matchesSearch && matchesStatus && matchesPinned && matchesFavourited && matchesWishlisted\r\n  })\r\n\r\n  const handleTogglePin = async (tenderId: string, currentValue: boolean) => {\r\n    setUpdatingTender(tenderId)\r\n    const result = await toggleTenderPin(tenderId, !currentValue)\r\n    if (result.success) {\r\n      await loadTenders()\r\n      toast({\r\n        title: currentValue ? \"Unpinned\" : \"Pinned\",\r\n        description: `Tender ${currentValue ? \"unpinned\" : \"pinned\"} successfully`,\r\n      })\r\n    } else {\r\n      toast({\r\n        title: \"Error\",\r\n        description: result.error || \"Failed to update tender\",\r\n        variant: \"destructive\",\r\n      })\r\n    }\r\n    setUpdatingTender(null)\r\n  }\r\n\r\n  const handleToggleFavourite = async (tenderId: string, currentValue: boolean) => {\r\n    setUpdatingTender(tenderId)\r\n    const result = await toggleTenderFavourite(tenderId, !currentValue)\r\n    if (result.success) {\r\n      await loadTenders()\r\n      toast({\r\n        title: currentValue ? \"Removed from favourites\" : \"Added to favourites\",\r\n        description: `Tender ${currentValue ? \"removed from\" : \"added to\"} favourites`,\r\n      })\r\n    } else {\r\n      toast({\r\n        title: \"Error\",\r\n        description: result.error || \"Failed to update tender\",\r\n        variant: \"destructive\",\r\n      })\r\n    }\r\n    setUpdatingTender(null)\r\n  }\r\n\r\n  const handleToggleWishlist = async (tenderId: string, currentValue: boolean) => {\r\n    setUpdatingTender(tenderId)\r\n    const result = await toggleTenderWishlist(tenderId, !currentValue)\r\n    if (result.success) {\r\n      await loadTenders()\r\n      toast({\r\n        title: currentValue ? \"Removed from wishlist\" : \"Added to wishlist\",\r\n        description: `Tender ${currentValue ? \"removed from\" : \"added to\"} wishlist`,\r\n      })\r\n    } else {\r\n      toast({\r\n        title: \"Error\",\r\n        description: result.error || \"Failed to update tender\",\r\n        variant: \"destructive\",\r\n      })\r\n    }\r\n    setUpdatingTender(null)\r\n  }\r\n\r\n  const handleDelete = async (tenderId: string, tenderType?: \"scraped\" | \"custom\") => {\r\n    if (!confirm(\"Are you sure you want to delete this tender?\")) return\r\n\r\n    setUpdatingTender(tenderId)\r\n    const result = await deleteTender(tenderId, tenderType)\r\n    if (result.success) {\r\n      await loadTenders()\r\n      toast({\r\n        title: \"Deleted\",\r\n        description: \"Tender deleted successfully\",\r\n      })\r\n    } else {\r\n      toast({\r\n        title: \"Error\",\r\n        description: result.error || \"Failed to delete tender\",\r\n        variant: \"destructive\",\r\n      })\r\n    }\r\n    setUpdatingTender(null)\r\n  }\r\n\r\n  const getStatusColor = (status: string) => {\r\n    switch (status) {\r\n      case \"draft\":\r\n        return \"bg-muted text-muted-foreground\"\r\n      case \"in-progress\":\r\n        return \"bg-accent/10 text-accent\"\r\n      case \"submitted\":\r\n        return \"bg-secondary/10 text-secondary\"\r\n      default:\r\n        return \"bg-muted text-muted-foreground\"\r\n    }\r\n  }\r\n\r\n  const getStatusLabel = (status: string) => {\r\n    switch (status) {\r\n      case \"draft\":\r\n        return \"Draft\"\r\n      case \"in-progress\":\r\n        return \"In Progress\"\r\n      case \"submitted\":\r\n        return \"Submitted\"\r\n      default:\r\n        return status\r\n    }\r\n  }\r\n\r\n  const getTenderDetailUrl = (tender: UserTender) => {\r\n    return `/dashboard/tenders/${tender.id}`\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"p-6 md:p-8 flex items-center justify-center min-h-[400px]\">\r\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-6 md:p-8 space-y-6\">\r\n      <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold text-foreground mb-2\">My Tenders</h1>\r\n          <p className=\"text-muted-foreground\">Manage and track all your tender submissions</p>\r\n        </div>\r\n        <Button asChild>\r\n          <Link href=\"/dashboard/tenders/new\">\r\n            <Plus className=\"h-4 w-4 mr-2\" />\r\n            New Tender\r\n          </Link>\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Filters */}\r\n      <Card className=\"border-border\">\r\n        <CardContent className=\"p-4\">\r\n          <div className=\"flex flex-col md:flex-row gap-4\">\r\n            <div className=\"flex-1 relative\">\r\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n              <Input\r\n                placeholder=\"Search tenders...\"\r\n                value={searchQuery}\r\n                onChange={(e) => setSearchQuery(e.target.value)}\r\n                className=\"pl-9\"\r\n              />\r\n            </div>\r\n            <div className=\"flex gap-2 flex-wrap\">\r\n              <Button\r\n                variant={statusFilter === \"all\" ? \"default\" : \"outline\"}\r\n                onClick={() => setStatusFilter(\"all\")}\r\n                className={statusFilter !== \"all\" ? \"bg-transparent\" : \"\"}\r\n                size=\"sm\"\r\n              >\r\n                All\r\n              </Button>\r\n              <Button\r\n                variant={statusFilter === \"draft\" ? \"default\" : \"outline\"}\r\n                onClick={() => setStatusFilter(\"draft\")}\r\n                className={statusFilter !== \"draft\" ? \"bg-transparent\" : \"\"}\r\n                size=\"sm\"\r\n              >\r\n                Draft\r\n              </Button>\r\n              <Button\r\n                variant={statusFilter === \"in-progress\" ? \"default\" : \"outline\"}\r\n                onClick={() => setStatusFilter(\"in-progress\")}\r\n                className={statusFilter !== \"in-progress\" ? \"bg-transparent\" : \"\"}\r\n                size=\"sm\"\r\n              >\r\n                In Progress\r\n              </Button>\r\n              <Button\r\n                variant={statusFilter === \"submitted\" ? \"default\" : \"outline\"}\r\n                onClick={() => setStatusFilter(\"submitted\")}\r\n                className={statusFilter !== \"submitted\" ? \"bg-transparent\" : \"\"}\r\n                size=\"sm\"\r\n              >\r\n                Submitted\r\n              </Button>\r\n            </div>\r\n            <div className=\"flex gap-2 flex-wrap\">\r\n              <Button\r\n                variant={showPinned ? \"default\" : \"outline\"}\r\n                onClick={() => setShowPinned(!showPinned)}\r\n                className={!showPinned ? \"bg-transparent\" : \"\"}\r\n                size=\"sm\"\r\n              >\r\n                <Pin className=\"h-4 w-4 mr-2\" />\r\n                Pinned\r\n              </Button>\r\n              <Button\r\n                variant={showFavourited ? \"default\" : \"outline\"}\r\n                onClick={() => setShowFavourited(!showFavourited)}\r\n                className={!showFavourited ? \"bg-transparent\" : \"\"}\r\n                size=\"sm\"\r\n              >\r\n                <Heart className=\"h-4 w-4 mr-2\" />\r\n                Favourites\r\n              </Button>\r\n              <Button\r\n                variant={showWishlisted ? \"default\" : \"outline\"}\r\n                onClick={() => setShowWishlisted(!showWishlisted)}\r\n                className={!showWishlisted ? \"bg-transparent\" : \"\"}\r\n                size=\"sm\"\r\n              >\r\n                <Star className=\"h-4 w-4 mr-2\" />\r\n                Wishlist\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Tenders List */}\r\n      <div className=\"grid gap-4\">\r\n        {filteredTenders.length === 0 ? (\r\n          <Card className=\"border-border\">\r\n            <CardContent className=\"p-12 text-center\">\r\n              <FileText className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\r\n              <h3 className=\"text-lg font-semibold text-foreground mb-2\">No tenders found</h3>\r\n              <p className=\"text-muted-foreground mb-4\">\r\n                {searchQuery || statusFilter !== \"all\" || showPinned || showFavourited || showWishlisted\r\n                  ? \"Try adjusting your filters\"\r\n                  : \"Get started by searching for tenders\"}\r\n              </p>\r\n              {!searchQuery && statusFilter === \"all\" && !showPinned && !showFavourited && !showWishlisted && (\r\n                <Button asChild>\r\n                  <Link href=\"/dashboard/search\">Search Tenders</Link>\r\n                </Button>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        ) : (\r\n          filteredTenders.map((tender) => (\r\n            <Card key={tender.id} className=\"border-border hover:border-primary transition-colors\">\r\n              <CardHeader>\r\n                <div className=\"flex items-start justify-between gap-4\">\r\n                  <div className=\"flex-1\">\r\n                    <div className=\"flex items-center gap-2 mb-2 flex-wrap\">\r\n                      <CardTitle className=\"text-xl\">{tender.title}</CardTitle>\r\n                      <Badge className={getStatusColor(tender.status)}>{getStatusLabel(tender.status)}</Badge>\r\n                      {tender.is_pinned && (\r\n                        <Badge className=\"bg-primary/10 text-primary border-primary/20\">\r\n                          <Pin className=\"h-3 w-3 mr-1\" />\r\n                          Pinned\r\n                        </Badge>\r\n                      )}\r\n                      {tender.is_favourited && (\r\n                        <Badge className=\"bg-red-500/10 text-red-500 border-red-500/20\">\r\n                          <Heart className=\"h-3 w-3 mr-1\" />\r\n                          Favourite\r\n                        </Badge>\r\n                      )}\r\n                      {tender.is_wishlisted && (\r\n                        <Badge className=\"bg-yellow-500/10 text-yellow-500 border-yellow-500/20\">\r\n                          <Star className=\"h-3 w-3 mr-1\" />\r\n                          Wishlist\r\n                        </Badge>\r\n                      )}\r\n                    </div>\r\n                    <CardDescription className=\"flex items-center gap-4 flex-wrap\">\r\n                      <span className=\"flex items-center gap-1\">\r\n                        <Building2 className=\"h-4 w-4\" />\r\n                        {tender.organization}\r\n                      </span>\r\n                      <span className=\"flex items-center gap-1\">\r\n                        <Calendar className=\"h-4 w-4\" />\r\n                        Deadline: {new Date(tender.close_date).toLocaleDateString()}\r\n                      </span>\r\n                      {tender.value && (\r\n                        <span className=\"flex items-center gap-1\">\r\n                          <DollarSign className=\"h-4 w-4\" />\r\n                          {tender.value}\r\n                        </span>\r\n                      )}\r\n                    </CardDescription>\r\n                  </div>\r\n                  <div className=\"flex gap-2 flex-wrap\">\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      size=\"icon\"\r\n                      onClick={() => handleTogglePin(tender.id, tender.is_pinned)}\r\n                      disabled={updatingTender === tender.id}\r\n                      className={tender.is_pinned ? \"bg-primary/10 text-primary\" : \"bg-transparent\"}\r\n                    >\r\n                      <Pin className=\"h-4 w-4\" />\r\n                    </Button>\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      size=\"icon\"\r\n                      onClick={() => handleToggleFavourite(tender.id, tender.is_favourited)}\r\n                      disabled={updatingTender === tender.id}\r\n                      className={tender.is_favourited ? \"bg-red-500/10 text-red-500\" : \"bg-transparent\"}\r\n                    >\r\n                      <Heart className=\"h-4 w-4\" />\r\n                    </Button>\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      size=\"icon\"\r\n                      onClick={() => handleToggleWishlist(tender.id, tender.is_wishlisted)}\r\n                      disabled={updatingTender === tender.id}\r\n                      className={tender.is_wishlisted ? \"bg-yellow-500/10 text-yellow-500\" : \"bg-transparent\"}\r\n                    >\r\n                      <Star className=\"h-4 w-4\" />\r\n                    </Button>\r\n                    <Button variant=\"outline\" size=\"icon\" asChild className=\"bg-transparent\">\r\n                      <Link href={getTenderDetailUrl(tender)}>\r\n                        <Eye className=\"h-4 w-4\" />\r\n                      </Link>\r\n                    </Button>\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      size=\"icon\"\r\n                      onClick={() => handleDelete(tender.id, tender.tender_type)}\r\n                      disabled={updatingTender === tender.id}\r\n                      className=\"bg-transparent text-destructive hover:text-destructive\"\r\n                    >\r\n                      <Trash2 className=\"h-4 w-4\" />\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              </CardHeader>\r\n            </Card>\r\n          ))\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}}]
}