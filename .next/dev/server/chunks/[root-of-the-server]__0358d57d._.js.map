{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Repo/LogsOfN/v0-bid-mate-ai/app/api/tenders/scraped/%5Bid%5D/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\r\nimport { createClient } from \"@supabase/supabase-js\"\r\n\r\nexport async function GET(request: NextRequest, { params }: { params: { id: string } }) {\r\n  try {\r\n    const { id } = await params\r\n\r\n    console.log(\"[v0] Fetching scraped tender:\", id)\r\n\r\n    const supabase = createClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.SUPABASE_SERVICE_ROLE_KEY!)\r\n\r\n    // Fetch the tender\r\n    const { data: tender, error: tenderError } = await supabase\r\n      .from(\"scraped_tenders\")\r\n      .select(\"*\")\r\n      .eq(\"id\", id)\r\n      .single()\r\n\r\n    if (tenderError) {\r\n      console.error(\"[v0] Error fetching tender:\", tenderError)\r\n      return NextResponse.json({ error: \"Tender not found\", details: tenderError.message }, { status: 404 })\r\n    }\r\n\r\n    if (!tender) {\r\n      console.error(\"[v0] No tender found for id:\", id)\r\n      return NextResponse.json({ error: \"Tender not found\" }, { status: 404 })\r\n    }\r\n\r\n    const { data: documents, error: docsError } = await supabase\r\n      .from(\"tender_documents\")\r\n      .select(\"*\")\r\n      .eq(\"tender_id\", id.toString())\r\n      .order(\"created_at\", { ascending: false })\r\n\r\n    if (docsError) {\r\n      console.error(\"[v0] Error fetching documents:\", docsError)\r\n    }\r\n\r\n    const { data: analysisData, error: analysisError } = await supabase\r\n      .from(\"tender_analysis\")\r\n      .select(\"*\")\r\n      .eq(\"tender_id\", id.toString())\r\n      .order(\"created_at\", { ascending: false })\r\n      .limit(1)\r\n      .single()\r\n\r\n    if (analysisError && analysisError.code !== \"PGRST116\") {\r\n      console.error(\"[v0] Error fetching analysis:\", analysisError)\r\n    }\r\n\r\n    console.log(\"[v0] Found tender with\", documents?.length || 0, \"documents\", analysisData ? \"and analysis\" : \"\")\r\n\r\n    return NextResponse.json({\r\n      tender,\r\n      documents: documents || [],\r\n      analysis: analysisData?.analysis_data || null, // Include analysis in response\r\n    })\r\n  } catch (error) {\r\n    console.error(\"[v0] Error in scraped tender API:\", error)\r\n    return NextResponse.json({ error: \"Internal server error\" }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,OAAoB,EAAE,EAAE,MAAM,EAA8B;IACpF,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QAErB,QAAQ,GAAG,CAAC,iCAAiC;QAE7C,MAAM,WAAW,IAAA,0QAAY,gFAAwC,QAAQ,GAAG,CAAC,yBAAyB;QAE1G,mBAAmB;QACnB,MAAM,EAAE,MAAM,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SAChD,IAAI,CAAC,mBACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,IACT,MAAM;QAET,IAAI,aAAa;YACf,QAAQ,KAAK,CAAC,+BAA+B;YAC7C,OAAO,sPAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;gBAAoB,SAAS,YAAY,OAAO;YAAC,GAAG;gBAAE,QAAQ;YAAI;QACtG;QAEA,IAAI,CAAC,QAAQ;YACX,QAAQ,KAAK,CAAC,gCAAgC;YAC9C,OAAO,sPAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,MAAM,EAAE,MAAM,SAAS,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,SACjD,IAAI,CAAC,oBACL,MAAM,CAAC,KACP,EAAE,CAAC,aAAa,GAAG,QAAQ,IAC3B,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM;QAE1C,IAAI,WAAW;YACb,QAAQ,KAAK,CAAC,kCAAkC;QAClD;QAEA,MAAM,EAAE,MAAM,YAAY,EAAE,OAAO,aAAa,EAAE,GAAG,MAAM,SACxD,IAAI,CAAC,mBACL,MAAM,CAAC,KACP,EAAE,CAAC,aAAa,GAAG,QAAQ,IAC3B,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM,GACvC,KAAK,CAAC,GACN,MAAM;QAET,IAAI,iBAAiB,cAAc,IAAI,KAAK,YAAY;YACtD,QAAQ,KAAK,CAAC,iCAAiC;QACjD;QAEA,QAAQ,GAAG,CAAC,0BAA0B,WAAW,UAAU,GAAG,aAAa,eAAe,iBAAiB;QAE3G,OAAO,sPAAY,CAAC,IAAI,CAAC;YACvB;YACA,WAAW,aAAa,EAAE;YAC1B,UAAU,cAAc,iBAAiB;QAC3C;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qCAAqC;QACnD,OAAO,sPAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}