{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///C:/Repo/LogsOfN/v0-bid-mate-ai/lib/providers/index.ts"],"sourcesContent":["import OpenAI from \"openai\"\r\nimport { streamText as aiStreamText, convertToModelMessages as aiConvertToModelMessages, DefaultChatTransport as aiDefaultChatTransport } from \"ai\"\r\n\r\ntype GenerateOptions = {\r\n  model: string\r\n  prompt: string\r\n  system?: string\r\n  temperature?: number\r\n  maxTokens?: number\r\n}\r\n\r\n/**\r\n * Simple provider abstraction with retry logic and fallbacks.\r\n * - If `AZURE_OPENAI_ENDPOINT` + `AZURE_OPENAI_KEY` + `AZURE_OPENAI_DEPLOYMENT` are set, calls Azure OpenAI chat completions.\r\n * - Otherwise tries Gemini (stable v1 endpoint)\r\n * - Falls back to OpenAI if Gemini fails\r\n * - Implements exponential backoff retry for transient failures\r\n */\r\nexport async function generateTextViaProvider(opts: GenerateOptions) {\r\n  const { model, prompt } = opts\r\n  const maxRetries = 3\r\n  let lastError: Error | null = null\r\n\r\n  for (let attempt = 1; attempt <= maxRetries; attempt++) {\r\n    try {\r\n      // Prefer Azure if configured\r\n      const azureEndpoint = process.env.AZURE_OPENAI_ENDPOINT\r\n      const azureKey = process.env.AZURE_OPENAI_KEY\r\n      const azureDeployment = process.env.AZURE_OPENAI_DEPLOYMENT\r\n\r\n      if (azureEndpoint && azureKey && azureDeployment) {\r\n        // Use Azure Chat Completions endpoint\r\n        const url = `${azureEndpoint.replace(/\\/$/, \"\")}/openai/deployments/${azureDeployment}/chat/completions?api-version=2023-05-15`\r\n        const body = {\r\n          messages: [{ role: \"system\", content: opts.system || \"\" }, { role: \"user\", content: prompt }],\r\n          max_tokens: opts.maxTokens || 1500,\r\n          temperature: typeof opts.temperature === \"number\" ? opts.temperature : 0.2,\r\n        }\r\n\r\n        const res = await fetch(url, {\r\n          method: \"POST\",\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            \"api-key\": azureKey,\r\n          },\r\n          body: JSON.stringify(body),\r\n        })\r\n\r\n        if (!res.ok) {\r\n          const text = await res.text()\r\n          throw new ProviderError(`Azure OpenAI request failed: ${res.status} ${text}`, res.status)\r\n        }\r\n\r\n        const data = await res.json()\r\n        const content = data?.choices?.[0]?.message?.content || data?.choices?.[0]?.text\r\n        return { text: content ?? \"\" }\r\n      }\r\n\r\n      // Prefer Gemini/Google when a key is present (allow explicit model or default)\r\n      let geminiKey = process.env.GEMINI_API_KEY || process.env.GOOGLE_API_KEY\r\n\r\n      if (geminiKey) {\r\n        geminiKey = geminiKey.trim()\r\n        const geminiModel = process.env.GEMINI_MODEL || (model.includes(\"gemini\") ? model : \"gemini-2.5-flash\")\r\n        const apiVersion = \"v1\"\r\n        const baseUrl = `https://generativelanguage.googleapis.com/${apiVersion}/models/${geminiModel}`\r\n\r\n        console.log(`[v0] Provider: Gemini (Model: ${geminiModel}, API: ${apiVersion}) - attempt ${attempt}/${maxRetries}`)\r\n\r\n        // Primary request shape: `contents` + `generationConfig` (matches models list supportedGenerationMethods)\r\n        const url = `${baseUrl}:generateContent?key=${geminiKey}`\r\n        const primaryBody = {\r\n          contents: [\r\n            {\r\n              role: \"user\",\r\n              parts: [{ text: `${opts.system ? opts.system + \"\\n\\n\" : \"\"}${prompt}` }],\r\n            },\r\n          ],\r\n          generationConfig: {\r\n            temperature: typeof opts.temperature === \"number\" ? opts.temperature : 0.2,\r\n            maxOutputTokens: opts.maxTokens || 4000,\r\n          },\r\n        }\r\n\r\n        try {\r\n          const res = await fetch(url, {\r\n            method: \"POST\",\r\n            headers: { \"Content-Type\": \"application/json\" },\r\n            body: JSON.stringify(primaryBody),\r\n            signal: AbortSignal.timeout(60000),\r\n          })\r\n\r\n          const text = await res.text()\r\n          if (!res.ok) {\r\n            console.error(`[v0] Gemini Error (${res.status}): ${text}`)\r\n            if (res.status === 429 || res.status === 403) {\r\n              throw new ProviderError(`Gemini API quota/rate limit: ${res.status}`, res.status, true)\r\n            }\r\n            throw new ProviderError(`Gemini API request failed: ${res.status} ${text}`, res.status)\r\n          }\r\n\r\n          let data: any\r\n          try { data = JSON.parse(text) } catch (e) { data = null }\r\n\r\n          const content = data?.candidates?.[0]?.content?.parts?.[0]?.text || data?.candidates?.[0]?.content?.text || data?.output?.[0]?.content?.text || data?.response?.output_text || data?.generated_text || (typeof data === 'string' ? data : null)\r\n\r\n          if (!content) {\r\n            console.error('[v0] Gemini returned no content in primary response shape:', data)\r\n            throw new ProviderError('Gemini returned empty response', 500)\r\n          }\r\n\r\n          return { text: String(content) }\r\n        } catch (err: any) {\r\n          console.error('[v0] Gemini primary request failed:', err?.message || err)\r\n          // Allow outer retry loop to fallback to other providers\r\n          if (err instanceof ProviderError && err.shouldFallback) throw err\r\n          lastError = err\r\n        }\r\n      }\r\n\r\n      // Fallback: OpenAI (openai package must be installed and `OPENAI_API_KEY` set)\r\n      const openaiKey = process.env.OPENAI_API_KEY\r\n      if (!openaiKey) throw new ProviderError(\"No OpenAI credentials found (set OPENAI_API_KEY or AZURE_OPENAI_* env vars)\", 500)\r\n\r\n      console.log(`[v0] Provider: OpenAI - attempt ${attempt}/${maxRetries}`)\r\n\r\n      const client = new OpenAI({ apiKey: openaiKey })\r\n\r\n      const resp = await client.chat.completions.create({\r\n        model,\r\n        messages: [{ role: \"system\", content: opts.system || \"\" }, { role: \"user\", content: prompt }],\r\n        max_tokens: opts.maxTokens || 1500,\r\n        temperature: typeof opts.temperature === \"number\" ? opts.temperature : 0.2,\r\n      })\r\n\r\n      const content = resp.choices?.[0]?.message?.content\r\n      return { text: content ?? \"\" }\r\n\r\n    } catch (error: any) {\r\n      lastError = error\r\n      const shouldFallback = error instanceof ProviderError && error.shouldFallback\r\n\r\n      console.error(`[v0] Provider attempt ${attempt}/${maxRetries} failed:`, error.message)\r\n\r\n      // If this was a quota/rate limit error, try different provider immediately\r\n      if (shouldFallback && attempt < maxRetries) {\r\n        console.log('[v0] Attempting fallback to different provider...')\r\n        continue\r\n      }\r\n\r\n      // For other errors, use exponential backoff before retry\r\n      if (attempt < maxRetries) {\r\n        const delay = Math.pow(2, attempt) * 1000\r\n        console.log(`[v0] Retrying in ${delay}ms...`)\r\n        await sleep(delay)\r\n        continue\r\n      }\r\n\r\n      // Max retries exceeded\r\n      break\r\n    }\r\n  }\r\n\r\n  // All attempts failed\r\n  throw new ProviderError(\r\n    `All AI providers failed after ${maxRetries} attempts. Last error: ${lastError?.message}`,\r\n    500\r\n  )\r\n}\r\n\r\n// Helper class for provider errors\r\nclass ProviderError extends Error {\r\n  statusCode: number\r\n  shouldFallback: boolean\r\n\r\n  constructor(message: string, statusCode: number, shouldFallback: boolean = false) {\r\n    super(message)\r\n    this.name = 'ProviderError'\r\n    this.statusCode = statusCode\r\n    this.shouldFallback = shouldFallback\r\n  }\r\n}\r\n\r\n// Helper sleep function\r\nfunction sleep(ms: number): Promise<void> {\r\n  return new Promise(resolve => setTimeout(resolve, ms))\r\n}\r\n\r\nexport default generateTextViaProvider\r\n\r\n// Streaming wrapper that delegates to the `ai` SDK but injects provider credentials\r\ntype StreamOptions = {\r\n  model: string\r\n  messages: Array<{ role: string; content: string }>\r\n  temperature?: number\r\n  maxTokens?: number\r\n  abortSignal?: AbortSignal\r\n  onFinish?: (args: { text: string; isAborted?: boolean }) => Promise<void> | void\r\n}\r\n\r\nexport function streamTextViaProvider(opts: StreamOptions) {\r\n  const openaiKey = process.env.OPENAI_API_KEY\r\n  const azureEndpoint = process.env.AZURE_OPENAI_ENDPOINT\r\n  const azureKey = process.env.AZURE_OPENAI_KEY\r\n\r\n  const providerOptions: any = {}\r\n  if (azureEndpoint && azureKey) {\r\n    providerOptions.azure = {\r\n      apiKey: azureKey,\r\n      endpoint: azureEndpoint,\r\n    }\r\n  } else if (openaiKey) {\r\n    providerOptions.openai = {\r\n      apiKey: openaiKey,\r\n    }\r\n  }\r\n\r\n  // Delegate to ai.streamText, preserving the SDK's stream response helpers\r\n  return aiStreamText({\r\n    model: opts.model,\r\n    messages: opts.messages,\r\n    temperature: typeof opts.temperature === \"number\" ? opts.temperature : 0.2,\r\n    maxTokens: opts.maxTokens || 1500,\r\n    abortSignal: opts.abortSignal,\r\n    onFinish: opts.onFinish,\r\n    providerOptions,\r\n  } as any)\r\n}\r\n\r\nexport const convertToModelMessages = aiConvertToModelMessages\r\nexport const DefaultChatTransport = aiDefaultChatTransport\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 256, "column": 0}, "map": {"version":3,"sources":["file:///C:/Repo/LogsOfN/v0-bid-mate-ai/lib/prompts/original-analysis-prompt.ts"],"sourcesContent":["/**\r\n * ORIGINAL AI ANALYSIS PROMPT\r\n *\r\n * This is the original, production-tested prompt for tender document analysis.\r\n * DO NOT MODIFY THIS FILE - it serves as a backup/reference.\r\n *\r\n * To test custom prompts, edit custom-analysis-prompt.ts instead.\r\n */\r\n\r\nexport const ORIGINAL_ANALYSIS_PROMPT = `You are an elite tender analyst with 20+ years of experience helping companies win government and corporate tenders. Your analysis must be thorough, actionable, and strategically valuable.\r\n\r\n===========================================\r\nCRITICAL METADATA EXTRACTION RULES\r\n===========================================\r\n\r\nExtract the following with ABSOLUTE PRECISION:\r\n\r\n1. TENDER TITLE:\r\n   - Extract the EXACT official title word-for-word\r\n   - Look in: Document header, \"Tender Name/Title\", \"Project Name\", \"RFP/RFQ/RFB Title\", \"Bid Number\"\r\n   - Common locations: First page header, title page, section 1\r\n   - DO NOT paraphrase, summarize, or interpret\r\n   - If multiple titles, use the most prominent/official one\r\n   - Example: \"Supply and Delivery of Medical Equipment to Provincial Hospitals\"\r\n\r\n2. ISSUING ORGANIZATION:\r\n   - Extract FULL official name including all hierarchy levels\r\n   - Look for: \"Issued by\", \"Procuring Entity\", \"Department\", \"Ministry\", \"Tender Authority\"\r\n   - Include: Department, Division, Province/Region, Country if specified\r\n   - Example: \"Department of Health, Western Cape Provincial Government, South Africa\"\r\n   - DO NOT abbreviate official names\r\n\r\n3. SUBMISSION DEADLINE:\r\n   - Extract FINAL submission date ONLY (no time component)\r\n   - Look for: \"Closing Date\", \"Submission Deadline\", \"Due Date\", \"Closing Time\", \"Tender Closes\"\r\n   - Format: YYYY-MM-DD ONLY (e.g., \"2024-03-15\")\r\n   - CRITICAL: DO NOT include time (HH:MM) in the deadline field\r\n   - If time is mentioned, include it in the deadlines array instead\r\n   - If unclear, note \"See deadlines section for details\"\r\n\r\n4. TENDER VALUE/BUDGET:\r\n   - Extract estimated contract value, budget range, or ceiling price\r\n   - Look for: \"Tender Value\", \"Estimated Budget\", \"Contract Value\", \"Price Range\", \"Maximum Price\"\r\n   - Include currency and amount: \"R 2,500,000\" or \"ZAR 2.5M\" or \"R 1M - R 3M\"\r\n   - If range, include both min and max\r\n   - If not stated: \"Not specified\" (never guess)\r\n\r\n5. CATEGORY:\r\n   - Classify accurately based on primary deliverable\r\n   - Categories: Construction, IT Services, Medical Supplies, Consulting, Professional Services, \r\n     Goods Supply, Maintenance, Security Services, Catering, Transport, Training, etc.\r\n   - Be specific: \"Medical Equipment Supply\" not just \"Supplies\"\r\n\r\n6. LOCATION:\r\n   - Extract project location, service area, or delivery address\r\n   - Look for: \"Location\", \"Project Site\", \"Delivery Address\", \"Service Area\", \"Province\"\r\n   - Include: City, Province/State, Country\r\n   - Example: \"Cape Town, Western Cape, South Africa\"\r\n\r\n===========================================\r\nCOMPREHENSIVE ANALYSIS REQUIREMENTS\r\n===========================================\r\n\r\nSUMMARY (5-7 sentences, highly informative):\r\nWrite a compelling executive summary that covers:\r\n- What is being procured (specific goods/services/works with quantities if mentioned)\r\n- Who is procuring it (organization, department, context)\r\n- Why it's being procured (background, problem being solved, objectives)\r\n- Key scope elements and main deliverables\r\n- Contract duration and key dates\r\n- Estimated value and budget considerations\r\n- Any unique or notable aspects of this tender\r\n\r\nMake it detailed enough that someone can understand the tender without reading the full document.\r\n\r\nKEY REQUIREMENTS (Extract ALL, be exhaustively specific):\r\nList EVERY requirement mentioned in the document, organized by category:\r\n\r\nMandatory Qualifications:\r\n- Professional registrations (e.g., \"Must be registered with Engineering Council of SA\")\r\n- Industry certifications (e.g., \"ISO 9001:2015 certification required\")\r\n- Licenses and permits\r\n- Minimum years in business\r\n- Minimum staff numbers\r\n\r\nTechnical Specifications:\r\n- Exact product specifications, models, standards\r\n- Technical standards to comply with (e.g., \"SANS 10142-1:2012\")\r\n- Performance requirements and KPIs\r\n- Quality standards\r\n- Testing and inspection requirements\r\n\r\nExperience Requirements:\r\n- Minimum years of relevant experience\r\n- Number of similar projects required (e.g., \"Minimum 3 similar projects in last 5 years\")\r\n- Specific industry experience\r\n- Geographic experience requirements\r\n- Project size/value experience\r\n\r\nFinancial Requirements:\r\n- Minimum annual turnover (e.g., \"R 5M annual turnover for last 3 years\")\r\n- Bank guarantees or bonds required\r\n- Insurance requirements (amounts and types)\r\n- Financial statements required\r\n- Credit rating requirements\r\n\r\nRegistration & Compliance:\r\n- Tax compliance (e.g., \"Valid tax clearance certificate\")\r\n- BBBEE requirements (level, points, certificates)\r\n- Industry body registrations\r\n- Labor compliance\r\n- Environmental compliance\r\n\r\nStaffing & Resources:\r\n- Key personnel requirements (qualifications, experience)\r\n- Minimum team size\r\n- Equipment and facilities required\r\n- Subcontracting limitations\r\n- Local content requirements\r\n\r\nDEADLINES (Extract ALL dates with full context, INCLUDING TIME):\r\nCreate a comprehensive timeline with:\r\n- Briefing session: Date, time, venue, RSVP requirements\r\n- Site visits: Dates, times, meeting points, mandatory/optional\r\n- Clarification questions deadline: Date, time, submission method\r\n- Addendum release dates\r\n- Document submission deadline: Date, time, location/method\r\n- Presentation/interview dates (if scheduled)\r\n- Contract award date (estimated)\r\n- Contract start date\r\n- Project milestones and completion dates\r\n- Payment schedule dates\r\n\r\nFormat each as: \"Action - Date Time - Details\"\r\nExample: \"Compulsory site visit - 2024-02-15 10:00 - Meet at main gate, RSVP by 2024-02-13\"\r\nExample: \"Submission deadline - 2024-03-15 11:00 - Submit to procurement office\"\r\n\r\nNOTE: Include time information in the deadlines array, but NOT in the metadata deadline field.\r\n\r\nEVALUATION CRITERIA (Extract exact scoring methodology):\r\nProvide the complete evaluation breakdown:\r\n\r\nPrice/Cost Component:\r\n- Points allocated (e.g., \"Price: 80 points\")\r\n- Calculation method (e.g., \"Lowest price gets 80 points, others pro-rata\")\r\n\r\nTechnical Component:\r\n- Technical capability points\r\n- Methodology and approach points\r\n- Project plan and timeline points\r\n- Quality assurance points\r\n\r\nExperience & Track Record:\r\n- Relevant experience points\r\n- Similar projects points\r\n- References points\r\n\r\nBBBEE/Transformation:\r\n- BBBEE points breakdown by level\r\n- Local content points\r\n- Subcontracting to SMMEs points\r\n\r\nOther Factors:\r\n- Presentation/interview points\r\n- Financial stability points\r\n- Health & safety record points\r\n\r\nMinimum Requirements:\r\n- Minimum qualifying scores\r\n- Threshold requirements\r\n- Disqualification criteria\r\n\r\nEvaluation Process:\r\n- Two-stage vs single-stage\r\n- Evaluation committee composition\r\n- Evaluation timeline\r\n\r\nRECOMMENDATIONS (Strategic, actionable advice):\r\nProvide expert strategic guidance:\r\n\r\nCritical Success Factors:\r\n- Top 3-5 factors that will determine bid success\r\n- Must-have vs nice-to-have elements\r\n- Common pitfalls to avoid\r\n\r\nCompetitive Positioning:\r\n- How to differentiate from competitors\r\n- Key value propositions to emphasize\r\n- Unique selling points to highlight\r\n\r\nRisk Mitigation:\r\n- Potential challenges and how to address them\r\n- Risk areas requiring special attention\r\n- Contingency planning needs\r\n\r\nResource Allocation:\r\n- Where to focus time and effort\r\n- Which sections need most attention\r\n- Team composition recommendations\r\n\r\nPartnership Strategy:\r\n- Whether partnerships/JVs are advisable\r\n- Types of partners to consider\r\n- Subcontracting opportunities\r\n\r\nPricing Strategy:\r\n- Pricing considerations and approach\r\n- Value engineering opportunities\r\n- Cost optimization areas\r\n\r\nCOMPLIANCE CHECKLIST (Comprehensive list):\r\nCreate a detailed checklist of ALL mandatory requirements:\r\n- Documents to submit (with quantities, e.g., \"3 original copies + 1 electronic\")\r\n- Certificates and licenses needed\r\n- Forms to complete (list each form)\r\n- Declarations to sign\r\n- Samples or prototypes required\r\n- Formatting requirements (page limits, binding, etc.)\r\n- Submission method and location\r\n- Packaging and labeling requirements\r\n\r\nACTIONABLE TASKS (Detailed, prioritized, time-bound):\r\nCreate a comprehensive task list with:\r\n\r\nHIGH PRIORITY (Critical path, early deadlines):\r\n- Tasks that must be done first\r\n- Tasks with imminent deadlines\r\n- Mandatory requirements\r\n- Long lead-time items\r\nExample: \"Obtain tax clearance certificate - Due: 2024-02-20 - Category: compliance\"\r\n\r\nMEDIUM PRIORITY (Important but not urgent):\r\n- Important preparation tasks\r\n- Standard requirements\r\n- Supporting documentation\r\nExample: \"Prepare company profile and credentials - Due: 2024-03-01 - Category: documentation\"\r\n\r\nLOW PRIORITY (Optional or later-stage):\r\n- Nice-to-have elements\r\n- Final touches\r\n- Post-submission tasks\r\nExample: \"Prepare presentation materials for interview - Due: TBD - Category: other\"\r\n\r\nFor each task include:\r\n- Specific action required\r\n- Deadline (if mentioned) - Format as YYYY-MM-DD ONLY (no time)\r\n- Category (documentation/technical/financial/compliance/other)\r\n- Priority level\r\n\r\n===========================================\r\nEXTRACTION PRINCIPLES\r\n===========================================\r\n\r\n1. ACCURACY: Extract exact information, never paraphrase official terms\r\n2. COMPLETENESS: Include ALL requirements, even minor ones\r\n3. SPECIFICITY: Provide specific details, numbers, dates, amounts\r\n4. CLARITY: Use clear, unambiguous language\r\n5. STRUCTURE: Organize information logically\r\n6. CONTEXT: Provide context for requirements\r\n7. HONESTY: If information is not found, state \"Not specified\" - never guess\r\n8. ACTIONABILITY: Make recommendations practical and implementable\r\n9. DATE FORMAT: Always use YYYY-MM-DD format for dates (no time in metadata deadline field)`\r\n"],"names":[],"mappings":"AAAA;;;;;;;CAOC;;;;AAEM,MAAM,2BAA2B,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;2FA4PkD,CAAC"}},
    {"offset": {"line": 524, "column": 0}, "map": {"version":3,"sources":["file:///C:/Repo/LogsOfN/v0-bid-mate-ai/lib/prompts/custom-analysis-prompt.ts"],"sourcesContent":["/**\r\n * CUSTOM AI ANALYSIS PROMPT\r\n *\r\n * This is your testing ground for prompt engineering.\r\n * Modify this prompt to experiment with different analysis approaches.\r\n *\r\n * To revert to the original prompt, copy from original-analysis-prompt.ts\r\n * or set USE_CUSTOM_PROMPT=false in your environment variables.\r\n */\r\n\r\nexport const CUSTOM_ANALYSIS_PROMPT = `You are BidMate AI, an intelligent tender analysis system for South African government and SOE procurement documents.\r\n\r\nYour task: Analyze the tender document and extract structured information to help users prepare winning bids.\r\n\r\n---\r\n\r\n### STEP 1 — EXTRACT TENDER SUMMARY\r\nExtract basic tender information:\r\n- tender_number: Reference/RFP number (e.g., \"RFB0094/25-26\")\r\n- title: Full tender title\r\n- entity: Issuing organization (e.g., \"Dept of Education\", \"City of Cape Town\")\r\n- description: Brief scope (2-3 sentences)\r\n- contract_duration: Contract period (e.g., \"36 months\")\r\n- closing_date: Deadline in YYYY-MM-DD format\r\n- submission_method: How to submit (e.g., \"Manual drop-off at tender box\", \"Online portal\")\r\n- compulsory_briefing: Briefing details with date/time/location, or \"None\"\r\n- validity_period: Bid validity (e.g., \"120 days\")\r\n- contact_email: Email for queries\r\n\r\nIf any field is missing, use \"Not specified\" for text or \"2024-12-31\" for dates.\r\n\r\n---\r\n\r\n### STEP 2 — IDENTIFY COMPLIANCE REQUIREMENTS\r\nCategorize requirements into three lists:\r\n\r\n**requirements**: Mandatory items that must be provided\r\n- Examples: \"Valid CSD registration\", \"Tax clearance certificate\", \"Signed MBD forms\", \"CIDB Grade 6CE or higher\"\r\n\r\n**disqualifiers**: Actions/omissions that cause automatic elimination\r\n- Examples: \"Late submission\", \"Unsigned forms\", \"Missing compulsory briefing attendance\", \"Non-compliant pricing format\"\r\n\r\n**strengtheners**: Items that improve bid quality/scoring\r\n- Examples: \"BBBEE Level 1-4 certification\", \"Relevant project references\", \"ISO certifications\", \"Local content commitment\"\r\n\r\n---\r\n\r\n### STEP 3 — EXTRACT EVALUATION CRITERIA\r\nIdentify how bids will be scored:\r\n\r\n**criteria**: List each evaluation factor with its weight as a NUMBER (not percentage)\r\n- Example: { \"criterion\": \"Price\", \"weight\": 80 }\r\n- Example: { \"criterion\": \"BBBEE Status\", \"weight\": 20 }\r\n\r\n**threshold**: Minimum qualifying score (e.g., \"70%\", \"60 points\")\r\n\r\n**pricing_system**: Preference point system (e.g., \"80/20\", \"90/10\", \"Point-based\")\r\n\r\n---\r\n\r\n### STEP 4 — CREATE ACTION PLAN\r\nGenerate two lists to help users prepare:\r\n\r\n**critical_dates**: Important dates with full details\r\n- date: YYYY-MM-DD format\r\n- event: What happens (e.g., \"Compulsory site visit\", \"Closing date\")\r\n- time: HH:MM format or \"Not specified\"\r\n- location: Physical location or \"N/A\"\r\n\r\n**preparation_tasks**: Prioritized checklist of what to do\r\n- task: Clear action item (e.g., \"Obtain tax clearance certificate\")\r\n- priority: \"High\", \"Medium\", or \"Low\"\r\n- deadline: YYYY-MM-DD or \"Before submission\"\r\n- category: \"Compliance\", \"Documentation\", \"Technical\", or \"Financial\"\r\n\r\nInclude 5-10 tasks covering all major requirements.\r\n\r\n---\r\n\r\n### STEP 5 — EXTRACT FINANCIAL REQUIREMENTS\r\nIdentify all financial obligations and requirements:\r\n\r\n- bank_guarantee: Amount and duration (e.g., \"10% of contract value for 12 months\")\r\n- performance_bond: Amount and conditions\r\n- insurance_requirements: List of required insurance types with coverage amounts\r\n- financial_turnover: Minimum annual turnover requirement\r\n- audited_financials: Period required (e.g., \"Last 3 years\")\r\n- payment_terms: Payment schedule, retention amounts, payment timeframes\r\n\r\n---\r\n\r\n### STEP 6 — EXTRACT LEGAL & REGISTRATION REQUIREMENTS\r\nIdentify all registration and legal requirements:\r\n\r\n- cidb_grading: Specific CIDB grade required (e.g., \"CE6\", \"GB4\")\r\n- cipc_registration: Company registration requirements\r\n- professional_registration: Required professional bodies (SACPCMP, ECSA, SACAP, etc.)\r\n- joint_venture_requirements: JV limitations or requirements\r\n- subcontracting_limitations: Maximum percentage allowed\r\n\r\n---\r\n\r\n### STEP 7 — EXTRACT LABOUR & EMPLOYMENT REQUIREMENTS\r\nIdentify workforce and local content requirements:\r\n\r\n- local_content: Required percentage (e.g., \"100%\", \"60%\")\r\n- subcontracting_limit: Maximum subcontracting percentage\r\n- labour_composition: Required workforce demographics\r\n- skills_development: Training or skills levy requirements\r\n- employment_equity: EE plan requirements\r\n\r\n---\r\n\r\n### STEP 8 — EXTRACT TECHNICAL SPECIFICATIONS\r\nIdentify experience and capability requirements:\r\n\r\n- minimum_experience: Years of experience required (e.g., \"5 years in similar projects\")\r\n- project_references: Number and value of similar projects required\r\n- key_personnel: Qualifications and experience for key staff\r\n- equipment_resources: Required machinery, vehicles, or equipment\r\n- methodology_requirements: Expected approach or methodology\r\n\r\n---\r\n\r\n### STEP 9 — EXTRACT SUBMISSION REQUIREMENTS\r\nIdentify how to submit the tender:\r\n\r\n- number_of_copies: Hard and soft copies required\r\n- formatting_requirements: Page limits, font sizes, binding\r\n- submission_address: Physical address or portal URL\r\n- query_deadline: Last date for questions\r\n- late_submission_policy: Whether late submissions are accepted\r\n\r\n---\r\n\r\n### STEP 10 — EXTRACT PENALTIES & PAYMENT TERMS\r\nIdentify financial penalties and payment structure:\r\n\r\n- late_completion_penalty: Daily or percentage penalty\r\n- non_performance_penalty: Penalties for not meeting KPIs\r\n- warranty_period: Defects liability period\r\n- payment_schedule: Monthly, milestone-based, etc.\r\n- retention_amount: Percentage held back\r\n- payment_timeframe: Days from invoice (e.g., \"30 days\")\r\n\r\n---\r\n\r\n### STEP 11 — EXTRACT ALL FILLABLE FORM FIELDS\r\nCRITICAL: You must scan the ENTIRE document and extract EVERY field that needs to be filled in by the bidder.\r\n\r\n**SCAN FOR THESE SPECIFIC ELEMENTS:**\r\n\r\n1. **Standard Bid Documents (SBD Forms)**:\r\n   - SBD 1: Invitation to Bid (company details, contact info, pricing totals)\r\n   - SBD 2: Tax Clearance Certificate requirements\r\n   - SBD 3.1: Pricing Schedule - Firm Prices (line items, quantities, rates, totals)\r\n   - SBD 3.2: Pricing Schedule - Non-Firm Prices\r\n   - SBD 3.3: Pricing Schedule - Professional Services\r\n   - SBD 4: Declaration of Interest (director details, relationships, conflicts)\r\n   - SBD 6.1: Preference Points Claim Form (BBBEE level, ownership)\r\n   - SBD 6.2: Local Content Declaration\r\n   - SBD 7.1: Contract Form - Purchase of Goods\r\n   - SBD 7.2: Contract Form - Rendering of Services\r\n   - SBD 7.3: Contract Form - Disposal of Assets\r\n   - SBD 8: Declaration of Bidder's Past SCM Practices\r\n   - SBD 9: Certificate of Independent Bid Determination\r\n\r\n2. **Municipal Bid Documents (MBD Forms)**:\r\n   - MBD 1: Invitation to Bid\r\n   - MBD 4: Declaration of Interest\r\n   - MBD 5: Declaration for Procurement above R10 million\r\n   - MBD 6.1: Preference Points Claim Form\r\n   - MBD 6.2: Local Content Declaration\r\n   - MBD 7.1-7.3: Contract Forms\r\n   - MBD 8: Declaration of Bidder's Past SCM Practices\r\n   - MBD 9: Certificate of Independent Bid Determination\r\n\r\n3. **Tables and Schedules to Complete**:\r\n   - Pricing schedules with columns (item, description, quantity, unit, rate, amount)\r\n   - Bill of Quantities (BOQ)\r\n   - Resource schedules (equipment, personnel)\r\n   - Project programme/timeline tables\r\n   - Experience/reference tables\r\n\r\n4. **Declaration and Certification Fields**:\r\n   - Signature blocks (name, designation, date, signature)\r\n   - Witness signatures\r\n   - Commissioner of Oaths sections\r\n   - Director/shareholder declarations\r\n   - Conflict of interest declarations\r\n\r\n5. **Company Information Fields**:\r\n   - Company name, trading name\r\n   - Registration number (CIPC)\r\n   - VAT number\r\n   - CSD MAAA number\r\n   - CIDB registration number and grading\r\n   - BBBEE certificate details (level, expiry, verification agency)\r\n   - Physical address, postal address\r\n   - Contact details (phone, fax, email)\r\n   - Banking details\r\n\r\n6. **Technical Response Fields**:\r\n   - Methodology descriptions (textarea)\r\n   - Project approach\r\n   - Implementation timeline\r\n   - Quality management approach\r\n   - Health and safety plan\r\n   - Environmental management\r\n\r\n7. **Personnel and Resources**:\r\n   - Key personnel tables (name, qualification, experience, role)\r\n   - CV summaries\r\n   - Equipment lists (type, quantity, owned/hired)\r\n   - Subcontractor details\r\n\r\n**FIELD TYPES TO USE:**\r\n- \"text\": Short text inputs (names, numbers, addresses)\r\n- \"textarea\": Long text responses (methodology, descriptions)\r\n- \"number\": Numeric values (prices, quantities, percentages)\r\n- \"date\": Date fields (YYYY-MM-DD format)\r\n- \"email\": Email addresses\r\n- \"tel\": Phone/fax numbers\r\n- \"select\": Dropdown choices (yes/no, levels, categories)\r\n- \"checkbox\": Agreement/declaration confirmations\r\n- \"file\": Document uploads (certificates, CVs)\r\n- \"table\": Repeating rows (pricing items, personnel, references)\r\n\r\n**FOR TABLE FIELDS, include:**\r\n- columns: Array of column definitions with { id, label, type }\r\n- minRows: Minimum number of rows required\r\n\r\n**GENERATE 25-50 FORM FIELDS** covering every fillable element in the document.\r\n\r\nEach field must have:\r\n- id: Unique snake_case identifier (e.g., \"sbd1_company_name\", \"pricing_item_1_rate\")\r\n- label: Display name matching the document label\r\n- type: One of the types listed above\r\n- required: true for mandatory fields, false for optional\r\n- section: Group name (e.g., \"SBD 1 - Invitation to Bid\", \"Pricing Schedule\", \"Declaration of Interest\")\r\n- placeholder: Example value or hint\r\n- description: Help text explaining what to enter\r\n- options: Array for select fields (e.g., [\"Yes\", \"No\"], [\"Level 1\", \"Level 2\", ...])\r\n- validation: Optional regex pattern for validation\r\n- columns: For table type, array of column definitions\r\n- minRows: For table type, minimum rows required\r\n\r\n**SECTION NAMES TO USE:**\r\n- \"SBD 1 - Invitation to Bid\"\r\n- \"SBD 3.1 - Pricing Schedule\"\r\n- \"SBD 4 - Declaration of Interest\"\r\n- \"SBD 6.1 - Preference Points\"\r\n- \"SBD 8 - Past SCM Practices\"\r\n- \"SBD 9 - Independent Bid\"\r\n- \"Company Information\"\r\n- \"Technical Response\"\r\n- \"Key Personnel\"\r\n- \"Equipment & Resources\"\r\n- \"Project References\"\r\n- \"Banking Details\"\r\n- \"Declarations & Signatures\"\r\n\r\n---\r\n\r\n### STEP 12 — RISK ASSESSMENT & B-BBEE ANALYSIS\r\nAnalyze the tender for risks and B-BBEE scoring potential:\r\n\r\n**risk_assessment**:\r\n- **overall_risk_score**: Number from 1-10 (1=low risk, 10=high risk)\r\n- **risk_level**: \"Low\", \"Medium\", \"High\", or \"Critical\"\r\n- **risk_factors**: Array of specific risks identified, each with:\r\n  - factor: Description of the risk\r\n  - severity: \"Low\", \"Medium\", \"High\"\r\n  - mitigation: Suggested way to address this risk\r\n- **risk_reasoning**: 2-3 sentence summary of why this risk level was assigned\r\n\r\n**bbbee_analysis**:\r\n- **points_available**: Total B-BBEE preference points available (usually 10 or 20)\r\n- **pricing_system**: \"80/20\" or \"90/10\" preference point system\r\n- **level_points_breakdown**: Array showing points per B-BBEE level:\r\n  - level: \"Level 1\", \"Level 2\", etc.\r\n  - points: Points awarded for this level\r\n- **sub_contracting_requirements**: Any mandatory subcontracting to EMEs/QSEs\r\n- **local_content_bonus**: Additional points for local content commitment\r\n- **recommendations**: Array of 3-5 actionable recommendations to maximize B-BBEE points\r\n\r\nConsider these risk factors:\r\n- Tight deadlines or unrealistic timeframes\r\n- Onerous penalty clauses\r\n- Unusual payment terms (long payment periods, high retentions)\r\n- Complex technical requirements\r\n- High financial requirements (guarantees, bonds, insurance)\r\n- Mandatory certifications or registrations you may not have\r\n- Geographic constraints or local preference requirements\r\n- Joint venture or subcontracting complexities\r\n- Ambiguous scope or specifications\r\n- History of disputes or litigation with the entity\r\n\r\n---\r\n\r\n### OUTPUT FORMAT\r\nReturn ONE valid JSON object with this exact structure:\r\n\r\n{\r\n  \"tender_summary\": { ... },\r\n  \"compliance_summary\": { ... },\r\n  \"evaluation\": { ... },\r\n  \"action_plan\": { ... },\r\n  \"financial_requirements\": {\r\n    \"bank_guarantee\": \"\",\r\n    \"performance_bond\": \"\",\r\n    \"insurance_requirements\": [],\r\n    \"financial_turnover\": \"\",\r\n    \"audited_financials\": \"\",\r\n    \"payment_terms\": \"\"\r\n  },\r\n  \"legal_registration\": {\r\n    \"cidb_grading\": \"\",\r\n    \"cipc_registration\": \"\",\r\n    \"professional_registration\": [],\r\n    \"joint_venture_requirements\": \"\",\r\n    \"subcontracting_limitations\": \"\"\r\n  },\r\n  \"labour_employment\": {\r\n    \"local_content\": \"\",\r\n    \"subcontracting_limit\": \"\",\r\n    \"labour_composition\": \"\",\r\n    \"skills_development\": \"\",\r\n    \"employment_equity\": \"\"\r\n  },\r\n  \"technical_specs\": {\r\n    \"minimum_experience\": \"\",\r\n    \"project_references\": \"\",\r\n    \"key_personnel\": [],\r\n    \"equipment_resources\": [],\r\n    \"methodology_requirements\": \"\"\r\n  },\r\n  \"submission_requirements\": {\r\n    \"number_of_copies\": \"\",\r\n    \"formatting_requirements\": \"\",\r\n    \"submission_address\": \"\",\r\n    \"query_deadline\": \"\",\r\n    \"late_submission_policy\": \"\"\r\n  },\r\n  \"penalties_payment\": {\r\n    \"late_completion_penalty\": \"\",\r\n    \"non_performance_penalty\": \"\",\r\n    \"warranty_period\": \"\",\r\n    \"payment_schedule\": \"\",\r\n    \"retention_amount\": \"\",\r\n    \"payment_timeframe\": \"\"\r\n  },\r\n  \"formFields\": [\r\n    {\r\n      \"id\": \"sbd1_company_name\",\r\n      \"label\": \"Company Name\",\r\n      \"type\": \"text\",\r\n      \"required\": true,\r\n      \"section\": \"SBD 1 - Invitation to Bid\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter the name of your company\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_trading_name\",\r\n      \"label\": \"Trading Name\",\r\n      \"type\": \"text\",\r\n      \"required\": false,\r\n      \"section\": \"SBD 1 - Invitation to Bid\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter your company's trading name if applicable\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_contact_email\",\r\n      \"label\": \"Contact Email\",\r\n      \"type\": \"email\",\r\n      \"required\": true,\r\n      \"section\": \"SBD 1 - Invitation to Bid\",\r\n      \"placeholder\": \"example@example.com\",\r\n      \"description\": \"Enter your company's contact email\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_contact_phone\",\r\n      \"label\": \"Contact Phone\",\r\n      \"type\": \"tel\",\r\n      \"required\": true,\r\n      \"section\": \"SBD 1 - Invitation to Bid\",\r\n      \"placeholder\": \"123-456-7890\",\r\n      \"description\": \"Enter your company's contact phone number\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_contact_fax\",\r\n      \"label\": \"Contact Fax\",\r\n      \"type\": \"tel\",\r\n      \"required\": false,\r\n      \"section\": \"SBD 1 - Invitation to Bid\",\r\n      \"placeholder\": \"123-456-7890\",\r\n      \"description\": \"Enter your company's contact fax number if applicable\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_physical_address\",\r\n      \"label\": \"Physical Address\",\r\n      \"type\": \"text\",\r\n      \"required\": true,\r\n      \"section\": \"SBD 1 - Invitation to Bid\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter your company's physical address\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_postal_address\",\r\n      \"label\": \"Postal Address\",\r\n      \"type\": \"text\",\r\n      \"required\": true,\r\n      \"section\": \"SBD 1 - Invitation to Bid\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter your company's postal address\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_cipc_registration\",\r\n      \"label\": \"CIPC Registration Number\",\r\n      \"type\": \"text\",\r\n      \"required\": true,\r\n      \"section\": \"Company Information\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter your company's CIPC registration number\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_vat_number\",\r\n      \"label\": \"VAT Number\",\r\n      \"type\": \"text\",\r\n      \"required\": true,\r\n      \"section\": \"Company Information\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter your company's VAT number\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_cidb_registration_number\",\r\n      \"label\": \"CIDB Registration Number\",\r\n      \"type\": \"text\",\r\n      \"required\": true,\r\n      \"section\": \"Company Information\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter your company's CIDB registration number\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_cidb_grading\",\r\n      \"label\": \"CIDB Grading\",\r\n      \"type\": \"select\",\r\n      \"required\": true,\r\n      \"section\": \"Company Information\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Select your company's CIDB grading\",\r\n      \"options\": [\"CE6\", \"GB4\", \"Other\"],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_bbbee_level\",\r\n      \"label\": \"BBBEE Level\",\r\n      \"type\": \"select\",\r\n      \"required\": true,\r\n      \"section\": \"Company Information\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Select your company's BBBEE level\",\r\n      \"options\": [\"Level 1\", \"Level 2\", \"Level 3\", \"Level 4\"],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_bbbee_expiry\",\r\n      \"label\": \"BBBEE Certificate Expiry\",\r\n      \"type\": \"date\",\r\n      \"required\": true,\r\n      \"section\": \"Company Information\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter the expiry date of your BBBEE certificate\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_bbbee_verification_agency\",\r\n      \"label\": \"BBBEE Verification Agency\",\r\n      \"type\": \"text\",\r\n      \"required\": true,\r\n      \"section\": \"Company Information\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter the name of the BBBEE verification agency\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_director_name\",\r\n      \"label\": \"Director's Name\",\r\n      \"type\": \"text\",\r\n      \"required\": true,\r\n      \"section\": \"SBD 4 - Declaration of Interest\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter the name of the director\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_director_designation\",\r\n      \"label\": \"Director's Designation\",\r\n      \"type\": \"text\",\r\n      \"required\": true,\r\n      \"section\": \"SBD 4 - Declaration of Interest\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter the designation of the director\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_director_date\",\r\n      \"label\": \"Declaration Date\",\r\n      \"type\": \"date\",\r\n      \"required\": true,\r\n      \"section\": \"SBD 4 - Declaration of Interest\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter the date of declaration\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_signature\",\r\n      \"label\": \"Signature\",\r\n      \"type\": \"file\",\r\n      \"required\": true,\r\n      \"section\": \"Declarations & Signatures\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Upload your signature\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"sbd1_conflict_of_interest\",\r\n      \"label\": \"Conflict of Interest Declaration\",\r\n      \"type\": \"checkbox\",\r\n      \"required\": true,\r\n      \"section\": \"Declarations & Signatures\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Confirm that there are no conflicts of interest\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"pricing_schedule\",\r\n      \"label\": \"Pricing Schedule\",\r\n      \"type\": \"table\",\r\n      \"required\": true,\r\n      \"section\": \"SBD 3.1 - Pricing Schedule\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter pricing details\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [\r\n        { \"id\": \"item\", \"label\": \"Item\", \"type\": \"text\" },\r\n        { \"id\": \"description\", \"label\": \"Description\", \"type\": \"text\" },\r\n        { \"id\": \"quantity\", \"label\": \"Quantity\", \"type\": \"number\" },\r\n        { \"id\": \"unit\", \"label\": \"Unit\", \"type\": \"text\" },\r\n        { \"id\": \"rate\", \"label\": \"Rate\", \"type\": \"number\" },\r\n        { \"id\": \"amount\", \"label\": \"Amount\", \"type\": \"number\" }\r\n      ],\r\n      \"minRows\": 5\r\n    },\r\n    {\r\n      \"id\": \"project_references\",\r\n      \"label\": \"Project References\",\r\n      \"type\": \"table\",\r\n      \"required\": true,\r\n      \"section\": \"Project References\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter your project references\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [\r\n        { \"id\": \"project_name\", \"label\": \"Project Name\", \"type\": \"text\" },\r\n        { \"id\": \"project_value\", \"label\": \"Project Value\", \"type\": \"number\" },\r\n        { \"id\": \"project_duration\", \"label\": \"Project Duration\", \"type\": \"text\" }\r\n      ],\r\n      \"minRows\": 3\r\n    },\r\n    {\r\n      \"id\": \"key_personnel\",\r\n      \"label\": \"Key Personnel\",\r\n      \"type\": \"table\",\r\n      \"required\": true,\r\n      \"section\": \"Key Personnel\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter details of key personnel\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [\r\n        { \"id\": \"name\", \"label\": \"Name\", \"type\": \"text\" },\r\n        { \"id\": \"qualification\", \"label\": \"Qualification\", \"type\": \"text\" },\r\n        { \"id\": \"experience\", \"label\": \"Experience\", \"type\": \"number\" },\r\n        { \"id\": \"role\", \"label\": \"Role\", \"type\": \"text\" }\r\n      ],\r\n      \"minRows\": 2\r\n    },\r\n    {\r\n      \"id\": \"equipment_resources\",\r\n      \"label\": \"Equipment & Resources\",\r\n      \"type\": \"table\",\r\n      \"required\": true,\r\n      \"section\": \"Equipment & Resources\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter details of required equipment and resources\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [\r\n        { \"id\": \"type\", \"label\": \"Type\", \"type\": \"text\" },\r\n        { \"id\": \"quantity\", \"label\": \"Quantity\", \"type\": \"number\" },\r\n        { \"id\": \"owned_hired\", \"label\": \"Owned/Hired\", \"type\": \"select\", \"options\": [\"Owned\", \"Hired\"] }\r\n      ],\r\n      \"minRows\": 3\r\n    },\r\n    {\r\n      \"id\": \"technical_response_methodology\",\r\n      \"label\": \"Methodology Description\",\r\n      \"type\": \"textarea\",\r\n      \"required\": true,\r\n      \"section\": \"Technical Response\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Describe your methodology for the project\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"technical_response_project_approach\",\r\n      \"label\": \"Project Approach\",\r\n      \"type\": \"text\",\r\n      \"required\": true,\r\n      \"section\": \"Technical Response\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter your project approach\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"technical_response_timeline\",\r\n      \"label\": \"Implementation Timeline\",\r\n      \"type\": \"textarea\",\r\n      \"required\": true,\r\n      \"section\": \"Technical Response\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter your implementation timeline\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"technical_response_quality_management\",\r\n      \"label\": \"Quality Management Approach\",\r\n      \"type\": \"textarea\",\r\n      \"required\": true,\r\n      \"section\": \"Technical Response\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Describe your quality management approach\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"technical_response_health_safety\",\r\n      \"label\": \"Health and Safety Plan\",\r\n      \"type\": \"textarea\",\r\n      \"required\": true,\r\n      \"section\": \"Technical Response\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Describe your health and safety plan\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"technical_response_environmental\",\r\n      \"label\": \"Environmental Management\",\r\n      \"type\": \"textarea\",\r\n      \"required\": true,\r\n      \"section\": \"Technical Response\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Describe your environmental management strategy\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    },\r\n    {\r\n      \"id\": \"banking_details\",\r\n      \"label\": \"Banking Details\",\r\n      \"type\": \"textarea\",\r\n      \"required\": true,\r\n      \"section\": \"Banking Details\",\r\n      \"placeholder\": \"\",\r\n      \"description\": \"Enter your banking details\",\r\n      \"options\": [],\r\n      \"validation\": \"\",\r\n      \"columns\": [],\r\n      \"minRows\": 0\r\n    }\r\n  ],\r\n  \"risk_assessment\": {\r\n    \"overall_risk_score\": 0,\r\n    \"risk_level\": \"\",\r\n    \"risk_factors\": [],\r\n    \"risk_reasoning\": \"\"\r\n  },\r\n  \"bbbee_analysis\": {\r\n    \"points_available\": 0,\r\n    \"pricing_system\": \"\",\r\n    \"level_points_breakdown\": [],\r\n    \"sub_contracting_requirements\": \"\",\r\n    \"local_content_bonus\": \"\",\r\n    \"recommendations\": []\r\n  }\r\n}\r\n\r\nCRITICAL RULES:\r\n- Return ONLY valid JSON, no additional text\r\n- Use South African terminology (CSD, CIDB, BBBEE, MBD, SBD)\r\n- All dates must be YYYY-MM-DD format\r\n- Weights must be numbers, not strings\r\n- If information is unclear, provide sensible defaults\r\n- Include at least one item in each array\r\n- Use \"Not specified\" for missing fields`\r\n"],"names":[],"mappings":"AAAA;;;;;;;;CAQC;;;;AAEM,MAAM,yBAAyB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;wCAywBC,CAAC"}},
    {"offset": {"line": 1318, "column": 0}, "map": {"version":3,"sources":["file:///C:/Repo/LogsOfN/v0-bid-mate-ai/lib/prompts/index.ts"],"sourcesContent":["/**\r\n * Prompt Management System\r\n *\r\n * This module manages AI analysis prompts and allows switching between\r\n * the original production prompt and custom test prompts.\r\n *\r\n * Usage:\r\n * - Set USE_CUSTOM_PROMPT=true in environment variables to use custom prompt\r\n * - Set USE_CUSTOM_PROMPT=false (or omit) to use original prompt\r\n * - Edit custom-analysis-prompt.ts to test new prompts\r\n * - Original prompt is always preserved in original-analysis-prompt.ts\r\n */\r\n\r\nimport { ORIGINAL_ANALYSIS_PROMPT } from \"./original-analysis-prompt\"\r\nimport { CUSTOM_ANALYSIS_PROMPT } from \"./custom-analysis-prompt\"\r\n\r\nexport function getAnalysisPrompt(): string {\r\n  const useCustomPrompt = process.env.USE_CUSTOM_PROMPT === \"true\"\r\n\r\n  if (useCustomPrompt) {\r\n    console.log(\"[v0] Using CUSTOM analysis prompt\")\r\n    return CUSTOM_ANALYSIS_PROMPT\r\n  }\r\n\r\n  console.log(\"[v0] Using ORIGINAL analysis prompt\")\r\n  return ORIGINAL_ANALYSIS_PROMPT\r\n}\r\n\r\nexport function getFormFieldsInstruction(pdfFields?: any[]): string {\r\n  if (pdfFields && pdfFields.length > 0) {\r\n    return `\r\nCRITICAL: The PDF has ${pdfFields.length} interactive form fields. You MUST use these EXACT field names as the 'id' property.\r\n\r\nPDF Form Fields:\r\n${pdfFields.map((f: any, idx: number) => `${idx + 1}. \"${f.name}\" (${f.type})`).join(\"\\n\")}\r\n\r\nFORM FIELD GENERATION RULES:\r\n1. For EACH PDF field above, create a corresponding form field entry\r\n2. Use the EXACT field name from the PDF as the 'id' (case-sensitive)\r\n3. Create a human-readable label by:\r\n   - Converting CamelCase to spaces (e.g., \"CompanyName\" → \"Company Name\")\r\n   - Converting snake_case to spaces (e.g., \"company_name\" → \"Company Name\")\r\n   - Capitalizing appropriately\r\n4. Map the PDF field type to the appropriate form field type:\r\n   - PDFTextField → \"text\" or \"textarea\" (use textarea for long text fields)\r\n   - PDFCheckBox → \"checkbox\"\r\n   - PDFRadioGroup → \"radio\"\r\n   - PDFDropdown → \"select\"\r\n5. Mark fields as required if they appear mandatory in the document\r\n6. Add helpful descriptions based on the document context\r\n7. Group fields into logical sections (Company Info, Financial, Technical, etc.)\r\n\r\nExample:\r\nPDF Field: \"CompanyRegistrationNumber\" (PDFTextField)\r\nForm Field:\r\n{\r\n  \"id\": \"CompanyRegistrationNumber\",\r\n  \"label\": \"Company Registration Number\",\r\n  \"type\": \"text\",\r\n  \"required\": true,\r\n  \"placeholder\": \"e.g., 2021/123456/07\",\r\n  \"description\": \"Your company's official registration number\",\r\n  \"section\": \"Company Information\"\r\n}\r\n`\r\n  }\r\n\r\n  return `\r\nFORM FIELD GENERATION (No PDF fields detected - create comprehensive form):\r\n\r\nExtract EVERY piece of information requested in the tender document and create appropriate form fields.\r\nBe thorough and detailed - include ALL information requirements mentioned.\r\n\r\nREQUIRED SECTIONS TO COVER:\r\n1. Company Information:\r\n   - Company name, registration number, VAT number\r\n   - Physical and postal addresses\r\n   - Contact person details (name, email, phone)\r\n   - Company type, years in business\r\n   - Website, social media\r\n\r\n2. Financial Information:\r\n   - Annual turnover (last 3 years)\r\n   - Bank details (name, branch, account)\r\n   - Tax clearance certificate\r\n   - Financial statements\r\n   - Credit references\r\n\r\n3. Technical Capabilities:\r\n   - Relevant experience (years)\r\n   - Similar projects completed\r\n   - Technical staff qualifications\r\n   - Equipment and resources\r\n   - Quality certifications (ISO, etc.)\r\n\r\n4. Compliance & Legal:\r\n   - BBBEE certificate and level\r\n   - Professional indemnity insurance\r\n   - Public liability insurance\r\n   - Health and safety compliance\r\n   - Industry-specific licenses\r\n\r\n5. Project-Specific:\r\n   - Methodology and approach\r\n   - Project timeline\r\n   - Resource allocation\r\n   - Risk management plan\r\n   - Quality assurance procedures\r\n\r\n6. Pricing:\r\n   - Detailed cost breakdown\r\n   - Payment terms\r\n   - Validity period\r\n   - Assumptions and exclusions\r\n\r\n7. References:\r\n   - Client references (minimum 3)\r\n   - Contact details for references\r\n   - Project descriptions\r\n\r\n8. Supporting Documents:\r\n   - Company profile\r\n   - Certificates and licenses\r\n   - Previous work samples\r\n   - CVs of key personnel\r\n\r\nFor each field, provide:\r\n- Unique, descriptive ID (use snake_case)\r\n- Clear, concise label\r\n- Appropriate type (text, email, tel, number, date, textarea, select, checkbox, file)\r\n- Whether it's required\r\n- Helpful placeholder text\r\n- Detailed description of what's needed\r\n- Logical section grouping\r\n- Options array for select/checkbox/radio fields\r\n`\r\n}\r\n\r\n// Export both prompts for reference\r\nexport { ORIGINAL_ANALYSIS_PROMPT, CUSTOM_ANALYSIS_PROMPT }\r\n"],"names":[],"mappings":"AAAA;;;;;;;;;;;CAWC;;;;;;AAED;AACA;;;AAEO,SAAS;IACd,MAAM,kBAAkB,QAAQ,GAAG,CAAC,iBAAiB,KAAK;IAE1D,IAAI,iBAAiB;QACnB,QAAQ,GAAG,CAAC;QACZ,OAAO,0KAAsB;IAC/B;IAEA,QAAQ,GAAG,CAAC;IACZ,OAAO,8KAAwB;AACjC;AAEO,SAAS,yBAAyB,SAAiB;IACxD,IAAI,aAAa,UAAU,MAAM,GAAG,GAAG;QACrC,OAAO,CAAC;sBACU,EAAE,UAAU,MAAM,CAAC;;;AAGzC,EAAE,UAAU,GAAG,CAAC,CAAC,GAAQ,MAAgB,GAAG,MAAM,EAAE,GAAG,EAAE,EAAE,IAAI,CAAC,GAAG,EAAE,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,MAAM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8B3F,CAAC;IACC;IAEA,OAAO,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoEV,CAAC;AACD"}},
    {"offset": {"line": 1461, "column": 0}, "map": {"version":3,"sources":["file:///C:/Repo/LogsOfN/v0-bid-mate-ai/app/api/analyze-tender/route.ts"],"sourcesContent":["import generateTextViaProvider from \"@/lib/providers\"\r\nimport { extractText } from \"unpdf\"\r\nimport { PDFDocument } from \"pdf-lib\"\r\nimport { getAnalysisPrompt } from \"@/lib/prompts\"\r\n\r\nasync function extractPdfFormFields(pdfUrl: string): Promise<{\r\n  fields: Array<{\r\n    name: string\r\n    type: string\r\n    options?: string[]\r\n    position?: { x: number; y: number; width: number; height: number; page: number }\r\n  }>\r\n  hasFormFields: boolean\r\n}> {\r\n  try {\r\n    console.log(\"[v0] Extracting PDF form fields from:\", pdfUrl)\r\n    const pdfResponse = await fetch(pdfUrl)\r\n    if (!pdfResponse.ok) {\r\n      throw new Error(`Failed to fetch PDF: ${pdfResponse.status}`)\r\n    }\r\n\r\n    const pdfBytes = await pdfResponse.arrayBuffer()\r\n    const pdfDoc = await PDFDocument.load(pdfBytes, { ignoreEncryption: true })\r\n    const form = pdfDoc.getForm()\r\n    const fields = form.getFields()\r\n    const pages = pdfDoc.getPages()\r\n\r\n    const extractedFields = fields.map((field: any) => {\r\n      const name = field.getName()\r\n      const typeName = field.constructor.name\r\n\r\n      let type = \"text\"\r\n      let options: string[] | undefined\r\n      let position: { x: number; y: number; width: number; height: number; page: number } | undefined\r\n\r\n      if (typeName === \"PDFTextField\") {\r\n        type = \"text\"\r\n      } else if (typeName === \"PDFCheckBox\") {\r\n        type = \"checkbox\"\r\n      } else if (typeName === \"PDFRadioGroup\") {\r\n        type = \"radio\"\r\n        try {\r\n          options = (field as any).getOptions?.() || []\r\n        } catch {\r\n          options = []\r\n        }\r\n      } else if (typeName === \"PDFDropdown\") {\r\n        type = \"select\"\r\n        try {\r\n          options = (field as any).getOptions?.() || []\r\n        } catch {\r\n          options = []\r\n        }\r\n      }\r\n\r\n      try {\r\n          const widgets = field.acroField.getWidgets()\r\n        if (widgets.length > 0) {\r\n          const widget = widgets[0]\r\n          const rect = widget.getRectangle()\r\n\r\n          // Find which page this widget is on\r\n          let pageIndex = 0\r\n          for (let i = 0; i < pages.length; i++) {\r\n            const pageRef = pages[i].ref\r\n            const widgetPage = widget.P()\r\n            if (widgetPage && pageRef.toString() === widgetPage.toString()) {\r\n              pageIndex = i\r\n              break\r\n            }\r\n          }\r\n\r\n          position = {\r\n            x: rect.x,\r\n            y: rect.y,\r\n            width: rect.width,\r\n            height: rect.height,\r\n            page: pageIndex + 1, // 1-based page number\r\n          }\r\n          console.log(`[v0] Field \"${name}\" position:`, position)\r\n        }\r\n      } catch (posError) {\r\n        console.log(`[v0] Could not extract position for field \"${name}\"`)\r\n      }\r\n\r\n      return { name, type, options, position }\r\n    })\r\n\r\n    console.log(\"[v0] Found\", extractedFields.length, \"PDF form fields with positions\")\r\n\r\n    return {\r\n      fields: extractedFields,\r\n      hasFormFields: extractedFields.length > 0,\r\n    }\r\n  } catch (error: any) {\r\n    console.log(\"[v0] Could not extract PDF form fields:\", error.message)\r\n    return { fields: [], hasFormFields: false }\r\n  }\r\n}\r\n\r\nexport async function POST(request: Request) {\r\n  try {\r\n    const { documentText, documentUrl, pdfFields } = await request.json()\r\n\r\n    console.log(\"[v0] ========================================\")\r\n    console.log(\"[v0] TENDER ANALYSIS REQUEST\")\r\n    console.log(\"[v0] ========================================\")\r\n    console.log(\"[v0] Document text length:\", documentText?.length || 0, \"characters\")\r\n    console.log(\"[v0] Document URL provided:\", documentUrl ? \"YES\" : \"NO\")\r\n    console.log(\"[v0] PDF fields provided:\", pdfFields?.length || 0)\r\n\r\n    if (!documentText && !documentUrl) {\r\n      return Response.json({ error: \"Either document text or document URL is required\" }, { status: 400 })\r\n    }\r\n\r\n    let pdfFormFields: Array<{\r\n      name: string\r\n      type: string\r\n      options?: string[]\r\n      position?: { x: number; y: number; width: number; height: number; page: number }\r\n    }> = []\r\n    let hasPdfFormFields = false\r\n\r\n    if (documentUrl) {\r\n      const pdfFieldsResult = await extractPdfFormFields(documentUrl)\r\n      pdfFormFields = pdfFieldsResult.fields\r\n      hasPdfFormFields = pdfFieldsResult.hasFormFields\r\n      console.log(\"[v0] PDF has interactive form fields:\", hasPdfFormFields)\r\n    }\r\n\r\n    let textToAnalyze = documentText\r\n\r\n    if (documentUrl && (!documentText || documentText === \"\")) {\r\n      console.log(\"[v0] No text provided - extracting from PDF URL using unpdf...\")\r\n      console.log(\"[v0] PDF URL:\", documentUrl)\r\n\r\n      try {\r\n        console.log(\"[v0] Step 1: Fetching PDF from blob storage...\")\r\n\r\n        const pdfResponse = await fetch(documentUrl)\r\n        if (!pdfResponse.ok) {\r\n          throw new Error(`Failed to fetch PDF: ${pdfResponse.status} ${pdfResponse.statusText}`)\r\n        }\r\n\r\n        const pdfArrayBuffer = await pdfResponse.arrayBuffer()\r\n        console.log(\"[v0] PDF fetched successfully, size:\", (pdfArrayBuffer.byteLength / 1024).toFixed(2), \"KB\")\r\n\r\n        console.log(\"[v0] Step 2: Extracting text using unpdf library...\")\r\n\r\n        const { text, totalPages } = await extractText(pdfArrayBuffer, { mergePages: true })\r\n\r\n        textToAnalyze = text\r\n        console.log(\"[v0] ✓ Text extracted successfully using unpdf\")\r\n        console.log(\"[v0] Total pages:\", totalPages)\r\n        console.log(\"[v0] Extracted text length:\", textToAnalyze.length, \"characters\")\r\n        console.log(\"[v0] First 500 characters:\", textToAnalyze.substring(0, 500))\r\n\r\n        if (!textToAnalyze || textToAnalyze.trim().length < 50) {\r\n          throw new Error(\r\n            `Insufficient text extracted from PDF - only got ${textToAnalyze?.length || 0} characters. The PDF might be scanned/image-based.`,\r\n          )\r\n        }\r\n\r\n        const wordCount = textToAnalyze.trim().split(/\\s+/).length\r\n        const avgWordsPerPage = Math.round(wordCount / totalPages)\r\n        console.log(\"[v0] Word count:\", wordCount)\r\n        console.log(\"[v0] Average words per page:\", avgWordsPerPage)\r\n\r\n        if (avgWordsPerPage < 50) {\r\n          console.warn(\"[v0] ⚠️ WARNING: Low word density - PDF might be partially scanned\")\r\n        }\r\n      } catch (extractError: any) {\r\n        console.error(\"[v0] PDF TEXT EXTRACTION FAILED\")\r\n        console.error(\"[v0] Error message:\", extractError?.message)\r\n\r\n        return Response.json(\r\n          {\r\n            error: \"Failed to extract text from PDF\",\r\n            errorType: \"pdf_extraction_error\",\r\n            details: extractError?.message || \"Could not read PDF content\",\r\n            hint: \"The PDF might be scanned/image-based, corrupted, or password-protected. Try converting it to a text-based PDF first.\",\r\n          },\r\n          { status: 500 },\r\n        )\r\n      }\r\n    }\r\n\r\n    if (!textToAnalyze || textToAnalyze.length < 50) {\r\n      return Response.json(\r\n        {\r\n          error: \"Document text is too short to analyze\",\r\n          errorType: \"insufficient_content\",\r\n          details: `Only ${textToAnalyze?.length || 0} characters available.`,\r\n        },\r\n        { status: 400 },\r\n      )\r\n    }\r\n\r\n    const truncatedText = textToAnalyze!.substring(0, 100000)\r\n    console.log(\"[v0] Using text for analysis, length:\", truncatedText.length, \"characters\")\r\n\r\n    const basePrompt = getAnalysisPrompt()\r\n\r\n    let pdfFieldsInstruction = \"\"\r\n    if (hasPdfFormFields && pdfFormFields.length > 0) {\r\n      pdfFieldsInstruction = `\r\nIMPORTANT - PDF FORM FIELDS DETECTED:\r\nThis PDF document has ${pdfFormFields.length} interactive form fields. You MUST use these EXACT field names as the \"id\" for your formFields output so they can be auto-filled in the PDF.\r\n\r\nHere are the actual PDF form field names and their types:\r\n${pdfFormFields\r\n          .map((f) => {\r\n            let info = `- \"${f.name}\" (type: ${f.type})`\r\n            if (f.options && f.options.length > 0) {\r\n              info += ` [options: ${f.options.join(\", \")}]`\r\n            }\r\n            if (f.position) {\r\n              info += ` [position: page ${f.position.page}, x ${f.position.x}, y ${f.position.y}, width ${f.position.width}, height ${f.position.height}]`\r\n            }\r\n            return info\r\n          })\r\n          .join(\"\\n\")}\r\n\r\nFor each PDF field above, create a corresponding formField entry with:\r\n- id: Use the EXACT field name from the PDF (e.g., \"${pdfFormFields[0]?.name || \"Text1\"}\")\r\n- label: A human-readable label describing what the field is for\r\n- type: Match the PDF field type (text, checkbox, select, etc.)\r\n- section: Group related fields together\r\n- required: true if the field appears mandatory\r\n- description: Help text for the user\r\n\r\nIf the PDF has fewer than 20 form fields, also add additional formFields for any information requested in the document text that doesn't have a corresponding PDF field.\r\n`\r\n    } else {\r\n      pdfFieldsInstruction = `\r\nNOTE: This PDF does not have interactive form fields. Generate formFields based on ALL fillable information requested in the document text. Create 25-50 fields covering company details, pricing, declarations, technical responses, and all SBD/MBD forms referenced in the document.\r\n`\r\n    }\r\n\r\n    console.log(\"[v0] Step 3: Calling configured AI provider via wrapper for analysis...\")\r\n\r\n    // Validate provider configuration early to give actionable errors\r\n    const hasOpenAI = !!process.env.OPENAI_API_KEY\r\n    const hasAzure = !!process.env.AZURE_OPENAI_ENDPOINT && !!process.env.AZURE_OPENAI_KEY && !!process.env.AZURE_OPENAI_DEPLOYMENT\r\n    const hasGemini = !!(process.env.GEMINI_API_KEY || process.env.GOOGLE_API_KEY)\r\n    if (!hasOpenAI && !hasAzure && !hasGemini) {\r\n      console.error('[v0] No AI provider configured. Set OPENAI_API_KEY or GEMINI_API_KEY/GOOGLE_API_KEY or AZURE_OPENAI_* env vars.')\r\n      return Response.json(\r\n        {\r\n          error: 'No AI provider configured',\r\n          errorType: 'no_ai_provider_configured',\r\n          details:\r\n            'Set OPENAI_API_KEY or GEMINI_API_KEY/GOOGLE_API_KEY or AZURE_OPENAI_ENDPOINT+AZURE_OPENAI_KEY+AZURE_OPENAI_DEPLOYMENT in your environment.',\r\n        },\r\n        { status: 400 },\r\n      )\r\n    }\r\n\r\n    // Determine preferred provider for logging/response (actual selection may be influenced by provider wrapper)\r\n    const preferredProvider = hasGemini ? 'Gemini' : hasAzure ? 'Azure' : 'OpenAI'\r\n    const modelToUse = hasGemini ? 'gemini-1.5-flash' : hasAzure ? 'azure-deployment' : 'gpt-4o'\r\n    const promptLength = (basePrompt + '\\n' + truncatedText).length\r\n    console.log(`[v0] Provider selection: ${preferredProvider}; model hint: ${modelToUse}; prompt length: ${promptLength} chars; truncated text length: ${truncatedText.length}`)\r\n\r\n    try {\r\n      const startTime = Date.now()\r\n\r\n      const { text: aiResponse } = await generateTextViaProvider({\r\n        model: \"gemini-1.5-flash\",\r\n        prompt: `${basePrompt}\r\n\r\n${pdfFieldsInstruction}\r\n\r\nIMPORTANT: You MUST respond with ONLY valid JSON. No markdown, no explanations, no code blocks. Just pure JSON.\r\n\r\n===========================================\r\nTENDER DOCUMENT TEXT\r\n===========================================\r\n\r\n${truncatedText}\r\n\r\n===========================================\r\nEND OF DOCUMENT\r\n===========================================\r\n\r\nRespond with ONLY the following JSON structure (no markdown, no code blocks, just raw JSON):\r\n\r\n{\r\n  \"tender_summary\": {\r\n    \"tender_number\": \"string or Not specified\",\r\n    \"title\": \"string or Not specified\",\r\n    \"entity\": \"string or Not specified\",\r\n    \"description\": \"string or Not specified\",\r\n    \"contract_duration\": \"string or Not specified\",\r\n    \"closing_date\": \"YYYY-MM-DD format or Not specified\",\r\n    \"submission_method\": \"string or Not specified\",\r\n    \"compulsory_briefing\": \"string or Not specified\",\r\n    \"validity_period\": \"string or Not specified\",\r\n    \"contact_email\": \"string or Not specified\"\r\n  },\r\n  \"compliance_summary\": {\r\n    \"requirements\": [\"array of requirement strings\"],\r\n    \"disqualifiers\": [\"array of disqualifier strings\"],\r\n    \"strengtheners\": [\"array of strengthener strings\"]\r\n  },\r\n  \"evaluation\": {\r\n    \"criteria\": [{\"criterion\": \"string\", \"weight\": number}],\r\n    \"threshold\": \"string or Not specified\",\r\n    \"pricing_system\": \"string or Not specified\"\r\n  },\r\n  \"action_plan\": {\r\n    \"critical_dates\": [{\"date\": \"YYYY-MM-DD\", \"event\": \"string\", \"time\": \"string\", \"location\": \"string\"}],\r\n    \"preparation_tasks\": [{\"task\": \"string\", \"priority\": \"High/Medium/Low\", \"deadline\": \"string\", \"category\": \"string\"}]\r\n  },\r\n  \"financial_requirements\": {\r\n    \"bank_guarantee\": \"string or Not specified\",\r\n    \"performance_bond\": \"string or Not specified\",\r\n    \"insurance_requirements\": [\"array of strings\"],\r\n    \"financial_turnover\": \"string or Not specified\",\r\n    \"audited_financials\": \"string or Not specified\",\r\n    \"payment_terms\": \"string or Not specified\"\r\n  },\r\n  \"legal_registration\": {\r\n    \"cidb_grading\": \"string or Not specified\",\r\n    \"cipc_registration\": \"string or Not specified\",\r\n    \"professional_registration\": [\"array of strings\"],\r\n    \"joint_venture_requirements\": \"string or Not specified\",\r\n    \"subcontracting_limitations\": \"string or Not specified\"\r\n  },\r\n  \"labour_employment\": {\r\n    \"local_content\": \"string or Not specified\",\r\n    \"subcontracting_limit\": \"string or Not specified\",\r\n    \"labour_composition\": \"string or Not specified\",\r\n    \"skills_development\": \"string or Not specified\",\r\n    \"employment_equity\": \"string or Not specified\"\r\n  },\r\n  \"technical_specs\": {\r\n    \"minimum_experience\": \"string or Not specified\",\r\n    \"project_references\": \"string or Not specified\",\r\n    \"key_personnel\": [\"array of strings\"],\r\n    \"equipment_resources\": [\"array of strings\"],\r\n    \"methodology_requirements\": \"string or Not specified\"\r\n  },\r\n  \"submission_requirements\": {\r\n    \"number_of_copies\": \"string or Not specified\",\r\n    \"formatting_requirements\": \"string or Not specified\",\r\n    \"submission_address\": \"string or Not specified\",\r\n    \"query_deadline\": \"string or Not specified\",\r\n    \"late_submission_policy\": \"string or Not specified\"\r\n  },\r\n  \"penalties_payment\": {\r\n    \"late_completion_penalty\": \"string or Not specified\",\r\n    \"non_performance_penalty\": \"string or Not specified\",\r\n    \"warranty_period\": \"string or Not specified\",\r\n    \"payment_schedule\": \"string or Not specified\",\r\n    \"retention_amount\": \"string or Not specified\",\r\n    \"payment_timeframe\": \"string or Not specified\"\r\n  },\r\n  \"formFields\": [\r\n    {\r\n      \"id\": \"unique_field_id_or_pdf_field_name\",\r\n      \"label\": \"Field Label\",\r\n      \"type\": \"text|textarea|number|date|select|checkbox|file|email|tel\",\r\n      \"required\": true/false,\r\n      \"section\": \"Section Name\",\r\n      \"placeholder\": \"optional placeholder\",\r\n      \"description\": \"optional description\",\r\n      \"options\": [\"for select fields only\"],\r\n      \"pdfFieldName\": \"original PDF field name if applicable\"\r\n    }\r\n  ],\r\n  \"pdfFormFieldsDetected\": ${hasPdfFormFields},\r\n  \"pdfFormFieldCount\": ${pdfFormFields.length}\r\n}`,\r\n      })\r\n\r\n      const endTime = Date.now()\r\n      console.log(\"[v0] AI generation completed in\", (endTime - startTime) / 1000, \"seconds\")\r\n      console.log(\"[v0] Raw AI response length:\", aiResponse.length, \"characters\")\r\n      console.log(\"[v0] AI response preview (first 200 chars):\", aiResponse.substring(0, 200))\r\n      console.log(\"[v0] First 500 chars of response:\", aiResponse.substring(0, 500))\r\n\r\n      let analysis\r\n      try {\r\n        let cleanedResponse = aiResponse.trim()\r\n        if (cleanedResponse.startsWith(\"```json\")) {\r\n          cleanedResponse = cleanedResponse.slice(7)\r\n        }\r\n        if (cleanedResponse.startsWith(\"```\")) {\r\n          cleanedResponse = cleanedResponse.slice(3)\r\n        }\r\n        if (cleanedResponse.endsWith(\"```\")) {\r\n          cleanedResponse = cleanedResponse.slice(0, -3)\r\n        }\r\n        cleanedResponse = cleanedResponse.trim()\r\n\r\n        analysis = JSON.parse(cleanedResponse)\r\n        console.log(\"[v0] ✓ JSON parsed successfully\")\r\n      } catch (parseError: any) {\r\n        console.error(\"[v0] JSON parse error:\", parseError.message)\r\n        console.error(\"[v0] Response that failed to parse:\", aiResponse.substring(0, 1000))\r\n\r\n        return Response.json(\r\n          {\r\n            error: \"Failed to parse AI response as JSON\",\r\n            errorType: \"json_parse_error\",\r\n            details: parseError.message,\r\n          },\r\n          { status: 500 },\r\n        )\r\n      }\r\n\r\n      // Attach provider info to analysis for frontend visibility (no secrets)\r\n      analysis.__meta = { provider: preferredProvider, model: modelToUse }\r\n\r\n      analysis.pdfFormFieldsDetected = hasPdfFormFields\r\n      analysis.pdfFormFieldCount = pdfFormFields.length\r\n      analysis.pdfFormFields = pdfFormFields\r\n\r\n      const defaults = {\r\n        tender_summary: {\r\n          tender_number: \"Not specified\",\r\n          title: \"Not specified\",\r\n          entity: \"Not specified\",\r\n          description: \"Not specified\",\r\n          contract_duration: \"Not specified\",\r\n          closing_date: \"Not specified\",\r\n          submission_method: \"Not specified\",\r\n          compulsory_briefing: \"Not specified\",\r\n          validity_period: \"Not specified\",\r\n          contact_email: \"Not specified\",\r\n        },\r\n        compliance_summary: {\r\n          requirements: [],\r\n          disqualifiers: [],\r\n          strengtheners: [],\r\n        },\r\n        evaluation: {\r\n          criteria: [],\r\n          threshold: \"Not specified\",\r\n          pricing_system: \"Not specified\",\r\n        },\r\n        action_plan: {\r\n          critical_dates: [],\r\n          preparation_tasks: [],\r\n        },\r\n        financial_requirements: {\r\n          bank_guarantee: \"Not specified\",\r\n          performance_bond: \"Not specified\",\r\n          insurance_requirements: [],\r\n          financial_turnover: \"Not specified\",\r\n          audited_financials: \"Not specified\",\r\n          payment_terms: \"Not specified\",\r\n        },\r\n        legal_registration: {\r\n          cidb_grading: \"Not specified\",\r\n          cipc_registration: \"Not specified\",\r\n          professional_registration: [],\r\n          joint_venture_requirements: \"Not specified\",\r\n          subcontracting_limitations: \"Not specified\",\r\n        },\r\n        labour_employment: {\r\n          local_content: \"Not specified\",\r\n          subcontracting_limit: \"Not specified\",\r\n          labour_composition: \"Not specified\",\r\n          skills_development: \"Not specified\",\r\n          employment_equity: \"Not specified\",\r\n        },\r\n        technical_specs: {\r\n          minimum_experience: \"Not specified\",\r\n          project_references: \"Not specified\",\r\n          key_personnel: [],\r\n          equipment_resources: [],\r\n          methodology_requirements: \"Not specified\",\r\n        },\r\n        submission_requirements: {\r\n          number_of_copies: \"Not specified\",\r\n          formatting_requirements: \"Not specified\",\r\n          submission_address: \"Not specified\",\r\n          query_deadline: \"Not specified\",\r\n          late_submission_policy: \"Not specified\",\r\n        },\r\n        penalties_payment: {\r\n          late_completion_penalty: \"Not specified\",\r\n          non_performance_penalty: \"Not specified\",\r\n          warranty_period: \"Not specified\",\r\n          payment_schedule: \"Not specified\",\r\n          retention_amount: \"Not specified\",\r\n          payment_timeframe: \"Not specified\",\r\n        },\r\n        formFields: [],\r\n      }\r\n\r\n      for (const key of Object.keys(defaults)) {\r\n        if (!analysis[key]) {\r\n          console.log(`[v0] Adding default for missing: ${key}`)\r\n          analysis[key] = defaults[key as keyof typeof defaults]\r\n        } else if (\r\n          typeof defaults[key as keyof typeof defaults] === \"object\" &&\r\n          !Array.isArray(defaults[key as keyof typeof defaults])\r\n        ) {\r\n          analysis[key] = { ...defaults[key as keyof typeof defaults], ...analysis[key] }\r\n        }\r\n      }\r\n\r\n      console.log(\"[v0] ========================================\")\r\n      console.log(\"[v0] ANALYSIS RESULTS\")\r\n      console.log(\"[v0] ========================================\")\r\n      console.log(\"[v0] Tender title:\", analysis.tender_summary?.title)\r\n      console.log(\"[v0] Requirements count:\", analysis.compliance_summary?.requirements?.length || 0)\r\n      console.log(\"[v0] Disqualifiers count:\", analysis.compliance_summary?.disqualifiers?.length || 0)\r\n      console.log(\"[v0] Criteria count:\", analysis.evaluation?.criteria?.length || 0)\r\n      console.log(\"[v0] Form fields count:\", analysis.formFields?.length || 0)\r\n      console.log(\"[v0] PDF form fields detected:\", hasPdfFormFields)\r\n      console.log(\"[v0] PDF form field count:\", pdfFormFields.length)\r\n      console.log(\"[v0] ========================================\")\r\n\r\n      return Response.json(analysis)\r\n    } catch (aiError: any) {\r\n      console.error(\"[v0] AI GENERATION ERROR\")\r\n      console.error(\"[v0] Error message:\", aiError?.message)\r\n      console.error(\"[v0] Error stack:\", aiError?.stack?.substring?.(0, 1000))\r\n\r\n      return Response.json(\r\n        {\r\n          error: \"AI generation failed\",\r\n          errorType: \"ai_generation_error\",\r\n          details: aiError?.message || \"Unknown AI error\",\r\n          // include truncated stack for local debugging\r\n          stack: (aiError?.stack || '').substring(0, 1000),\r\n          provider: preferredProvider,\r\n          model: modelToUse,\r\n        },\r\n        { status: 502 },\r\n      )\r\n    }\r\n  } catch (error: any) {\r\n    console.error(\"[v0] ========================================\")\r\n    console.error(\"[v0] TENDER ANALYSIS ERROR\")\r\n    console.error(\"[v0] ========================================\")\r\n    console.error(\"[v0] Error type:\", error?.constructor?.name)\r\n    console.error(\"[v0] Error message:\", error?.message)\r\n\r\n    return Response.json(\r\n      {\r\n        error: \"Failed to analyze tender document\",\r\n        details: error?.message || \"Unknown error\",\r\n        errorType: \"server_error\",\r\n      },\r\n      { status: 500 },\r\n    )\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}