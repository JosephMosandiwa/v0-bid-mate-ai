{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Repo/LogsOfN/v0-bid-mate-ai/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient as createSupabaseServerClient } from \"@supabase/ssr\"\r\nimport { cookies } from \"next/headers\"\r\n\r\nexport async function createClient() {\r\n  const cookieStore = await cookies()\r\n\r\n  return createSupabaseServerClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!, {\r\n    cookies: {\r\n      getAll() {\r\n        return cookieStore.getAll()\r\n      },\r\n      setAll(cookiesToSet) {\r\n        try {\r\n          cookiesToSet.forEach(({ name, value, options }) => cookieStore.set(name, value, options))\r\n        } catch {\r\n          // The \"setAll\" method was called from a Server Component.\r\n          // This can be ignored if you have middleware refreshing\r\n          // user sessions.\r\n        }\r\n      },\r\n    },\r\n  })\r\n}\r\n\r\nexport const createServerClient = createClient\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,gPAAO;IAEjC,OAAO,IAAA,4SAA0B,sUAAoF;QACnH,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAK,YAAY,GAAG,CAAC,MAAM,OAAO;gBAClF,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AACF;AAEO,MAAM,qBAAqB"}},
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":["file:///C:/Repo/LogsOfN/v0-bid-mate-ai/lib/engines/orchestrator/tender-orchestrator.ts"],"sourcesContent":["/**\r\n * Tender Orchestrator Service\r\n * \r\n * Coordinates multi-engine analysis for tender documents.\r\n * Manages parallel/sequential execution of engines and tracks progress.\r\n */\r\n\r\nimport { createClient } from \"@/lib/supabase/server\"\r\n\r\nexport interface OrchestrationOptions {\r\n    tenderId: string\r\n    documentUrl?: string\r\n    userId: string\r\n    skipEngines?: string[] // Allow skipping specific engines\r\n}\r\n\r\nexport interface EngineResult {\r\n    engine: string\r\n    status: 'completed' | 'failed' | 'skipped'\r\n    duration?: number\r\n    error?: string\r\n    data?: any\r\n}\r\n\r\nexport interface OrchestrationResult {\r\n    orchestrationId: string\r\n    status: 'processing' | 'completed' | 'partial_failure' | 'failed'\r\n    phase1Results: EngineResult[]\r\n    phase2Results: EngineResult[]\r\n    errors: string[]\r\n}\r\n\r\nexport class TenderOrchestrator {\r\n    private supabase: any\r\n    private orchestrationId: string\r\n    private tenderId: string\r\n    private userId: string\r\n\r\n    constructor(options: OrchestrationOptions) {\r\n        this.tenderId = options.tenderId\r\n        this.userId = options.userId\r\n        this.orchestrationId = crypto.randomUUID()\r\n    }\r\n\r\n    /**\r\n     * Main entry point - orchestrates all tender analysis engines\r\n     */\r\n    async orchestrateTenderAnalysis(documentUrl?: string): Promise<OrchestrationResult> {\r\n        console.log(`[Orchestrator] Starting orchestration ${this.orchestrationId} for tender ${this.tenderId}`)\r\n\r\n        try {\r\n            this.supabase = await createClient()\r\n\r\n            // Initialize progress tracking\r\n            await this.initializeProgress()\r\n\r\n            // Phase 1: Critical path (sequential)\r\n            console.log(`[Orchestrator] Starting Phase 1 - Critical Analysis`)\r\n            const phase1Results = await this.executePhase1(documentUrl)\r\n\r\n            // Check if Phase 1 had critical failures\r\n            const phase1Failed = phase1Results.some(r => r.status === 'failed' && r.engine === 'tender_analysis')\r\n            if (phase1Failed) {\r\n                await this.updateOverallProgress('failed', 50)\r\n                return {\r\n                    orchestrationId: this.orchestrationId,\r\n                    status: 'failed',\r\n                    phase1Results,\r\n                    phase2Results: [],\r\n                    errors: ['Critical analysis failed - cannot proceed to Phase 2']\r\n                }\r\n            }\r\n\r\n            // Mark Phase 1 complete\r\n            await this.updatePhaseProgress(1, true)\r\n\r\n            // Phase 2: Deep analysis (parallel - non-blocking)\r\n            console.log(`[Orchestrator] Starting Phase 2 - Deep Analysis (parallel)`)\r\n\r\n            // Get analysis data for Phase 2 engines\r\n            const analysisData = phase1Results.find(r => r.engine === 'tender_analysis')?.data\r\n\r\n            // Fire and don't wait - these run in background\r\n            this.executePhase2Async(analysisData).catch(error => {\r\n                console.error(`[Orchestrator] Phase 2 background execution error:`, error)\r\n            })\r\n\r\n            // Return immediately with Phase 1 complete\r\n            return {\r\n                orchestrationId: this.orchestrationId,\r\n                status: 'processing',\r\n                phase1Results,\r\n                phase2Results: [],\r\n                errors: []\r\n            }\r\n        } catch (error: any) {\r\n            console.error(`[Orchestrator] Fatal error:`, error)\r\n            await this.updateOverallProgress('failed', 0)\r\n            throw error\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Phase 1: Critical path - must complete before user can proceed\r\n     * - Document analysis (if URL provided)\r\n     * - Tender requirements analysis\r\n     */\r\n    private async executePhase1(documentUrl?: string): Promise<EngineResult[]> {\r\n        const results: EngineResult[] = []\r\n\r\n        // Document Analysis (optional)\r\n        if (documentUrl) {\r\n            const docResult = await this.runEngine('document', async () => {\r\n                // Document engine would go here\r\n                // For now, just mark as completed\r\n                return { extracted: true }\r\n            })\r\n            results.push(docResult)\r\n        }\r\n\r\n        // Tender Analysis (critical)\r\n        const analysisResult = await this.runEngine('tender_analysis', async () => {\r\n            // Get existing analysis from database\r\n            const { data } = await this.supabase\r\n                .from('user_tender_analysis')\r\n                .select('analysis_data')\r\n                .eq('tender_id', this.tenderId)\r\n                .single()\r\n\r\n            return data?.analysis_data\r\n        })\r\n        results.push(analysisResult)\r\n\r\n        return results\r\n    }\r\n\r\n    /**\r\n     * Phase 2: Deep analysis - runs in parallel, non-blocking\r\n     * - BOQ generation\r\n     * - Strategy generation\r\n     * - Readiness assessment\r\n     * - Risk assessment (future)\r\n     * - Compliance check (future)\r\n     */\r\n    private async executePhase2Async(analysisData: any): Promise<void> {\r\n        console.log(`[Orchestrator] Phase 2 execution started in background`)\r\n\r\n        const engines = [\r\n            { name: 'boq', fn: () => this.generateBOQ(analysisData) },\r\n            { name: 'strategy', fn: () => this.generateStrategy(analysisData) },\r\n            { name: 'readiness', fn: () => this.assessReadiness() },\r\n        ]\r\n        try {\r\n            // Run all engines in parallel and collect EngineResult objects\r\n            const results: EngineResult[] = await Promise.all(\r\n                engines.map(async (engine) => {\r\n                    return await this.runEngine(engine.name, engine.fn)\r\n                })\r\n            )\r\n\r\n            // Classify results\r\n            const succeeded = results.filter(r => r.status === 'completed')\r\n            const failed = results.filter(r => r.status === 'failed')\r\n\r\n            // Ensure engines map in DB reflects final statuses/durations\r\n            const { data: current } = await this.supabase\r\n                .from('tender_orchestration_progress')\r\n                .select('engines, errors')\r\n                .eq('id', this.orchestrationId)\r\n                .single()\r\n\r\n            const enginesObj = current?.engines || {}\r\n            results.forEach(r => {\r\n                enginesObj[r.engine] = {\r\n                    status: r.status,\r\n                    progress: r.status === 'completed' ? 100 : 0,\r\n                    duration: r.duration\r\n                }\r\n            })\r\n\r\n            const newErrors: string[] = failed.map(f => `${f.engine}: ${f.error || 'unknown'}`)\r\n\r\n            await this.supabase\r\n                .from('tender_orchestration_progress')\r\n                .update({\r\n                    engines: enginesObj,\r\n                    phase2_completed: failed.length === 0,\r\n                    phase2_results: results,\r\n                    errors: (current?.errors || []).concat(newErrors),\r\n                    overall_progress: 100,\r\n                    status: failed.length === 0 ? 'completed' : succeeded.length > 0 ? 'partial_failure' : 'failed',\r\n                    updated_at: new Date().toISOString(),\r\n                    completed_at: new Date().toISOString()\r\n                })\r\n                .eq('id', this.orchestrationId)\r\n\r\n            console.log(`[Orchestrator] Phase 2 complete - succeeded=${succeeded.length} failed=${failed.length}`)\r\n        } catch (error: any) {\r\n            console.error(`[Orchestrator] Phase 2 background execution error:`, error)\r\n\r\n            // Attempt to persist the fatal error to DB\r\n            try {\r\n                const { data: current } = await this.supabase\r\n                    .from('tender_orchestration_progress')\r\n                    .select('errors')\r\n                    .eq('id', this.orchestrationId)\r\n                    .single()\r\n\r\n                const updatedErrors = (current?.errors || []).concat([error?.message || String(error)])\r\n\r\n                await this.supabase\r\n                    .from('tender_orchestration_progress')\r\n                    .update({\r\n                        status: 'failed',\r\n                        errors: updatedErrors,\r\n                        overall_progress: 100,\r\n                        phase2_completed: false,\r\n                        updated_at: new Date().toISOString(),\r\n                        completed_at: new Date().toISOString()\r\n                    })\r\n                    .eq('id', this.orchestrationId)\r\n            } catch (persistErr) {\r\n                console.error('[Orchestrator] Failed to persist Phase 2 error:', persistErr)\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Generic engine runner with error handling and progress tracking\r\n     */\r\n    private async runEngine(\r\n        engineName: string,\r\n        engineFn: () => Promise<any>,\r\n        maxRetries: number = 2\r\n    ): Promise<EngineResult> {\r\n        const startTime = Date.now()\r\n\r\n        await this.updateEngineProgress(engineName, 'processing', 0)\r\n\r\n        for (let attempt = 1; attempt <= maxRetries; attempt++) {\r\n            try {\r\n                console.log(`[Orchestrator] Running ${engineName} (attempt ${attempt}/${maxRetries})`)\r\n\r\n                const result = await engineFn()\r\n                const duration = (Date.now() - startTime) / 1000\r\n\r\n                await this.updateEngineProgress(engineName, 'completed', 100, duration)\r\n\r\n                return {\r\n                    engine: engineName,\r\n                    status: 'completed',\r\n                    duration,\r\n                    data: result\r\n                }\r\n            } catch (error: any) {\r\n                console.error(`[Orchestrator] ${engineName} failed (attempt ${attempt}):`, error.message)\r\n\r\n                if (attempt === maxRetries) {\r\n                    await this.updateEngineProgress(engineName, 'failed', 0)\r\n\r\n                    return {\r\n                        engine: engineName,\r\n                        status: 'failed',\r\n                        error: error.message\r\n                    }\r\n                }\r\n\r\n                // Exponential backoff\r\n                await this.sleep(Math.pow(2, attempt) * 1000)\r\n            }\r\n        }\r\n\r\n        // Should never reach here\r\n        return {\r\n            engine: engineName,\r\n            status: 'failed',\r\n            error: 'Max retries exceeded'\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Engine-specific implementations\r\n     */\r\n\r\n    private async generateBOQ(analysisData: any): Promise<any> {\r\n        const response = await fetch(`${process.env.NEXT_PUBLIC_SITE_URL || 'http://localhost:3000'}/api/strategist/boq`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({\r\n                tender_id: this.tenderId,\r\n                tenderTitle: analysisData?.tender_summary?.title || 'Tender',\r\n                analysisData,\r\n            })\r\n        })\r\n\r\n        if (!response.ok) {\r\n            throw new Error(`BOQ generation failed: ${response.statusText}`)\r\n        }\r\n\r\n        return await response.json()\r\n    }\r\n\r\n    private async generateStrategy(analysisData: any): Promise<any> {\r\n        const response = await fetch(`${process.env.NEXT_PUBLIC_SITE_URL || 'http://localhost:3000'}/api/strategist/strategy`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({\r\n                tender_id: this.tenderId,\r\n                title: 'Bid Strategy'\r\n            })\r\n        })\r\n\r\n        if (!response.ok) {\r\n            throw new Error(`Strategy generation failed: ${response.statusText}`)\r\n        }\r\n\r\n        return await response.json()\r\n    }\r\n\r\n    private async assessReadiness(): Promise<any> {\r\n        const response = await fetch(`${process.env.NEXT_PUBLIC_SITE_URL || 'http://localhost:3000'}/api/strategist/readiness?tender_id=${this.tenderId}`)\r\n\r\n        if (!response.ok) {\r\n            throw new Error(`Readiness assessment failed: ${response.statusText}`)\r\n        }\r\n\r\n        return await response.json()\r\n    }\r\n\r\n    /**\r\n     * Progress tracking helpers\r\n     */\r\n\r\n    private async initializeProgress(): Promise<void> {\r\n        const engines = {\r\n            document: { status: 'queued', progress: 0 },\r\n            tender_analysis: { status: 'queued', progress: 0 },\r\n            boq: { status: 'queued', progress: 0 },\r\n            strategy: { status: 'queued', progress: 0 },\r\n            readiness: { status: 'queued', progress: 0 },\r\n        }\r\n\r\n        await this.supabase.from('tender_orchestration_progress').insert({\r\n            id: this.orchestrationId,\r\n            tender_id: this.tenderId,\r\n            user_id: this.userId,\r\n            status: 'processing',\r\n            overall_progress: 0,\r\n            engines,\r\n            phase1_completed: false,\r\n            phase2_completed: false,\r\n            started_at: new Date().toISOString(),\r\n        })\r\n    }\r\n\r\n    private async updateEngineProgress(\r\n        engine: string,\r\n        status: string,\r\n        progress: number,\r\n        duration?: number\r\n    ): Promise<void> {\r\n        const { data: current } = await this.supabase\r\n            .from('tender_orchestration_progress')\r\n            .select('engines')\r\n            .eq('id', this.orchestrationId)\r\n            .single()\r\n\r\n        const engines = current?.engines || {}\r\n        engines[engine] = { status, progress, duration }\r\n\r\n        await this.supabase\r\n            .from('tender_orchestration_progress')\r\n            .update({\r\n                engines,\r\n                updated_at: new Date().toISOString()\r\n            })\r\n            .eq('id', this.orchestrationId)\r\n    }\r\n\r\n    private async updatePhaseProgress(phase: number, completed: boolean): Promise<void> {\r\n        const field = phase === 1 ? 'phase1_completed' : 'phase2_completed'\r\n\r\n        await this.supabase\r\n            .from('tender_orchestration_progress')\r\n            .update({\r\n                [field]: completed,\r\n                updated_at: new Date().toISOString()\r\n            })\r\n            .eq('id', this.orchestrationId)\r\n    }\r\n\r\n    private async updateOverallProgress(status: string, progress: number): Promise<void> {\r\n        const update: any = {\r\n            status,\r\n            overall_progress: progress,\r\n            updated_at: new Date().toISOString()\r\n        }\r\n\r\n        if (status === 'completed' || status === 'failed') {\r\n            update.completed_at = new Date().toISOString()\r\n        }\r\n\r\n        await this.supabase\r\n            .from('tender_orchestration_progress')\r\n            .update(update)\r\n            .eq('id', this.orchestrationId)\r\n    }\r\n\r\n    private sleep(ms: number): Promise<void> {\r\n        return new Promise(resolve => setTimeout(resolve, ms))\r\n    }\r\n}\r\n\r\n/**\r\n * Helper function to start orchestration\r\n */\r\nexport async function orchestrateTenderAnalysis(\r\n    tenderId: string,\r\n    userId: string,\r\n    documentUrl?: string\r\n): Promise<OrchestrationResult> {\r\n    const orchestrator = new TenderOrchestrator({\r\n        tenderId,\r\n        userId,\r\n        documentUrl\r\n    })\r\n\r\n    return await orchestrator.orchestrateTenderAnalysis(documentUrl)\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 375, "column": 0}, "map": {"version":3,"sources":["file:///C:/Repo/LogsOfN/v0-bid-mate-ai/app/actions/tender-actions.ts"],"sourcesContent":["\"use server\"\r\n\r\nimport { createClient } from \"@/lib/supabase/server\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { PinTenderOptions } from \"@/lib/types\"\r\nimport { redirect } from \"next/navigation\"\r\nimport { AnalyzedTender } from \"@/lib/types/tender\"\r\nimport { orchestrateTenderAnalysis } from \"@/lib/engines/orchestrator/tender-orchestrator\"\r\n\r\n\r\nexport interface TenderDocument {\r\n  id?: string\r\n  title: string\r\n  url: string\r\n  documentType?: string\r\n  format?: string\r\n  description?: string\r\n}\r\n\r\nexport interface TenderData {\r\n  tenderId: string\r\n  title: string\r\n  organization: string\r\n  publishDate?: string\r\n  closeDate?: string\r\n  value?: string\r\n  category?: string\r\n  description?: string\r\n  url?: string\r\n  documents?: TenderDocument[] // Add documents array\r\n}\r\n\r\nexport async function addTenderToUser(tenderData: TenderData) {\r\n  const supabase = await createClient()\r\n\r\n  // Get current user\r\n  const {\r\n    data: { user },\r\n    error: userError,\r\n  } = await supabase.auth.getUser()\r\n\r\n  if (userError || !user) {\r\n    return { success: false, error: \"Not authenticated\" }\r\n  }\r\n\r\n  // Insert tender\r\n  const { data, error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .insert({\r\n      user_id: user.id,\r\n      tender_id: tenderData.tenderId,\r\n      title: tenderData.title,\r\n      organization: tenderData.organization,\r\n      publish_date: tenderData.publishDate,\r\n      close_date: tenderData.closeDate,\r\n      value: tenderData.value,\r\n      category: tenderData.category,\r\n      description: tenderData.description,\r\n      url: tenderData.url,\r\n      status: \"draft\",\r\n    })\r\n    .select()\r\n    .single()\r\n\r\n  if (error) {\r\n    // Check if it's a duplicate\r\n    if (error.code === \"23505\") {\r\n      return { success: false, error: \"Tender already added\" }\r\n    }\r\n    console.error(\"[v0] Error adding tender:\", error)\r\n    return { success: false, error: \"Failed to add tender\" }\r\n  }\r\n\r\n  if (tenderData.documents && tenderData.documents.length > 0 && data) {\r\n    console.log(\"[v0] Adding\", tenderData.documents.length, \"documents to tender\", data.id)\r\n    console.log(\"[v0] Document data:\", JSON.stringify(tenderData.documents, null, 2))\r\n\r\n    const documentsToInsert = tenderData.documents.map((doc) => ({\r\n      user_tender_id: data.id, // Changed from tender_id\r\n      user_id: user.id,\r\n      file_name: doc.title, // Changed from name\r\n      storage_path: doc.url, // Changed from file_url - external URLs stored as storage_path\r\n      file_type: doc.format || \"application/pdf\",\r\n      file_size: 0, // Unknown size for external documents\r\n      // Removed document_type and description as they don't exist in schema\r\n    }))\r\n\r\n    console.log(\"[v0] Inserting documents:\", JSON.stringify(documentsToInsert, null, 2))\r\n\r\n    const { data: insertedDocs, error: docsError } = await supabase\r\n      .from(\"tender_documents\")\r\n      .insert(documentsToInsert)\r\n      .select()\r\n\r\n    if (docsError) {\r\n      console.error(\"[v0] Error adding documents:\", docsError)\r\n      console.error(\"[v0] Error details:\", JSON.stringify(docsError, null, 2))\r\n      // Don't fail the whole operation if documents fail, just log it\r\n    } else {\r\n      console.log(\"[v0] Successfully added\", insertedDocs?.length || 0, \"documents\")\r\n      console.log(\r\n        \"[v0] Inserted document IDs:\",\r\n        insertedDocs?.map((d) => d.id),\r\n      )\r\n    }\r\n  } else {\r\n    console.log(\"[v0] No documents to add for this tender\")\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  return { success: true, data }\r\n}\r\n\r\nexport async function toggleTenderPin(tenderId: string, isPinned: boolean) {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  const { error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .update({ is_pinned: isPinned })\r\n    .eq(\"id\", tenderId)\r\n    .eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error toggling pin:\", error)\r\n    return { success: false, error: \"Failed to update tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  revalidatePath(\"/dashboard/search\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function toggleTenderFavourite(tenderId: string, isFavourited: boolean) {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  const { error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .update({ is_favourited: isFavourited })\r\n    .eq(\"id\", tenderId)\r\n    .eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error toggling favourite:\", error)\r\n    return { success: false, error: \"Failed to update tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  revalidatePath(\"/dashboard/search\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function toggleTenderWishlist(tenderId: string, isWishlisted: boolean) {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  const { error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .update({ is_wishlisted: isWishlisted })\r\n    .eq(\"id\", tenderId)\r\n    .eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error toggling wishlist:\", error)\r\n    return { success: false, error: \"Failed to update tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function getUserTenders() {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\", tenders: [] }\r\n\r\n  // Fetch all tenders from user_tenders (both scraped and custom)\r\n  const { data: tenders, error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .select(\"*\")\r\n    .eq(\"user_id\", user.id)\r\n    .order(\"created_at\", { ascending: false })\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error fetching tenders:\", error)\r\n    return { success: false, error: \"Failed to fetch tenders\", tenders: [] }\r\n  }\r\n\r\n  // Normalize data for frontend\r\n  const normalizedTenders = (tenders || []).map((tender) => ({\r\n    id: tender.id,\r\n    tender_id: tender.tender_id || `custom-${tender.id}`, // Fallback for custom tenders\r\n    title: tender.title,\r\n    organization: tender.organization,\r\n    status: tender.status,\r\n    close_date: tender.close_date || tender.deadline, // Use deadline if close_date is null\r\n    value: tender.value,\r\n    category: tender.category,\r\n    is_pinned: tender.is_pinned || false,\r\n    is_favourited: tender.is_favourited || false,\r\n    is_wishlisted: tender.is_wishlisted || false,\r\n    created_at: tender.created_at,\r\n    tender_type: tender.tender_type || \"scraped\", // Default to scraped if null\r\n    location: tender.location,\r\n  }))\r\n\r\n  return { success: true, tenders: normalizedTenders }\r\n}\r\n\r\nexport async function deleteTender(tenderId: string, tenderType?: \"scraped\" | \"custom\") {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  // Simply delete from user_tenders table\r\n  const { error } = await supabase.from(\"user_tenders\").delete().eq(\"id\", tenderId).eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error deleting tender:\", error)\r\n    return { success: false, error: \"Failed to delete tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function saveScrapedTenderToUser(scrapedTender: {\r\n  id: string\r\n  title: string\r\n  source_name: string\r\n  description?: string\r\n  publish_date?: string\r\n  close_date?: string\r\n  estimated_value?: string\r\n  category?: string\r\n  tender_url?: string\r\n}) {\r\n  const supabase = await createClient()\r\n\r\n  // Get current user\r\n  const {\r\n    data: { user },\r\n    error: userError,\r\n  } = await supabase.auth.getUser()\r\n\r\n  if (userError || !user) {\r\n    return { success: false, error: \"Not authenticated\" }\r\n  }\r\n\r\n  // Check if tender already exists for this user\r\n  const { data: existing } = await supabase\r\n    .from(\"user_tenders\")\r\n    .select(\"id, status\")\r\n    .eq(\"user_id\", user.id)\r\n    .eq(\"tender_id\", scrapedTender.id)\r\n    .single()\r\n\r\n  if (existing) {\r\n    // If already exists and is draft, update to in-progress\r\n    if (existing.status === \"draft\") {\r\n      const { error: updateError } = await supabase\r\n        .from(\"user_tenders\")\r\n        .update({ status: \"in-progress\" })\r\n        .eq(\"id\", existing.id)\r\n\r\n      if (updateError) {\r\n        console.error(\"[v0] Error updating tender status:\", updateError)\r\n        return { success: false, error: \"Failed to update tender status\" }\r\n      }\r\n\r\n      revalidatePath(\"/dashboard/tenders\")\r\n      return { success: true, message: \"Tender status updated to in-progress\", isNew: false }\r\n    }\r\n\r\n    // Already exists and not draft, no need to update\r\n    return { success: true, message: \"Tender already in your list\", isNew: false }\r\n  }\r\n\r\n  // Insert new tender with in-progress status\r\n  const { data, error } = await supabase\r\n    .from(\"user_tenders\")\r\n    .insert({\r\n      user_id: user.id,\r\n      tender_id: scrapedTender.id,\r\n      title: scrapedTender.title,\r\n      organization: scrapedTender.source_name,\r\n      publish_date: scrapedTender.publish_date,\r\n      close_date: scrapedTender.close_date,\r\n      value: scrapedTender.estimated_value,\r\n      category: scrapedTender.category,\r\n      description: scrapedTender.description,\r\n      url: scrapedTender.tender_url,\r\n      status: \"in-progress\",\r\n      tender_type: \"scraped\",\r\n    })\r\n    .select()\r\n    .single()\r\n\r\n  if (error) {\r\n    console.error(\"[v0] Error saving tender:\", error)\r\n    return { success: false, error: \"Failed to save tender\" }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/tenders\")\r\n  return { success: true, message: \"Tender saved to My Tenders\", isNew: true, data }\r\n}\r\n\r\nexport async function createCustomTender(tenderData: {\r\n  title: string\r\n  organization: string\r\n  deadline: string\r\n  value: string\r\n  description: string\r\n  category?: string\r\n  location?: string\r\n  uploadedFile?: File\r\n  analysis?: any\r\n}) {\r\n  console.log(\"[v0] createCustomTender called with data:\", {\r\n    title: tenderData.title,\r\n    organization: tenderData.organization,\r\n    deadline: tenderData.deadline,\r\n    hasFile: !!tenderData.uploadedFile,\r\n    hasAnalysis: !!tenderData.analysis,\r\n  })\r\n\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n    error: userError,\r\n  } = await supabase.auth.getUser()\r\n\r\n  if (userError || !user) {\r\n    console.error(\"[v0] Auth error:\", userError)\r\n    return { success: false, error: \"Not authenticated\" }\r\n  }\r\n\r\n  console.log(\"[v0] User authenticated:\", user.id)\r\n\r\n  try {\r\n    console.log(\"[v0] Creating custom tender record...\")\r\n\r\n    const { data: customTender, error: customTenderError } = await supabase\r\n      .from(\"user_tenders\")\r\n      .insert({\r\n        user_id: user.id,\r\n        title: tenderData.title,\r\n        organization: tenderData.organization,\r\n        deadline: tenderData.deadline,\r\n        value: tenderData.value,\r\n        category: tenderData.category || \"Custom\",\r\n        description: tenderData.description,\r\n        location: tenderData.location,\r\n        status: \"in-progress\",\r\n        tender_type: \"custom\",\r\n      })\r\n      .select()\r\n      .single()\r\n\r\n    if (customTenderError) {\r\n      console.error(\"[v0] Error creating custom tender:\", customTenderError)\r\n      return { success: false, error: \"Failed to create tender: \" + customTenderError.message }\r\n    }\r\n\r\n    console.log(\"[v0] Custom tender created successfully:\", customTender.id)\r\n\r\n    let documentSaved = false\r\n    let documentError: string | null = null\r\n    let uploadData: any = null // Declare uploadData here to be accessible later\r\n\r\n    if (tenderData.uploadedFile) {\r\n      console.log(\"[v0] Processing existing document...\")\r\n\r\n      try {\r\n        const file = tenderData.uploadedFile\r\n        const fileName = `${user.id}/${customTender.id}/${file.name}`\r\n\r\n        const { data: uploaded, error: uploadError } = await supabase.storage\r\n          .from(\"tender-documents\")\r\n          .upload(fileName, file)\r\n        uploadData = uploaded // Assign to the outer scope variable\r\n\r\n        if (uploadError) {\r\n          console.error(\"[v0] Error uploading file to Supabase:\", uploadError)\r\n          documentError = \"Failed to upload file to permanent storage\"\r\n        } else {\r\n          const documentData = {\r\n            tender_id: customTender.id,\r\n            file_name: file.name,\r\n            file_type: file.type,\r\n            file_size: file.size,\r\n            storage_path: uploadData.path,\r\n            blob_url: uploadData.path,\r\n          }\r\n\r\n          const { data: insertedDoc, error: docError } = await supabase\r\n            .from(\"user_tender_documents\")\r\n            .insert(documentData)\r\n            .select()\r\n            .single()\r\n\r\n          if (docError) {\r\n            console.error(\"[v0] Error saving doc ref:\", docError)\r\n            documentError = \"Failed to save document reference\"\r\n          } else {\r\n            documentSaved = true\r\n          }\r\n        }\r\n      } catch (err: any) {\r\n        console.error(\"[v0] Upload error:\", err)\r\n        documentError = err.message\r\n      }\r\n    } else {\r\n      console.log(\"[v0] No file to upload\")\r\n    }\r\n\r\n    let analysisSaved = false\r\n    let analysisError: string | null = null\r\n    let orchestrationId: string | null = null\r\n\r\n    if (tenderData.analysis) {\r\n      console.log(\"[v0] Saving analysis data...\")\r\n\r\n      const analysisData = {\r\n        tender_id: customTender.id,\r\n        analysis_data: tenderData.analysis,\r\n      }\r\n\r\n      console.log(\"[v0] Inserting analysis with tender_id:\", customTender.id)\r\n\r\n      const { data: insertedAnalysis, error: analysisErr } = await supabase\r\n        .from(\"user_tender_analysis\") // Updated table name\r\n        .insert(analysisData)\r\n        .select()\r\n        .single()\r\n\r\n      if (analysisErr) {\r\n        console.error(\"[v0] Error saving analysis:\", analysisErr)\r\n        analysisError = analysisErr.message\r\n      } else {\r\n        console.log(\"[v0] Analysis saved successfully\")\r\n        analysisSaved = true\r\n\r\n        // Trigger multi-engine orchestration for deep analysis\r\n        console.log(\"[v0] Triggering multi-engine orchestration...\")\r\n        try {\r\n          // Get document URL if file was uploaded\r\n          let documentUrl: string | undefined\r\n          if (documentSaved) {\r\n            const { data: { publicUrl } } = supabase.storage\r\n              .from('tender-documents')\r\n              .getPublicUrl(uploadData?.path || '')\r\n            documentUrl = publicUrl\r\n          }\r\n\r\n          const orchestrationResult = await orchestrateTenderAnalysis(\r\n            customTender.id,\r\n            user.id,\r\n            documentUrl\r\n          )\r\n\r\n          orchestrationId = orchestrationResult.orchestrationId\r\n          console.log(`[v0] Orchestration started: ${orchestrationId}`)\r\n        } catch (orchError: any) {\r\n          console.error(\"[v0] Orchestration failed:\", orchError)\r\n          // Don't fail the entire operation if orchestration fails, just log it\r\n        }\r\n      }\r\n    } else {\r\n      console.log(\"[v0] No analysis data provided\")\r\n    }\r\n\r\n    // Return success with tender ID and orchestration ID\r\n    console.log(\"[v0] Returning success for tender:\", customTender.id)\r\n\r\n    revalidatePath(\"/dashboard/tenders\")\r\n    revalidatePath(\"/dashboard/custom-tenders\")\r\n\r\n    return {\r\n      success: true,\r\n      tenderId: customTender.id,\r\n      orchestrationId,\r\n      documentSaved,\r\n      documentError,\r\n      analysisSaved,\r\n      analysisError,\r\n    }\r\n  } catch (error) {\r\n    console.error(\"[v0] Error in createCustomTender:\", error)\r\n    return { success: false, error: \"Failed to create tender: \" + (error as Error).message }\r\n  }\r\n}\r\n\r\nexport async function getDashboardStats() {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  try {\r\n    // Get all tenders count for this user\r\n    const { count: totalTenders } = await supabase\r\n      .from(\"user_tenders\")\r\n      .select(\"*\", { count: \"exact\", head: true })\r\n      .eq(\"user_id\", user.id)\r\n\r\n    // Get analyzed tenders count (where we have analysis data)\r\n    // RLS ensures we only see our own analyses\r\n    const { count: analyzedCount } = await supabase\r\n      .from(\"user_tender_analysis\")\r\n      .select(\"tender_id\", { count: \"exact\", head: true })\r\n    // Wait, user_tender_analysis doesn't have user_id in my migration?\r\n    // Let's check migration script...\r\n    // user_custom_tender_analysis didn't have user_id in the original schema I saw in 031?\r\n    // L131: WHERE id = tender_id AND user_id = auth.uid() -> checking parent tender.\r\n    // So user_tender_analysis table assumes linking to user_tenders.\r\n    // query:\r\n    // select count(*) from user_tender_analysis join user_tenders on ... where user_tenders.user_id = ...\r\n\r\n    // Alternative: Just query user_tenders where tender_type='custom' (proxy for analyzed?)\r\n    // Or just fetching recent activity from unified table.\r\n\r\n    // Get recent activity (last 5 tenders)\r\n    const { data: recentTenders } = await supabase\r\n      .from(\"user_tenders\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", user.id)\r\n      .order(\"created_at\", { ascending: false })\r\n      .limit(5)\r\n\r\n    const recentActivity = (recentTenders || []).map((tender) => ({\r\n      id: tender.id,\r\n      title: tender.title,\r\n      organization: tender.organization,\r\n      type: tender.tender_type === \"custom\" ? (\"analyzed\" as const) : (\"saved\" as const),\r\n      created_at: tender.created_at,\r\n    }))\r\n\r\n    // Get tenders closing soon (next 7 days)\r\n    const sevenDaysFromNow = new Date()\r\n    sevenDaysFromNow.setDate(sevenDaysFromNow.getDate() + 7)\r\n\r\n    // Check both close_date (scraped) and deadline (custom, if parsed?)\r\n    // For now, relying on close_date. My migration copied deadline to close_date if I recall?\r\n    // No, I copied close_date to close_date. Custom tenders might rely on 'deadline' text column.\r\n    // This is tricky for sorting. Ideally we parse deadline to close_date.\r\n    // Assuming close_date is populated for meaningful deadlines.\r\n\r\n    const { data: closingSoon } = await supabase\r\n      .from(\"user_tenders\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", user.id)\r\n      .not(\"close_date\", \"is\", null)\r\n      .gte(\"close_date\", new Date().toISOString())\r\n      .lte(\"close_date\", sevenDaysFromNow.toISOString())\r\n      .order(\"close_date\", { ascending: true })\r\n      .limit(5)\r\n\r\n    return {\r\n      success: true,\r\n      stats: {\r\n        totalTenders: totalTenders || 0,\r\n        analyzedTenders: analyzedCount || 0, // This might be inaccurate without join, but acceptable for now or I can do a join query if needed.\r\n        // Actually, let's try to get substantial analyzed count if possible.\r\n        // For now 0 is fine or just count custom tenders?\r\n        closingSoon: closingSoon?.length || 0,\r\n        recentActivity,\r\n        upcomingDeadlines: closingSoon || [],\r\n      },\r\n    }\r\n  } catch (error) {\r\n    console.error(\"[v0] Error fetching dashboard stats:\", error)\r\n    return { success: false, error: \"Failed to fetch dashboard statistics\" }\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 904, "column": 0}, "map": {"version":3,"sources":["file:///C:/Repo/LogsOfN/v0-bid-mate-ai/.next-internal/server/app/dashboard/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getDashboardStats as '00052b433a8d3627d42c4602d3a6d40abd8c843384'} from 'ACTIONS_MODULE0'\nexport {getUserTenders as '005a2aadafbb6faa45a02e6cd4449af94b0aef8dc2'} from 'ACTIONS_MODULE0'\nexport {addTenderToUser as '403db14cb99710538e989f04eececb7b800fbb320c'} from 'ACTIONS_MODULE0'\nexport {saveScrapedTenderToUser as '4060312bd46fc40ec5491a64b4d4a1575650502b8b'} from 'ACTIONS_MODULE0'\nexport {createCustomTender as '40e39e6b203aafe32c7bc01f01043759da8563a3c7'} from 'ACTIONS_MODULE0'\nexport {toggleTenderWishlist as '60277855b49813fe487ce40f597a8c6ccae651cc90'} from 'ACTIONS_MODULE0'\nexport {deleteTender as '60723eb04469c5ed6a93a3606bc24e6caa02ce5c0f'} from 'ACTIONS_MODULE0'\nexport {toggleTenderFavourite as '60ab41ac7fcad5f2c43b740b4e480963e1cbe14487'} from 'ACTIONS_MODULE0'\nexport {toggleTenderPin as '60b0f135c75d05c230071fa31fc5abb4f61209affc'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}