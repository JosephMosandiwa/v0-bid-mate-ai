{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Repo/LogsOfN/v0-bid-mate-ai/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient as createSupabaseServerClient } from \"@supabase/ssr\"\r\nimport { cookies } from \"next/headers\"\r\nimport { createClient as createSupabaseClient } from '@supabase/supabase-js'\r\n\r\nexport async function createClient() {\r\n  const cookieStore = await cookies()\r\n\r\n  return createSupabaseServerClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!, {\r\n    cookies: {\r\n      getAll() {\r\n        return cookieStore.getAll()\r\n      },\r\n      setAll(cookiesToSet) {\r\n        try {\r\n          cookiesToSet.forEach(({ name, value, options }) => cookieStore.set(name, value, options))\r\n        } catch {\r\n          // The \"setAll\" method was called from a Server Component.\r\n          // This can be ignored if you have middleware refreshing\r\n          // user sessions.\r\n        }\r\n      },\r\n    },\r\n  })\r\n}\r\n\r\nexport const createServerClient = createClient\r\n\r\n// Admin/service-role client for privileged server-side operations that must bypass RLS.\r\nexport function createAdminClient() {\r\n  const url = process.env.NEXT_PUBLIC_SUPABASE_URL!\r\n  const key = process.env.SUPABASE_SERVICE_ROLE_KEY || process.env.SUPABASE_SERVICE_ROLE\r\n  if (!url || !key) {\r\n    throw new Error('SUPABASE service role key not configured')\r\n  }\r\n  return createSupabaseClient(url, key)\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AAAA;AACA;AACA;;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,kPAAO;IAEjC,OAAO,IAAA,8SAA0B,sUAAoF;QACnH,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAK,YAAY,GAAG,CAAC,MAAM,OAAO;gBAClF,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AACF;AAEO,MAAM,qBAAqB;AAG3B,SAAS;IACd,MAAM;IACN,MAAM,MAAM,QAAQ,GAAG,CAAC,yBAAyB,IAAI,QAAQ,GAAG,CAAC,qBAAqB;IACtF,IAAI,CAAC,OAAO,CAAC,KAAK;QAChB,MAAM,IAAI,MAAM;IAClB;IACA,OAAO,IAAA,0QAAoB,EAAC,KAAK;AACnC"}},
    {"offset": {"line": 87, "column": 0}, "map": {"version":3,"sources":["file:///C:/Repo/LogsOfN/v0-bid-mate-ai/app/api/tenders/%5Bid%5D/route.ts"],"sourcesContent":["import { createClient } from \"@/lib/supabase/server\"\r\nimport type { NextRequest } from \"next/server\"\r\n\r\nfunction isValidUUID(id: string): boolean {\r\n  const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i\r\n  return uuidRegex.test(id)\r\n}\r\n\r\nexport async function GET(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {\r\n  try {\r\n    const { id } = await params\r\n\r\n    if (!isValidUUID(id)) {\r\n      console.log(\"[v0] Invalid UUID format:\", id)\r\n      return Response.json({ error: \"Invalid tender ID format\" }, { status: 400 })\r\n    }\r\n\r\n    const supabase = await createClient()\r\n\r\n    // 1. Try to fetch from user_tenders (Unified entry point for saved tenders)\r\n    const { data: userTender, error: userError } = await supabase\r\n      .from(\"user_tenders\")\r\n      .select(\"*\")\r\n      .eq(\"id\", id)\r\n      .single()\r\n\r\n    if (userTender && !userError) {\r\n      // It is a saved tender (Custom or Scraped)\r\n\r\n      if (userTender.tender_type === 'custom') {\r\n        // Fetch custom analysis and docs\r\n        const { data: analysis } = await supabase\r\n          .from('user_tender_analysis')\r\n          .select('analysis_data')\r\n          .eq('tender_id', id)\r\n          .single()\r\n\r\n        const { data: documents } = await supabase\r\n          .from('user_tender_documents')\r\n          .select('*')\r\n          .eq('tender_id', id)\r\n\r\n        return Response.json({\r\n          tender: userTender,\r\n          analysis: analysis?.analysis_data || null,\r\n          documents: documents || []\r\n        })\r\n\r\n      } else {\r\n        // It is a saved scraped tender\r\n        // Fetch original scraped data for extra details\r\n        // userTender.tender_id points to scraped_tenders.id\r\n\r\n        const { data: scrapedTender } = await supabase\r\n          .from('scraped_tenders')\r\n          .select('*')\r\n          .eq('id', userTender.tender_id)\r\n          .single()\r\n\r\n        // Fetch original documents\r\n        const { data: documents } = await supabase\r\n          .from('tender_documents')\r\n          .select('*')\r\n          .eq('tender_id', userTender.tender_id)\r\n\r\n        // Fetch user-uploaded documents for this tender\r\n        const { data: userDocuments } = await supabase\r\n          .from('user_tender_documents')\r\n          .select('*')\r\n          .eq('tender_id', id) // id is the user_tenders(id)\r\n\r\n        // Fetch original analysis\r\n        const { data: analysis } = await supabase\r\n          .from('tender_analysis')\r\n          .select('analysis_data')\r\n          .eq('tender_id', userTender.tender_id)\r\n          .single()\r\n\r\n        // Fetch user analysis overrides?\r\n        const { data: userAnalysis } = await supabase\r\n          .from('user_tender_analysis')\r\n          .select('analysis_data')\r\n          .eq('tender_id', id)\r\n          .single()\r\n\r\n        // Merge data: userTender takes precedence for status/metadata, scrapedTender for content\r\n        const mergedTender = {\r\n          ...scrapedTender,\r\n          ...userTender, // Overwrite with user-specifics (id, status, etc.)\r\n          // Ensure we keep the correct titles/desc if user modified them (future proofing)\r\n        }\r\n\r\n        return Response.json({\r\n          tender: mergedTender,\r\n          analysis: userAnalysis?.analysis_data || analysis?.analysis_data || null,\r\n          documents: [...(documents || []), ...(userDocuments || [])]\r\n        })\r\n      }\r\n    }\r\n\r\n    // 2. Fallback: Check scraped_tenders directly\r\n    // This supports viewing details of a tender that hasn't been saved to \"My Tenders\" yet\r\n    const { data: scrapedTenderRaw, error: scrapedError } = await supabase\r\n      .from(\"scraped_tenders\")\r\n      .select(\"*\")\r\n      .eq(\"id\", id)\r\n      .single()\r\n\r\n    if (scrapedTenderRaw && !scrapedError) {\r\n      const { data: documents } = await supabase\r\n        .from('tender_documents')\r\n        .select('*')\r\n        .eq('tender_id', id)\r\n\r\n      const { data: analysis } = await supabase\r\n        .from('tender_analysis')\r\n        .select('analysis_data')\r\n        .eq('tender_id', id)\r\n        .single()\r\n\r\n      return Response.json({\r\n        tender: scrapedTenderRaw,\r\n        analysis: analysis?.analysis_data || null,\r\n        documents: documents || []\r\n      })\r\n    }\r\n\r\n    return Response.json({ error: \"Tender not found\" }, { status: 404 })\r\n  } catch (error) {\r\n    console.error(\"[API] Error fetching tender:\", error)\r\n    return Response.json({ error: \"Failed to fetch tender\" }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}